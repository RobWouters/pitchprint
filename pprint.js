/*!
 * PitchPrint - v8.2.0 - Auto-compiled on 2016-08-29 - Copyright 2016 
 * @author SynergicLabs
 */
(window._gsQueue || (window._gsQueue = [])).push(function() {
        "use strict";
        window._gsDefine("TweenMax", ["core.Animation", "core.SimpleTimeline", "TweenLite"], function(a, b, c) {
                var d = [].slice,
                    e = function(a, b, d) {
                        c.call(this, a, b, d), this._cycle = 0, this._yoyo = this.vars.yoyo === !0, this._repeat = this.vars.repeat || 0, this._repeatDelay = this.vars.repeatDelay || 0, this._dirty = !0, this.render = e.prototype.render
                    },
                    f = function(a) {
                        return a.jquery || a.length && a !== window && a[0] && (a[0] === window || a[0].nodeType && a[0].style && !a.nodeType)
                    },
                    g = e.prototype = c.to({}, .1, {}),
                    h = [];
                e.version = "1.10.3", g.constructor = e, g.kill()._gc = !1, e.killTweensOf = e.killDelayedCallsTo = c.killTweensOf, e.getTweensOf = c.getTweensOf, e.ticker = c.ticker, g.invalidate = function() {
                    return this._yoyo = this.vars.yoyo === !0, this._repeat = this.vars.repeat || 0, this._repeatDelay = this.vars.repeatDelay || 0, this._uncache(!0), c.prototype.invalidate.call(this)
                }, g.updateTo = function(a, b) {
                    var d, e = this.ratio;
                    b && this.timeline && this._startTime < this._timeline._time && (this._startTime = this._timeline._time, this._uncache(!1), this._gc ? this._enabled(!0, !1) : this._timeline.insert(this, this._startTime - this._delay));
                    for (d in a) this.vars[d] = a[d];
                    if (this._initted)
                        if (b) this._initted = !1;
                        else if (this._notifyPluginsOfEnabled && this._firstPT && c._onPluginEvent("_onDisable", this), this._time / this._duration > .998) {
                        var f = this._time;
                        this.render(0, !0, !1), this._initted = !1, this.render(f, !0, !1)
                    } else if (this._time > 0) {
                        this._initted = !1, this._init();
                        for (var g, h = 1 / (1 - e), i = this._firstPT; i;) g = i.s + i.c, i.c *= h, i.s = g - i.c, i = i._next
                    }
                    return this
                }, g.render = function(a, b, c) {
                    var d, e, f, g, i, j, k, l = this._dirty ? this.totalDuration() : this._totalDuration,
                        m = this._time,
                        n = this._totalTime,
                        o = this._cycle;
                    if (a >= l ? (this._totalTime = l, this._cycle = this._repeat, this._yoyo && 0 !== (1 & this._cycle) ? (this._time = 0, this.ratio = this._ease._calcEnd ? this._ease.getRatio(0) : 0) : (this._time = this._duration, this.ratio = this._ease._calcEnd ? this._ease.getRatio(1) : 1), this._reversed || (d = !0, e = "onComplete"), 0 === this._duration && ((0 === a || 0 > this._rawPrevTime) && this._rawPrevTime !== a && (c = !0, this._rawPrevTime > 0 && (e = "onReverseComplete", b && (a = -1))), this._rawPrevTime = a)) : 1e-7 > a ? (this._totalTime = this._time = this._cycle = 0, this.ratio = this._ease._calcEnd ? this._ease.getRatio(0) : 0, (0 !== n || 0 === this._duration && this._rawPrevTime > 0) && (e = "onReverseComplete", d = this._reversed), 0 > a ? (this._active = !1, 0 === this._duration && (this._rawPrevTime >= 0 && (c = !0), this._rawPrevTime = a)) : this._initted || (c = !0)) : (this._totalTime = this._time = a, 0 !== this._repeat && (g = this._duration + this._repeatDelay, this._cycle = this._totalTime / g >> 0, 0 !== this._cycle && this._cycle === this._totalTime / g && this._cycle--, this._time = this._totalTime - this._cycle * g, this._yoyo && 0 !== (1 & this._cycle) && (this._time = this._duration - this._time), this._time > this._duration ? this._time = this._duration : 0 > this._time && (this._time = 0)), this._easeType ? (i = this._time / this._duration, j = this._easeType, k = this._easePower, (1 === j || 3 === j && i >= .5) && (i = 1 - i), 3 === j && (i *= 2), 1 === k ? i *= i : 2 === k ? i *= i * i : 3 === k ? i *= i * i * i : 4 === k && (i *= i * i * i * i), this.ratio = 1 === j ? 1 - i : 2 === j ? i : .5 > this._time / this._duration ? i / 2 : 1 - i / 2) : this.ratio = this._ease.getRatio(this._time / this._duration)), m === this._time && !c) return void(n !== this._totalTime && this._onUpdate && (b || this._onUpdate.apply(this.vars.onUpdateScope || this, this.vars.onUpdateParams || h)));
                    if (!this._initted) {
                        if (this._init(), !this._initted) return;
                        this._time && !d ? this.ratio = this._ease.getRatio(this._time / this._duration) : d && this._ease._calcEnd && (this.ratio = this._ease.getRatio(0 === this._time ? 0 : 1))
                    }
                    for (this._active || !this._paused && this._time !== m && a >= 0 && (this._active = !0), 0 === n && (this._startAt && (a >= 0 ? this._startAt.render(a, b, c) : e || (e = "_dummyGS")), this.vars.onStart && (0 !== this._totalTime || 0 === this._duration) && (b || this.vars.onStart.apply(this.vars.onStartScope || this, this.vars.onStartParams || h))), f = this._firstPT; f;) f.f ? f.t[f.p](f.c * this.ratio + f.s) : f.t[f.p] = f.c * this.ratio + f.s, f = f._next;
                    this._onUpdate && (0 > a && this._startAt && this._startAt.render(a, b, c), b || this._onUpdate.apply(this.vars.onUpdateScope || this, this.vars.onUpdateParams || h)), this._cycle !== o && (b || this._gc || this.vars.onRepeat && this.vars.onRepeat.apply(this.vars.onRepeatScope || this, this.vars.onRepeatParams || h)), e && (this._gc || (0 > a && this._startAt && !this._onUpdate && this._startAt.render(a, b, c), d && (this._timeline.autoRemoveChildren && this._enabled(!1, !1), this._active = !1), !b && this.vars[e] && this.vars[e].apply(this.vars[e + "Scope"] || this, this.vars[e + "Params"] || h)))
                }, e.to = function(a, b, c) {
                    return new e(a, b, c)
                }, e.from = function(a, b, c) {
                    return c.runBackwards = !0, c.immediateRender = 0 != c.immediateRender, new e(a, b, c)
                }, e.fromTo = function(a, b, c, d) {
                    return d.startAt = c, d.immediateRender = 0 != d.immediateRender && 0 != c.immediateRender, new e(a, b, d)
                }, e.staggerTo = e.allTo = function(a, b, g, i, j, k, l) {
                    i = i || 0;
                    var m, n, o, p, q = g.delay || 0,
                        r = [],
                        s = function() {
                            g.onComplete && g.onComplete.apply(g.onCompleteScope || this, arguments), j.apply(l || this, k || h)
                        };
                    for (a instanceof Array || ("string" == typeof a && (a = c.selector(a) || a), f(a) && (a = d.call(a, 0))), m = a.length, o = 0; m > o; o++) {
                        n = {};
                        for (p in g) n[p] = g[p];
                        n.delay = q, o === m - 1 && j && (n.onComplete = s), r[o] = new e(a[o], b, n), q += i
                    }
                    return r
                }, e.staggerFrom = e.allFrom = function(a, b, c, d, f, g, h) {
                    return c.runBackwards = !0, c.immediateRender = 0 != c.immediateRender, e.staggerTo(a, b, c, d, f, g, h)
                }, e.staggerFromTo = e.allFromTo = function(a, b, c, d, f, g, h, i) {
                    return d.startAt = c, d.immediateRender = 0 != d.immediateRender && 0 != c.immediateRender, e.staggerTo(a, b, d, f, g, h, i)
                }, e.delayedCall = function(a, b, c, d, f) {
                    return new e(b, 0, {
                        delay: a,
                        onComplete: b,
                        onCompleteParams: c,
                        onCompleteScope: d,
                        onReverseComplete: b,
                        onReverseCompleteParams: c,
                        onReverseCompleteScope: d,
                        immediateRender: !1,
                        useFrames: f,
                        overwrite: 0
                    })
                }, e.set = function(a, b) {
                    return new e(a, 0, b)
                }, e.isTweening = function(a) {
                    for (var b, d = c.getTweensOf(a), e = d.length; --e > -1;)
                        if (b = d[e], b._active || b._startTime === b._timeline._time && b._timeline._active) return !0;
                    return !1
                };
                var i = function(a, b) {
                        for (var d = [], e = 0, f = a._first; f;) f instanceof c ? d[e++] = f : (b && (d[e++] = f), d = d.concat(i(f, b)), e = d.length), f = f._next;
                        return d
                    },
                    j = e.getAllTweens = function(b) {
                        return i(a._rootTimeline, b).concat(i(a._rootFramesTimeline, b))
                    };
                e.killAll = function(a, c, d, e) {
                    null == c && (c = !0), null == d && (d = !0);
                    var f, g, h, i = j(0 != e),
                        k = i.length,
                        l = c && d && e;
                    for (h = 0; k > h; h++) g = i[h], (l || g instanceof b || (f = g.target === g.vars.onComplete) && d || c && !f) && (a ? g.totalTime(g.totalDuration()) : g._enabled(!1, !1))
                }, e.killChildTweensOf = function(a, b) {
                    if (null != a) {
                        var g, h, i, j, k, l = c._tweenLookup;
                        if ("string" == typeof a && (a = c.selector(a) || a), f(a) && (a = d(a, 0)), a instanceof Array)
                            for (j = a.length; --j > -1;) e.killChildTweensOf(a[j], b);
                        else {
                            g = [];
                            for (i in l)
                                for (h = l[i].target.parentNode; h;) h === a && (g = g.concat(l[i].tweens)), h = h.parentNode;
                            for (k = g.length, j = 0; k > j; j++) b && g[j].totalTime(g[j].totalDuration()), g[j]._enabled(!1, !1)
                        }
                    }
                };
                var k = function(a, c, d, e) {
                    c = c !== !1, d = d !== !1, e = e !== !1;
                    for (var f, g, h = j(e), i = c && d && e, k = h.length; --k > -1;) g = h[k], (i || g instanceof b || (f = g.target === g.vars.onComplete) && d || c && !f) && g.paused(a)
                };
                return e.pauseAll = function(a, b, c) {
                    k(!0, a, b, c)
                }, e.resumeAll = function(a, b, c) {
                    k(!1, a, b, c)
                }, e.globalTimeScale = function(b) {
                    var d = a._rootTimeline,
                        e = c.ticker.time;
                    return arguments.length ? (b = b || 1e-6, d._startTime = e - (e - d._startTime) * d._timeScale / b, d = a._rootFramesTimeline, e = c.ticker.frame, d._startTime = e - (e - d._startTime) * d._timeScale / b, d._timeScale = a._rootTimeline._timeScale = b, b) : d._timeScale
                }, g.progress = function(a) {
                    return arguments.length ? this.totalTime(this.duration() * (this._yoyo && 0 !== (1 & this._cycle) ? 1 - a : a) + this._cycle * (this._duration + this._repeatDelay), !1) : this._time / this.duration()
                }, g.totalProgress = function(a) {
                    return arguments.length ? this.totalTime(this.totalDuration() * a, !1) : this._totalTime / this.totalDuration()
                }, g.time = function(a, b) {
                    return arguments.length ? (this._dirty && this.totalDuration(), a > this._duration && (a = this._duration), this._yoyo && 0 !== (1 & this._cycle) ? a = this._duration - a + this._cycle * (this._duration + this._repeatDelay) : 0 !== this._repeat && (a += this._cycle * (this._duration + this._repeatDelay)), this.totalTime(a, b)) : this._time
                }, g.duration = function(b) {
                    return arguments.length ? a.prototype.duration.call(this, b) : this._duration
                }, g.totalDuration = function(a) {
                    return arguments.length ? -1 === this._repeat ? this : this.duration((a - this._repeat * this._repeatDelay) / (this._repeat + 1)) : (this._dirty && (this._totalDuration = -1 === this._repeat ? 999999999999 : this._duration * (this._repeat + 1) + this._repeatDelay * this._repeat, this._dirty = !1), this._totalDuration)
                }, g.repeat = function(a) {
                    return arguments.length ? (this._repeat = a, this._uncache(!0)) : this._repeat
                }, g.repeatDelay = function(a) {
                    return arguments.length ? (this._repeatDelay = a, this._uncache(!0)) : this._repeatDelay
                }, g.yoyo = function(a) {
                    return arguments.length ? (this._yoyo = a, this) : this._yoyo
                }, e
            }, !0), window._gsDefine("TimelineLite", ["core.Animation", "core.SimpleTimeline", "TweenLite"], function(a, b, c) {
                var d = function(a) {
                        b.call(this, a), this._labels = {}, this.autoRemoveChildren = this.vars.autoRemoveChildren === !0, this.smoothChildTiming = this.vars.smoothChildTiming === !0, this._sortChildren = !0, this._onUpdate = this.vars.onUpdate;
                        var c, d, e = this.vars;
                        for (d in e) c = e[d], c instanceof Array && -1 !== c.join("").indexOf("{self}") && (e[d] = this._swapSelfInParams(c));
                        e.tweens instanceof Array && this.add(e.tweens, 0, e.align, e.stagger)
                    },
                    e = [],
                    f = function(a) {
                        var b, c = {};
                        for (b in a) c[b] = a[b];
                        return c
                    },
                    g = function(a, b, c, d) {
                        a._timeline.pause(a._startTime), b && b.apply(d || a._timeline, c || e)
                    },
                    h = e.slice,
                    i = d.prototype = new b;
                return d.version = "1.10.3", i.constructor = d, i.kill()._gc = !1, i.to = function(a, b, d, e) {
                    return b ? this.add(new c(a, b, d), e) : this.set(a, d, e)
                }, i.from = function(a, b, d, e) {
                    return this.add(c.from(a, b, d), e)
                }, i.fromTo = function(a, b, d, e, f) {
                    return b ? this.add(c.fromTo(a, b, d, e), f) : this.set(a, e, f)
                }, i.staggerTo = function(a, b, e, g, i, j, k, l) {
                    var m, n = new d({
                        onComplete: j,
                        onCompleteParams: k,
                        onCompleteScope: l
                    });
                    for ("string" == typeof a && (a = c.selector(a) || a), !(a instanceof Array) && a.length && a !== window && a[0] && (a[0] === window || a[0].nodeType && a[0].style && !a.nodeType) && (a = h.call(a, 0)), g = g || 0, m = 0; a.length > m; m++) e.startAt && (e.startAt = f(e.startAt)), n.to(a[m], b, f(e), m * g);
                    return this.add(n, i)
                }, i.staggerFrom = function(a, b, c, d, e, f, g, h) {
                    return c.immediateRender = 0 != c.immediateRender, c.runBackwards = !0, this.staggerTo(a, b, c, d, e, f, g, h)
                }, i.staggerFromTo = function(a, b, c, d, e, f, g, h, i) {
                    return d.startAt = c, d.immediateRender = 0 != d.immediateRender && 0 != c.immediateRender, this.staggerTo(a, b, d, e, f, g, h, i)
                }, i.call = function(a, b, d, e) {
                    return this.add(c.delayedCall(0, a, b, d), e)
                }, i.set = function(a, b, d) {
                    return d = this._parseTimeOrLabel(d, 0, !0), null == b.immediateRender && (b.immediateRender = d === this._time && !this._paused), this.add(new c(a, 0, b), d)
                }, d.exportRoot = function(a, b) {
                    a = a || {}, null == a.smoothChildTiming && (a.smoothChildTiming = !0);
                    var e, f, g = new d(a),
                        h = g._timeline;
                    for (null == b && (b = !0), h._remove(g, !0), g._startTime = 0, g._rawPrevTime = g._time = g._totalTime = h._time, e = h._first; e;) f = e._next, b && e instanceof c && e.target === e.vars.onComplete || g.add(e, e._startTime - e._delay), e = f;
                    return h.add(g, 0), g
                }, i.add = function(e, f, g, h) {
                    var i, j, k, l, m, n;
                    if ("number" != typeof f && (f = this._parseTimeOrLabel(f, 0, !0, e)), !(e instanceof a)) {
                        if (e instanceof Array) {
                            for (g = g || "normal", h = h || 0, i = f, j = e.length, k = 0; j > k; k++)(l = e[k]) instanceof Array && (l = new d({
                                tweens: l
                            })), this.add(l, i), "string" != typeof l && "function" != typeof l && ("sequence" === g ? i = l._startTime + l.totalDuration() / l._timeScale : "start" === g && (l._startTime -= l.delay())), i += h;
                            return this._uncache(!0)
                        }
                        if ("string" == typeof e) return this.addLabel(e, f);
                        if ("function" != typeof e) throw "Cannot add " + e + " into the timeline; it is not a tween, timeline, function, or string.";
                        e = c.delayedCall(0, e)
                    }
                    if (b.prototype.add.call(this, e, f), this._gc && !this._paused && this._duration < this.duration())
                        for (m = this, n = m.rawTime() > e._startTime; m._gc && m._timeline;) m._timeline.smoothChildTiming && n ? m.totalTime(m._totalTime, !0) : m._enabled(!0, !1), m = m._timeline;
                    return this
                }, i.remove = function(b) {
                    if (b instanceof a) return this._remove(b, !1);
                    if (b instanceof Array) {
                        for (var c = b.length; --c > -1;) this.remove(b[c]);
                        return this
                    }
                    return "string" == typeof b ? this.removeLabel(b) : this.kill(null, b)
                }, i._remove = function(a, c) {
                    return b.prototype._remove.call(this, a, c), this._last ? this._time > this._last._startTime && (this._time = this.duration(), this._totalTime = this._totalDuration) : this._time = this._totalTime = 0, this
                }, i.append = function(a, b) {
                    return this.add(a, this._parseTimeOrLabel(null, b, !0, a))
                }, i.insert = i.insertMultiple = function(a, b, c, d) {
                    return this.add(a, b || 0, c, d)
                }, i.appendMultiple = function(a, b, c, d) {
                    return this.add(a, this._parseTimeOrLabel(null, b, !0, a), c, d)
                }, i.addLabel = function(a, b) {
                    return this._labels[a] = this._parseTimeOrLabel(b), this
                }, i.addPause = function(a, b, c, d) {
                    return this.call(g, ["{self}", b, c, d], this, a)
                }, i.removeLabel = function(a) {
                    return delete this._labels[a], this
                }, i.getLabelTime = function(a) {
                    return null != this._labels[a] ? this._labels[a] : -1
                }, i._parseTimeOrLabel = function(b, c, d, e) {
                    var f;
                    if (e instanceof a && e.timeline === this) this.remove(e);
                    else if (e instanceof Array)
                        for (f = e.length; --f > -1;) e[f] instanceof a && e[f].timeline === this && this.remove(e[f]);
                    if ("string" == typeof c) return this._parseTimeOrLabel(c, d && "number" == typeof b && null == this._labels[c] ? b - this.duration() : 0, d);
                    if (c = c || 0, "string" != typeof b || !isNaN(b) && null == this._labels[b]) null == b && (b = this.duration());
                    else {
                        if (f = b.indexOf("="), -1 === f) return null == this._labels[b] ? d ? this._labels[b] = this.duration() + c : c : this._labels[b] + c;
                        c = parseInt(b.charAt(f - 1) + "1", 10) * Number(b.substr(f + 1)), b = f > 1 ? this._parseTimeOrLabel(b.substr(0, f - 1), 0, d) : this.duration()
                    }
                    return Number(b) + c
                }, i.seek = function(a, b) {
                    return this.totalTime("number" == typeof a ? a : this._parseTimeOrLabel(a), b !== !1)
                }, i.stop = function() {
                    return this.paused(!0)
                }, i.gotoAndPlay = function(a, b) {
                    return this.play(a, b)
                }, i.gotoAndStop = function(a, b) {
                    return this.pause(a, b)
                }, i.render = function(a, b, c) {
                    this._gc && this._enabled(!0, !1);
                    var d, f, g, h, i, j = this._dirty ? this.totalDuration() : this._totalDuration,
                        k = this._time,
                        l = this._startTime,
                        m = this._timeScale,
                        n = this._paused;
                    if (a >= j ? (this._totalTime = this._time = j, this._reversed || this._hasPausedChild() || (f = !0, h = "onComplete", 0 === this._duration && (0 === a || 0 > this._rawPrevTime) && this._rawPrevTime !== a && this._first && (i = !0, this._rawPrevTime > 0 && (h = "onReverseComplete"))), this._rawPrevTime = a, a = j + 1e-6) : 1e-7 > a ? (this._totalTime = this._time = 0, (0 !== k || 0 === this._duration && this._rawPrevTime > 0) && (h = "onReverseComplete", f = this._reversed), 0 > a ? (this._active = !1, 0 === this._duration && this._rawPrevTime >= 0 && this._first && (i = !0), this._rawPrevTime = a) : (this._rawPrevTime = a, a = 0, this._initted || (i = !0))) : this._totalTime = this._time = this._rawPrevTime = a, this._time !== k && this._first || c || i) {
                        if (this._initted || (this._initted = !0), this._active || !this._paused && this._time !== k && a > 0 && (this._active = !0), 0 === k && this.vars.onStart && 0 !== this._time && (b || this.vars.onStart.apply(this.vars.onStartScope || this, this.vars.onStartParams || e)), this._time >= k)
                            for (d = this._first; d && (g = d._next, !this._paused || n);)(d._active || d._startTime <= this._time && !d._paused && !d._gc) && (d._reversed ? d.render((d._dirty ? d.totalDuration() : d._totalDuration) - (a - d._startTime) * d._timeScale, b, c) : d.render((a - d._startTime) * d._timeScale, b, c)), d = g;
                        else
                            for (d = this._last; d && (g = d._prev, !this._paused || n);)(d._active || k >= d._startTime && !d._paused && !d._gc) && (d._reversed ? d.render((d._dirty ? d.totalDuration() : d._totalDuration) - (a - d._startTime) * d._timeScale, b, c) : d.render((a - d._startTime) * d._timeScale, b, c)), d = g;
                        this._onUpdate && (b || this._onUpdate.apply(this.vars.onUpdateScope || this, this.vars.onUpdateParams || e)), h && (this._gc || (l === this._startTime || m !== this._timeScale) && (0 === this._time || j >= this.totalDuration()) && (f && (this._timeline.autoRemoveChildren && this._enabled(!1, !1), this._active = !1), !b && this.vars[h] && this.vars[h].apply(this.vars[h + "Scope"] || this, this.vars[h + "Params"] || e)))
                    }
                }, i._hasPausedChild = function() {
                    for (var a = this._first; a;) {
                        if (a._paused || a instanceof d && a._hasPausedChild()) return !0;
                        a = a._next
                    }
                    return !1
                }, i.getChildren = function(a, b, d, e) {
                    e = e || -9999999999;
                    for (var f = [], g = this._first, h = 0; g;) e > g._startTime || (g instanceof c ? b !== !1 && (f[h++] = g) : (d !== !1 && (f[h++] = g), a !== !1 && (f = f.concat(g.getChildren(!0, b, d)), h = f.length))), g = g._next;
                    return f
                }, i.getTweensOf = function(a, b) {
                    for (var d = c.getTweensOf(a), e = d.length, f = [], g = 0; --e > -1;)(d[e].timeline === this || b && this._contains(d[e])) && (f[g++] = d[e]);
                    return f
                }, i._contains = function(a) {
                    for (var b = a.timeline; b;) {
                        if (b === this) return !0;
                        b = b.timeline
                    }
                    return !1
                }, i.shiftChildren = function(a, b, c) {
                    c = c || 0;
                    for (var d, e = this._first, f = this._labels; e;) e._startTime >= c && (e._startTime += a), e = e._next;
                    if (b)
                        for (d in f) f[d] >= c && (f[d] += a);
                    return this._uncache(!0)
                }, i._kill = function(a, b) {
                    if (!a && !b) return this._enabled(!1, !1);
                    for (var c = b ? this.getTweensOf(b) : this.getChildren(!0, !0, !1), d = c.length, e = !1; --d > -1;) c[d]._kill(a, b) && (e = !0);
                    return e
                }, i.clear = function(a) {
                    var b = this.getChildren(!1, !0, !0),
                        c = b.length;
                    for (this._time = this._totalTime = 0; --c > -1;) b[c]._enabled(!1, !1);
                    return a !== !1 && (this._labels = {}), this._uncache(!0)
                }, i.invalidate = function() {
                    for (var a = this._first; a;) a.invalidate(), a = a._next;
                    return this
                }, i._enabled = function(a, c) {
                    if (a === this._gc)
                        for (var d = this._first; d;) d._enabled(a, !0), d = d._next;
                    return b.prototype._enabled.call(this, a, c)
                }, i.progress = function(a) {
                    return arguments.length ? this.totalTime(this.duration() * a, !1) : this._time / this.duration()
                }, i.duration = function(a) {
                    return arguments.length ? (0 !== this.duration() && 0 !== a && this.timeScale(this._duration / a), this) : (this._dirty && this.totalDuration(), this._duration)
                }, i.totalDuration = function(a) {
                    if (!arguments.length) {
                        if (this._dirty) {
                            for (var b, c, d = 0, e = this._last, f = 999999999999; e;) b = e._prev, e._dirty && e.totalDuration(), e._startTime > f && this._sortChildren && !e._paused ? this.add(e, e._startTime - e._delay) : f = e._startTime, 0 > e._startTime && !e._paused && (d -= e._startTime, this._timeline.smoothChildTiming && (this._startTime += e._startTime / this._timeScale), this.shiftChildren(-e._startTime, !1, -9999999999), f = 0), c = e._startTime + e._totalDuration / e._timeScale, c > d && (d = c), e = b;
                            this._duration = this._totalDuration = d, this._dirty = !1
                        }
                        return this._totalDuration
                    }
                    return 0 !== this.totalDuration() && 0 !== a && this.timeScale(this._totalDuration / a), this
                }, i.usesFrames = function() {
                    for (var b = this._timeline; b._timeline;) b = b._timeline;
                    return b === a._rootFramesTimeline
                }, i.rawTime = function() {
                    return this._paused ? this._totalTime : (this._timeline.rawTime() - this._startTime) * this._timeScale
                }, d
            }, !0), window._gsDefine("TimelineMax", ["TimelineLite", "TweenLite", "easing.Ease"], function(a, b, c) {
                var d = function(b) {
                        a.call(this, b), this._repeat = this.vars.repeat || 0, this._repeatDelay = this.vars.repeatDelay || 0, this._cycle = 0, this._yoyo = this.vars.yoyo === !0, this._dirty = !0
                    },
                    e = [],
                    f = new c(null, null, 1, 0),
                    g = function(a) {
                        for (; a;) {
                            if (a._paused) return !0;
                            a = a._timeline
                        }
                        return !1
                    },
                    h = d.prototype = new a;
                return h.constructor = d, h.kill()._gc = !1, d.version = "1.10.3", h.invalidate = function() {
                    return this._yoyo = this.vars.yoyo === !0, this._repeat = this.vars.repeat || 0, this._repeatDelay = this.vars.repeatDelay || 0, this._uncache(!0), a.prototype.invalidate.call(this)
                }, h.addCallback = function(a, c, d, e) {
                    return this.add(b.delayedCall(0, a, d, e), c)
                }, h.removeCallback = function(a, b) {
                    if (a)
                        if (null == b) this._kill(null, a);
                        else
                            for (var c = this.getTweensOf(a, !1), d = c.length, e = this._parseTimeOrLabel(b); --d > -1;) c[d]._startTime === e && c[d]._enabled(!1, !1);
                    return this
                }, h.tweenTo = function(a, c) {
                    c = c || {};
                    var d, g, h = {
                        ease: f,
                        overwrite: 2,
                        useFrames: this.usesFrames(),
                        immediateRender: !1
                    };
                    for (d in c) h[d] = c[d];
                    return h.time = this._parseTimeOrLabel(a), g = new b(this, Math.abs(Number(h.time) - this._time) / this._timeScale || .001, h), h.onStart = function() {
                        g.target.paused(!0), g.vars.time !== g.target.time() && g.duration(Math.abs(g.vars.time - g.target.time()) / g.target._timeScale), c.onStart && c.onStart.apply(c.onStartScope || g, c.onStartParams || e)
                    }, g
                }, h.tweenFromTo = function(a, b, c) {
                    c = c || {}, a = this._parseTimeOrLabel(a), c.startAt = {
                        onComplete: this.seek,
                        onCompleteParams: [a],
                        onCompleteScope: this
                    }, c.immediateRender = c.immediateRender !== !1;
                    var d = this.tweenTo(b, c);
                    return d.duration(Math.abs(d.vars.time - a) / this._timeScale || .001)
                }, h.render = function(a, b, c) {
                    this._gc && this._enabled(!0, !1);
                    var d, f, g, h, i, j, k = this._dirty ? this.totalDuration() : this._totalDuration,
                        l = this._duration,
                        m = this._time,
                        n = this._totalTime,
                        o = this._startTime,
                        p = this._timeScale,
                        q = this._rawPrevTime,
                        r = this._paused,
                        s = this._cycle;
                    if (a >= k ? (this._locked || (this._totalTime = k, this._cycle = this._repeat), this._reversed || this._hasPausedChild() || (f = !0, h = "onComplete", 0 === l && (0 === a || 0 > this._rawPrevTime) && this._rawPrevTime !== a && this._first && (i = !0, this._rawPrevTime > 0 && (h = "onReverseComplete"))), this._rawPrevTime = a, this._yoyo && 0 !== (1 & this._cycle) ? this._time = a = 0 : (this._time = l, a = l + 1e-6)) : 1e-7 > a ? (this._locked || (this._totalTime = this._cycle = 0), this._time = 0, (0 !== m || 0 === l && this._rawPrevTime > 0 && !this._locked) && (h = "onReverseComplete", f = this._reversed), 0 > a ? (this._active = !1, 0 === l && this._rawPrevTime >= 0 && this._first && (i = !0), this._rawPrevTime = a) : (this._rawPrevTime = a, a = 0, this._initted || (i = !0))) : (this._time = this._rawPrevTime = a, this._locked || (this._totalTime = a, 0 !== this._repeat && (j = l + this._repeatDelay, this._cycle = this._totalTime / j >> 0, 0 !== this._cycle && this._cycle === this._totalTime / j && this._cycle--, this._time = this._totalTime - this._cycle * j, this._yoyo && 0 !== (1 & this._cycle) && (this._time = l - this._time), this._time > l ? (this._time = l, a = l + 1e-6) : 0 > this._time ? this._time = a = 0 : a = this._time))), this._cycle !== s && !this._locked) {
                        var t = this._yoyo && 0 !== (1 & s),
                            u = t === (this._yoyo && 0 !== (1 & this._cycle)),
                            v = this._totalTime,
                            w = this._cycle,
                            x = this._rawPrevTime,
                            y = this._time;
                        if (this._totalTime = s * l, s > this._cycle ? t = !t : this._totalTime += l, this._time = m, this._rawPrevTime = 0 === l ? q - 1e-5 : q, this._cycle = s, this._locked = !0, m = t ? 0 : l, this.render(m, b, 0 === l), b || this._gc || this.vars.onRepeat && this.vars.onRepeat.apply(this.vars.onRepeatScope || this, this.vars.onRepeatParams || e), u && (m = t ? l + 1e-6 : -1e-6, this.render(m, !0, !1)), this._locked = !1, this._paused && !r) return;
                        this._time = y, this._totalTime = v, this._cycle = w, this._rawPrevTime = x
                    }
                    if (!(this._time !== m && this._first || c || i)) return void(n !== this._totalTime && this._onUpdate && (b || this._onUpdate.apply(this.vars.onUpdateScope || this, this.vars.onUpdateParams || e)));
                    if (this._initted || (this._initted = !0), this._active || !this._paused && this._totalTime !== n && a > 0 && (this._active = !0), 0 === n && this.vars.onStart && 0 !== this._totalTime && (b || this.vars.onStart.apply(this.vars.onStartScope || this, this.vars.onStartParams || e)), this._time >= m)
                        for (d = this._first; d && (g = d._next, !this._paused || r);)(d._active || d._startTime <= this._time && !d._paused && !d._gc) && (d._reversed ? d.render((d._dirty ? d.totalDuration() : d._totalDuration) - (a - d._startTime) * d._timeScale, b, c) : d.render((a - d._startTime) * d._timeScale, b, c)), d = g;
                    else
                        for (d = this._last; d && (g = d._prev, !this._paused || r);)(d._active || m >= d._startTime && !d._paused && !d._gc) && (d._reversed ? d.render((d._dirty ? d.totalDuration() : d._totalDuration) - (a - d._startTime) * d._timeScale, b, c) : d.render((a - d._startTime) * d._timeScale, b, c)), d = g;
                    this._onUpdate && (b || this._onUpdate.apply(this.vars.onUpdateScope || this, this.vars.onUpdateParams || e)), h && (this._locked || this._gc || (o === this._startTime || p !== this._timeScale) && (0 === this._time || k >= this.totalDuration()) && (f && (this._timeline.autoRemoveChildren && this._enabled(!1, !1), this._active = !1), !b && this.vars[h] && this.vars[h].apply(this.vars[h + "Scope"] || this, this.vars[h + "Params"] || e)))
                }, h.getActive = function(a, b, c) {
                    null == a && (a = !0), null == b && (b = !0), null == c && (c = !1);
                    var d, e, f = [],
                        h = this.getChildren(a, b, c),
                        i = 0,
                        j = h.length;
                    for (d = 0; j > d; d++) e = h[d], e._paused || e._timeline._time >= e._startTime && e._timeline._time < e._startTime + e._totalDuration / e._timeScale && (g(e._timeline) || (f[i++] = e));
                    return f
                }, h.getLabelAfter = function(a) {
                    a || 0 !== a && (a = this._time);
                    var b, c = this.getLabelsArray(),
                        d = c.length;
                    for (b = 0; d > b; b++)
                        if (c[b].time > a) return c[b].name;
                    return null
                }, h.getLabelBefore = function(a) {
                    null == a && (a = this._time);
                    for (var b = this.getLabelsArray(), c = b.length; --c > -1;)
                        if (a > b[c].time) return b[c].name;
                    return null
                }, h.getLabelsArray = function() {
                    var a, b = [],
                        c = 0;
                    for (a in this._labels) b[c++] = {
                        time: this._labels[a],
                        name: a
                    };
                    return b.sort(function(a, b) {
                        return a.time - b.time
                    }), b
                }, h.progress = function(a) {
                    return arguments.length ? this.totalTime(this.duration() * (this._yoyo && 0 !== (1 & this._cycle) ? 1 - a : a) + this._cycle * (this._duration + this._repeatDelay), !1) : this._time / this.duration()
                }, h.totalProgress = function(a) {
                    return arguments.length ? this.totalTime(this.totalDuration() * a, !1) : this._totalTime / this.totalDuration()
                }, h.totalDuration = function(b) {
                    return arguments.length ? -1 === this._repeat ? this : this.duration((b - this._repeat * this._repeatDelay) / (this._repeat + 1)) : (this._dirty && (a.prototype.totalDuration.call(this), this._totalDuration = -1 === this._repeat ? 999999999999 : this._duration * (this._repeat + 1) + this._repeatDelay * this._repeat), this._totalDuration)
                }, h.time = function(a, b) {
                    return arguments.length ? (this._dirty && this.totalDuration(), a > this._duration && (a = this._duration), this._yoyo && 0 !== (1 & this._cycle) ? a = this._duration - a + this._cycle * (this._duration + this._repeatDelay) : 0 !== this._repeat && (a += this._cycle * (this._duration + this._repeatDelay)), this.totalTime(a, b)) : this._time
                }, h.repeat = function(a) {
                    return arguments.length ? (this._repeat = a, this._uncache(!0)) : this._repeat
                }, h.repeatDelay = function(a) {
                    return arguments.length ? (this._repeatDelay = a, this._uncache(!0)) : this._repeatDelay
                }, h.yoyo = function(a) {
                    return arguments.length ? (this._yoyo = a, this) : this._yoyo
                }, h.currentLabel = function(a) {
                    return arguments.length ? this.seek(a, !0) : this.getLabelBefore(this._time + 1e-8)
                }, d
            }, !0),
            function() {
                var a = 180 / Math.PI,
                    b = Math.PI / 180,
                    c = [],
                    d = [],
                    e = [],
                    f = {},
                    g = function(a, b, c, d) {
                        this.a = a, this.b = b, this.c = c, this.d = d, this.da = d - a, this.ca = c - a, this.ba = b - a
                    },
                    h = ",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",
                    i = function(a, b, c, d) {
                        var e = {
                                a: a
                            },
                            f = {},
                            g = {},
                            h = {
                                c: d
                            },
                            i = (a + b) / 2,
                            j = (b + c) / 2,
                            k = (c + d) / 2,
                            l = (i + j) / 2,
                            m = (j + k) / 2,
                            n = (m - l) / 8;
                        return e.b = i + (a - i) / 4, f.b = l + n, e.c = f.a = (e.b + f.b) / 2, f.c = g.a = (l + m) / 2, g.b = m - n, h.b = k + (d - k) / 4, g.c = h.a = (g.b + h.b) / 2, [e, f, g, h]
                    },
                    j = function(a, b, f, g, h) {
                        var j, k, l, m, n, o, p, q, r, s, t, u, v, w = a.length - 1,
                            x = 0,
                            y = a[0].a;
                        for (j = 0; w > j; j++) n = a[x], k = n.a, l = n.d, m = a[x + 1].d, h ? (t = c[j], u = d[j], v = .25 * (u + t) * b / (g ? .5 : e[j] || .5), o = l - (l - k) * (g ? .5 * b : 0 !== t ? v / t : 0), p = l + (m - l) * (g ? .5 * b : 0 !== u ? v / u : 0), q = l - (o + ((p - o) * (3 * t / (t + u) + .5) / 4 || 0))) : (o = l - .5 * (l - k) * b, p = l + .5 * (m - l) * b, q = l - (o + p) / 2), o += q, p += q, n.c = r = o, n.b = 0 !== j ? y : y = n.a + .6 * (n.c - n.a), n.da = l - k, n.ca = r - k, n.ba = y - k, f ? (s = i(k, y, r, l), a.splice(x, 1, s[0], s[1], s[2], s[3]), x += 4) : x++, y = p;
                        n = a[x], n.b = y, n.c = y + .4 * (n.d - y), n.da = n.d - n.a, n.ca = n.c - n.a, n.ba = y - n.a, f && (s = i(n.a, y, n.c, n.d), a.splice(x, 1, s[0], s[1], s[2], s[3]))
                    },
                    k = function(a, b, e, f) {
                        var h, i, j, k, l, m, n = [];
                        if (f)
                            for (a = [f].concat(a), i = a.length; --i > -1;) "string" == typeof(m = a[i][b]) && "=" === m.charAt(1) && (a[i][b] = f[b] + Number(m.charAt(0) + m.substr(2)));
                        if (h = a.length - 2, 0 > h) return n[0] = new g(a[0][b], 0, 0, a[-1 > h ? 0 : 1][b]), n;
                        for (i = 0; h > i; i++) j = a[i][b], k = a[i + 1][b], n[i] = new g(j, 0, 0, k), e && (l = a[i + 2][b], c[i] = (c[i] || 0) + (k - j) * (k - j), d[i] = (d[i] || 0) + (l - k) * (l - k));
                        return n[i] = new g(a[i][b], 0, 0, a[i + 1][b]), n
                    },
                    l = function(a, b, g, i, l, m) {
                        var n, o, p, q, r, s, t, u, v = {},
                            w = [],
                            x = m || a[0];
                        l = "string" == typeof l ? "," + l + "," : h, null == b && (b = 1);
                        for (o in a[0]) w.push(o);
                        if (a.length > 1) {
                            for (u = a[a.length - 1], t = !0, n = w.length; --n > -1;)
                                if (o = w[n], Math.abs(x[o] - u[o]) > .05) {
                                    t = !1;
                                    break
                                }
                            t && (a = a.concat(), m && a.unshift(m), a.push(a[1]), m = a[a.length - 3])
                        }
                        for (c.length = d.length = e.length = 0, n = w.length; --n > -1;) o = w[n], f[o] = -1 !== l.indexOf("," + o + ","), v[o] = k(a, o, f[o], m);
                        for (n = c.length; --n > -1;) c[n] = Math.sqrt(c[n]), d[n] = Math.sqrt(d[n]);
                        if (!i) {
                            for (n = w.length; --n > -1;)
                                if (f[o])
                                    for (p = v[w[n]], s = p.length - 1, q = 0; s > q; q++) r = p[q + 1].da / d[q] + p[q].da / c[q], e[q] = (e[q] || 0) + r * r;
                            for (n = e.length; --n > -1;) e[n] = Math.sqrt(e[n])
                        }
                        for (n = w.length, q = g ? 4 : 1; --n > -1;) o = w[n], p = v[o], j(p, b, g, i, f[o]), t && (p.splice(0, q), p.splice(p.length - q, q));
                        return v
                    },
                    m = function(a, b, c) {
                        b = b || "soft";
                        var d, e, f, h, i, j, k, l, m, n, o, p = {},
                            q = "cubic" === b ? 3 : 2,
                            r = "soft" === b,
                            s = [];
                        if (r && c && (a = [c].concat(a)), null == a || q + 1 > a.length) throw "invalid Bezier data";
                        for (m in a[0]) s.push(m);
                        for (j = s.length; --j > -1;) {
                            for (m = s[j], p[m] = i = [], n = 0, l = a.length, k = 0; l > k; k++) d = null == c ? a[k][m] : "string" == typeof(o = a[k][m]) && "=" === o.charAt(1) ? c[m] + Number(o.charAt(0) + o.substr(2)) : Number(o), r && k > 1 && l - 1 > k && (i[n++] = (d + i[n - 2]) / 2), i[n++] = d;
                            for (l = n - q + 1, n = 0, k = 0; l > k; k += q) d = i[k], e = i[k + 1], f = i[k + 2], h = 2 === q ? 0 : i[k + 3], i[n++] = o = 3 === q ? new g(d, e, f, h) : new g(d, (2 * e + d) / 3, (2 * e + f) / 3, f);
                            i.length = n
                        }
                        return p
                    },
                    n = function(a, b, c) {
                        for (var d, e, f, g, h, i, j, k, l, m, n, o = 1 / c, p = a.length; --p > -1;)
                            for (m = a[p], f = m.a, g = m.d - f, h = m.c - f, i = m.b - f, d = e = 0, k = 1; c >= k; k++) j = o * k, l = 1 - j, d = e - (e = (j * j * g + 3 * l * (j * h + l * i)) * j), n = p * c + k - 1, b[n] = (b[n] || 0) + d * d
                    },
                    o = function(a, b) {
                        b = b >> 0 || 6;
                        var c, d, e, f, g = [],
                            h = [],
                            i = 0,
                            j = 0,
                            k = b - 1,
                            l = [],
                            m = [];
                        for (c in a) n(a[c], g, b);
                        for (e = g.length, d = 0; e > d; d++) i += Math.sqrt(g[d]), f = d % b, m[f] = i, f === k && (j += i, f = d / b >> 0, l[f] = m, h[f] = j, i = 0, m = []);
                        return {
                            length: j,
                            lengths: h,
                            segments: l
                        }
                    },
                    p = window._gsDefine.plugin({
                        propName: "bezier",
                        priority: -1,
                        API: 2,
                        global: !0,
                        init: function(a, b, c) {
                            this._target = a, b instanceof Array && (b = {
                                values: b
                            }), this._func = {}, this._round = {}, this._props = [], this._timeRes = null == b.timeResolution ? 6 : parseInt(b.timeResolution, 10);
                            var d, e, f, g, h, i = b.values || [],
                                j = {},
                                k = i[0],
                                n = b.autoRotate || c.vars.orientToBezier;
                            this._autoRotate = n ? n instanceof Array ? n : [
                                ["x", "y", "rotation", n === !0 ? 0 : Number(n) || 0]
                            ] : null;
                            for (d in k) this._props.push(d);
                            for (f = this._props.length; --f > -1;) d = this._props[f], this._overwriteProps.push(d), e = this._func[d] = "function" == typeof a[d], j[d] = e ? a[d.indexOf("set") || "function" != typeof a["get" + d.substr(3)] ? d : "get" + d.substr(3)]() : parseFloat(a[d]), h || j[d] !== i[0][d] && (h = j);
                            if (this._beziers = "cubic" !== b.type && "quadratic" !== b.type && "soft" !== b.type ? l(i, isNaN(b.curviness) ? 1 : b.curviness, !1, "thruBasic" === b.type, b.correlate, h) : m(i, b.type, j), this._segCount = this._beziers[d].length, this._timeRes) {
                                var p = o(this._beziers, this._timeRes);
                                this._length = p.length, this._lengths = p.lengths, this._segments = p.segments, this._l1 = this._li = this._s1 = this._si = 0, this._l2 = this._lengths[0], this._curSeg = this._segments[0], this._s2 = this._curSeg[0], this._prec = 1 / this._curSeg.length
                            }
                            if (n = this._autoRotate)
                                for (n[0] instanceof Array || (this._autoRotate = n = [n]), f = n.length; --f > -1;)
                                    for (g = 0; 3 > g; g++) d = n[f][g], this._func[d] = "function" == typeof a[d] ? a[d.indexOf("set") || "function" != typeof a["get" + d.substr(3)] ? d : "get" + d.substr(3)] : !1;
                            return !0
                        },
                        set: function(b) {
                            var c, d, e, f, g, h, i, j, k, l, m = this._segCount,
                                n = this._func,
                                o = this._target;
                            if (this._timeRes) {
                                if (k = this._lengths, l = this._curSeg, b *= this._length, e = this._li, b > this._l2 && m - 1 > e) {
                                    for (j = m - 1; j > e && b >= (this._l2 = k[++e]););
                                    this._l1 = k[e - 1], this._li = e, this._curSeg = l = this._segments[e], this._s2 = l[this._s1 = this._si = 0]
                                } else if (this._l1 > b && e > 0) {
                                    for (; e > 0 && (this._l1 = k[--e]) >= b;);
                                    0 === e && this._l1 > b ? this._l1 = 0 : e++, this._l2 = k[e], this._li = e, this._curSeg = l = this._segments[e], this._s1 = l[(this._si = l.length - 1) - 1] || 0, this._s2 = l[this._si]
                                }
                                if (c = e, b -= this._l1, e = this._si, b > this._s2 && l.length - 1 > e) {
                                    for (j = l.length - 1; j > e && b >= (this._s2 = l[++e]););
                                    this._s1 = l[e - 1], this._si = e
                                } else if (this._s1 > b && e > 0) {
                                    for (; e > 0 && (this._s1 = l[--e]) >= b;);
                                    0 === e && this._s1 > b ? this._s1 = 0 : e++, this._s2 = l[e], this._si = e
                                }
                                h = (e + (b - this._s1) / (this._s2 - this._s1)) * this._prec
                            } else c = 0 > b ? 0 : b >= 1 ? m - 1 : m * b >> 0, h = (b - c * (1 / m)) * m;
                            for (d = 1 - h, e = this._props.length; --e > -1;) f = this._props[e], g = this._beziers[f][c], i = (h * h * g.da + 3 * d * (h * g.ca + d * g.ba)) * h + g.a, this._round[f] && (i = i + (i > 0 ? .5 : -.5) >> 0), n[f] ? o[f](i) : o[f] = i;
                            if (this._autoRotate) {
                                var p, q, r, s, t, u, v, w = this._autoRotate;
                                for (e = w.length; --e > -1;) f = w[e][2], u = w[e][3] || 0, v = w[e][4] === !0 ? 1 : a, g = this._beziers[w[e][0]], p = this._beziers[w[e][1]], g && p && (g = g[c], p = p[c], q = g.a + (g.b - g.a) * h, s = g.b + (g.c - g.b) * h, q += (s - q) * h, s += (g.c + (g.d - g.c) * h - s) * h, r = p.a + (p.b - p.a) * h, t = p.b + (p.c - p.b) * h, r += (t - r) * h, t += (p.c + (p.d - p.c) * h - t) * h, i = Math.atan2(t - r, s - q) * v + u, n[f] ? o[f](i) : o[f] = i)
                            }
                        }
                    }),
                    q = p.prototype;
                p.bezierThrough = l, p.cubicToQuadratic = i, p._autoCSS = !0, p.quadraticToCubic = function(a, b, c) {
                    return new g(a, (2 * b + a) / 3, (2 * b + c) / 3, c)
                }, p._cssRegister = function() {
                    var a = window._gsDefine.globals.CSSPlugin;
                    if (a) {
                        var c = a._internals,
                            d = c._parseToProxy,
                            e = c._setPluginRatio,
                            f = c.CSSPropTween;
                        c._registerComplexSpecialProp("bezier", {
                            parser: function(a, c, g, h, i, j) {
                                c instanceof Array && (c = {
                                    values: c
                                }), j = new p;
                                var k, l, m, n = c.values,
                                    o = n.length - 1,
                                    q = [],
                                    r = {};
                                if (0 > o) return i;
                                for (k = 0; o >= k; k++) m = d(a, n[k], h, i, j, o !== k), q[k] = m.end;
                                for (l in c) r[l] = c[l];
                                return r.values = q, i = new f(a, "bezier", 0, 0, m.pt, 2), i.data = m, i.plugin = j, i.setRatio = e, 0 === r.autoRotate && (r.autoRotate = !0), !r.autoRotate || r.autoRotate instanceof Array || (k = r.autoRotate === !0 ? 0 : Number(r.autoRotate) * b, r.autoRotate = null != m.end.left ? [
                                        ["left", "top", "rotation", k, !0]
                                    ] : null != m.end.x ? [
                                        ["x", "y", "rotation", k, !0]
                                    ] : !1),
                                    r.autoRotate && (h._transform || h._enableTransforms(!1), m.autoRotate = h._target._gsTransform), j._onInitTween(m.proxy, r, h._tween), i
                            }
                        })
                    }
                }, q._roundProps = function(a, b) {
                    for (var c = this._overwriteProps, d = c.length; --d > -1;)(a[c[d]] || a.bezier || a.bezierThrough) && (this._round[c[d]] = b)
                }, q._kill = function(a) {
                    var b, c, d = this._props;
                    for (b in this._beziers)
                        if (b in a)
                            for (delete this._beziers[b], delete this._func[b], c = d.length; --c > -1;) d[c] === b && d.splice(c, 1);
                    return this._super._kill.call(this, a)
                }
            }(), window._gsDefine("plugins.CSSPlugin", ["plugins.TweenPlugin", "TweenLite"], function(a, b) {
                var c, d, e, f, g = function() {
                        a.call(this, "css"), this._overwriteProps.length = 0, this.setRatio = g.prototype.setRatio
                    },
                    h = {},
                    i = g.prototype = new a("css");
                i.constructor = g, g.version = "1.10.3", g.API = 2, g.defaultTransformPerspective = 0, i = "px", g.suffixMap = {
                    top: i,
                    right: i,
                    bottom: i,
                    left: i,
                    width: i,
                    height: i,
                    fontSize: i,
                    padding: i,
                    margin: i,
                    perspective: i
                };
                var j, k, l, m, n, o, p = /(?:\d|\-\d|\.\d|\-\.\d)+/g,
                    q = /(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,
                    r = /(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,
                    s = /[^\d\-\.]/g,
                    t = /(?:\d|\-|\+|=|#|\.)*/g,
                    u = /opacity *= *([^)]*)/,
                    v = /opacity:([^;]*)/,
                    w = /alpha\(opacity *=.+?\)/i,
                    x = /^(rgb|hsl)/,
                    y = /([A-Z])/g,
                    z = /-([a-z])/gi,
                    A = /(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,
                    B = function(a, b) {
                        return b.toUpperCase()
                    },
                    C = /(?:Left|Right|Width)/i,
                    D = /(M11|M12|M21|M22)=[\d\-\.e]+/gi,
                    E = /progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,
                    F = /,(?=[^\)]*(?:\(|$))/gi,
                    G = Math.PI / 180,
                    H = 180 / Math.PI,
                    I = {},
                    J = document,
                    K = J.createElement("div"),
                    L = J.createElement("img"),
                    M = g._internals = {
                        _specialProps: h
                    },
                    N = navigator.userAgent,
                    O = function() {
                        var a, b = N.indexOf("Android"),
                            c = J.createElement("div");
                        return l = -1 !== N.indexOf("Safari") && -1 === N.indexOf("Chrome") && (-1 === b || Number(N.substr(b + 8, 1)) > 3), n = l && 6 > Number(N.substr(N.indexOf("Version/") + 8, 1)), m = -1 !== N.indexOf("Firefox"), /MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(N), o = parseFloat(RegExp.$1), c.innerHTML = "<a style='top:1px;opacity:.55;'>a</a>", a = c.getElementsByTagName("a")[0], a ? /^0.55/.test(a.style.opacity) : !1
                    }(),
                    P = function(a) {
                        return u.test("string" == typeof a ? a : (a.currentStyle ? a.currentStyle.filter : a.style.filter) || "") ? parseFloat(RegExp.$1) / 100 : 1
                    },
                    Q = function(a) {
                        window.console && console.log(a)
                    },
                    R = "",
                    S = "",
                    T = function(a, b) {
                        b = b || K;
                        var c, d, e = b.style;
                        if (void 0 !== e[a]) return a;
                        for (a = a.charAt(0).toUpperCase() + a.substr(1), c = ["O", "Moz", "ms", "Ms", "Webkit"], d = 5; --d > -1 && void 0 === e[c[d] + a];);
                        return d >= 0 ? (S = 3 === d ? "ms" : c[d], R = "-" + S.toLowerCase() + "-", S + a) : null
                    },
                    U = J.defaultView ? J.defaultView.getComputedStyle : function() {},
                    V = g.getStyle = function(a, b, c, d, e) {
                        var f;
                        return O || "opacity" !== b ? (!d && a.style[b] ? f = a.style[b] : (c = c || U(a, null)) ? (a = c.getPropertyValue(b.replace(y, "-$1").toLowerCase()), f = a || c.length ? a : c[b]) : a.currentStyle && (f = a.currentStyle[b]), null == e || f && "none" !== f && "auto" !== f && "auto auto" !== f ? f : e) : P(a)
                    },
                    W = function(a, b, c, d, e) {
                        if ("px" === d || !d) return c;
                        if ("auto" === d || !c) return 0;
                        var f, g = C.test(b),
                            h = a,
                            i = K.style,
                            j = 0 > c;
                        return j && (c = -c), "%" === d && -1 !== b.indexOf("border") ? f = c / 100 * (g ? a.clientWidth : a.clientHeight) : (i.cssText = "border-style:solid;border-width:0;position:absolute;line-height:0;", "%" !== d && h.appendChild ? i[g ? "borderLeftWidth" : "borderTopWidth"] = c + d : (h = a.parentNode || J.body, i[g ? "width" : "height"] = c + d), h.appendChild(K), f = parseFloat(K[g ? "offsetWidth" : "offsetHeight"]), h.removeChild(K), 0 !== f || e || (f = W(a, b, c, d, !0))), j ? -f : f
                    },
                    X = function(a, b, c) {
                        if ("absolute" !== V(a, "position", c)) return 0;
                        var d = "left" === b ? "Left" : "Top",
                            e = V(a, "margin" + d, c);
                        return a["offset" + d] - (W(a, b, parseFloat(e), e.replace(t, "")) || 0)
                    },
                    Y = function(a, b) {
                        var c, d, e = {};
                        if (b = b || U(a, null))
                            if (c = b.length)
                                for (; --c > -1;) e[b[c].replace(z, B)] = b.getPropertyValue(b[c]);
                            else
                                for (c in b) e[c] = b[c];
                        else if (b = a.currentStyle || a.style)
                            for (c in b) e[c.replace(z, B)] = b[c];
                        return O || (e.opacity = P(a)), d = xa(a, b, !1), e.rotation = d.rotation * H, e.skewX = d.skewX * H, e.scaleX = d.scaleX, e.scaleY = d.scaleY, e.x = d.x, e.y = d.y, wa && (e.z = d.z, e.rotationX = d.rotationX * H, e.rotationY = d.rotationY * H, e.scaleZ = d.scaleZ), e.filters && delete e.filters, e
                    },
                    Z = function(a, b, c, d, e) {
                        var f, g, h, i = {},
                            j = a.style;
                        for (g in c) "cssText" !== g && "length" !== g && isNaN(g) && (b[g] !== (f = c[g]) || e && e[g]) && -1 === g.indexOf("Origin") && ("number" == typeof f || "string" == typeof f) && (i[g] = "auto" !== f || "left" !== g && "top" !== g ? "" !== f && "auto" !== f && "none" !== f || "string" != typeof b[g] || "" === b[g].replace(s, "") ? f : 0 : X(a, g), void 0 !== j[g] && (h = new la(j, g, j[g], h)));
                        if (d)
                            for (g in d) "className" !== g && (i[g] = d[g]);
                        return {
                            difs: i,
                            firstMPT: h
                        }
                    },
                    $ = {
                        width: ["Left", "Right"],
                        height: ["Top", "Bottom"]
                    },
                    _ = ["marginLeft", "marginRight", "marginTop", "marginBottom"],
                    aa = function(a, b, c) {
                        var d = parseFloat("width" === b ? a.offsetWidth : a.offsetHeight),
                            e = $[b],
                            f = e.length;
                        for (c = c || U(a, null); --f > -1;) d -= parseFloat(V(a, "padding" + e[f], c, !0)) || 0, d -= parseFloat(V(a, "border" + e[f] + "Width", c, !0)) || 0;
                        return d
                    },
                    ba = function(a, b) {
                        (null == a || "" === a || "auto" === a || "auto auto" === a) && (a = "0 0");
                        var c = a.split(" "),
                            d = -1 !== a.indexOf("left") ? "0%" : -1 !== a.indexOf("right") ? "100%" : c[0],
                            e = -1 !== a.indexOf("top") ? "0%" : -1 !== a.indexOf("bottom") ? "100%" : c[1];
                        return null == e ? e = "0" : "center" === e && (e = "50%"), ("center" === d || isNaN(parseFloat(d)) && -1 === (d + "").indexOf("=")) && (d = "50%"), b && (b.oxp = -1 !== d.indexOf("%"), b.oyp = -1 !== e.indexOf("%"), b.oxr = "=" === d.charAt(1), b.oyr = "=" === e.charAt(1), b.ox = parseFloat(d.replace(s, "")), b.oy = parseFloat(e.replace(s, ""))), d + " " + e + (c.length > 2 ? " " + c[2] : "")
                    },
                    ca = function(a, b) {
                        return "string" == typeof a && "=" === a.charAt(1) ? parseInt(a.charAt(0) + "1", 10) * parseFloat(a.substr(2)) : parseFloat(a) - parseFloat(b)
                    },
                    da = function(a, b) {
                        return null == a ? b : "string" == typeof a && "=" === a.charAt(1) ? parseInt(a.charAt(0) + "1", 10) * Number(a.substr(2)) + b : parseFloat(a)
                    },
                    ea = function(a, b, c, d) {
                        var e, f, g, h, i = 1e-6;
                        return null == a ? h = b : "number" == typeof a ? h = a * G : (e = 2 * Math.PI, f = a.split("_"), g = Number(f[0].replace(s, "")) * (-1 === a.indexOf("rad") ? G : 1) - ("=" === a.charAt(1) ? 0 : b), f.length && (d && (d[c] = b + g), -1 !== a.indexOf("short") && (g %= e, g !== g % (e / 2) && (g = 0 > g ? g + e : g - e)), -1 !== a.indexOf("_cw") && 0 > g ? g = (g + 9999999999 * e) % e - (0 | g / e) * e : -1 !== a.indexOf("ccw") && g > 0 && (g = (g - 9999999999 * e) % e - (0 | g / e) * e)), h = b + g), i > h && h > -i && (h = 0), h
                    },
                    fa = {
                        aqua: [0, 255, 255],
                        lime: [0, 255, 0],
                        silver: [192, 192, 192],
                        black: [0, 0, 0],
                        maroon: [128, 0, 0],
                        teal: [0, 128, 128],
                        blue: [0, 0, 255],
                        navy: [0, 0, 128],
                        white: [255, 255, 255],
                        fuchsia: [255, 0, 255],
                        olive: [128, 128, 0],
                        yellow: [255, 255, 0],
                        orange: [255, 165, 0],
                        gray: [128, 128, 128],
                        purple: [128, 0, 128],
                        green: [0, 128, 0],
                        red: [255, 0, 0],
                        pink: [255, 192, 203],
                        cyan: [0, 255, 255],
                        transparent: [255, 255, 255, 0]
                    },
                    ga = function(a, b, c) {
                        return a = 0 > a ? a + 1 : a > 1 ? a - 1 : a, 0 | 255 * (1 > 6 * a ? b + 6 * (c - b) * a : .5 > a ? c : 2 > 3 * a ? b + 6 * (c - b) * (2 / 3 - a) : b) + .5
                    },
                    ha = function(a) {
                        var b, c, d, e, f, g;
                        return a && "" !== a ? "number" == typeof a ? [a >> 16, 255 & a >> 8, 255 & a] : ("," === a.charAt(a.length - 1) && (a = a.substr(0, a.length - 1)), fa[a] ? fa[a] : "#" === a.charAt(0) ? (4 === a.length && (b = a.charAt(1), c = a.charAt(2), d = a.charAt(3), a = "#" + b + b + c + c + d + d), a = parseInt(a.substr(1), 16), [a >> 16, 255 & a >> 8, 255 & a]) : "hsl" === a.substr(0, 3) ? (a = a.match(p), e = Number(a[0]) % 360 / 360, f = Number(a[1]) / 100, g = Number(a[2]) / 100, c = .5 >= g ? g * (f + 1) : g + f - g * f, b = 2 * g - c, a.length > 3 && (a[3] = Number(a[3])), a[0] = ga(e + 1 / 3, b, c), a[1] = ga(e, b, c), a[2] = ga(e - 1 / 3, b, c), a) : (a = a.match(p) || fa.transparent, a[0] = Number(a[0]), a[1] = Number(a[1]), a[2] = Number(a[2]), a.length > 3 && (a[3] = Number(a[3])), a)) : fa.black
                    },
                    ia = "(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#.+?\\b";
                for (i in fa) ia += "|" + i + "\\b";
                ia = RegExp(ia + ")", "gi");
                var ja = function(a, b, c, d) {
                        if (null == a) return function(a) {
                            return a
                        };
                        var e, f = b ? (a.match(ia) || [""])[0] : "",
                            g = a.split(f).join("").match(r) || [],
                            h = a.substr(0, a.indexOf(g[0])),
                            i = ")" === a.charAt(a.length - 1) ? ")" : "",
                            j = -1 !== a.indexOf(" ") ? " " : ",",
                            k = g.length,
                            l = k > 0 ? g[0].replace(p, "") : "";
                        return k ? e = b ? function(a) {
                            var b, m, n, o;
                            if ("number" == typeof a) a += l;
                            else if (d && F.test(a)) {
                                for (o = a.replace(F, "|").split("|"), n = 0; o.length > n; n++) o[n] = e(o[n]);
                                return o.join(",")
                            }
                            if (b = (a.match(ia) || [f])[0], m = a.split(b).join("").match(r) || [], n = m.length, k > n--)
                                for (; k > ++n;) m[n] = c ? m[0 | (n - 1) / 2] : g[n];
                            return h + m.join(j) + j + b + i + (-1 !== a.indexOf("inset") ? " inset" : "")
                        } : function(a) {
                            var b, f, m;
                            if ("number" == typeof a) a += l;
                            else if (d && F.test(a)) {
                                for (f = a.replace(F, "|").split("|"), m = 0; f.length > m; m++) f[m] = e(f[m]);
                                return f.join(",")
                            }
                            if (b = a.match(r) || [], m = b.length, k > m--)
                                for (; k > ++m;) b[m] = c ? b[0 | (m - 1) / 2] : g[m];
                            return h + b.join(j) + i
                        } : function(a) {
                            return a
                        }
                    },
                    ka = function(a) {
                        return a = a.split(","),
                            function(b, c, d, e, f, g, h) {
                                var i, j = (c + "").split(" ");
                                for (h = {}, i = 0; 4 > i; i++) h[a[i]] = j[i] = j[i] || j[(i - 1) / 2 >> 0];
                                return e.parse(b, h, f, g)
                            }
                    },
                    la = (M._setPluginRatio = function(a) {
                        this.plugin.setRatio(a);
                        for (var b, c, d, e, f = this.data, g = f.proxy, h = f.firstMPT, i = 1e-6; h;) b = g[h.v], h.r ? b = b > 0 ? 0 | b + .5 : 0 | b - .5 : i > b && b > -i && (b = 0), h.t[h.p] = b, h = h._next;
                        if (f.autoRotate && (f.autoRotate.rotation = g.rotation), 1 === a)
                            for (h = f.firstMPT; h;) {
                                if (c = h.t, c.type) {
                                    if (1 === c.type) {
                                        for (e = c.xs0 + c.s + c.xs1, d = 1; c.l > d; d++) e += c["xn" + d] + c["xs" + (d + 1)];
                                        c.e = e
                                    }
                                } else c.e = c.s + c.xs0;
                                h = h._next
                            }
                    }, function(a, b, c, d, e) {
                        this.t = a, this.p = b, this.v = c, this.r = e, d && (d._prev = this, this._next = d)
                    }),
                    ma = (M._parseToProxy = function(a, b, c, d, e, f) {
                        var g, h, i, j, k, l = d,
                            m = {},
                            n = {},
                            o = c._transform,
                            p = I;
                        for (c._transform = null, I = b, d = k = c.parse(a, b, d, e), I = p, f && (c._transform = o, l && (l._prev = null, l._prev && (l._prev._next = null))); d && d !== l;) {
                            if (1 >= d.type && (h = d.p, n[h] = d.s + d.c, m[h] = d.s, f || (j = new la(d, "s", h, j, d.r), d.c = 0), 1 === d.type))
                                for (g = d.l; --g > 0;) i = "xn" + g, h = d.p + "_" + i, n[h] = d.data[i], m[h] = d[i], f || (j = new la(d, i, h, j, d.rxp[i]));
                            d = d._next
                        }
                        return {
                            proxy: m,
                            end: n,
                            firstMPT: j,
                            pt: k
                        }
                    }, M.CSSPropTween = function(a, b, d, e, g, h, i, j, k, l, m) {
                        this.t = a, this.p = b, this.s = d, this.c = e, this.n = i || b, a instanceof ma || f.push(this.n), this.r = j, this.type = h || 0, k && (this.pr = k, c = !0), this.b = void 0 === l ? d : l, this.e = void 0 === m ? d + e : m, g && (this._next = g, g._prev = this)
                    }),
                    na = g.parseComplex = function(a, b, c, d, e, f, g, h, i, k) {
                        c = c || f || "", g = new ma(a, b, 0, 0, g, k ? 2 : 1, null, !1, h, c, d), d += "";
                        var l, m, n, o, r, s, t, u, v, w, y, z, A = c.split(", ").join(",").split(" "),
                            B = d.split(", ").join(",").split(" "),
                            C = A.length,
                            D = j !== !1;
                        for ((-1 !== d.indexOf(",") || -1 !== c.indexOf(",")) && (A = A.join(" ").replace(F, ", ").split(" "), B = B.join(" ").replace(F, ", ").split(" "), C = A.length), C !== B.length && (A = (f || "").split(" "), C = A.length), g.plugin = i, g.setRatio = k, l = 0; C > l; l++)
                            if (o = A[l], r = B[l], u = parseFloat(o), u || 0 === u) g.appendXtra("", u, ca(r, u), r.replace(q, ""), D && -1 !== r.indexOf("px"), !0);
                            else if (e && ("#" === o.charAt(0) || fa[o] || x.test(o))) z = "," === r.charAt(r.length - 1) ? ")," : ")", o = ha(o), r = ha(r), v = o.length + r.length > 6, v && !O && 0 === r[3] ? (g["xs" + g.l] += g.l ? " transparent" : "transparent", g.e = g.e.split(B[l]).join("transparent")) : (O || (v = !1), g.appendXtra(v ? "rgba(" : "rgb(", o[0], r[0] - o[0], ",", !0, !0).appendXtra("", o[1], r[1] - o[1], ",", !0).appendXtra("", o[2], r[2] - o[2], v ? "," : z, !0), v && (o = 4 > o.length ? 1 : o[3], g.appendXtra("", o, (4 > r.length ? 1 : r[3]) - o, z, !1)));
                        else if (s = o.match(p)) {
                            if (t = r.match(q), !t || t.length !== s.length) return g;
                            for (n = 0, m = 0; s.length > m; m++) y = s[m], w = o.indexOf(y, n), g.appendXtra(o.substr(n, w - n), Number(y), ca(t[m], y), "", D && "px" === o.substr(w + y.length, 2), 0 === m), n = w + y.length;
                            g["xs" + g.l] += o.substr(n)
                        } else g["xs" + g.l] += g.l ? " " + o : o;
                        if (-1 !== d.indexOf("=") && g.data) {
                            for (z = g.xs0 + g.data.s, l = 1; g.l > l; l++) z += g["xs" + l] + g.data["xn" + l];
                            g.e = z + g["xs" + l]
                        }
                        return g.l || (g.type = -1, g.xs0 = g.e), g.xfirst || g
                    },
                    oa = 9;
                for (i = ma.prototype, i.l = i.pr = 0; --oa > 0;) i["xn" + oa] = 0, i["xs" + oa] = "";
                i.xs0 = "", i._next = i._prev = i.xfirst = i.data = i.plugin = i.setRatio = i.rxp = null, i.appendXtra = function(a, b, c, d, e, f) {
                    var g = this,
                        h = g.l;
                    return g["xs" + h] += f && h ? " " + a : a || "", c || 0 === h || g.plugin ? (g.l++, g.type = g.setRatio ? 2 : 1, g["xs" + g.l] = d || "", h > 0 ? (g.data["xn" + h] = b + c, g.rxp["xn" + h] = e, g["xn" + h] = b, g.plugin || (g.xfirst = new ma(g, "xn" + h, b, c, g.xfirst || g, 0, g.n, e, g.pr), g.xfirst.xs0 = 0), g) : (g.data = {
                        s: b + c
                    }, g.rxp = {}, g.s = b, g.c = c, g.r = e, g)) : (g["xs" + h] += b + (d || ""), g)
                };
                var pa = function(a, b) {
                        b = b || {}, this.p = b.prefix ? T(a) || a : a, h[a] = h[this.p] = this, this.format = b.formatter || ja(b.defaultValue, b.color, b.collapsible, b.multi), b.parser && (this.parse = b.parser), this.clrs = b.color, this.multi = b.multi, this.keyword = b.keyword, this.dflt = b.defaultValue, this.pr = b.priority || 0
                    },
                    qa = M._registerComplexSpecialProp = function(a, b, c) {
                        "object" != typeof b && (b = {
                            parser: c
                        });
                        var d, e, f = a.split(","),
                            g = b.defaultValue;
                        for (c = c || [g], d = 0; f.length > d; d++) b.prefix = 0 === d && b.prefix, b.defaultValue = c[d] || g, e = new pa(f[d], b)
                    },
                    ra = function(a) {
                        if (!h[a]) {
                            var b = a.charAt(0).toUpperCase() + a.substr(1) + "Plugin";
                            qa(a, {
                                parser: function(a, c, d, e, f, g, i) {
                                    var j = (window.GreenSockGlobals || window).com.greensock.plugins[b];
                                    return j ? (j._cssRegister(), h[d].parse(a, c, d, e, f, g, i)) : (Q("Error: " + b + " js file not loaded."), f)
                                }
                            })
                        }
                    };
                i = pa.prototype, i.parseComplex = function(a, b, c, d, e, f) {
                    var g, h, i, j, k, l, m = this.keyword;
                    if (this.multi && (F.test(c) || F.test(b) ? (h = b.replace(F, "|").split("|"), i = c.replace(F, "|").split("|")) : m && (h = [b], i = [c])), i) {
                        for (j = i.length > h.length ? i.length : h.length, g = 0; j > g; g++) b = h[g] = h[g] || this.dflt, c = i[g] = i[g] || this.dflt, m && (k = b.indexOf(m), l = c.indexOf(m), k !== l && (c = -1 === l ? i : h, c[g] += " " + m));
                        b = h.join(", "), c = i.join(", ")
                    }
                    return na(a, this.p, b, c, this.clrs, this.dflt, d, this.pr, e, f)
                }, i.parse = function(a, b, c, d, f, g) {
                    return this.parseComplex(a.style, this.format(V(a, this.p, e, !1, this.dflt)), this.format(b), f, g)
                }, g.registerSpecialProp = function(a, b, c) {
                    qa(a, {
                        parser: function(a, d, e, f, g, h) {
                            var i = new ma(a, e, 0, 0, g, 2, e, !1, c);
                            return i.plugin = h, i.setRatio = b(a, d, f._tween, e), i
                        },
                        priority: c
                    })
                };
                var sa = "scaleX,scaleY,scaleZ,x,y,z,skewX,rotation,rotationX,rotationY,perspective".split(","),
                    ta = T("transform"),
                    ua = R + "transform",
                    va = T("transformOrigin"),
                    wa = null !== T("perspective"),
                    xa = function(a, b, c, d) {
                        if (a._gsTransform && c && !d) return a._gsTransform;
                        var e, f, h, i, j, k, l, m, n, o, p, q, r, s = c ? a._gsTransform || {
                                skewY: 0
                            } : {
                                skewY: 0
                            },
                            t = 0 > s.scaleX,
                            u = 2e-5,
                            v = 1e5,
                            w = -Math.PI + 1e-4,
                            x = Math.PI - 1e-4,
                            y = wa ? parseFloat(V(a, va, b, !1, "0 0 0").split(" ")[2]) || s.zOrigin || 0 : 0;
                        for (ta ? e = V(a, ua, b, !0) : a.currentStyle && (e = a.currentStyle.filter.match(D), e = e && 4 === e.length ? [e[0].substr(4), Number(e[2].substr(4)), Number(e[1].substr(4)), e[3].substr(4), s.x || 0, s.y || 0].join(",") : ""), f = (e || "").match(/(?:\-|\b)[\d\-\.e]+\b/gi) || [], h = f.length; --h > -1;) i = Number(f[h]), f[h] = (j = i - (i |= 0)) ? (0 | j * v + (0 > j ? -.5 : .5)) / v + i : i;
                        if (16 === f.length) {
                            var z = f[8],
                                A = f[9],
                                B = f[10],
                                C = f[12],
                                E = f[13],
                                F = f[14];
                            if (s.zOrigin && (F = -s.zOrigin, C = z * F - f[12], E = A * F - f[13], F = B * F + s.zOrigin - f[14]), !c || d || null == s.rotationX) {
                                var G, H, I, J, K, L, M, N = f[0],
                                    O = f[1],
                                    P = f[2],
                                    Q = f[3],
                                    R = f[4],
                                    S = f[5],
                                    T = f[6],
                                    U = f[7],
                                    W = f[11],
                                    X = s.rotationX = Math.atan2(T, B),
                                    Y = w > X || X > x;
                                X && (J = Math.cos(-X), K = Math.sin(-X), G = R * J + z * K, H = S * J + A * K, I = T * J + B * K, z = R * -K + z * J, A = S * -K + A * J, B = T * -K + B * J, W = U * -K + W * J, R = G, S = H, T = I), X = s.rotationY = Math.atan2(z, N), X && (L = w > X || X > x, J = Math.cos(-X), K = Math.sin(-X), G = N * J - z * K, H = O * J - A * K, I = P * J - B * K, A = O * K + A * J, B = P * K + B * J, W = Q * K + W * J, N = G, O = H, P = I), X = s.rotation = Math.atan2(O, S), X && (M = w > X || X > x, J = Math.cos(-X), K = Math.sin(-X), N = N * J + R * K, H = O * J + S * K, S = O * -K + S * J, T = P * -K + T * J, O = H), M && Y ? s.rotation = s.rotationX = 0 : M && L ? s.rotation = s.rotationY = 0 : L && Y && (s.rotationY = s.rotationX = 0), s.scaleX = (0 | Math.sqrt(N * N + O * O) * v + .5) / v, s.scaleY = (0 | Math.sqrt(S * S + A * A) * v + .5) / v, s.scaleZ = (0 | Math.sqrt(T * T + B * B) * v + .5) / v, s.skewX = 0, s.perspective = W ? 1 / (0 > W ? -W : W) : 0, s.x = C, s.y = E, s.z = F
                            }
                        } else if (!(wa && !d && f.length && s.x === f[4] && s.y === f[5] && (s.rotationX || s.rotationY) || void 0 !== s.x && "none" === V(a, "display", b))) {
                            var Z = f.length >= 6,
                                $ = Z ? f[0] : 1,
                                _ = f[1] || 0,
                                aa = f[2] || 0,
                                ba = Z ? f[3] : 1;
                            s.x = f[4] || 0, s.y = f[5] || 0, k = Math.sqrt($ * $ + _ * _), l = Math.sqrt(ba * ba + aa * aa), m = $ || _ ? Math.atan2(_, $) : s.rotation || 0, n = aa || ba ? Math.atan2(aa, ba) + m : s.skewX || 0, o = k - Math.abs(s.scaleX || 0), p = l - Math.abs(s.scaleY || 0), Math.abs(n) > Math.PI / 2 && Math.abs(n) < 1.5 * Math.PI && (t ? (k *= -1, n += 0 >= m ? Math.PI : -Math.PI, m += 0 >= m ? Math.PI : -Math.PI) : (l *= -1, n += 0 >= n ? Math.PI : -Math.PI)), q = (m - s.rotation) % Math.PI, r = (n - s.skewX) % Math.PI, (void 0 === s.skewX || o > u || -u > o || p > u || -u > p || q > w && x > q && !1 | q * v || r > w && x > r && !1 | r * v) && (s.scaleX = k, s.scaleY = l, s.rotation = m, s.skewX = n), wa && (s.rotationX = s.rotationY = s.z = 0, s.perspective = parseFloat(g.defaultTransformPerspective) || 0, s.scaleZ = 1)
                        }
                        s.zOrigin = y;
                        for (h in s) u > s[h] && s[h] > -u && (s[h] = 0);
                        return c && (a._gsTransform = s), s
                    },
                    ya = function(a) {
                        var b, c, d = this.data,
                            e = -d.rotation,
                            f = e + d.skewX,
                            g = 1e5,
                            h = (0 | Math.cos(e) * d.scaleX * g) / g,
                            i = (0 | Math.sin(e) * d.scaleX * g) / g,
                            j = (0 | Math.sin(f) * -d.scaleY * g) / g,
                            k = (0 | Math.cos(f) * d.scaleY * g) / g,
                            l = this.t.style,
                            m = this.t.currentStyle;
                        if (m) {
                            c = i, i = -j, j = -c, b = m.filter, l.filter = "";
                            var n, p, q = this.t.offsetWidth,
                                r = this.t.offsetHeight,
                                s = "absolute" !== m.position,
                                v = "progid:DXImageTransform.Microsoft.Matrix(M11=" + h + ", M12=" + i + ", M21=" + j + ", M22=" + k,
                                w = d.x,
                                x = d.y;
                            if (null != d.ox && (n = (d.oxp ? .01 * q * d.ox : d.ox) - q / 2, p = (d.oyp ? .01 * r * d.oy : d.oy) - r / 2, w += n - (n * h + p * i), x += p - (n * j + p * k)), s ? (n = q / 2, p = r / 2, v += ", Dx=" + (n - (n * h + p * i) + w) + ", Dy=" + (p - (n * j + p * k) + x) + ")") : v += ", sizingMethod='auto expand')", l.filter = -1 !== b.indexOf("DXImageTransform.Microsoft.Matrix(") ? b.replace(E, v) : v + " " + b, (0 === a || 1 === a) && 1 === h && 0 === i && 0 === j && 1 === k && (s && -1 === v.indexOf("Dx=0, Dy=0") || u.test(b) && 100 !== parseFloat(RegExp.$1) || -1 === b.indexOf(b.indexOf("Alpha")) && l.removeAttribute("filter")), !s) {
                                var y, z, A, B = 8 > o ? 1 : -1;
                                for (n = d.ieOffsetX || 0, p = d.ieOffsetY || 0, d.ieOffsetX = Math.round((q - ((0 > h ? -h : h) * q + (0 > i ? -i : i) * r)) / 2 + w), d.ieOffsetY = Math.round((r - ((0 > k ? -k : k) * r + (0 > j ? -j : j) * q)) / 2 + x), oa = 0; 4 > oa; oa++) z = _[oa], y = m[z], c = -1 !== y.indexOf("px") ? parseFloat(y) : W(this.t, z, parseFloat(y), y.replace(t, "")) || 0, A = c !== d[z] ? 2 > oa ? -d.ieOffsetX : -d.ieOffsetY : 2 > oa ? n - d.ieOffsetX : p - d.ieOffsetY, l[z] = (d[z] = Math.round(c - A * (0 === oa || 2 === oa ? 1 : B))) + "px"
                            }
                        }
                    },
                    za = function() {
                        var a, b, c, d, e, f, g, h, i, j, k, l, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B = this.data,
                            C = this.t.style,
                            D = B.rotation,
                            E = B.scaleX,
                            F = B.scaleY,
                            G = B.scaleZ,
                            H = B.perspective;
                        if (m && (y = C.top ? "top" : C.bottom ? "bottom" : parseFloat(V(this.t, "top", null, !1)) ? "bottom" : "top", u = V(this.t, y, null, !1), z = parseFloat(u) || 0, A = u.substr((z + "").length) || "px", B._ffFix = !B._ffFix, C[y] = (B._ffFix ? z + .05 : z - .05) + A), D || B.skewX) s = Math.cos(D), t = Math.sin(D), a = s, e = t, B.skewX && (D -= B.skewX, s = Math.cos(D), t = Math.sin(D)), b = -t, f = s;
                        else {
                            if (!(B.rotationY || B.rotationX || 1 !== G || H)) return void(C[ta] = "translate3d(" + B.x + "px," + B.y + "px," + B.z + "px)" + (1 !== E || 1 !== F ? " scale(" + E + "," + F + ")" : ""));
                            a = f = 1, b = e = 0
                        }
                        k = 1, c = d = g = h = i = j = l = n = o = 0, p = H ? -1 / H : 0, q = B.zOrigin, r = 1e5, D = B.rotationY, D && (s = Math.cos(D), t = Math.sin(D), i = k * -t, n = p * -t, c = a * t, g = e * t, k *= s, p *= s, a *= s, e *= s), D = B.rotationX, D && (s = Math.cos(D), t = Math.sin(D), u = b * s + c * t, v = f * s + g * t, w = j * s + k * t, x = o * s + p * t, c = b * -t + c * s, g = f * -t + g * s, k = j * -t + k * s, p = o * -t + p * s, b = u, f = v, j = w, o = x), 1 !== G && (c *= G, g *= G, k *= G, p *= G), 1 !== F && (b *= F, f *= F, j *= F, o *= F), 1 !== E && (a *= E, e *= E, i *= E, n *= E), q && (l -= q, d = c * l, h = g * l, l = k * l + q), d = (u = (d += B.x) - (d |= 0)) ? (0 | u * r + (0 > u ? -.5 : .5)) / r + d : d, h = (u = (h += B.y) - (h |= 0)) ? (0 | u * r + (0 > u ? -.5 : .5)) / r + h : h, l = (u = (l += B.z) - (l |= 0)) ? (0 | u * r + (0 > u ? -.5 : .5)) / r + l : l, C[ta] = "matrix3d(" + [(0 | a * r) / r, (0 | e * r) / r, (0 | i * r) / r, (0 | n * r) / r, (0 | b * r) / r, (0 | f * r) / r, (0 | j * r) / r, (0 | o * r) / r, (0 | c * r) / r, (0 | g * r) / r, (0 | k * r) / r, (0 | p * r) / r, d, h, l, H ? 1 + -l / H : 1].join(",") + ")"
                    },
                    Aa = function() {
                        var a, b, c, d, e, f, g, h, i, j = this.data,
                            k = this.t,
                            l = k.style;
                        m && (a = l.top ? "top" : l.bottom ? "bottom" : parseFloat(V(k, "top", null, !1)) ? "bottom" : "top", b = V(k, a, null, !1), c = parseFloat(b) || 0, d = b.substr((c + "").length) || "px", j._ffFix = !j._ffFix, l[a] = (j._ffFix ? c + .05 : c - .05) + d), j.rotation || j.skewX ? (e = j.rotation, f = e - j.skewX, g = 1e5, h = j.scaleX * g, i = j.scaleY * g, l[ta] = "matrix(" + (0 | Math.cos(e) * h) / g + "," + (0 | Math.sin(e) * h) / g + "," + (0 | Math.sin(f) * -i) / g + "," + (0 | Math.cos(f) * i) / g + "," + j.x + "," + j.y + ")") : l[ta] = "matrix(" + j.scaleX + ",0,0," + j.scaleY + "," + j.x + "," + j.y + ")"
                    };
                qa("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,transformPerspective,directionalRotation,parseTransform,force3D", {
                    parser: function(a, b, c, d, f, g, h) {
                        if (d._transform) return f;
                        var i, j, k, l, m, n, o, p = d._transform = xa(a, e, !0, h.parseTransform),
                            q = a.style,
                            r = 1e-6,
                            s = sa.length,
                            t = h,
                            u = {};
                        if ("string" == typeof t.transform && ta) k = q.cssText, q[ta] = t.transform, q.display = "block", i = xa(a, null, !1), q.cssText = k;
                        else if ("object" == typeof t) {
                            if (i = {
                                    scaleX: da(null != t.scaleX ? t.scaleX : t.scale, p.scaleX),
                                    scaleY: da(null != t.scaleY ? t.scaleY : t.scale, p.scaleY),
                                    scaleZ: da(null != t.scaleZ ? t.scaleZ : t.scale, p.scaleZ),
                                    x: da(t.x, p.x),
                                    y: da(t.y, p.y),
                                    z: da(t.z, p.z),
                                    perspective: da(t.transformPerspective, p.perspective)
                                }, o = t.directionalRotation, null != o)
                                if ("object" == typeof o)
                                    for (k in o) t[k] = o[k];
                                else t.rotation = o;
                            i.rotation = ea("rotation" in t ? t.rotation : "shortRotation" in t ? t.shortRotation + "_short" : "rotationZ" in t ? t.rotationZ : p.rotation * H, p.rotation, "rotation", u), wa && (i.rotationX = ea("rotationX" in t ? t.rotationX : "shortRotationX" in t ? t.shortRotationX + "_short" : p.rotationX * H || 0, p.rotationX, "rotationX", u), i.rotationY = ea("rotationY" in t ? t.rotationY : "shortRotationY" in t ? t.shortRotationY + "_short" : p.rotationY * H || 0, p.rotationY, "rotationY", u)), i.skewX = null == t.skewX ? p.skewX : ea(t.skewX, p.skewX), i.skewY = null == t.skewY ? p.skewY : ea(t.skewY, p.skewY), (j = i.skewY - p.skewY) && (i.skewX += j, i.rotation += j)
                        }
                        for (null != t.force3D && (p.force3D = t.force3D, n = !0), m = p.force3D || p.z || p.rotationX || p.rotationY || i.z || i.rotationX || i.rotationY || i.perspective, m || null == t.scale || (i.scaleZ = 1); --s > -1;) c = sa[s], l = i[c] - p[c], (l > r || -r > l || null != I[c]) && (n = !0, f = new ma(p, c, p[c], l, f), c in u && (f.e = u[c]), f.xs0 = 0, f.plugin = g, d._overwriteProps.push(f.n));
                        return l = t.transformOrigin, (l || wa && m && p.zOrigin) && (ta ? (n = !0, c = va, l = (l || V(a, c, e, !1, "50% 50%")) + "", f = new ma(q, c, 0, 0, f, -1, "transformOrigin"), f.b = q[c], f.plugin = g, wa ? (k = p.zOrigin, l = l.split(" "), p.zOrigin = (l.length > 2 && (0 === k || "0px" !== l[2]) ? parseFloat(l[2]) : k) || 0, f.xs0 = f.e = q[c] = l[0] + " " + (l[1] || "50%") + " 0px", f = new ma(p, "zOrigin", 0, 0, f, -1, f.n), f.b = k, f.xs0 = f.e = p.zOrigin) : f.xs0 = f.e = q[c] = l) : ba(l + "", p)), n && (d._transformType = m || 3 === this._transformType ? 3 : 2), f
                    },
                    prefix: !0
                }), qa("boxShadow", {
                    defaultValue: "0px 0px 0px 0px #999",
                    prefix: !0,
                    color: !0,
                    multi: !0,
                    keyword: "inset"
                }), qa("borderRadius", {
                    defaultValue: "0px",
                    parser: function(a, b, c, f, g) {
                        b = this.format(b);
                        var h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x = ["borderTopLeftRadius", "borderTopRightRadius", "borderBottomRightRadius", "borderBottomLeftRadius"],
                            y = a.style;
                        for (p = parseFloat(a.offsetWidth), q = parseFloat(a.offsetHeight), h = b.split(" "), i = 0; x.length > i; i++) this.p.indexOf("border") && (x[i] = T(x[i])), l = k = V(a, x[i], e, !1, "0px"), -1 !== l.indexOf(" ") && (k = l.split(" "), l = k[0], k = k[1]), m = j = h[i], n = parseFloat(l), s = l.substr((n + "").length), t = "=" === m.charAt(1), t ? (o = parseInt(m.charAt(0) + "1", 10), m = m.substr(2), o *= parseFloat(m), r = m.substr((o + "").length - (0 > o ? 1 : 0)) || "") : (o = parseFloat(m), r = m.substr((o + "").length)), "" === r && (r = d[c] || s), r !== s && (u = W(a, "borderLeft", n, s), v = W(a, "borderTop", n, s), "%" === r ? (l = 100 * (u / p) + "%", k = 100 * (v / q) + "%") : "em" === r ? (w = W(a, "borderLeft", 1, "em"), l = u / w + "em", k = v / w + "em") : (l = u + "px", k = v + "px"), t && (m = parseFloat(l) + o + r, j = parseFloat(k) + o + r)), g = na(y, x[i], l + " " + k, m + " " + j, !1, "0px", g);
                        return g
                    },
                    prefix: !0,
                    formatter: ja("0px 0px 0px 0px", !1, !0)
                }), qa("backgroundPosition", {
                    defaultValue: "0 0",
                    parser: function(a, b, c, d, f, g) {
                        var h, i, j, k, l, m, n = "background-position",
                            p = e || U(a, null),
                            q = this.format((p ? o ? p.getPropertyValue(n + "-x") + " " + p.getPropertyValue(n + "-y") : p.getPropertyValue(n) : a.currentStyle.backgroundPositionX + " " + a.currentStyle.backgroundPositionY) || "0 0"),
                            r = this.format(b);
                        if (-1 !== q.indexOf("%") != (-1 !== r.indexOf("%")) && (m = V(a, "backgroundImage").replace(A, ""), m && "none" !== m)) {
                            for (h = q.split(" "), i = r.split(" "), L.setAttribute("src", m), j = 2; --j > -1;) q = h[j], k = -1 !== q.indexOf("%"), k !== (-1 !== i[j].indexOf("%")) && (l = 0 === j ? a.offsetWidth - L.width : a.offsetHeight - L.height, h[j] = k ? parseFloat(q) / 100 * l + "px" : 100 * (parseFloat(q) / l) + "%");
                            q = h.join(" ")
                        }
                        return this.parseComplex(a.style, q, r, f, g)
                    },
                    formatter: ba
                }), qa("backgroundSize", {
                    defaultValue: "0 0",
                    formatter: ba
                }), qa("perspective", {
                    defaultValue: "0px",
                    prefix: !0
                }), qa("perspectiveOrigin", {
                    defaultValue: "50% 50%",
                    prefix: !0
                }), qa("transformStyle", {
                    prefix: !0
                }), qa("backfaceVisibility", {
                    prefix: !0
                }), qa("margin", {
                    parser: ka("marginTop,marginRight,marginBottom,marginLeft")
                }), qa("padding", {
                    parser: ka("paddingTop,paddingRight,paddingBottom,paddingLeft")
                }), qa("clip", {
                    defaultValue: "rect(0px,0px,0px,0px)",
                    parser: function(a, b, c, d, f, g) {
                        var h, i, j;
                        return 9 > o ? (i = a.currentStyle, j = 8 > o ? " " : ",", h = "rect(" + i.clipTop + j + i.clipRight + j + i.clipBottom + j + i.clipLeft + ")", b = this.format(b).split(",").join(j)) : (h = this.format(V(a, this.p, e, !1, this.dflt)), b = this.format(b)), this.parseComplex(a.style, h, b, f, g)
                    }
                }), qa("textShadow", {
                    defaultValue: "0px 0px 0px #999",
                    color: !0,
                    multi: !0
                }), qa("autoRound,strictUnits", {
                    parser: function(a, b, c, d, e) {
                        return e
                    }
                }), qa("border", {
                    defaultValue: "0px solid #000",
                    parser: function(a, b, c, d, f, g) {
                        return this.parseComplex(a.style, this.format(V(a, "borderTopWidth", e, !1, "0px") + " " + V(a, "borderTopStyle", e, !1, "solid") + " " + V(a, "borderTopColor", e, !1, "#000")), this.format(b), f, g)
                    },
                    color: !0,
                    formatter: function(a) {
                        var b = a.split(" ");
                        return b[0] + " " + (b[1] || "solid") + " " + (a.match(ia) || ["#000"])[0]
                    }
                }), qa("float,cssFloat,styleFloat", {
                    parser: function(a, b, c, d, e) {
                        var f = a.style,
                            g = "cssFloat" in f ? "cssFloat" : "styleFloat";
                        return new ma(f, g, 0, 0, e, -1, c, !1, 0, f[g], b)
                    }
                });
                var Ba = function(a) {
                    var b, c = this.t,
                        d = c.filter || V(this.data, "filter"),
                        e = 0 | this.s + this.c * a;
                    100 === e && (-1 === d.indexOf("atrix(") && -1 === d.indexOf("radient(") && -1 === d.indexOf("oader(") ? (c.removeAttribute("filter"), b = !V(this.data, "filter")) : (c.filter = d.replace(w, ""), b = !0)), b || (this.xn1 && (c.filter = d = d || "alpha(opacity=" + e + ")"), -1 === d.indexOf("opacity") ? 0 === e && this.xn1 || (c.filter = d + " alpha(opacity=" + e + ")") : c.filter = d.replace(u, "opacity=" + e))
                };
                qa("opacity,alpha,autoAlpha", {
                    defaultValue: "1",
                    parser: function(a, b, c, d, f, g) {
                        var h = parseFloat(V(a, "opacity", e, !1, "1")),
                            i = a.style,
                            j = "autoAlpha" === c;
                        return b = parseFloat(b), j && 1 === h && "hidden" === V(a, "visibility", e) && 0 !== b && (h = 0), O ? f = new ma(i, "opacity", h, b - h, f) : (f = new ma(i, "opacity", 100 * h, 100 * (b - h), f), f.xn1 = j ? 1 : 0, i.zoom = 1, f.type = 2, f.b = "alpha(opacity=" + f.s + ")", f.e = "alpha(opacity=" + (f.s + f.c) + ")", f.data = a, f.plugin = g, f.setRatio = Ba), j && (f = new ma(i, "visibility", 0, 0, f, -1, null, !1, 0, 0 !== h ? "inherit" : "hidden", 0 === b ? "hidden" : "inherit"), f.xs0 = "inherit", d._overwriteProps.push(f.n), d._overwriteProps.push(c)), f
                    }
                });
                var Ca = function(a, b) {
                        b && (a.removeProperty ? a.removeProperty(b.replace(y, "-$1").toLowerCase()) : a.removeAttribute(b))
                    },
                    Da = function(a) {
                        if (this.t._gsClassPT = this, 1 === a || 0 === a) {
                            this.t.className = 0 === a ? this.b : this.e;
                            for (var b = this.data, c = this.t.style; b;) b.v ? c[b.p] = b.v : Ca(c, b.p), b = b._next;
                            1 === a && this.t._gsClassPT === this && (this.t._gsClassPT = null)
                        } else this.t.className !== this.e && (this.t.className = this.e)
                    };
                qa("className", {
                    parser: function(a, b, d, f, g, h, i) {
                        var j, k, l, m, n, o = a.className,
                            p = a.style.cssText;
                        if (g = f._classNamePT = new ma(a, d, 0, 0, g, 2), g.setRatio = Da, g.pr = -11, c = !0, g.b = o, k = Y(a, e), l = a._gsClassPT) {
                            for (m = {}, n = l.data; n;) m[n.p] = 1, n = n._next;
                            l.setRatio(1)
                        }
                        return a._gsClassPT = g, g.e = "=" !== b.charAt(1) ? b : o.replace(RegExp("\\s*\\b" + b.substr(2) + "\\b"), "") + ("+" === b.charAt(0) ? " " + b.substr(2) : ""), f._tween._duration && (a.className = g.e, j = Z(a, k, Y(a), i, m), a.className = o, g.data = j.firstMPT, a.style.cssText = p, g = g.xfirst = f.parse(a, j.difs, g, h)), g
                    }
                });
                var Ea = function(a) {
                    if ((1 === a || 0 === a) && this.data._totalTime === this.data._totalDuration) {
                        var b, c, d, e, f = this.t.style,
                            g = h.transform.parse;
                        if ("all" === this.e) f.cssText = "", e = !0;
                        else
                            for (b = this.e.split(","), d = b.length; --d > -1;) c = b[d], h[c] && (h[c].parse === g ? e = !0 : c = "transformOrigin" === c ? va : h[c].p), Ca(f, c);
                        e && (Ca(f, ta), this.t._gsTransform && delete this.t._gsTransform)
                    }
                };
                for (qa("clearProps", {
                        parser: function(a, b, d, e, f) {
                            return f = new ma(a, d, 0, 0, f, 2), f.setRatio = Ea, f.e = b, f.pr = -10, f.data = e._tween, c = !0, f
                        }
                    }), i = "bezier,throwProps,physicsProps,physics2D".split(","), oa = i.length; oa--;) ra(i[oa]);
                i = g.prototype, i._firstPT = null, i._onInitTween = function(a, b, h) {
                    if (!a.nodeType) return !1;
                    this._target = a, this._tween = h, this._vars = b, j = b.autoRound, c = !1, d = b.suffixMap || g.suffixMap, e = U(a, ""), f = this._overwriteProps;
                    var i, m, o, p, q, r, s, t, u, w = a.style;
                    if (k && "" === w.zIndex && (i = V(a, "zIndex", e), ("auto" === i || "" === i) && (w.zIndex = 0)), "string" == typeof b && (p = w.cssText, i = Y(a, e), w.cssText = p + ";" + b, i = Z(a, i, Y(a)).difs, !O && v.test(b) && (i.opacity = parseFloat(RegExp.$1)), b = i, w.cssText = p), this._firstPT = m = this.parse(a, b, null), this._transformType) {
                        for (u = 3 === this._transformType, ta ? l && (k = !0, "" === w.zIndex && (s = V(a, "zIndex", e), ("auto" === s || "" === s) && (w.zIndex = 0)), n && (w.WebkitBackfaceVisibility = this._vars.WebkitBackfaceVisibility || (u ? "visible" : "hidden"))) : w.zoom = 1, o = m; o && o._next;) o = o._next;
                        t = new ma(a, "transform", 0, 0, null, 2), this._linkCSSP(t, null, o), t.setRatio = u && wa ? za : ta ? Aa : ya, t.data = this._transform || xa(a, e, !0), f.pop()
                    }
                    if (c) {
                        for (; m;) {
                            for (r = m._next, o = p; o && o.pr > m.pr;) o = o._next;
                            (m._prev = o ? o._prev : q) ? m._prev._next = m: p = m, (m._next = o) ? o._prev = m : q = m, m = r
                        }
                        this._firstPT = p
                    }
                    return !0
                }, i.parse = function(a, b, c, f) {
                    var g, i, k, l, m, n, o, p, q, r, s = a.style;
                    for (g in b) n = b[g], i = h[g], i ? c = i.parse(a, n, g, this, c, f, b) : (m = V(a, g, e) + "", q = "string" == typeof n, "color" === g || "fill" === g || "stroke" === g || -1 !== g.indexOf("Color") || q && x.test(n) ? (q || (n = ha(n), n = (n.length > 3 ? "rgba(" : "rgb(") + n.join(",") + ")"), c = na(s, g, m, n, !0, "transparent", c, 0, f)) : !q || -1 === n.indexOf(" ") && -1 === n.indexOf(",") ? (k = parseFloat(m), o = k || 0 === k ? m.substr((k + "").length) : "", ("" === m || "auto" === m) && ("width" === g || "height" === g ? (k = aa(a, g, e), o = "px") : "left" === g || "top" === g ? (k = X(a, g, e), o = "px") : (k = "opacity" !== g ? 0 : 1, o = "")), r = q && "=" === n.charAt(1), r ? (l = parseInt(n.charAt(0) + "1", 10), n = n.substr(2), l *= parseFloat(n), p = n.replace(t, "")) : (l = parseFloat(n), p = q ? n.substr((l + "").length) || "" : ""), "" === p && (p = d[g] || o), n = l || 0 === l ? (r ? l + k : l) + p : b[g], o !== p && "" !== p && (l || 0 === l) && (k || 0 === k) && (k = W(a, g, k, o), "%" === p ? (k /= W(a, g, 100, "%") / 100, k > 100 && (k = 100), b.strictUnits !== !0 && (m = k + "%")) : "em" === p ? k /= W(a, g, 1, "em") : (l = W(a, g, l, p), p = "px"), r && (l || 0 === l) && (n = l + k + p)), r && (l += k), !k && 0 !== k || !l && 0 !== l ? void 0 !== s[g] && (n || "NaN" != n + "" && null != n) ? (c = new ma(s, g, l || k || 0, 0, c, -1, g, !1, 0, m, n), c.xs0 = "none" !== n || "display" !== g && -1 === g.indexOf("Style") ? n : m) : Q("invalid " + g + " tween value: " + b[g]) : (c = new ma(s, g, k, l - k, c, 0, g, j !== !1 && ("px" === p || "zIndex" === g), 0, m, n), c.xs0 = p)) : c = na(s, g, m, n, !0, null, c, 0, f)), f && c && !c.plugin && (c.plugin = f);
                    return c
                }, i.setRatio = function(a) {
                    var b, c, d, e = this._firstPT,
                        f = 1e-6;
                    if (1 !== a || this._tween._time !== this._tween._duration && 0 !== this._tween._time)
                        if (a || this._tween._time !== this._tween._duration && 0 !== this._tween._time || this._tween._rawPrevTime === -1e-6)
                            for (; e;) {
                                if (b = e.c * a + e.s, e.r ? b = b > 0 ? 0 | b + .5 : 0 | b - .5 : f > b && b > -f && (b = 0), e.type)
                                    if (1 === e.type)
                                        if (d = e.l, 2 === d) e.t[e.p] = e.xs0 + b + e.xs1 + e.xn1 + e.xs2;
                                        else if (3 === d) e.t[e.p] = e.xs0 + b + e.xs1 + e.xn1 + e.xs2 + e.xn2 + e.xs3;
                                else if (4 === d) e.t[e.p] = e.xs0 + b + e.xs1 + e.xn1 + e.xs2 + e.xn2 + e.xs3 + e.xn3 + e.xs4;
                                else if (5 === d) e.t[e.p] = e.xs0 + b + e.xs1 + e.xn1 + e.xs2 + e.xn2 + e.xs3 + e.xn3 + e.xs4 + e.xn4 + e.xs5;
                                else {
                                    for (c = e.xs0 + b + e.xs1, d = 1; e.l > d; d++) c += e["xn" + d] + e["xs" + (d + 1)];
                                    e.t[e.p] = c
                                } else -1 === e.type ? e.t[e.p] = e.xs0 : e.setRatio && e.setRatio(a);
                                else e.t[e.p] = b + e.xs0;
                                e = e._next
                            } else
                                for (; e;) 2 !== e.type ? e.t[e.p] = e.b : e.setRatio(a), e = e._next;
                        else
                            for (; e;) 2 !== e.type ? e.t[e.p] = e.e : e.setRatio(a), e = e._next
                }, i._enableTransforms = function(a) {
                    this._transformType = a || 3 === this._transformType ? 3 : 2, this._transform = this._transform || xa(this._target, e, !0)
                }, i._linkCSSP = function(a, b, c, d) {
                    return a && (b && (b._prev = a), a._next && (a._next._prev = a._prev), a._prev ? a._prev._next = a._next : this._firstPT === a && (this._firstPT = a._next, d = !0), c ? c._next = a : d || null !== this._firstPT || (this._firstPT = a), a._next = b, a._prev = c), a
                }, i._kill = function(b) {
                    var c, d, e, f = b;
                    if (b.autoAlpha || b.alpha) {
                        f = {};
                        for (d in b) f[d] = b[d];
                        f.opacity = 1, f.autoAlpha && (f.visibility = 1)
                    }
                    return b.className && (c = this._classNamePT) && (e = c.xfirst, e && e._prev ? this._linkCSSP(e._prev, c._next, e._prev._prev) : e === this._firstPT && (this._firstPT = c._next), c._next && this._linkCSSP(c._next, c._next._next, e._prev), this._classNamePT = null), a.prototype._kill.call(this, f)
                };
                var Fa = function(a, b, c) {
                    var d, e, f, g;
                    if (a.slice)
                        for (e = a.length; --e > -1;) Fa(a[e], b, c);
                    else
                        for (d = a.childNodes, e = d.length; --e > -1;) f = d[e], g = f.type, f.style && (b.push(Y(f)), c && c.push(f)), 1 !== g && 9 !== g && 11 !== g || !f.childNodes.length || Fa(f, b, c)
                };
                return g.cascadeTo = function(a, c, d) {
                    var e, f, g, h = b.to(a, c, d),
                        i = [h],
                        j = [],
                        k = [],
                        l = [],
                        m = b._internals.reservedProps;
                    for (a = h._targets || h.target, Fa(a, j, l), h.render(c, !0), Fa(a, k), h.render(0, !0), h._enabled(!0), e = l.length; --e > -1;)
                        if (f = Z(l[e], j[e], k[e]), f.firstMPT) {
                            f = f.difs;
                            for (g in d) m[g] && (f[g] = d[g]);
                            i.push(b.to(l[e], c, f))
                        }
                    return i
                }, a.activate([g]), g
            }, !0),
            function() {
                var a = window._gsDefine.plugin({
                        propName: "roundProps",
                        priority: -1,
                        API: 2,
                        init: function(a, b, c) {
                            return this._tween = c, !0
                        }
                    }),
                    b = a.prototype;
                b._onInitAllProps = function() {
                    for (var a, b, c, d = this._tween, e = d.vars.roundProps instanceof Array ? d.vars.roundProps : d.vars.roundProps.split(","), f = e.length, g = {}, h = d._propLookup.roundProps; --f > -1;) g[e[f]] = 1;
                    for (f = e.length; --f > -1;)
                        for (a = e[f], b = d._firstPT; b;) c = b._next, b.pg ? b.t._roundProps(g, !0) : b.n === a && (this._add(b.t, a, b.s, b.c), c && (c._prev = b._prev), b._prev ? b._prev._next = c : d._firstPT === b && (d._firstPT = c), b._next = b._prev = null,
                            d._propLookup[a] = h), b = c;
                    return !1
                }, b._add = function(a, b, c, d) {
                    this._addTween(a, b, c, c + d, b, !0), this._overwriteProps.push(b)
                }
            }(), window._gsDefine.plugin({
                propName: "attr",
                API: 2,
                init: function(a, b) {
                    var c;
                    if ("function" != typeof a.setAttribute) return !1;
                    this._target = a, this._proxy = {};
                    for (c in b) this._addTween(this._proxy, c, parseFloat(a.getAttribute(c)), b[c], c) && this._overwriteProps.push(c);
                    return !0
                },
                set: function(a) {
                    this._super.setRatio.call(this, a);
                    for (var b, c = this._overwriteProps, d = c.length; --d > -1;) b = c[d], this._target.setAttribute(b, this._proxy[b] + "")
                }
            }), window._gsDefine.plugin({
                propName: "directionalRotation",
                API: 2,
                init: function(a, b) {
                    "object" != typeof b && (b = {
                        rotation: b
                    }), this.finals = {};
                    var c, d, e, f, g, h, i = b.useRadians === !0 ? 2 * Math.PI : 360,
                        j = 1e-6;
                    for (c in b) "useRadians" !== c && (h = (b[c] + "").split("_"), d = h[0], e = parseFloat("function" != typeof a[c] ? a[c] : a[c.indexOf("set") || "function" != typeof a["get" + c.substr(3)] ? c : "get" + c.substr(3)]()), f = this.finals[c] = "string" == typeof d && "=" === d.charAt(1) ? e + parseInt(d.charAt(0) + "1", 10) * Number(d.substr(2)) : Number(d) || 0, g = f - e, h.length && (d = h.join("_"), -1 !== d.indexOf("short") && (g %= i, g !== g % (i / 2) && (g = 0 > g ? g + i : g - i)), -1 !== d.indexOf("_cw") && 0 > g ? g = (g + 9999999999 * i) % i - (0 | g / i) * i : -1 !== d.indexOf("ccw") && g > 0 && (g = (g - 9999999999 * i) % i - (0 | g / i) * i)), (g > j || -j > g) && (this._addTween(a, c, e, e + g, c), this._overwriteProps.push(c)));
                    return !0
                },
                set: function(a) {
                    var b;
                    if (1 !== a) this._super.setRatio.call(this, a);
                    else
                        for (b = this._firstPT; b;) b.f ? b.t[b.p](this.finals[b.p]) : b.t[b.p] = this.finals[b.p], b = b._next
                }
            })._autoCSS = !0, window._gsDefine("easing.Back", ["easing.Ease"], function(a) {
                var b, c, d, e = window.GreenSockGlobals || window,
                    f = e.com.greensock,
                    g = 2 * Math.PI,
                    h = Math.PI / 2,
                    i = f._class,
                    j = function(b, c) {
                        var d = i("easing." + b, function() {}, !0),
                            e = d.prototype = new a;
                        return e.constructor = d, e.getRatio = c, d
                    },
                    k = a.register || function() {},
                    l = function(a, b, c, d) {
                        var e = i("easing." + a, {
                            easeOut: new b,
                            easeIn: new c,
                            easeInOut: new d
                        }, !0);
                        return k(e, a), e
                    },
                    m = function(a, b, c) {
                        this.t = a, this.v = b, c && (this.next = c, c.prev = this, this.c = c.v - b, this.gap = c.t - a)
                    },
                    n = function(b, c) {
                        var d = i("easing." + b, function(a) {
                                this._p1 = a || 0 === a ? a : 1.70158, this._p2 = 1.525 * this._p1
                            }, !0),
                            e = d.prototype = new a;
                        return e.constructor = d, e.getRatio = c, e.config = function(a) {
                            return new d(a)
                        }, d
                    },
                    o = l("Back", n("BackOut", function(a) {
                        return (a -= 1) * a * ((this._p1 + 1) * a + this._p1) + 1
                    }), n("BackIn", function(a) {
                        return a * a * ((this._p1 + 1) * a - this._p1)
                    }), n("BackInOut", function(a) {
                        return 1 > (a *= 2) ? .5 * a * a * ((this._p2 + 1) * a - this._p2) : .5 * ((a -= 2) * a * ((this._p2 + 1) * a + this._p2) + 2)
                    })),
                    p = i("easing.SlowMo", function(a, b, c) {
                        b = b || 0 === b ? b : .7, null == a ? a = .7 : a > 1 && (a = 1), this._p = 1 !== a ? b : 0, this._p1 = (1 - a) / 2, this._p2 = a, this._p3 = this._p1 + this._p2, this._calcEnd = c === !0
                    }, !0),
                    q = p.prototype = new a;
                return q.constructor = p, q.getRatio = function(a) {
                    var b = a + (.5 - a) * this._p;
                    return this._p1 > a ? this._calcEnd ? 1 - (a = 1 - a / this._p1) * a : b - (a = 1 - a / this._p1) * a * a * a * b : a > this._p3 ? this._calcEnd ? 1 - (a = (a - this._p3) / this._p1) * a : b + (a - b) * (a = (a - this._p3) / this._p1) * a * a * a : this._calcEnd ? 1 : b
                }, p.ease = new p(.7, .7), q.config = p.config = function(a, b, c) {
                    return new p(a, b, c)
                }, b = i("easing.SteppedEase", function(a) {
                    a = a || 1, this._p1 = 1 / a, this._p2 = a + 1
                }, !0), q = b.prototype = new a, q.constructor = b, q.getRatio = function(a) {
                    return 0 > a ? a = 0 : a >= 1 && (a = .999999999), (this._p2 * a >> 0) * this._p1
                }, q.config = b.config = function(a) {
                    return new b(a)
                }, c = i("easing.RoughEase", function(b) {
                    b = b || {};
                    for (var c, d, e, f, g, h, i = b.taper || "none", j = [], k = 0, l = 0 | (b.points || 20), n = l, o = b.randomize !== !1, p = b.clamp === !0, q = b.template instanceof a ? b.template : null, r = "number" == typeof b.strength ? .4 * b.strength : .4; --n > -1;) c = o ? Math.random() : 1 / l * n, d = q ? q.getRatio(c) : c, "none" === i ? e = r : "out" === i ? (f = 1 - c, e = f * f * r) : "in" === i ? e = c * c * r : .5 > c ? (f = 2 * c, e = .5 * f * f * r) : (f = 2 * (1 - c), e = .5 * f * f * r), o ? d += Math.random() * e - .5 * e : n % 2 ? d += .5 * e : d -= .5 * e, p && (d > 1 ? d = 1 : 0 > d && (d = 0)), j[k++] = {
                        x: c,
                        y: d
                    };
                    for (j.sort(function(a, b) {
                            return a.x - b.x
                        }), h = new m(1, 1, null), n = l; --n > -1;) g = j[n], h = new m(g.x, g.y, h);
                    this._prev = new m(0, 0, 0 !== h.t ? h : h.next)
                }, !0), q = c.prototype = new a, q.constructor = c, q.getRatio = function(a) {
                    var b = this._prev;
                    if (a > b.t) {
                        for (; b.next && a >= b.t;) b = b.next;
                        b = b.prev
                    } else
                        for (; b.prev && b.t >= a;) b = b.prev;
                    return this._prev = b, b.v + (a - b.t) / b.gap * b.c
                }, q.config = function(a) {
                    return new c(a)
                }, c.ease = new c, l("Bounce", j("BounceOut", function(a) {
                    return 1 / 2.75 > a ? 7.5625 * a * a : 2 / 2.75 > a ? 7.5625 * (a -= 1.5 / 2.75) * a + .75 : 2.5 / 2.75 > a ? 7.5625 * (a -= 2.25 / 2.75) * a + .9375 : 7.5625 * (a -= 2.625 / 2.75) * a + .984375
                }), j("BounceIn", function(a) {
                    return 1 / 2.75 > (a = 1 - a) ? 1 - 7.5625 * a * a : 2 / 2.75 > a ? 1 - (7.5625 * (a -= 1.5 / 2.75) * a + .75) : 2.5 / 2.75 > a ? 1 - (7.5625 * (a -= 2.25 / 2.75) * a + .9375) : 1 - (7.5625 * (a -= 2.625 / 2.75) * a + .984375)
                }), j("BounceInOut", function(a) {
                    var b = .5 > a;
                    return a = b ? 1 - 2 * a : 2 * a - 1, a = 1 / 2.75 > a ? 7.5625 * a * a : 2 / 2.75 > a ? 7.5625 * (a -= 1.5 / 2.75) * a + .75 : 2.5 / 2.75 > a ? 7.5625 * (a -= 2.25 / 2.75) * a + .9375 : 7.5625 * (a -= 2.625 / 2.75) * a + .984375, b ? .5 * (1 - a) : .5 * a + .5
                })), l("Circ", j("CircOut", function(a) {
                    return Math.sqrt(1 - (a -= 1) * a)
                }), j("CircIn", function(a) {
                    return -(Math.sqrt(1 - a * a) - 1)
                }), j("CircInOut", function(a) {
                    return 1 > (a *= 2) ? -.5 * (Math.sqrt(1 - a * a) - 1) : .5 * (Math.sqrt(1 - (a -= 2) * a) + 1)
                })), d = function(b, c, d) {
                    var e = i("easing." + b, function(a, b) {
                            this._p1 = a || 1, this._p2 = b || d, this._p3 = this._p2 / g * (Math.asin(1 / this._p1) || 0)
                        }, !0),
                        f = e.prototype = new a;
                    return f.constructor = e, f.getRatio = c, f.config = function(a, b) {
                        return new e(a, b)
                    }, e
                }, l("Elastic", d("ElasticOut", function(a) {
                    return this._p1 * Math.pow(2, -10 * a) * Math.sin((a - this._p3) * g / this._p2) + 1
                }, .3), d("ElasticIn", function(a) {
                    return -(this._p1 * Math.pow(2, 10 * (a -= 1)) * Math.sin((a - this._p3) * g / this._p2))
                }, .3), d("ElasticInOut", function(a) {
                    return 1 > (a *= 2) ? -.5 * this._p1 * Math.pow(2, 10 * (a -= 1)) * Math.sin((a - this._p3) * g / this._p2) : .5 * this._p1 * Math.pow(2, -10 * (a -= 1)) * Math.sin((a - this._p3) * g / this._p2) + 1
                }, .45)), l("Expo", j("ExpoOut", function(a) {
                    return 1 - Math.pow(2, -10 * a)
                }), j("ExpoIn", function(a) {
                    return Math.pow(2, 10 * (a - 1)) - .001
                }), j("ExpoInOut", function(a) {
                    return 1 > (a *= 2) ? .5 * Math.pow(2, 10 * (a - 1)) : .5 * (2 - Math.pow(2, -10 * (a - 1)))
                })), l("Sine", j("SineOut", function(a) {
                    return Math.sin(a * h)
                }), j("SineIn", function(a) {
                    return -Math.cos(a * h) + 1
                }), j("SineInOut", function(a) {
                    return -.5 * (Math.cos(Math.PI * a) - 1)
                })), i("easing.EaseLookup", {
                    find: function(b) {
                        return a.map[b]
                    }
                }, !0), k(e.SlowMo, "SlowMo", "ease,"), k(c, "RoughEase", "ease,"), k(b, "SteppedEase", "ease,"), o
            }, !0)
    }),
    function(a) {
        "use strict";
        var b, c, d, e, f, g = a.GreenSockGlobals || a,
            h = function(a) {
                var b, c = a.split("."),
                    d = g;
                for (b = 0; c.length > b; b++) d[c[b]] = d = d[c[b]] || {};
                return d
            },
            i = h("com.greensock"),
            j = [].slice,
            k = function() {},
            l = {},
            m = function(b, c, d, e) {
                this.sc = l[b] ? l[b].sc : [], l[b] = this, this.gsClass = null, this.func = d;
                var f = [];
                this.check = function(i) {
                    for (var j, k, n, o, p = c.length, q = p; --p > -1;)(j = l[c[p]] || new m(c[p], [])).gsClass ? (f[p] = j.gsClass, q--) : i && j.sc.push(this);
                    if (0 === q && d)
                        for (k = ("com.greensock." + b).split("."), n = k.pop(), o = h(k.join("."))[n] = this.gsClass = d.apply(d, f), e && (g[n] = o, "function" == typeof define && define.amd ? define((a.GreenSockAMDPath ? a.GreenSockAMDPath + "/" : "") + b.split(".").join("/"), [], function() {
                                return o
                            }) : "undefined" != typeof module && module.exports && (module.exports = o)), p = 0; this.sc.length > p; p++) this.sc[p].check()
                }, this.check(!0)
            },
            n = a._gsDefine = function(a, b, c, d) {
                return new m(a, b, c, d)
            },
            o = i._class = function(a, b, c) {
                return b = b || function() {}, n(a, [], function() {
                    return b
                }, c), b
            };
        n.globals = g;
        var p = [0, 0, 1, 1],
            q = [],
            r = o("easing.Ease", function(a, b, c, d) {
                this._func = a, this._type = c || 0, this._power = d || 0, this._params = b ? p.concat(b) : p
            }, !0),
            s = r.map = {},
            t = r.register = function(a, b, c, d) {
                for (var e, f, g, h, j = b.split(","), k = j.length, l = (c || "easeIn,easeOut,easeInOut").split(","); --k > -1;)
                    for (f = j[k], e = d ? o("easing." + f, null, !0) : i.easing[f] || {}, g = l.length; --g > -1;) h = l[g], s[f + "." + h] = s[h + f] = e[h] = a.getRatio ? a : a[h] || new a
            };
        for (d = r.prototype, d._calcEnd = !1, d.getRatio = function(a) {
                if (this._func) return this._params[0] = a, this._func.apply(null, this._params);
                var b = this._type,
                    c = this._power,
                    d = 1 === b ? 1 - a : 2 === b ? a : .5 > a ? 2 * a : 2 * (1 - a);
                return 1 === c ? d *= d : 2 === c ? d *= d * d : 3 === c ? d *= d * d * d : 4 === c && (d *= d * d * d * d), 1 === b ? 1 - d : 2 === b ? d : .5 > a ? d / 2 : 1 - d / 2
            }, b = ["Linear", "Quad", "Cubic", "Quart", "Quint,Strong"], c = b.length; --c > -1;) d = b[c] + ",Power" + c, t(new r(null, null, 1, c), d, "easeOut", !0), t(new r(null, null, 2, c), d, "easeIn" + (0 === c ? ",easeNone" : "")), t(new r(null, null, 3, c), d, "easeInOut");
        s.linear = i.easing.Linear.easeIn, s.swing = i.easing.Quad.easeInOut;
        var u = o("events.EventDispatcher", function(a) {
            this._listeners = {}, this._eventTarget = a || this
        });
        d = u.prototype, d.addEventListener = function(a, b, c, d, g) {
            g = g || 0;
            var h, i, j = this._listeners[a],
                k = 0;
            for (null == j && (this._listeners[a] = j = []), i = j.length; --i > -1;) h = j[i], h.c === b && h.s === c ? j.splice(i, 1) : 0 === k && g > h.pr && (k = i + 1);
            j.splice(k, 0, {
                c: b,
                s: c,
                up: d,
                pr: g
            }), this !== e || f || e.wake()
        }, d.removeEventListener = function(a, b) {
            var c, d = this._listeners[a];
            if (d)
                for (c = d.length; --c > -1;)
                    if (d[c].c === b) return void d.splice(c, 1)
        }, d.dispatchEvent = function(a) {
            var b, c, d, e = this._listeners[a];
            if (e)
                for (b = e.length, c = this._eventTarget; --b > -1;) d = e[b], d.up ? d.c.call(d.s || c, {
                    type: a,
                    target: c
                }) : d.c.call(d.s || c)
        };
        var v = a.requestAnimationFrame,
            w = a.cancelAnimationFrame,
            x = Date.now || function() {
                return (new Date).getTime()
            },
            y = x();
        for (b = ["ms", "moz", "webkit", "o"], c = b.length; --c > -1 && !v;) v = a[b[c] + "RequestAnimationFrame"], w = a[b[c] + "CancelAnimationFrame"] || a[b[c] + "CancelRequestAnimationFrame"];
        o("Ticker", function(a, b) {
            var c, d, g, h, i, j = this,
                l = x(),
                m = b !== !1 && v,
                n = function(a) {
                    y = x(), j.time = (y - l) / 1e3;
                    var b, e = j.time - i;
                    (!c || e > 0 || a === !0) && (j.frame++, i += e + (e >= h ? .004 : h - e), b = !0), a !== !0 && (g = d(n)), b && j.dispatchEvent("tick")
                };
            u.call(j), j.time = j.frame = 0, j.tick = function() {
                n(!0)
            }, j.sleep = function() {
                null != g && (m && w ? w(g) : clearTimeout(g), d = k, g = null, j === e && (f = !1))
            }, j.wake = function() {
                null !== g && j.sleep(), d = 0 === c ? k : m && v ? v : function(a) {
                    return setTimeout(a, 0 | 1e3 * (i - j.time) + 1)
                }, j === e && (f = !0), n(2)
            }, j.fps = function(a) {
                return arguments.length ? (c = a, h = 1 / (c || 60), i = this.time + h, void j.wake()) : c
            }, j.useRAF = function(a) {
                return arguments.length ? (j.sleep(), m = a, void j.fps(c)) : m
            }, j.fps(a), setTimeout(function() {
                m && (!g || 5 > j.frame) && j.useRAF(!1)
            }, 1500)
        }), d = i.Ticker.prototype = new i.events.EventDispatcher, d.constructor = i.Ticker;
        var z = o("core.Animation", function(a, b) {
            if (this.vars = b = b || {}, this._duration = this._totalDuration = a || 0, this._delay = Number(b.delay) || 0, this._timeScale = 1, this._active = b.immediateRender === !0, this.data = b.data, this._reversed = b.reversed === !0, M) {
                f || e.wake();
                var c = this.vars.useFrames ? L : M;
                c.add(this, c._time), this.vars.paused && this.paused(!0)
            }
        });
        e = z.ticker = new i.Ticker, d = z.prototype, d._dirty = d._gc = d._initted = d._paused = !1, d._totalTime = d._time = 0, d._rawPrevTime = -1, d._next = d._last = d._onUpdate = d._timeline = d.timeline = null, d._paused = !1;
        var A = function() {
            x() - y > 2e3 && e.wake(), setTimeout(A, 2e3)
        };
        A(), d.play = function(a, b) {
            return arguments.length && this.seek(a, b), this.reversed(!1).paused(!1)
        }, d.pause = function(a, b) {
            return arguments.length && this.seek(a, b), this.paused(!0)
        }, d.resume = function(a, b) {
            return arguments.length && this.seek(a, b), this.paused(!1)
        }, d.seek = function(a, b) {
            return this.totalTime(Number(a), b !== !1)
        }, d.restart = function(a, b) {
            return this.reversed(!1).paused(!1).totalTime(a ? -this._delay : 0, b !== !1, !0)
        }, d.reverse = function(a, b) {
            return arguments.length && this.seek(a || this.totalDuration(), b), this.reversed(!0).paused(!1)
        }, d.render = function() {}, d.invalidate = function() {
            return this
        }, d._enabled = function(a, b) {
            return f || e.wake(), this._gc = !a, this._active = a && !this._paused && this._totalTime > 0 && this._totalTime < this._totalDuration, b !== !0 && (a && !this.timeline ? this._timeline.add(this, this._startTime - this._delay) : !a && this.timeline && this._timeline._remove(this, !0)), !1
        }, d._kill = function() {
            return this._enabled(!1, !1)
        }, d.kill = function(a, b) {
            return this._kill(a, b), this
        }, d._uncache = function(a) {
            for (var b = a ? this : this.timeline; b;) b._dirty = !0, b = b.timeline;
            return this
        }, d._swapSelfInParams = function(a) {
            for (var b = a.length, c = a.concat(); --b > -1;) "{self}" === a[b] && (c[b] = this);
            return c
        }, d.eventCallback = function(a, b, c, d) {
            if ("on" === (a || "").substr(0, 2)) {
                var e = this.vars;
                if (1 === arguments.length) return e[a];
                null == b ? delete e[a] : (e[a] = b, e[a + "Params"] = c instanceof Array && -1 !== c.join("").indexOf("{self}") ? this._swapSelfInParams(c) : c, e[a + "Scope"] = d), "onUpdate" === a && (this._onUpdate = b)
            }
            return this
        }, d.delay = function(a) {
            return arguments.length ? (this._timeline.smoothChildTiming && this.startTime(this._startTime + a - this._delay), this._delay = a, this) : this._delay
        }, d.duration = function(a) {
            return arguments.length ? (this._duration = this._totalDuration = a, this._uncache(!0), this._timeline.smoothChildTiming && this._time > 0 && this._time < this._duration && 0 !== a && this.totalTime(this._totalTime * (a / this._duration), !0), this) : (this._dirty = !1, this._duration)
        }, d.totalDuration = function(a) {
            return this._dirty = !1, arguments.length ? this.duration(a) : this._totalDuration
        }, d.time = function(a, b) {
            return arguments.length ? (this._dirty && this.totalDuration(), this.totalTime(a > this._duration ? this._duration : a, b)) : this._time
        }, d.totalTime = function(a, b, c) {
            if (f || e.wake(), !arguments.length) return this._totalTime;
            if (this._timeline) {
                if (0 > a && !c && (a += this.totalDuration()), this._timeline.smoothChildTiming) {
                    this._dirty && this.totalDuration();
                    var d = this._totalDuration,
                        g = this._timeline;
                    if (a > d && !c && (a = d), this._startTime = (this._paused ? this._pauseTime : g._time) - (this._reversed ? d - a : a) / this._timeScale, g._dirty || this._uncache(!1), g._timeline)
                        for (; g._timeline;) g._timeline._time !== (g._startTime + g._totalTime) / g._timeScale && g.totalTime(g._totalTime, !0), g = g._timeline
                }
                this._gc && this._enabled(!0, !1), this._totalTime !== a && this.render(a, b, !1)
            }
            return this
        }, d.startTime = function(a) {
            return arguments.length ? (a !== this._startTime && (this._startTime = a, this.timeline && this.timeline._sortChildren && this.timeline.add(this, a - this._delay)), this) : this._startTime
        }, d.timeScale = function(a) {
            if (!arguments.length) return this._timeScale;
            if (a = a || 1e-6, this._timeline && this._timeline.smoothChildTiming) {
                var b = this._pauseTime,
                    c = b || 0 === b ? b : this._timeline.totalTime();
                this._startTime = c - (c - this._startTime) * this._timeScale / a
            }
            return this._timeScale = a, this._uncache(!1)
        }, d.reversed = function(a) {
            return arguments.length ? (a != this._reversed && (this._reversed = a, this.totalTime(this._totalTime, !0)), this) : this._reversed
        }, d.paused = function(a) {
            if (!arguments.length) return this._paused;
            if (a != this._paused && this._timeline) {
                f || a || e.wake();
                var b = this._timeline,
                    c = b.rawTime(),
                    d = c - this._pauseTime;
                !a && b.smoothChildTiming && (this._startTime += d, this._uncache(!1)), this._pauseTime = a ? c : null, this._paused = a, this._active = !a && this._totalTime > 0 && this._totalTime < this._totalDuration, a || 0 === d || 0 === this._duration || this.render(b.smoothChildTiming ? this._totalTime : (c - this._startTime) / this._timeScale, !0, !0)
            }
            return this._gc && !a && this._enabled(!0, !1), this
        };
        var B = o("core.SimpleTimeline", function(a) {
            z.call(this, 0, a), this.autoRemoveChildren = this.smoothChildTiming = !0
        });
        d = B.prototype = new z, d.constructor = B, d.kill()._gc = !1, d._first = d._last = null, d._sortChildren = !1, d.add = d.insert = function(a, b) {
            var c, d;
            if (a._startTime = Number(b || 0) + a._delay, a._paused && this !== a._timeline && (a._pauseTime = a._startTime + (this.rawTime() - a._startTime) / a._timeScale), a.timeline && a.timeline._remove(a, !0), a.timeline = a._timeline = this, a._gc && a._enabled(!0, !0), c = this._last, this._sortChildren)
                for (d = a._startTime; c && c._startTime > d;) c = c._prev;
            return c ? (a._next = c._next, c._next = a) : (a._next = this._first, this._first = a), a._next ? a._next._prev = a : this._last = a, a._prev = c, this._timeline && this._uncache(!0), this
        }, d._remove = function(a, b) {
            return a.timeline === this && (b || a._enabled(!1, !0), a.timeline = null, a._prev ? a._prev._next = a._next : this._first === a && (this._first = a._next), a._next ? a._next._prev = a._prev : this._last === a && (this._last = a._prev), this._timeline && this._uncache(!0)), this
        }, d.render = function(a, b, c) {
            var d, e = this._first;
            for (this._totalTime = this._time = this._rawPrevTime = a; e;) d = e._next, (e._active || a >= e._startTime && !e._paused) && (e._reversed ? e.render((e._dirty ? e.totalDuration() : e._totalDuration) - (a - e._startTime) * e._timeScale, b, c) : e.render((a - e._startTime) * e._timeScale, b, c)), e = d
        }, d.rawTime = function() {
            return f || e.wake(), this._totalTime
        };
        var C = o("TweenLite", function(b, c, d) {
                if (z.call(this, c, d), this.render = C.prototype.render, null == b) throw "Cannot tween a null target.";
                this.target = b = "string" != typeof b ? b : C.selector(b) || b;
                var e, f, g, h = b.jquery || b.length && b !== a && b[0] && (b[0] === a || b[0].nodeType && b[0].style && !b.nodeType),
                    i = this.vars.overwrite;
                if (this._overwrite = i = null == i ? K[C.defaultOverwrite] : "number" == typeof i ? i >> 0 : K[i], (h || b instanceof Array) && "number" != typeof b[0])
                    for (this._targets = g = j.call(b, 0), this._propLookup = [], this._siblings = [], e = 0; g.length > e; e++) f = g[e], f ? "string" != typeof f ? f.length && f !== a && f[0] && (f[0] === a || f[0].nodeType && f[0].style && !f.nodeType) ? (g.splice(e--, 1), this._targets = g = g.concat(j.call(f, 0))) : (this._siblings[e] = N(f, this, !1), 1 === i && this._siblings[e].length > 1 && O(f, this, null, 1, this._siblings[e])) : (f = g[e--] = C.selector(f), "string" == typeof f && g.splice(e + 1, 1)) : g.splice(e--, 1);
                else this._propLookup = {}, this._siblings = N(b, this, !1), 1 === i && this._siblings.length > 1 && O(b, this, null, 1, this._siblings);
                (this.vars.immediateRender || 0 === c && 0 === this._delay && this.vars.immediateRender !== !1) && this.render(-this._delay, !1, !0)
            }, !0),
            D = function(b) {
                return b.length && b !== a && b[0] && (b[0] === a || b[0].nodeType && b[0].style && !b.nodeType)
            },
            E = function(a, b) {
                var c, d = {};
                for (c in a) J[c] || c in b && "x" !== c && "y" !== c && "width" !== c && "height" !== c && "className" !== c && "border" !== c || !(!G[c] || G[c] && G[c]._autoCSS) || (d[c] = a[c], delete a[c]);
                a.css = d
            };
        d = C.prototype = new z, d.constructor = C, d.kill()._gc = !1, d.ratio = 0, d._firstPT = d._targets = d._overwrittenProps = d._startAt = null, d._notifyPluginsOfEnabled = !1, C.version = "1.10.3", C.defaultEase = d._ease = new r(null, null, 1, 1), C.defaultOverwrite = "auto", C.ticker = e, C.autoSleep = !0, C.selector = a.$ || a.jQuery || function(b) {
            return a.$ ? (C.selector = a.$, a.$(b)) : a.document ? a.document.getElementById("#" === b.charAt(0) ? b.substr(1) : b) : b
        };
        var F = C._internals = {},
            G = C._plugins = {},
            H = C._tweenLookup = {},
            I = 0,
            J = F.reservedProps = {
                ease: 1,
                delay: 1,
                overwrite: 1,
                onComplete: 1,
                onCompleteParams: 1,
                onCompleteScope: 1,
                useFrames: 1,
                runBackwards: 1,
                startAt: 1,
                onUpdate: 1,
                onUpdateParams: 1,
                onUpdateScope: 1,
                onStart: 1,
                onStartParams: 1,
                onStartScope: 1,
                onReverseComplete: 1,
                onReverseCompleteParams: 1,
                onReverseCompleteScope: 1,
                onRepeat: 1,
                onRepeatParams: 1,
                onRepeatScope: 1,
                easeParams: 1,
                yoyo: 1,
                immediateRender: 1,
                repeat: 1,
                repeatDelay: 1,
                data: 1,
                paused: 1,
                reversed: 1,
                autoCSS: 1
            },
            K = {
                none: 0,
                all: 1,
                auto: 2,
                concurrent: 3,
                allOnStart: 4,
                preexisting: 5,
                "true": 1,
                "false": 0
            },
            L = z._rootFramesTimeline = new B,
            M = z._rootTimeline = new B;
        M._startTime = e.time, L._startTime = e.frame, M._active = L._active = !0, z._updateRoot = function() {
            if (M.render((e.time - M._startTime) * M._timeScale, !1, !1), L.render((e.frame - L._startTime) * L._timeScale, !1, !1), !(e.frame % 120)) {
                var a, b, c;
                for (c in H) {
                    for (b = H[c].tweens, a = b.length; --a > -1;) b[a]._gc && b.splice(a, 1);
                    0 === b.length && delete H[c]
                }
                if (c = M._first, (!c || c._paused) && C.autoSleep && !L._first && 1 === e._listeners.tick.length) {
                    for (; c && c._paused;) c = c._next;
                    c || e.sleep()
                }
            }
        }, e.addEventListener("tick", z._updateRoot);
        var N = function(a, b, c) {
                var d, e, f = a._gsTweenID;
                if (H[f || (a._gsTweenID = f = "t" + I++)] || (H[f] = {
                        target: a,
                        tweens: []
                    }), b && (d = H[f].tweens, d[e = d.length] = b, c))
                    for (; --e > -1;) d[e] === b && d.splice(e, 1);
                return H[f].tweens
            },
            O = function(a, b, c, d, e) {
                var f, g, h, i;
                if (1 === d || d >= 4) {
                    for (i = e.length, f = 0; i > f; f++)
                        if ((h = e[f]) !== b) h._gc || h._enabled(!1, !1) && (g = !0);
                        else if (5 === d) break;
                    return g
                }
                var j, k = b._startTime + 1e-10,
                    l = [],
                    m = 0,
                    n = 0 === b._duration;
                for (f = e.length; --f > -1;)(h = e[f]) === b || h._gc || h._paused || (h._timeline !== b._timeline ? (j = j || P(b, 0, n), 0 === P(h, j, n) && (l[m++] = h)) : k >= h._startTime && h._startTime + h.totalDuration() / h._timeScale + 1e-10 > k && ((n || !h._initted) && 2e-10 >= k - h._startTime || (l[m++] = h)));
                for (f = m; --f > -1;) h = l[f], 2 === d && h._kill(c, a) && (g = !0), (2 !== d || !h._firstPT && h._initted) && h._enabled(!1, !1) && (g = !0);
                return g
            },
            P = function(a, b, c) {
                for (var d = a._timeline, e = d._timeScale, f = a._startTime, g = 1e-10; d._timeline;) {
                    if (f += d._startTime, e *= d._timeScale, d._paused) return -100;
                    d = d._timeline
                }
                return f /= e, f > b ? f - b : c && f === b || !a._initted && 2 * g > f - b ? g : (f += a.totalDuration() / a._timeScale / e) > b + g ? 0 : f - b - g
            };
        d._init = function() {
            var a, b, c, d, e = this.vars,
                f = this._overwrittenProps,
                g = this._duration,
                h = e.immediateRender,
                i = e.ease;
            if (e.startAt) {
                if (this._startAt && this._startAt.render(-1, !0), e.startAt.overwrite = 0, e.startAt.immediateRender = !0, this._startAt = C.to(this.target, 0, e.startAt), h)
                    if (this._time > 0) this._startAt = null;
                    else if (0 !== g) return
            } else if (e.runBackwards && e.immediateRender && 0 !== g)
                if (this._startAt) this._startAt.render(-1, !0), this._startAt = null;
                else if (0 === this._time) {
                c = {};
                for (d in e) J[d] && "autoCSS" !== d || (c[d] = e[d]);
                return c.overwrite = 0, void(this._startAt = C.to(this.target, 0, c))
            }
            if (this._ease = i ? i instanceof r ? e.easeParams instanceof Array ? i.config.apply(i, e.easeParams) : i : "function" == typeof i ? new r(i, e.easeParams) : s[i] || C.defaultEase : C.defaultEase, this._easeType = this._ease._type, this._easePower = this._ease._power, this._firstPT = null, this._targets)
                for (a = this._targets.length; --a > -1;) this._initProps(this._targets[a], this._propLookup[a] = {}, this._siblings[a], f ? f[a] : null) && (b = !0);
            else b = this._initProps(this.target, this._propLookup, this._siblings, f);
            if (b && C._onPluginEvent("_onInitAllProps", this), f && (this._firstPT || "function" != typeof this.target && this._enabled(!1, !1)), e.runBackwards)
                for (c = this._firstPT; c;) c.s += c.c, c.c = -c.c, c = c._next;
            this._onUpdate = e.onUpdate, this._initted = !0
        }, d._initProps = function(b, c, d, e) {
            var f, g, h, i, j, k;
            if (null == b) return !1;
            this.vars.css || b.style && b !== a && b.nodeType && G.css && this.vars.autoCSS !== !1 && E(this.vars, b);
            for (f in this.vars) {
                if (k = this.vars[f], J[f]) k instanceof Array && -1 !== k.join("").indexOf("{self}") && (this.vars[f] = k = this._swapSelfInParams(k, this));
                else if (G[f] && (i = new G[f])._onInitTween(b, this.vars[f], this)) {
                    for (this._firstPT = j = {
                            _next: this._firstPT,
                            t: i,
                            p: "setRatio",
                            s: 0,
                            c: 1,
                            f: !0,
                            n: f,
                            pg: !0,
                            pr: i._priority
                        }, g = i._overwriteProps.length; --g > -1;) c[i._overwriteProps[g]] = this._firstPT;
                    (i._priority || i._onInitAllProps) && (h = !0), (i._onDisable || i._onEnable) && (this._notifyPluginsOfEnabled = !0)
                } else this._firstPT = c[f] = j = {
                    _next: this._firstPT,
                    t: b,
                    p: f,
                    f: "function" == typeof b[f],
                    n: f,
                    pg: !1,
                    pr: 0
                }, j.s = j.f ? b[f.indexOf("set") || "function" != typeof b["get" + f.substr(3)] ? f : "get" + f.substr(3)]() : parseFloat(b[f]), j.c = "string" == typeof k && "=" === k.charAt(1) ? parseInt(k.charAt(0) + "1", 10) * Number(k.substr(2)) : Number(k) - j.s || 0;
                j && j._next && (j._next._prev = j)
            }
            return e && this._kill(e, b) ? this._initProps(b, c, d, e) : this._overwrite > 1 && this._firstPT && d.length > 1 && O(b, this, c, this._overwrite, d) ? (this._kill(c, b), this._initProps(b, c, d, e)) : h
        }, d.render = function(a, b, c) {
            var d, e, f, g = this._time;
            if (a >= this._duration) this._totalTime = this._time = this._duration, this.ratio = this._ease._calcEnd ? this._ease.getRatio(1) : 1, this._reversed || (d = !0, e = "onComplete"), 0 === this._duration && ((0 === a || 0 > this._rawPrevTime) && this._rawPrevTime !== a && (c = !0, this._rawPrevTime > 0 && (e = "onReverseComplete", b && (a = -1))), this._rawPrevTime = a);
            else if (1e-7 > a) this._totalTime = this._time = 0, this.ratio = this._ease._calcEnd ? this._ease.getRatio(0) : 0, (0 !== g || 0 === this._duration && this._rawPrevTime > 0) && (e = "onReverseComplete", d = this._reversed), 0 > a ? (this._active = !1, 0 === this._duration && (this._rawPrevTime >= 0 && (c = !0), this._rawPrevTime = a)) : this._initted || (c = !0);
            else if (this._totalTime = this._time = a, this._easeType) {
                var h = a / this._duration,
                    i = this._easeType,
                    j = this._easePower;
                (1 === i || 3 === i && h >= .5) && (h = 1 - h), 3 === i && (h *= 2), 1 === j ? h *= h : 2 === j ? h *= h * h : 3 === j ? h *= h * h * h : 4 === j && (h *= h * h * h * h), this.ratio = 1 === i ? 1 - h : 2 === i ? h : .5 > a / this._duration ? h / 2 : 1 - h / 2
            } else this.ratio = this._ease.getRatio(a / this._duration);
            if (this._time !== g || c) {
                if (!this._initted) {
                    if (this._init(), !this._initted) return;
                    this._time && !d ? this.ratio = this._ease.getRatio(this._time / this._duration) : d && this._ease._calcEnd && (this.ratio = this._ease.getRatio(0 === this._time ? 0 : 1))
                }
                for (this._active || !this._paused && this._time !== g && a >= 0 && (this._active = !0), 0 === g && (this._startAt && (a >= 0 ? this._startAt.render(a, b, c) : e || (e = "_dummyGS")), this.vars.onStart && (0 !== this._time || 0 === this._duration) && (b || this.vars.onStart.apply(this.vars.onStartScope || this, this.vars.onStartParams || q))), f = this._firstPT; f;) f.f ? f.t[f.p](f.c * this.ratio + f.s) : f.t[f.p] = f.c * this.ratio + f.s, f = f._next;
                this._onUpdate && (0 > a && this._startAt && this._startAt.render(a, b, c), b || this._onUpdate.apply(this.vars.onUpdateScope || this, this.vars.onUpdateParams || q)), e && (this._gc || (0 > a && this._startAt && !this._onUpdate && this._startAt.render(a, b, c), d && (this._timeline.autoRemoveChildren && this._enabled(!1, !1), this._active = !1), !b && this.vars[e] && this.vars[e].apply(this.vars[e + "Scope"] || this, this.vars[e + "Params"] || q)))
            }
        }, d._kill = function(a, b) {
            if ("all" === a && (a = null), null == a && (null == b || b === this.target)) return this._enabled(!1, !1);
            b = "string" != typeof b ? b || this._targets || this.target : C.selector(b) || b;
            var c, d, e, f, g, h, i, j;
            if ((b instanceof Array || D(b)) && "number" != typeof b[0])
                for (c = b.length; --c > -1;) this._kill(a, b[c]) && (h = !0);
            else {
                if (this._targets) {
                    for (c = this._targets.length; --c > -1;)
                        if (b === this._targets[c]) {
                            g = this._propLookup[c] || {}, this._overwrittenProps = this._overwrittenProps || [], d = this._overwrittenProps[c] = a ? this._overwrittenProps[c] || {} : "all";
                            break
                        }
                } else {
                    if (b !== this.target) return !1;
                    g = this._propLookup, d = this._overwrittenProps = a ? this._overwrittenProps || {} : "all"
                }
                if (g) {
                    i = a || g, j = a !== d && "all" !== d && a !== g && (null == a || a._tempKill !== !0);
                    for (e in i)(f = g[e]) && (f.pg && f.t._kill(i) && (h = !0), f.pg && 0 !== f.t._overwriteProps.length || (f._prev ? f._prev._next = f._next : f === this._firstPT && (this._firstPT = f._next), f._next && (f._next._prev = f._prev), f._next = f._prev = null), delete g[e]), j && (d[e] = 1);
                    !this._firstPT && this._initted && this._enabled(!1, !1)
                }
            }
            return h
        }, d.invalidate = function() {
            return this._notifyPluginsOfEnabled && C._onPluginEvent("_onDisable", this), this._firstPT = null, this._overwrittenProps = null, this._onUpdate = null, this._startAt = null, this._initted = this._active = this._notifyPluginsOfEnabled = !1, this._propLookup = this._targets ? {} : [], this
        }, d._enabled = function(a, b) {
            if (f || e.wake(), a && this._gc) {
                var c, d = this._targets;
                if (d)
                    for (c = d.length; --c > -1;) this._siblings[c] = N(d[c], this, !0);
                else this._siblings = N(this.target, this, !0)
            }
            return z.prototype._enabled.call(this, a, b), this._notifyPluginsOfEnabled && this._firstPT ? C._onPluginEvent(a ? "_onEnable" : "_onDisable", this) : !1
        }, C.to = function(a, b, c) {
            return new C(a, b, c)
        }, C.from = function(a, b, c) {
            return c.runBackwards = !0, c.immediateRender = 0 != c.immediateRender, new C(a, b, c)
        }, C.fromTo = function(a, b, c, d) {
            return d.startAt = c, d.immediateRender = 0 != d.immediateRender && 0 != c.immediateRender, new C(a, b, d)
        }, C.delayedCall = function(a, b, c, d, e) {
            return new C(b, 0, {
                delay: a,
                onComplete: b,
                onCompleteParams: c,
                onCompleteScope: d,
                onReverseComplete: b,
                onReverseCompleteParams: c,
                onReverseCompleteScope: d,
                immediateRender: !1,
                useFrames: e,
                overwrite: 0
            })
        }, C.set = function(a, b) {
            return new C(a, 0, b)
        }, C.killTweensOf = C.killDelayedCallsTo = function(a, b) {
            for (var c = C.getTweensOf(a), d = c.length; --d > -1;) c[d]._kill(b, a)
        }, C.getTweensOf = function(a) {
            if (null == a) return [];
            a = "string" != typeof a ? a : C.selector(a) || a;
            var b, c, d, e;
            if ((a instanceof Array || D(a)) && "number" != typeof a[0]) {
                for (b = a.length, c = []; --b > -1;) c = c.concat(C.getTweensOf(a[b]));
                for (b = c.length; --b > -1;)
                    for (e = c[b], d = b; --d > -1;) e === c[d] && c.splice(b, 1)
            } else
                for (c = N(a).concat(), b = c.length; --b > -1;) c[b]._gc && c.splice(b, 1);
            return c
        };
        var Q = o("plugins.TweenPlugin", function(a, b) {
            this._overwriteProps = (a || "").split(","), this._propName = this._overwriteProps[0], this._priority = b || 0, this._super = Q.prototype
        }, !0);
        if (d = Q.prototype, Q.version = "1.10.1", Q.API = 2, d._firstPT = null, d._addTween = function(a, b, c, d, e, f) {
                var g, h;
                return null != d && (g = "number" == typeof d || "=" !== d.charAt(1) ? Number(d) - c : parseInt(d.charAt(0) + "1", 10) * Number(d.substr(2))) ? (this._firstPT = h = {
                    _next: this._firstPT,
                    t: a,
                    p: b,
                    s: c,
                    c: g,
                    f: "function" == typeof a[b],
                    n: e || b,
                    r: f
                }, h._next && (h._next._prev = h), h) : void 0
            }, d.setRatio = function(a) {
                for (var b, c = this._firstPT, d = 1e-6; c;) b = c.c * a + c.s, c.r ? b = 0 | b + (b > 0 ? .5 : -.5) : d > b && b > -d && (b = 0), c.f ? c.t[c.p](b) : c.t[c.p] = b, c = c._next
            }, d._kill = function(a) {
                var b, c = this._overwriteProps,
                    d = this._firstPT;
                if (null != a[this._propName]) this._overwriteProps = [];
                else
                    for (b = c.length; --b > -1;) null != a[c[b]] && c.splice(b, 1);
                for (; d;) null != a[d.n] && (d._next && (d._next._prev = d._prev), d._prev ? (d._prev._next = d._next, d._prev = null) : this._firstPT === d && (this._firstPT = d._next)), d = d._next;
                return !1
            }, d._roundProps = function(a, b) {
                for (var c = this._firstPT; c;)(a[this._propName] || null != c.n && a[c.n.split(this._propName + "_").join("")]) && (c.r = b), c = c._next
            }, C._onPluginEvent = function(a, b) {
                var c, d, e, f, g, h = b._firstPT;
                if ("_onInitAllProps" === a) {
                    for (; h;) {
                        for (g = h._next, d = e; d && d.pr > h.pr;) d = d._next;
                        (h._prev = d ? d._prev : f) ? h._prev._next = h: e = h, (h._next = d) ? d._prev = h : f = h, h = g
                    }
                    h = b._firstPT = e
                }
                for (; h;) h.pg && "function" == typeof h.t[a] && h.t[a]() && (c = !0), h = h._next;
                return c
            }, Q.activate = function(a) {
                for (var b = a.length; --b > -1;) a[b].API === Q.API && (G[(new a[b])._propName] = a[b]);
                return !0
            }, n.plugin = function(a) {
                if (!(a && a.propName && a.init && a.API)) throw "illegal plugin definition.";
                var b, c = a.propName,
                    d = a.priority || 0,
                    e = a.overwriteProps,
                    f = {
                        init: "_onInitTween",
                        set: "setRatio",
                        kill: "_kill",
                        round: "_roundProps",
                        initAll: "_onInitAllProps"
                    },
                    g = o("plugins." + c.charAt(0).toUpperCase() + c.substr(1) + "Plugin", function() {
                        Q.call(this, c, d), this._overwriteProps = e || []
                    }, a.global === !0),
                    h = g.prototype = new Q(c);
                h.constructor = g, g.API = a.API;
                for (b in f) "function" == typeof a[b] && (h[f[b]] = a[b]);
                return g.version = a.version, Q.activate([g]), g
            }, b = a._gsQueue) {
            for (c = 0; b.length > c; c++) b[c]();
            for (d in l) l[d].func || a.console.log("GSAP encountered missing dependency: com.greensock." + d)
        }
        f = !1
    }(window);
var Base = function() {
    arguments.length && (this == window ? Base.prototype.extend.call(arguments[0], arguments.callee.prototype) : this.extend(arguments[0]))
};
Base.version = "1.0.2", Base.prototype = {
    extend: function(a, b) {
        var c = Base.prototype.extend;
        if (2 == arguments.length) {
            var d = this[a];
            if (d instanceof Function && b instanceof Function && d.valueOf() != b.valueOf() && /\bbase\b/.test(b)) {
                var e = b;
                b = function() {
                    var a = this.base;
                    this.base = d;
                    var b = e.apply(this, arguments);
                    return this.base = a, b
                }, b.valueOf = function() {
                    return e
                }, b.toString = function() {
                    return String(e)
                }
            }
            return this[a] = b
        }
        if (a) {
            var f = {
                    toSource: null
                },
                g = ["toString", "valueOf"];
            Base._prototyping && (g[2] = "constructor");
            for (var h = 0; i = g[h]; h++) a[i] != f[i] && c.call(this, i, a[i]);
            for (var i in a) f[i] || c.call(this, i, a[i])
        }
        return this
    },
    base: function() {}
}, Base.extend = function(a, b) {
    var c = Base.prototype.extend;
    a || (a = {}), Base._prototyping = !0;
    var d = new this;
    c.call(d, a);
    var e = d.constructor;
    d.constructor = this, delete Base._prototyping;
    var f = function() {
        Base._prototyping || e.apply(this, arguments), this.constructor = f
    };
    f.prototype = d, f.extend = this.extend, f.implement = this.implement, f.toString = function() {
        return String(e)
    }, c.call(f, b);
    var g = e ? f : d;
    return g.init instanceof Function && g.init(), g
}, Base.implement = function(a) {
    a instanceof Function && (a = a.prototype), this.prototype.extend(a)
};
var AbstractColor = Base.extend({
        constructor: function() {
            this.warn()
        },
        toHex: function() {
            this.warn()
        },
        toRGB: function() {
            this.warn()
        },
        toXYZ: function() {
            this.warn()
        },
        toYxy: function() {
            this.warn()
        },
        toCIELab: function() {
            this.warn()
        },
        toCIELCh: function() {
            this.warn()
        },
        toCMY: function() {
            this.warn()
        },
        toCMYK: function() {
            this.warn()
        },
        toHSV: function() {
            this.warn()
        },
        distance: function(a) {
            var b = this.toCIELab(),
                c = a.toCIELab();
            return Math.sqrt(Math.pow(b.l - c.l, 2) + Math.pow(b.a - c.a, 2) + Math.pow(b.b - c.b, 2))
        },
        websafe: function() {
            var a = new Array("00", "CC", "33", "66", "99", "FF"),
                b = [];
            for (i = 0; i < 6; i++)
                for (j = 0; j < 6; j++)
                    for (k = 0; k < 6; k++) b.push(new Hex(a[i] + a[j] + a[k]));
            return this.match(b)
        },
        match: function(a) {
            for (var b = null, c = null, d = 0; d < a.length; d++) {
                var e = this.distance(a[d]);
                (null == b || b > e) && (b = e, c = a[d])
            }
            return c[this.toSelf]()
        },
        equal: function(a, b) {
            null == b && (b = !1), 2 > a && (a = 2);
            var c = 360 / a,
                d = [];
            b && d.push(this);
            for (var e = 1; a > e; e++) d.push(this.hue(c * e)[this.toSelf]());
            return d
        },
        split: function(a) {
            null == a && (a = !1);
            var b = [];
            return b.push(this.hue(150)[this.toSelf]()), a && b.push(this), b.push(this.hue(-150)[this.toSelf]()), b
        },
        complement: function(a) {
            null == a && (a = !1);
            var b = [this.hue(180)[this.toSelf]()];
            return a && b.unshift(this), b
        },
        sweetspot: function(a) {
            null == a && (a = !1);
            var b = [this.toHSV()];
            b[1] = new HSV(b[0].h, Math.round(.3 * b[0].s), Math.min(Math.round(1.3 * b[0].v), 100)), b[3] = new HSV((b[0].h + 300) % 360, b[0].s, b[0].v), b[2] = new HSV(b[1].h, Math.min(Math.round(1.2 * b[1].s), 100), Math.min(Math.round(.5 * b[1].v), 100)), b[4] = new HSV(b[2].h, 0, (b[2].v + 50) % 100), b[5] = new HSV(b[4].h, b[4].s, (b[4].v + 50) % 100), a || b.shift();
            for (var c = 0; c < b.length; c++) b[c] = b[c][this.toSelf]();
            return b
        },
        analogous: function(a) {
            null == a && (a = !1);
            var b = [];
            return b.push(this.hue(30)[this.toSelf]()), a && b.push(this), b.push(this.hue(-30)[this.toSelf]()), b
        },
        rectangle: function(a, b) {
            null == b && (b = !1);
            var c = a,
                d = (360 - 2 * a) / 2,
                e = (this.toCIELCh(), [this.hue(c)[this.toSelf](), this.hue(c + d)[this.toSelf](), this.hue(c + d + c)[this.toSelf]()]);
            return b && e.unshift(this), e
        },
        range: function(a, b, c) {
            null == c && (c = !1);
            var d = this.toRGB(),
                e = a.toRGB(),
                f = [];
            for (b--, n = 1; n < b; n++) {
                var g = Math.floor(d.r + n * (e.r - d.r) / b),
                    h = Math.floor(d.g + n * (e.g - d.g) / b),
                    i = Math.floor(d.b + n * (e.b - d.b) / b);
                f.push(new RGB(g, h, i)[this.toSelf]())
            }
            return c && (f.unshift(this), f.push(a[this.toSelf]())), f
        },
        greyscale: function() {
            var a = this.toRGB(),
                b = .3 * a.r + .59 * a.g + .11 * a.b;
            return new RGB(b, b, b)[this.toSelf]()
        },
        hue: function(a) {
            var b = this.toCIELCh();
            return b.h += a, b[this.toSelf]()
        },
        saturation: function(a) {
            var b = this.toHSV();
            return b.s += a / 100, b.s = Math.min(1, Math.max(0, b.s)), b[this.toSelf]()
        },
        brightness: function(a) {
            var b = this.toCIELab();
            return b.l += a, b[this.toSelf]()
        },
        warn: function() {
            alert("AbstractColor should not be created directly. Treat this as an abstract class.")
        }
    }),
    Hex = AbstractColor.extend({
        constructor: function(a) {
            this.hex = a
        },
        toHex: function() {
            return this
        },
        toRGB: function() {
            var a = (16711680 & this.hex) >> 16,
                b = (65280 & this.hex) >> 8,
                c = 255 & this.hex;
            return new RGB(a, b, c)
        },
        toXYZ: function() {
            return this.toRGB().toXYZ()
        },
        toYxy: function() {
            return this.toRGB().toYxy()
        },
        toHSV: function() {
            return this.toRGB().toHSV()
        },
        toCMY: function() {
            return this.toRGB().toCMY()
        },
        toCMYK: function() {
            return this.toCMY().toCMYK()
        },
        toCIELab: function() {
            return this.toXYZ().toCIELab()
        },
        toCIELCh: function() {
            return this.toCIELab().toCIELCh()
        },
        toString: function() {
            var a = this.hex.toString(16);
            return ("000000".substr(0, 6 - a.length) + a).toUpperCase()
        },
        toSelf: "toHex"
    }, {
        fromString: function(a) {
            return a = (a + "").replace(/[^a-f0-9]/gi, ""), new Hex(parseInt(a, 16))
        }
    }),
    RGB = AbstractColor.extend({
        constructor: function(a, b, c) {
            this.r = Math.min(255, Math.max(a, 0)), this.g = Math.min(255, Math.max(b, 0)), this.b = Math.min(255, Math.max(c, 0))
        },
        toHex: function() {
            return new Hex(this.r << 16 | this.g << 8 | this.b)
        },
        toRGB: function() {
            return this
        },
        toXYZ: function() {
            var a = this.r / 255,
                b = this.g / 255,
                c = this.b / 255;
            a > .04045 ? a = Math.pow((a + .055) / 1.055, 2.4) : a /= 12.92, b > .04045 ? b = Math.pow((b + .055) / 1.055, 2.4) : b /= 12.92, c > .04045 ? c = Math.pow((c + .055) / 1.055, 2.4) : c /= 12.92, a = 100 * a, b = 100 * b, c = 100 * c;
            var d = .4124 * a + .3576 * b + .1805 * c,
                e = .2126 * a + .7152 * b + .0722 * c,
                f = .0193 * a + .1192 * b + .9505 * c;
            return new XYZ(d, e, f)
        },
        toYxy: function() {
            return this.toXYZ().toYxy()
        },
        toHSV: function() {
            var a, b, c, d, e = this.r / 255,
                f = this.g / 255,
                g = this.b / 255,
                h = 0,
                i = 0;
            return c = Math.min(e, f, g), d = Math.max(e, f, g), h = d, i = d - c, 1 == e && 1 == f && 1 == g ? new HSV(0, 0, 100) : 0 == d ? (b = 0, a = -1, new HSV(a, b, h)) : (b = i / d, a = e == d ? (f - g) / i : f == d ? 2 + (g - e) / i : 4 + (e - f) / i, a *= 60, 0 > a && (a += 360), new HSV(a, 100 * b, 100 * h))
        },
        toCMY: function() {
            var a = 1 - this.r / 255,
                b = 1 - this.g / 255,
                c = 1 - this.b / 255;
            return new CMY(a, b, c)
        },
        toCMYK: function() {
            return this.toCMY().toCMYK()
        },
        toCIELab: function() {
            return this.toXYZ().toCIELab()
        },
        toCIELCh: function() {
            return this.toCIELab().toCIELCh()
        },
        toString: function() {
            return this.r + "," + this.g + "," + this.b
        },
        toSelf: "toRGB"
    }),
    HSV = AbstractColor.extend({
        constructor: function(a, b, c) {
            this.h = a, this.s = b, this.v = c
        },
        toHex: function() {
            return this.toRGB().toHex()
        },
        toRGB: function() {
            var a = this.h / 360,
                b = this.s / 100,
                c = this.v / 100;
            if (0 == b) var d = 255 * c,
                e = 255 * c,
                f = 255 * c;
            else {
                var_h = 6 * a, 6 == var_h && (var_h = 0), var_i = Math.floor(var_h), var_1 = c * (1 - b), var_2 = c * (1 - b * (var_h - var_i)), var_3 = c * (1 - b * (1 - (var_h - var_i))), 0 == var_i ? (var_r = c, var_g = var_3, var_b = var_1) : 1 == var_i ? (var_r = var_2, var_g = c, var_b = var_1) : 2 == var_i ? (var_r = var_1, var_g = c, var_b = var_3) : 3 == var_i ? (var_r = var_1, var_g = var_2, var_b = c) : 4 == var_i ? (var_r = var_3, var_g = var_1, var_b = c) : (var_r = c, var_g = var_1, var_b = var_2);
                var d = 255 * var_r,
                    e = 255 * var_g,
                    f = 255 * var_b
            }
            return new RGB(d, e, f)
        },
        toXYZ: function() {
            return this.toRGB().toXYZ()
        },
        toYxy: function() {
            return this.toXYZ().toYxy()
        },
        toHSV: function() {
            return this
        },
        toCMY: function() {
            return this.toRGB().toCMY()
        },
        toCMYK: function() {
            return this.toCMY().toCMYK()
        },
        toCIELab: function() {
            return this.toRGB().toCIELab()
        },
        toCIELCh: function() {
            return this.toCIELab().toCIELCh()
        },
        toString: function() {
            return this.h + "," + this.s + "," + this.v
        },
        toSelf: "toHSV"
    }),
    CMY = AbstractColor.extend({
        constructor: function(a, b, c) {
            this.c = a, this.m = b, this.y = c
        },
        toHex: function() {
            return this.toRGB().toHex()
        },
        toRGB: function() {
            var a = 255 * (1 - this.c),
                b = 255 * (1 - this.m),
                c = 255 * (1 - this.y);
            return new RGB(a, b, c)
        },
        toXYZ: function() {
            return this.toRGB().toXYZ()
        },
        toYxy: function() {
            return this.toXYZ().toYxy()
        },
        toHSV: function() {
            return this.toRGB().toHSV()
        },
        toCMY: function() {
            return this
        },
        toCMYK: function() {
            var a = 1;
            if (this.c < a && (a = this.c), this.m < a && (a = this.m), this.y < a && (a = this.y), 1 == a) var b = 0,
                c = 0,
                d = 0;
            else var b = (this.c - a) / (1 - a),
                c = (this.m - a) / (1 - a),
                d = (this.y - a) / (1 - a);
            var e = a;
            return new CMYK(b, c, d, e)
        },
        toCIELab: function() {
            return this.toRGB().toCIELab()
        },
        toCIELCh: function() {
            return this.toCIELab().toCIELCh()
        },
        toString: function() {
            return this.c + "," + this.m + "," + this.y
        },
        toSelf: "toCMY"
    }),
    CMYK = AbstractColor.extend({
        constructor: function(a, b, c, d) {
            this.c = a, this.m = b, this.y = c, this.k = d
        },
        toHex: function() {
            return this.toRGB().toHex()
        },
        toRGB: function() {
            return this.toCMY().toRGB()
        },
        toXYZ: function() {
            return this.toRGB().toXYZ()
        },
        toYxy: function() {
            return this.toXYZ().toYxy()
        },
        toHSV: function() {
            return this.toRGB().toHSV()
        },
        toCMY: function() {
            var a = this.c * (1 - this.k) + this.k,
                b = this.m * (1 - this.k) + this.k,
                c = this.y * (1 - this.k) + this.k;
            return new CMY(a, b, c)
        },
        toCMYK: function() {
            return this
        },
        toCIELab: function() {
            return this.toRGB().toCIELab()
        },
        toCIELCh: function() {
            return this.toCIELab().toCIELCh()
        },
        toString: function() {
            return this.c + "," + this.m + "," + this.y + "," + this.k
        },
        toSelf: "toCMYK"
    }),
    XYZ = AbstractColor.extend({
        constructor: function(a, b, c) {
            this.x = a, this.y = b, this.z = c
        },
        toHex: function() {
            return this.toRGB().toHex()
        },
        toRGB: function() {
            var a = this.x / 100,
                b = this.y / 100,
                c = this.z / 100,
                d = 3.2406 * a + -1.5372 * b + c * -.4986,
                e = a * -.9689 + 1.8758 * b + .0415 * c,
                f = .0557 * a + b * -.204 + 1.057 * c;
            d = d > .0031308 ? 1.055 * Math.pow(d, 1 / 2.4) - .055 : 12.92 * d, e = e > .0031308 ? 1.055 * Math.pow(e, 1 / 2.4) - .055 : 12.92 * e, f = f > .0031308 ? 1.055 * Math.pow(f, 1 / 2.4) - .055 : 12.92 * f;
            var g = Math.round(255 * d),
                h = Math.round(255 * e),
                i = Math.round(255 * f);
            return new RGB(g, h, i)
        },
        toXYZ: function() {
            return this
        },
        toYxy: function() {
            var a = this.y,
                b = this.x / (this.x + this.y + this.z),
                c = this.y / (this.x + a + this.z);
            return new Yxy(a, b, c)
        },
        toHSV: function() {
            return this.toRGB().toHSV()
        },
        toCMY: function() {
            return this.toRGB().toCMY()
        },
        toCMYK: function() {
            return this.toCMY().toCMYK()
        },
        toCIELab: function() {
            var a = 95.047,
                b = 100,
                c = 108.883,
                d = this.x / a,
                e = this.y / b,
                f = this.z / c;
            if (d = d > .008856 ? Math.pow(d, 1 / 3) : 7.787 * d + 16 / 116, e = e > .008856 ? Math.pow(e, 1 / 3) : 7.787 * e + 16 / 116, f = f > .008856 ? Math.pow(f, 1 / 3) : 7.787 * f + 16 / 116, e > .008856) var g = 116 * e - 16;
            else var g = 903.3 * e;
            var h = 500 * (d - e),
                i = 200 * (e - f);
            return new CIELab(g, h, i)
        },
        toCIELCh: function() {
            return this.toCIELab().toCIELCh()
        },
        toString: function() {
            return this.x + "," + this.y + "," + this.z
        },
        toSelf: "toXYZ"
    }),
    Yxy = AbstractColor.extend({
        constructor: function(a, b, c) {
            this.Y = a, this.x = b, this.y = c
        },
        toHex: function() {
            return this.toXYZ().toHex()
        },
        toRGB: function() {
            return this.toXYZ().toRGB()
        },
        toXYZ: function() {
            var a = this.x * (this.Y / this.y),
                b = this.Y,
                c = (1 - this.x - this.y) * (this.Y / this.y);
            return new XYZ(a, b, c)
        },
        toYxy: function() {
            return this
        },
        toHSV: function() {
            return this.toXYZ().toHSV()
        },
        toCMY: function() {
            return this.toXYZ().toCMY()
        },
        toCMYK: function() {
            return this.toXYZ().toCMYK()
        },
        toCIELab: function() {
            return this.toXYZ().toCIELab()
        },
        toCIELCh: function() {
            return this.toXYZ().toCIELCh()
        },
        toString: function() {
            return this.Y + "," + this.x + "," + this.y
        },
        toSelf: "toYxy"
    }),
    CIELCh = AbstractColor.extend({
        constructor: function(a, b, c) {
            this.l = a, this.c = b, this.h = 360 > c ? c : c - 360
        },
        toHex: function() {
            return this.toCIELab().toHex()
        },
        toRGB: function() {
            return this.toCIELab().toRGB()
        },
        toXYZ: function() {
            return this.toCIELab().toXYZ()
        },
        toYxy: function() {
            return this.toXYZ().toYxy()
        },
        toHSV: function() {
            return this.toCIELab().toHSV()
        },
        toCMY: function() {
            return this.toCIELab().toCMY()
        },
        toCMYK: function() {
            return this.toCIELab().toCMYK()
        },
        toCIELab: function() {
            var a = this.l,
                b = this.h * (Math.PI / 180),
                c = Math.cos(b) * this.c,
                d = Math.sin(b) * this.c;
            return new CIELab(a, c, d)
        },
        toCIELCh: function() {
            return this
        },
        toString: function() {
            return this.l + "," + this.c + "," + this.h
        },
        toSelf: "toXYZ"
    }),
    CIELab = AbstractColor.extend({
        constructor: function(a, b, c) {
            this.l = a, this.a = b, this.b = c
        },
        toHex: function() {
            return this.toRGB().toHex()
        },
        toRGB: function() {
            return this.toXYZ().toRGB()
        },
        toXYZ: function() {
            var a = 95.047,
                b = 100,
                c = 108.883,
                d = (this.l + 16) / 116,
                e = this.a / 500 + d,
                f = d - this.b / 200;
            return d = Math.pow(d, 3) > .008856 ? Math.pow(d, 3) : (d - 16 / 116) / 7.787, e = Math.pow(e, 3) > .008856 ? Math.pow(e, 3) : (e - 16 / 116) / 7.787, f = Math.pow(f, 3) > .008856 ? Math.pow(f, 3) : (f - 16 / 116) / 7.787, x = a * e, y = b * d, z = c * f, new XYZ(x, y, z)
        },
        toYxy: function() {
            return this.toXYZ().toYxy()
        },
        toHSV: function() {
            return this.toRGB().toHSV()
        },
        toCMY: function() {
            return this.toRGB().toCMY()
        },
        toCMYK: function() {
            return this.toCMY().toCMYK()
        },
        toCIELab: function() {
            return this
        },
        toCIELCh: function() {
            var a = Math.atan2(this.b, this.a);
            a = a > 0 ? a / Math.PI * 180 : 360 - Math.abs(a) / Math.PI * 180;
            var b = this.l,
                c = Math.sqrt(Math.pow(this.a, 2) + Math.pow(this.b, 2)),
                d = a;
            return new CIELCh(b, c, d)
        },
        toString: function() {
            return this.l + "," + this.a + "," + this.b
        },
        toSelf: "toCIELab"
    });
! function(AV, window, document) {
    AV.build = {
        contentShouldUseStaging: !1,
        version: "4.2.1",
        bundled: !1,
        feather_baseURL: "http://feather.aviary.com/csdk/4.2.1.19/",
        feather_baseURL_SSL: "https://dme0ih8comzn4.cloudfront.net/csdk/4.2.1.19/",
        feather_stickerURL: "http://feather.aviary.com/stickers/",
        feather_stickerURL_SSL: "https://dme0ih8comzn4.cloudfront.net/stickers/",
        imgrecvBase: "http://featherservices.aviary.com/",
        imgrecvBase_SSL: "https://featherservices.aviary.com/",
        featherTargetAnnounce: "http://featherservices.aviary.com/feather_target_announce_v3.html",
        featherTargetAnnounce_SSL: "https://featherservices.aviary.com/feather_target_announce_v3.html",
        imgrecvServer: "http://featherservices.aviary.com/FeatherReceiver.aspx",
        imgrecvServer_SSL: "https://featherservices.aviary.com/FeatherReceiver.aspx",
        jsonp_imgserver: "http://featherservices.aviary.com/imgjsonpserver.aspx",
        jsonp_imgserver_SSL: "https://featherservices.aviary.com/imgjsonpserver.aspx",
        proxyServer: "http://featherservices.aviary.com/proxy.aspx",
        proxyServer_SSL: "https://featherservices.aviary.com/proxy.aspx",
        asyncImgrecvBase: "http://cc-api-aviary-cds.adobe.io/",
        asyncImgrecvBase_SSL: "https://cc-api-aviary-cds.adobe.io/",
        manifestURL: "http://cd.aviary.com",
        manifestURL_SSL: "https://d42hh4005hpu.cloudfront.net",
        gatewayAssetURL: "http://cc-api-aviary-cds.adobe.io",
        gatewayAssetURL_SSL: "https://cc-api-aviary-cds.adobe.io",
        cdsContentURL: "http://cd.aviary.com",
        cdsContentURL_SSL: "https://d42hh4005hpu.cloudfront.net",
        asyncFeatherTargetAnnounce: "http://cc-api-aviary-cds.adobe.io/feather_target_announce_v3.html",
        asyncFeatherTargetAnnounce_SSL: "https://cc-api-aviary-cds.adobe.io/feather_target_announce_v3.html",
        asyncImgrecvCreateJob: "http://cc-api-aviary-cds.adobe.io/v2/createjob",
        asyncImgrecvCreateJob_SSL: "https://cc-api-aviary-cds.adobe.io/v2/createjob",
        asyncImgrecvGetJobStatus: "http://cc-api-aviary-cds.adobe.io/v2/getjobstatus",
        asyncImgrecvGetJobStatus_SSL: "https://cc-api-aviary-cds.adobe.io/v2/getjobstatus",
        googleTracker: "UA-84575-22",
        inAppPurchaseFrameURL: "http://purchases.viary.com/gateway.aspx?p=flickr"
    };
    var eventSplitter = /\s+/,
        Events = AV.Events = {
            on: function(a, b, c) {
                var d, e, f;
                if (!b) return this;
                for (a = a.split(eventSplitter), d = this._callbacks || (this._callbacks = {}); e = a.shift();) f = d[e] || (d[e] = []), f.push(b, c);
                return this
            },
            off: function(a, b, c) {
                var d, e, f, g;
                if (!(e = this._callbacks)) return this;
                if (!(a || b || c)) return delete this._callbacks, this;
                for (a = a ? a.split(eventSplitter) : _.keys(e); d = a.shift();)
                    if ((f = e[d]) && (b || c))
                        for (g = f.length - 2; g >= 0; g -= 2) b && f[g] !== b || c && f[g + 1] !== c || f.splice(g, 2);
                    else delete e[d];
                return this
            },
            trigger: function(a) {
                var b, c, d, e, f, g, h, i;
                if (!(c = this._callbacks)) return this;
                for (i = [], a = a.split(eventSplitter), e = 1, f = arguments.length; f > e; e++) i[e - 1] = arguments[e];
                for (; b = a.shift();) {
                    if ((h = c.all) && (h = h.slice()), (d = c[b]) && (d = d.slice()), d)
                        for (e = 0, f = d.length; f > e; e += 2) d[e].apply(d[e + 1] || this, i);
                    if (h)
                        for (g = [b].concat(i), e = 0, f = h.length; f > e; e += 2) h[e].apply(h[e + 1] || this, g)
                }
                return this
            }
        };
    "undefined" == typeof AV && (AV = {}), AV.JSON = {},
        function() {
            "use strict";

            function f(a) {
                return 10 > a ? "0" + a : a
            }

            function quote(a) {
                return escapable.lastIndex = 0, escapable.test(a) ? '"' + a.replace(escapable, function(a) {
                    var b = meta[a];
                    return "string" == typeof b ? b : "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4)
                }) + '"' : '"' + a + '"'
            }

            function str(a, b) {
                var c, d, e, f, g, h = gap,
                    i = b[a];
                switch (i && "object" == typeof i && "function" == typeof i.toJSON && (i = i.toJSON(a)), "function" == typeof rep && (i = rep.call(b, a, i)), typeof i) {
                    case "string":
                        return quote(i);
                    case "number":
                        return isFinite(i) ? String(i) : "null";
                    case "boolean":
                    case "null":
                        return String(i);
                    case "object":
                        if (!i) return "null";
                        if (gap += indent, g = [], "[object Array]" === Object.prototype.toString.apply(i)) {
                            for (f = i.length, c = 0; f > c; c += 1) g[c] = str(c, i) || "null";
                            return e = 0 === g.length ? "[]" : gap ? "[\n" + gap + g.join(",\n" + gap) + "\n" + h + "]" : "[" + g.join(",") + "]", gap = h, e
                        }
                        if (rep && "object" == typeof rep)
                            for (f = rep.length, c = 0; f > c; c += 1) d = rep[c], "string" == typeof d && (e = str(d, i), e && g.push(quote(d) + (gap ? ": " : ":") + e));
                        else
                            for (d in i) Object.hasOwnProperty.call(i, d) && (e = str(d, i), e && g.push(quote(d) + (gap ? ": " : ":") + e));
                        return e = 0 === g.length ? "{}" : gap ? "{\n" + gap + g.join(",\n" + gap) + "\n" + h + "}" : "{" + g.join(",") + "}", gap = h, e
                }
            }
            "function" != typeof Date.prototype.toJSON && (Date.prototype.toJSON = function(a) {
                return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null
            }, String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function(a) {
                return this.valueOf()
            });
            var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
                escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
                gap, indent, meta = {
                    "\b": "\\b",
                    "	": "\\t",
                    "\n": "\\n",
                    "\f": "\\f",
                    "\r": "\\r",
                    '"': '\\"',
                    "\\": "\\\\"
                },
                rep;
            "function" != typeof AV.JSON.stringify && (AV.JSON.stringify = function(a, b, c) {
                var d;
                if (gap = "", indent = "", "number" == typeof c)
                    for (d = 0; c > d; d += 1) indent += " ";
                else "string" == typeof c && (indent = c);
                if (rep = b, b && "function" != typeof b && ("object" != typeof b || "number" != typeof b.length)) throw new Error("AV.JSON.stringify");
                return str("", {
                    "": a
                })
            }), "function" != typeof AV.JSON.parse && (AV.JSON.parse = function(text, reviver) {
                function walk(a, b) {
                    var c, d, e = a[b];
                    if (e && "object" == typeof e)
                        for (c in e) Object.hasOwnProperty.call(e, c) && (d = walk(e, c), void 0 !== d ? e[c] = d : delete e[c]);
                    return reviver.call(a, b, e)
                }
                var j;
                if (text = String(text), cx.lastIndex = 0, cx.test(text) && (text = text.replace(cx, function(a) {
                        return "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4)
                    })), /^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) return j = eval("(" + text + ")"), "function" == typeof reviver ? walk({
                    "": j
                }, "") : j;
                throw new SyntaxError("AV.JSON.parse")
            })
        }(), "undefined" == typeof AV && (AV = {}), AV.validLanguages = {
            en: !0,
            android: !0,
            bg: !0,
            ca: !0,
            zh_hans: !0,
            zh_hant: !0,
            cs: !0,
            da: !0,
            nl: !0,
            fi: !0,
            fr: !0,
            de: !0,
            he: !0,
            id: !0,
            it: !0,
            ja: !0,
            ko: !0,
            lv: !0,
            lt: !0,
            pl: !0,
            pt: !0,
            pt_br: !0,
            ru: !0,
            es: !0,
            sv: !0,
            tr: !0,
            vi: !0,
            el: !0,
            hu: !0,
            no: !0,
            sk: !0,
            uk: !0
        }, AV.util = {
            getX: function(a) {
                for (var b = 0; null != a;) b += a.offsetLeft, a = a.offsetParent;
                return b
            },
            getY: function(a) {
                for (var b = 0; null != a;) b += a.offsetTop, a = a.offsetParent;
                return b
            },
            getTouch: function(a) {
                var b;
                return a.originalEvent && (a = a.originalEvent), b = a.changedTouches && 1 == a.changedTouches.length ? a.changedTouches[0] : a.touches && 1 == a.touches.length ? a.touches[0] : !1
            },
            getScaledDims: function(a, b, c, d) {
                d = d || c;
                var e = a,
                    f = b,
                    g = a / b;
                return (a > c || b > d) && (a - c > g * (b - d) ? (e = c, f = c * b / a + .5 | 0) : (e = d * g + .5 | 0, f = d)), {
                    width: e,
                    height: f
                }
            },
            nextFrame: function(a) {
                setTimeout(a, 1)
            },
            getDomain: function(a, b) {
                var c, d, e, f, g, h, i;
                return c = "http://" == a.substr(0, 7) ? 7 : "https://" == a.substr(0, 8) ? 8 : "ftp://" == a.substr(0, 6) ? 6 : 0, e = a.indexOf("/", c), -1 == e && (e = a.length), b ? d = c : (h = a, i = a.lastIndexOf(":"), h = i > c ? a.substring(c, i) : a.substring(c, e), h.match(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/) ? d = c : (f = a.lastIndexOf(".", e), g = a.lastIndexOf(".", f - 1), d = -1 == g ? c : g + 1)), a.substring(d, e)
            },
            extend: function() {
                var a, b, c, d, e, f, g = arguments[0] || {},
                    h = 1,
                    i = arguments.length,
                    j = !1;
                for ("boolean" == typeof g && (j = g, g = arguments[1] || {}, h = 2), "object" == typeof g || jQuery.isFunction(g) || (g = {}), i === h && (g = this, --h); i > h; h++)
                    if (null != (a = arguments[h]))
                        for (b in a) c = g[b], d = a[b], g !== d && (j && d && (jQuery.isPlainObject(d) || (e = jQuery.isArray(d))) ? (e ? (e = !1, f = c && jQuery.isArray(c) ? c : []) : f = c && jQuery.isPlainObject(c) ? c : {}, g[b] = jQuery.extend(j, f, d)) : void 0 !== d && (g[b] = d));
                return g
            },
            findItemByKeyValueFromArray: function(a, b, c) {
                var d, e;
                for (c.length, d = 0; d < c.length; d++)
                    if (c[d] && c[d][a] && c[d][a] === b) {
                        e = c[d];
                        break
                    }
                return e
            },
            loadFile: function() {
                var a, b, c, d, e = 0,
                    f = function(a, b) {
                        function c(a) {
                            (4 == this.readyState || "complete" == this.readyState || "loaded" == this.readyState) && b(a)
                        }
                        b && ("Microsoft Internet Explorer" == navigator.appName ? a.onreadystatechange = c : a.onload = b)
                    };
                return a = f,
                    function(f, g, h) {
                        var i;
                        return "js" == g ? (i = document.createElement("script"), i.setAttribute("type", "text/javascript"), a(i, h), i.setAttribute("src", f)) : "css" == g ? document.createStyleSheet ? document.createStyleSheet(f, e++) : (i = document.createElement("link"), i.setAttribute("rel", "stylesheet"), i.setAttribute("type", "text/css"), i.setAttribute("href", f)) : "img" == g && (i = document.createElement("img"), a(i, h), i.setAttribute("src", f)), i && (b = b || document.getElementsByTagName("head")[0], "js" == g ? b.appendChild(i) : "css" == g && (c = c || document.createDocumentFragment(), c.appendChild(i), b.insertBefore(i, d))), i
                    }
            }(),
            getImageElem: function(a) {
                return "string" == typeof a ? document.getElementById(a) : a.length ? a[0] : a
            },
            getImageId: function(a) {
                return "string" == typeof a ? a : a.id
            },
            imgOnLoad: function(a, b) {
                var c = avpw$(a);
                c.load(b), (1 == c[0].complete || 4 == c[0].readyState || "complete" == c[0].readyState || "loaded" == c[0].readyState) && c.trigger("load")
            },
            color_is_white: function(a) {
                return a = a.toLowerCase(), "#fff" == a || "#ffffff" == a || "white" == a || "rgb(255,255,255)" == a || "rgb(255, 255, 255)" == a
            },
            color_is_light: function(a) {
                var b, c, d, e, f;
                return b = c = d = 0, f = AV.util.color_to_array(a), b = f[0], c = f[1], d = f[2], e = .2 * b + .7 * c + .1 * d, e > 127.5
            },
            color_expand: function(a) {
                var b, c, d;
                return 4 == a.length && (b = a.charAt(1), c = a.charAt(2), d = a.charAt(3), a = "#" + b + b + c + c + d + d), a
            },
            color_to_array: function(a) {
                var b, c, d;
                return "#" == a.charAt(0) ? (a = AV.util.color_expand(a), b = parseInt(a.substr(1, 2), 16), c = parseInt(a.substr(3, 2), 16), d = parseInt(a.substr(5, 2), 16)) : "r" == a.charAt(0).toLowerCase() && (a = AV.util.rgb_to_color(a), b = parseInt(a.substr(1, 2), 16), c = parseInt(a.substr(3, 2), 16), d = parseInt(a.substr(5, 2), 16)), a = [b, c, d, 1]
            },
            array_to_color: function(a) {
                var b = AV.util.array_to_rgb(a);
                return b = AV.util.rgb_to_color(b)
            },
            array_to_rgb: function(a) {
                var b = "rgb(0,0,0)";
                return a.join && (a.length > 3 && (a = a.slice(0, 3)), b = "rgb(" + a.join(",") + ")"), b
            },
            color_to_rgb: function(a) {
                return a = AV.util.color_to_array(a), a = AV.util.array_to_rgb(a)
            },
            rgb_to_color: function(a) {
                var b, c, d, e = /\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/,
                    f = a.match(e);
                return f ? (b = parseInt(f[1]).toString(16), 1 == b.length && (b = "0" + b), c = parseInt(f[2]).toString(16), 1 == c.length && (c = "0" + c), d = parseInt(f[3]).toString(16), 1 == d.length && (d = "0" + d), "#" + b + c + d) : a
            },
            color_to_int: function(a) {
                return a = AV.util.color_expand(a), a = AV.util.rgb_to_color(a), parseInt(a.substr(1), 16)
            },
            getSafeAssetBaseURL: function(a) {
                return a = a.replace("http://cd-test.aviary.com:1338", AV.build.cdsContentURL), "https:" == window.location.protocol && (a = AV.build.contentShouldUseStaging ? a.replace("http://testassets.aviary.com.s3.amazonaws.com", "https://s3.amazonaws.com/testassets.aviary.com") : a.replace("http://assets.aviary.com", "https://d2q6aqs27yssdp.cloudfront.net")), a
            },
            loadImagesSync: function(a, b, c) {
                var d = 0,
                    e = a.length,
                    f = function() {
                        b && d == a.length && AV.util.nextFrame(b)
                    },
                    g = avpw$.support.cors && !("Microsoft Internet Explorer" == navigator.appName) || c; - 1 !== navigator.userAgent.indexOf("Safari") && -1 === navigator.userAgent.indexOf("Chrome") && (g = !1);
                for (var h = 0; e > h; h++) ! function(b) {
                    var c = a[b].img,
                        e = a[b].src;
                    c.onload = function() {
                        a[b].mappingObject && (a[b].mappingObject.w = c.width, a[b].mappingObject.h = c.height), d++, f()
                    }, g ? (c.crossOrigin = "Anonymous", c.src = e) : avpw$.ajax({
                        type: "GET",
                        dataType: "json",
                        url: AV.build.jsonp_imgserver + "?callback=?",
                        data: {
                            url: escape(e)
                        },
                        success: function(a) {
                            c.src = a.data
                        }
                    })
                }(h)
            },
            getApiVersion: function(a) {
                return a && a.apiVersion ? parseInt(a.apiVersion, 10) : 1
            },
            getUserFriendlyToolName: function(a) {
                var b = {
                        overlay: "Stickers",
                        drawing: "Draw",
                        textwithfont: "Text",
                        colorsplash: "Splash",
                        tiltshift: "Tilt Shift",
                        forcecrop: "Crop"
                    },
                    c = "";
                return a && (c = b[a] || a.substr(0, 1).toUpperCase() + a.substr(1)), c
            },
            keyDownHandlerNumber: function(a, b) {
                9 == a.keyCode || 27 == a.keyCode || 65 == a.keyCode && (a.ctrlKey === !0 || a.metaKey === !0) || a.keyCode >= 35 && a.keyCode <= 39 || ((a.keyCode < 48 || a.keyCode > 57) && (a.keyCode < 96 || a.keyCode > 105) && 46 !== a.keyCode && 8 !== a.keyCode ? a.preventDefault() : b && b.apply(this, [a]))
            },
            getBrowserVersion: function() {
                var a, b = navigator.userAgent,
                    c = b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
                return /trident/i.test(c[1]) ? (a = /\brv[ :]+(\d+)/g.exec(b) || [], "IE " + (a[1] || "")) : "Chrome" === c[1] && (a = b.match(/\bOPR\/(\d+)/), null != a) ? "Opera " + a[1] : (c = c[2] ? [c[1], c[2]] : [navigator.appName, navigator.appVersion, "-?"], null != (a = b.match(/version\/(\d+)/i)) && c.splice(1, 1, a[1]), c[1])
            },
            generatePointList: function(a, b) {
                var c, d = function(a, b, c, e, f, g, h, i) {
                        var j = (e - b) * (e - b) + (f - c) * (f - c);
                        if (i * i > j) return null;
                        var k, l, m, n, o, p;
                        void 0 !== g ? (k = (g + b) / 2, l = (g + e) / 2, m = (h + c) / 2, n = (h + f) / 2, o = (k + l) / 2, p = (m + n) / 2) : (o = (b + e) / 2, p = (c + f) / 2), d(a, b, c, o, p, k, m, i), a.push([0 | o, 0 | p]), d(a, o, p, e, f, l, n, i)
                    },
                    e = Math.floor(.2 * b),
                    f = 0,
                    g = [];
                for (f = 0; f < a.length - 1; ++f) {
                    var h = a[f],
                        i = a[f + 1],
                        j = [(h[0] + i[0]) / 2 | 0, (h[1] + i[1]) / 2 | 0];
                    0 === f ? d(g, h[0], h[1], j[0], j[1], void 0, void 0, e) : d(g, c[0], c[1], j[0], j[1], h[0], h[1], void 0, void 0, e), c = j, g.push(j), f === a.length - 2 && (d(g, j[0], j[1], i[0], i[1], void 0, void 0, e), g.push(i))
                }
                return g
            },
            isURLSameDomain: function(a) {
                var b = window.location,
                    c = document.createElement("a");
                return c.href = a, c.hostname == b.hostname && c.port == b.port && c.protocol == b.protocol
            },
            doesSupportImageCORS: function() {
                return avpw$.support.cors && !("Microsoft Internet Explorer" == navigator.appName)
            },
            isIE11: function() {
                return !window.ActiveXObject && "ActiveXObject" in window
            }
        },
        function(a, b, c) {
            a.AV = a.AV || {};
            var d = a.AV;
            return d.ImageSizeTracker = function(a) {
                var b = this;
                b.setImageScaledIndicator = function() {
                    d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "updateImageScaledIndicator")
                }, b.setOrigSize = function(a, c, e) {
                    var f, g;
                    if (a.hiresWidth && a.hiresHeight) f = parseInt(a.hiresWidth, 10), g = parseInt(a.hiresHeight, 10);
                    else if (a.hiresUrl) f = c.width, g = c.height;
                    else {
                        if (!a.displayImageSize) return null;
                        f = e.width, g = e.height
                    }
                    return d.paintWidgetInstance.actions.setOrigSize(f, g), b.setImageScaledIndicator(), {
                        width: f,
                        height: g
                    }
                }, b.isDisplayingImageSize = function(a) {
                    return a.hiresWidth || a.hiresHeight || a.displayImageSize
                }, b.isUsingHiResDimensions = function(a) {
                    return a.hiresWidth || a.hiresHeight || a.displayImageSize && a.hiresUrl
                }
            }, a
        }(this, "undefined" != typeof window ? window : {}, "undefined" != typeof document ? document : {}),
        function(a, b, c) {
            a.AV = a.AV || {};
            var d = a.AV,
                e = d.Events;
            return d.ToolManager = function(a) {
                var f = null,
                    g = function(b) {
                        var c, e, f = a.activeTools,
                            g = !1;
                        if (f)
                            for (e = f.length, c = 0; e > c; c++)
                                if (f[c] === b) {
                                    g = !0;
                                    break
                                }
                        return "forcecrop" === b && d.launchData.forceCropPreset ? !0 : (g || d.errorNotify("UNSUPPORTED_TOOL", [b]), g)
                    },
                    h = function(b, c, d) {
                        return a.objectNotify("tool", b, c, d)
                    },
                    i = function(a) {
                        null != a && (avpw$(".avpw_controlpanel").each(function() {
                            avpw$(this).hide()
                        }), avpw$("#avpw_controlpanel_" + a).show())
                    },
                    j = function() {
                        var c, g = function(g) {
                            h(f, "panelWillClose"), h(g, "panelWillOpen"), e.trigger("canvas:activate", a.panelMode2WidgetMode(g)), i(g), h(g, "resetUI"), b.setTimeout(function(a) {
                                return function() {
                                    h(a, "panelDidClose"), f = g, h(g, "panelDidOpen"), c = !1
                                }
                            }(f), 200), f = g, a.layoutNotify(d.launchData.openType, "disableZoomMode")
                        };
                        return function(a) {
                            c || (c = !0, g(a))
                        }
                    }(),
                    k = function(b) {
                        if (!a.paintWidget || !a.paintWidget.busy) {
                            if (a.layoutNotify(d.launchData.openType, "showView", ["editpanel"]), j(b), d.controlsWidgetInstance.onEggWaitThrobber.stop(), "mobile" == d.launchData.openType) {
                                var e, f = c.getElementById("avpw_main_" + b);
                                f && (e = f.getAttribute("data-header"), e && (c.getElementById("avpw_control_toolname").innerHTML = e))
                            }
                            d.usageTracker.addUsage(b)
                        }
                    },
                    l = function() {
                        e.on("tool:open", o), e.on("tool:close", n), e.on("tool:init", p), e.on("tool:shutdown", s), e.on("tool:commit", q), e.on("tool:cancel", r), e.on("tool:undo", x), e.on("tool:redo", y)
                    },
                    m = function() {
                        e.off("tool:open", o), e.off("tool:close", n), e.off("tool:init", p), e.off("tool:shutdown", s), e.off("tool:commit", q), e.off("tool:cancel", r), e.off("tool:undo", x), e.off("tool:redo", y)
                    },
                    n = function() {
                        a.layoutNotify(d.launchData.openType, "showView", ["main"]), j(null)
                    },
                    o = function(b, c) {
                        b = d.publicName2PanelMode(b), (g(b) || d.launchData.forceCropPreset) && a.paintWidget && !a.paintWidget.moduleLoaded(b, k) && c && (a.onEggWaitThrobber.stop(), a.onEggWaitThrobber.spin(avpw$(c).children(".avpw_icon_waiter")[0])), e.trigger("usage:tool", b, "opened"), e.trigger("usage:firstclick", b)
                    },
                    p = function(b) {
                        h(b, "init", [a])
                    },
                    q = function() {
                        var a, b = f;
                        b && (a = h(f, "commit"), a !== !1 && (e.trigger("usage:tool", b, "applied", a !== !0 ? a : ""), e.trigger("tool:commitDone")))
                    },
                    r = function() {
                        h(f, "cancel"), e.trigger("usage:tool", f, "canceled"), d.featherGLEnabled && (a.paintWidget.moaGL.createEffect(), a.paintWidget.moaGL.renderIdentity(), a.paintWidget.moaGL.finalizeEffect(), a.paintWidget.moaGL.commit())
                    },
                    s = function(a) {
                        h(a, "shutdown")
                    },
                    t = function() {
                        return a.paintWidget.busy ? !1 : h(f, "onUndo") === !1 ? !1 : (a.paintWidget.actions.undo(), h(f, "onUndoComplete"), !1)
                    },
                    u = function() {
                        return a.paintWidget.busy ? !1 : h(f, "onUndo", [{
                            global: !0
                        }]) === !1 ? !1 : (a.paintWidget.actions.undoToCheckpoint(), h(f, "onUndoComplete", [{
                            global: !0
                        }]), !1)
                    },
                    v = function() {
                        return a.paintWidget.busy ? !1 : h(f, "onRedo") === !1 ? !1 : (a.paintWidget.actions.redo(), h(f, "onRedoComplete"), !1)
                    },
                    w = function() {
                        if (a.paintWidget.busy) return !1;
                        if (h(f, "onRedo", [{
                                global: !0
                            }]) === !1) return !1;
                        var b = a.paintWidget.actions.redoToCheckpoint();
                        return b && h(f, "onRedoComplete", [{
                            global: !0
                        }]), b
                    },
                    x = function() {
                        e.trigger("usage:tool", "undo", "applied", f || ""), a.paintWidget.actions.isACheckpoint() ? u() : t()
                    },
                    y = function() {
                        e.trigger("usage:tool", "redo", "applied", f || ""), w() || v()
                    },
                    z = this;
                return z.init = l, z.shutdown = m, z.notify = h, z.getActiveTool = function() {
                    return f
                }, l(), z
            }, a
        }(this, "undefined" != typeof window ? window : {}, "undefined" != typeof document ? document : {}), AV.AssetManager = function(a, b) {
            "use strict";
            var c, d = {
                    EFFECT: "effects",
                    STICKER: "stickers",
                    IMAGEBORDER: "frames",
                    OVERLAYS: "overlays",
                    PERMISSION: "permissions",
                    FONTPACK: "fontpack"
                },
                e = {},
                f = function(a) {
                    return c[d[a]] || []
                },
                g = function(a, b) {
                    c ? b && b.apply(this, [f(a), d[a]]) : (e.getPartnerAssets || (e.getPartnerAssets = [], k.authenticate()), e.getPartnerAssets.push(function(e) {
                        e && e.status && "Ok" === e.status ? c = e : (AV.errorNotify("ERROR_AUTHENTICATING"), h()), AV.util.nextFrame(function() {
                            c && b && b.apply(this, [f(a), d[a]])
                        })
                    }))
                },
                h = function(a, b) {
                    return c = [{
                        needsPurchase: !1,
                        assetId: "default_effects",
                        assetType: "effect",
                        displayName: "Default",
                        resourceUrl: "js/proclist_default_effects.js"
                    }, {
                        needsPurchase: !1,
                        assetId: "original_effects",
                        assetType: "effect",
                        displayName: "Original",
                        resourceUrl: "js/proclist_original_effects.js"
                    }, {
                        needsPurchase: !1,
                        assetId: "original_stickers",
                        assetType: "sticker",
                        displayName: "Original",
                        resourceUrl: "js/stickers_original_stickers.js"
                    }, {
                        needsPurchase: !1,
                        assetId: "borders",
                        assetType: "imageborder",
                        displayName: "Default Image Borders",
                        resourceUrl: "js/borders_original.js"
                    }], b && AV.util.nextFrame(function() {
                        b.apply(this, [f(a)])
                    }), !0
                },
                i = function(a) {
                    var b, c, d;
                    if (a.messageName && (d = e[a.messageName])) {
                        if ("function" == typeof d) d.apply(this, [a.data]);
                        else
                            for (c = d.length, b = 0; c > b; b++) d[b].apply(this, [a.data]);
                        d = null
                    }
                },
                j = a ? g : h,
                k = this;
            return k.getAssets = j, k.getById = function(a) {
                for (var b = 0; b < c.length; b++)
                    if (c[b].assetId === a) return c[b]
            }, k.gatherContentAssetsHelper = function(a, b) {
                return k.getAssets(a, function(a) {
                    for (var c = {}, d = a, e = {}, f = function() {
                            h === d.length && b(e, d)
                        }, g = function(a, b) {
                            return AV.controlsWidgetInstance.serverMessaging.sendMessage({
                                id: "avpw_get_assetssticker",
                                action: b,
                                method: "GET",
                                dataType: "json",
                                announcer: AV.build.asyncFeatherTargetAnnounce,
                                origin: AV.build.asyncImgrecvBase,
                                callback: function(d) {
                                    e[a] = d, c[b] = !0, h++, f()
                                }
                            })
                        }, h = 0, i = 0; i < d.length; i++) {
                        var j = d[i].identifier,
                            k = AV.controlsWidgetInstance.assetManager.getContentURLByVersionKey(d[i].versionKey);
                        c[k] ? (h++, f()) : !e[j] && k && g(j, k)
                    }
                })
            }, k.getManifestURL = function() {
                var a, b, c = AV.build.contentShouldUseStaging;
                return AV.launchData.apiKey && AV.launchData.timestamp && AV.launchData.signature && AV.launchData.salt && AV.launchData.encryptionMethod ? (a = AV.build.gatewayAssetURL, b = ["&timestamp=", AV.launchData.timestamp, "&signature=", AV.launchData.signature, "&salt=", AV.launchData.salt, "&encryptionMethod=", AV.launchData.encryptionMethod].join("")) : a = AV.build.manifestURL, [a, "/hires/assets", "?platform=web", "&apiKey=", AV.launchData.apiKey || "", "&resolution=", window.devicePixelRatio > 1 ? "high" : "low", "&sdkVersion=" + AV.build.version, c ? "&staging=2" : "", b ? b : ""].join("")
            }, k.getContentURLByVersionKey = function(a) {
                var b = AV.build.contentShouldUseStaging;
                return AV.build.cdsContentURL + "/v1/content?versionKey=" + a + (b ? "&staging=2" : "")
            }, k.authenticate = function() {
                var a = function(a) {
                    var b = {
                        messageName: "getPartnerAssets",
                        data: a
                    };
                    i(b)
                };
                return function() {
                    return AV.controlsWidgetInstance.serverMessaging.sendMessage({
                        id: "avpw_auth_form",
                        action: k.getManifestURL(),
                        method: "GET",
                        dataType: "json",
                        announcer: AV.build.asyncFeatherTargetAnnounce,
                        origin: AV.build.asyncImgrecvBase,
                        callback: a,
                        onError: function(a) {
                            AV.errorNotify(a.status && 403 == a.status ? "ERROR_AUTHENTICATING" : "ERROR_GET_ASSETS")
                        }
                    })
                }
            }(), k.types = d, k
        }, AV.ServerMessaging = function(a) {
            var b = [],
                c = function(a, c) {
                    var d, e, f = !0,
                        g = b.shift();
                    if (g && (c && g.origin && (f = c === AV.util.getDomain(g.origin)), g.id && (d = avpw$("#" + g.id), e = d.attr("target"), avpw$("#" + e).unbind("load"), avpw$("#" + g.id + "_target_holder").empty(), d.remove()), f && g.callback)) {
                        if (g.dataType && "json" === g.dataType && "string" == typeof a) try {
                            a = AV.JSON.parse(a)
                        } catch (h) {}
                        g.callback.call(this, a)
                    }
                    b.length > 0 && l()
                },
                d = function(a, b, c, d, e, f) {
                    return avpw$.ajax({
                        url: a,
                        type: b,
                        data: c,
                        dataType: d,
                        error: function(b) {
                            f ? f.call(this, b) : AV.errorNotify("ERROR_SERVER_MESSAGING", [a])
                        },
                        success: e
                    })
                },
                e = function(a, b, c, d, e, f) {
                    var g = new XDomainRequest;
                    g.onload = function() {
                        var a = g.responseText;
                        window.setTimeout(function() {
                            var b;
                            try {
                                b = AV.JSON.parse(a), e(b)
                            } catch (c) {
                                e(a)
                            }
                        }, 0)
                    }, g.onerror = function(b) {
                        f ? f.call(this, b) : AV.errorNotify("ERROR_SERVER_MESSAGING", [a]), AV.errorNotify("ERROR_SERVER_MESSAGING", [a])
                    }, g.ontimeout = function() {}, g.onprogress = function() {}, g.open(b, a), c ? g.send(avpw$.param(c)) : g.send()
                },
                f = function(a, b, c, d, e) {
                    var f = avpw$("<form></form>").attr({
                            id: a,
                            action: b,
                            target: c,
                            method: d || "POST"
                        }).css({
                            display: "none"
                        }),
                        g = document.createDocumentFragment();
                    for (var h in e) e.hasOwnProperty(h) && g.appendChild(avpw$("<input></input>").attr({
                        name: h,
                        value: e[h],
                        type: "hidden"
                    })[0]);
                    return f.html(g), f.appendTo("#avpw_holder"), f
                },
                g = function(a, b, c) {
                    return c || (c = AV.build.feather_baseURL + "blank.html"), b || (b = a), ['<iframe width="1" height="1" ', 'style="position:absolute;left:-9999px;" ', 'id="' + a + '" name="' + b + '" src="' + c + '">', "</iframe>"].join("")
                },
                h = function(a, b, c) {
                    if (!a) return null;
                    var d = a + "_target_holder",
                        e = Math.floor(4294967295 * Math.random()).toString(16),
                        f = "avpw_form_target_" + e,
                        h = avpw$("#" + d);
                    return h && h.length || (h = avpw$('<div id="' + d + '"></div>').css({
                        position: "absolute",
                        top: 0,
                        left: 0
                    }).appendTo("#avpw_holder")), h.html(g(f)), avpw$("#" + f).load(b ? function() {
                        j(f, a, b)
                    } : c), f
                },
                i = function(a, b, c, d, e, g, i) {
                    var j = h(a, g, i);
                    b += "?responsecontenttypeheader=" + escape("text/html");
                    var k = f(a, b, j, c, e);
                    return k.submit(), k
                },
                j = function(a, b, d) {
                    var e, f = b + "_announcer";
                    if (window.postMessage) window[f] ? window[f].postMessage("avpw_load:" + a, "*") : (e = avpw$(g(f, f, d)), e.load(function() {
                        AV.util.nextFrame(function() {
                            window[f].postMessage("avpw_load:" + a, "*")
                        })
                    }), avpw$("#avpw_holder").append(e));
                    else {
                        var h, i = function() {
                                avpw$(h).unbind().remove()
                            },
                            j = b + "_observer",
                            k = j,
                            l = 0,
                            m = function() {
                                var a;
                                try {
                                    if ("about:blank" == h.contentWindow.location) return
                                } catch (b) {}
                                2 === l && (a = h.contentWindow.name, a && (l = 3, a !== k && a.substr && "avpw:" == a.substr(0, 5) ? (a = a.substr(5), c(a)) : (AV.errorNotify("ERROR_SAVING", [AV.build.imgrecvServer]),
                                    c()), i())), 1 === l && (l = 2, h.contentWindow.location = ""), l || (l = 1)
                            };
                        h = avpw$(g(j, k, d + "#" + a))[0], avpw$(h).load(m), avpw$(h).appendTo("#avpw_holder")
                    }
                },
                k = function(a) {
                    var b = a.data,
                        d = AV.util.getDomain(a.origin);
                    b.substr && "avpw:" == b.substr(0, 5) && (b = b.substr(5), c(b, d))
                },
                l = function() {
                    var a = b[0];
                    a && i(a.id, a.action, a.method, a.origin, a.keyValues, a.announcer)
                },
                m = function(a) {
                    a.announcer ? (b.push(a), 1 === b.length && l()) : i(a.id, a.action, a.method, a.origin, a.keyValues, a.announcer, a.callback)
                },
                n = function(a) {
                    var b, c = a.transport || "xhr";
                    "xhr" === c && avpw$.support.cors && (!AV.firefox || AV.firefox >= 4) ? (b = d(a.action, a.method, a.keyValues, a.dataType, a.callback, a.onError), b || m(a)) : "function" == typeof XDomainRequest ? e(a.action, a.method, a.keyValues, a.dataType, a.callback, a.onError) : m(a)
                },
                o = function() {
                    window.addEventListener ? window.addEventListener("message", k, !1) : window.attachEvent && window.attachEvent("onmessage", k)
                },
                p = this;
            return p.shutdown = function() {
                window.removeEventListener ? window.removeEventListener("message", k, !1) : window.detachEvent && window.detachEvent("onmessage", k), b = []
            }, p.sendMessage = n, o(), p
        },
        function(a, b, c) {
            a.AV = a.AV || {};
            var d = a.AV,
                e = d.Events;
            d.usageTracker = function() {
                var a, f = null,
                    g = {},
                    h = 0,
                    i = [],
                    j = 0,
                    k = -1,
                    l = !1,
                    m = {},
                    n = function() {
                        d.controlsWidgetInstance && m.submit("close")
                    },
                    o = function() {
                        l || (! function(a, b, c, d, e, f, g) {
                            a.GoogleAnalyticsObject = e, a[e] = a[e] || function() {
                                (a[e].q = a[e].q || []).push(arguments)
                            }, a[e].l = 1 * new Date, f = b.createElement(c), g = b.getElementsByTagName(c)[0], f.async = 1, f.src = d, g.parentNode.insertBefore(f, g)
                        }(b, c, "script", "https://www.google-analytics.com/analytics.js", "AV_ga"), AV_ga("create", d.build.googleTracker, "auto", {
                            allowLinker: !0
                        }), AV_ga("set", "dimension1", d.launchData.apiKey), AV_ga("set", "dimension2", d.build.version), AV_ga("set", "dimension3", this.getUUID()), AV_ga("set", "dimension4", d.launchData.language), AV_ga("set", "dimension5", d.launchData.apiVersion + ""), l = !0, AV_ga("send", "event", "editor", "isWebGLUsed", d.featherGLEnabled.toString()))
                    },
                    p = function(a, b, c) {
                        AV_ga("send", "event", "tool", a + ":" + b, c ? c + "" : "")
                    },
                    q = function(a, b, c) {
                        AV_ga("send", "event", "interaction", a + ":" + b, c ? c + "" : "")
                    },
                    r = function(a) {
                        m.submit("firstclick", a), e.off("usage:firstclick")
                    };
                return m.setup = function() {
                    avpw$(b).bind("unload", n), e.on("usage:submit", m.submit, m), e.on("usage:tool", p, m), e.on("usage:firstclick", r, m), e.on("usage:interact", q)
                }, m.shutdown = function() {
                    avpw$(b).unbind("unload", n), e.off("usage:submit", m.submit), e.off("usage:tool", p), e.off("usage:firstclick", r), e.off("usage:interact", q)
                }, m.clear = function() {
                    f = null, g = {}, h = 0, i = [], j = 0, k = -1
                }, m.getUUID = function() {
                    return f ? f : f = Math.floor(4294967295 * Math.random()).toString(16) + Math.floor(4294967295 * Math.random()).toString(16)
                }, m.addUsage = function(a, b) {
                    b || (b = 1), void 0 === g[a] ? g[a] = b : g[a] += b, h += b
                }, m.setPageCount = function(a) {
                    var b;
                    for (j = a, i = new Array(a), b = 0; a > b; b++) i[b] = 0
                }, m.addPageHit = function(b) {
                    b !== a && i[b]++, a = b
                }, m.submit = function(a, c) {
                    o.call(this), "launch" === a ? AV_ga("send", "pageview", (b.location || "").toString()) : AV_ga("send", "event", "submit", a, c)
                }, m
            }();
            var f = {
                lighting: {
                    brightness: !0,
                    contrast: !0
                },
                color: {
                    saturation: !0,
                    warmth: !0
                }
            };
            return d.getActiveTools = function(a) {
                var b = d.featherUseFlash ? d.flashSupportedTools : d.featherGLEnabled ? d.glSupportedTools : d.defaultTools,
                    c = a;
                c && "all" !== c && "All" !== c && "ALL" !== c && "" !== c || (c = b), "string" == typeof c && (c = a.split(","));
                var e, g, h = [],
                    i = {},
                    j = {};
                for (g = 0; g < b.length; g++) e = b[g], j[e] = !0;
                var k = !0;
                for (g = 0; g < c.length; g++) {
                    if (d.launchData.forceCropPreset) {
                        if ("resize" === c[g] || "orientation" === c[g] || "crop" === c[g] || "overlays" === c[g]) continue
                    } else if ("orientation" === c[g] && avpw$.browser.msie && 9 === parseInt(avpw$.browser.version)) continue;
                    e = d.publicName2PanelMode(c[g]), e in j ? (h.push(e), k = !1, i[e] = !0) : !i.lighting && f.lighting[e] ? (h.push("lighting"), i.lighting = !0, k = !1) : !i.color && f.color[e] && (h.push("color"), i.color = !0, k = !1)
                }
                return d.launchData.forceCropPreset && k && d.errorNotify("BAD_FORCECROP_TOOLS"), h
            }, d.paintWidgetGetPopupEmbedDiv = function(a) {
                var b = avpw$("#avpw_canvas_embed_popup");
                if (a) {
                    var d, e, f, g = avpw$(a),
                        h = ["top", "left", "bottom", "right", "margin-top", "margin-right", "margin-bottom", "margin-left", "border-top", "border-right", "border-bottom", "border-left", "padding-top", "padding-right", "padding-bottom", "padding-left"],
                        i = {
                            position: "relative"
                        };
                    for (e = 0; e < h.length; e++) f = h[e], i[f] = g.css(f);
                    d = avpw$(a).css("display"), ("" == d || "inline" == d) && (d = "inline-block"), i.display = d, 0 == b.length && (b = c.createElement("div"), b.id = "avpw_canvas_embed_popup"), avpw$(b).hide().css(i).insertBefore(a)
                }
                return b
            }, d.paintWidgetLauncher = function(a, b) {
                return d.paintWidgetInstance ? void 0 : (d.usageTracker.clear(), d.paintWidgetLauncher_HTML(a, b))
            }, d.paintWidgetLauncher_HTML = function(a, b) {
                var e, f, g, h, i, j = d.launchData.launchDelay,
                    k = d.util.getImageElem(a);
                return h = d.getActiveTools(d.launchData.tools), d.isRelaunched && "undefined" != typeof k.avpw_prevURL && (b = k.avpw_prevURL), i = new d.AssetManager(d.launchData.isPremiumPartner, d.launchData.allowInAppPurchase), d.controlsWidgetInstance = new d.ControlsWidget(null, a, h, i, new d.ServerMessaging), d.launchData.image instanceof HTMLImageElement && !b && (b = a.src), b && 0 === b.indexOf("//") && (b = c.location.protocol + b), d.controlsWidgetInstance.origURL = b ? b : avpw$(k).attr("src"), d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "placeControls", [d.util.getApiVersion(d.launchData) > 1 ? d.launchData.appendTo : void 0]), d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "enableControls"), d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "bindEvents"), avpw$("#avpw_controls").fadeIn(j), d.util.nextFrame(function() {
                    "mobile" == d.launchData.openType && d.setPageWidth(avpw$("#avpw_controls").width()), d.controlsWidgetInstance.setupScrollPanels()
                }), d.launchData.noCloseButton && avpw$("#avpw_control_cancel_pane").css("display", "none"), k && "canvas" === k.nodeName.toLowerCase() ? void d.mockLauncher(k) : (f = d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "getEmbedElement", [k]), e = c.createElement("img"), e.id = "avpw_temp_loading_image", d.tempLoadingImageSrc = e.src, avpw$(e).load(function() {
                    g = d.controlsWidgetInstance.getScaledDims(avpw$(k).width(), avpw$(k).height()), e.width = g.width, e.height = g.height, d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "getScaledImageDims", [e]), avpw$(e).unbind(), e.style.display = "block", avpw$(f).append(e), d.controlsWidgetInstance.showWaitThrobber(!0), d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "hideOriginalImage", [k]), avpw$(f).show(), d.util.nextFrame(function() {
                        d.paintWidgetLauncher_stage2(a, b)
                    })
                }).error(function() {
                    d.paintWidgetCloser(!0), d.errorNotify("BAD_IMAGE", [b])
                }), e.src = k.src, !1)
            }, d.paintWidgetLauncher_stage2 = function(a, b) {
                var c, f, g = d.util.getImageElem(a),
                    h = function(a) {
                        d.controlsWidgetInstance && d.paintWidgetInstance && (c = new Image, avpw$.support.cors && d.launchData.enableCORS && -1 === a.indexOf("data:") && (c.crossOrigin = "Anonymous"), avpw$(c).load(function(a) {
                            if (d.controlsWidgetInstance && d.paintWidgetInstance) {
                                if (f = d.controlsWidgetInstance.getScaledDims(c.width, c.height), d.controlsWidgetInstance.imageSizeTracker.setOrigSize(d.launchData, c, f), c.width = f.width, c.height = f.height, d.paintWidgetInstance.setDimensions(f.width, f.height), !d.paintWidgetInstance.setBackground(c)) return d.paintWidgetCloser(!0), d.errorNotify("IMAGE_NOT_CLEAN", [b]), !1;
                                d.paintWidgetInstance.setOrigSize(f.width, f.height), g.src !== b && d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "scaleCanvas"), avpw$(d.paintWidgetInstance.canvas).insertBefore("#avpw_temp_loading_image"), i.remove(), d.tempLoadingImageSrc = b, d.controlsWidgetInstance.showWaitThrobber(!1), d.controlsWidgetInstance.loaderPhase = 2, d.launchData.actionListJSON && d.paintWidgetInstance.actions.importJSON(d.launchData.actionListJSON, d.fireLaunchComplete)
                            }
                        }).attr("src", a))
                    };
                f = d.controlsWidgetInstance.getScaledDims(avpw$(g).width(), avpw$(g).height()), d.controlsWidgetInstance.loaderPhase = 1, d.paintWidgetInstance = new d.PaintWidget(f.width, f.height, new d.Actions, new d.ModeManager, new d.FilterManager, new d.OverlayRegistry, new d.ImageBorderManager), d.controlsWidgetInstance.canvasUI = new d.PaintUI(d.paintWidgetInstance.canvas, d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "getEmbedElement")), d.controlsWidgetInstance.initWithPaintWidget(d.paintWidgetInstance), d.paintWidgetInstance.setOrigSize(f.width, f.height), d.controlsWidgetInstance.imageSizeTracker.setOrigSize(d.launchData, g, f);
                var i = avpw$("#avpw_temp_loading_image");
                if (d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "scaleCanvas"), null != b)
                    if (!d.launchData.enableCORS || !avpw$.support.cors || avpw$.browser.msie || avpw$.browser.safari && -1 === navigator.userAgent.indexOf("Chrome") && parseInt(d.util.getBrowserVersion()) < 7)
                        if (-1 === b.indexOf("data:")) {
                            if (!b || !b.match(/^http(s|):\/\//)) return void d.errorNotify("BAD_URL", [b]);
                            d.util.isURLSameDomain(b) ? h(b) : avpw$.ajax({
                                type: "GET",
                                dataType: "json",
                                url: d.build.jsonp_imgserver + "?callback=?",
                                data: {
                                    url: escape(b)
                                },
                                success: function(a) {
                                    h(a.data)
                                },
                                error: function(a, c, e) {
                                    200 === a.status && "parsererror" === c && d.controlsWidgetInstance && (d.controlsWidgetInstance.showWaitThrobber(!1), d.util.nextFrame(function() {
                                        d.paintWidgetCloser(!0), d.errorNotify("BAD_URL", [b])
                                    }))
                                }
                            })
                        } else h(b);
                else h(b);
                else {
                    if (!d.paintWidgetInstance.setBackground(g)) return d.paintWidgetCloser(!0), d.launchData.enableCORS && avpw$.support.cors ? d.errorNotify("ERROR_BAD_IMAGE_WITHOUT_CORS") : d.errorNotify("IMAGE_NOT_CLEAN", [b]), !1;
                    avpw$("#avpw_controls").insertAfter(d.paintWidgetInstance.canvas), avpw$(d.paintWidgetInstance.canvas).insertBefore(i), i.remove(), d.tempLoadingImageSrc = g.src, d.controlsWidgetInstance.showWaitThrobber(!1), d.controlsWidgetInstance.loaderPhase = 2, d.launchData.actionListJSON && d.paintWidgetInstance.actions.importJSON(d.launchData.actionListJSON, d.fireLaunchComplete)
                }
                return e.trigger("usage:submit", "launch"), d.launchData.actionListJSON || d.fireLaunchComplete(), !1
            }, d.fireLaunchComplete = function() {
                var a = d.launchData.initTool;
                d.Events.trigger("layout:resize"), a && (d.util.nextFrame(function() {
                    e.trigger("tool:open", a)
                }), d.paintWidgetInstance.moduleLoaded(a, function(a) {
                    d.util.nextFrame(function() {
                        avpw$("#avpw_holder").removeClass("avpw_init_hide")
                    })
                })), "function" == typeof d.launchData.onReady && d.launchData.onReady()
            }, d.paintWidgetShutdown = function() {
                e.trigger("usage:submit", "close"), d.paintWidgetInstance && d.paintWidgetInstance.shutdown(), d.controlsWidgetInstance && (d.controlsWidgetInstance.serverMessaging && (d.controlsWidgetInstance.serverMessaging.shutdown(), d.controlsWidgetInstance.serverMessaging = null), d.controlsWidgetInstance.shutdown()), avpw$("#avpw_controls").hide(), d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "onShutdown"), "function" == typeof d.launchData.onClose && d.launchData.onClose(d.paintWidgetInstance.dirty), d.paintWidgetInstance = null, d.controlsWidgetInstance = null, d.tempLoadingImageSrc = null
            }, d.paintWidgetCloser = function(a) {
                var b = d.launchData.closeDelay;
                d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "onClose", [a]), a || 0 === b ? (avpw$("#avpw_controls").hide(), d.paintWidgetShutdown()) : avpw$("#avpw_controls").fadeOut(b, function() {
                    d.paintWidgetInstance && d.paintWidgetShutdown()
                })
            }, d.controlsWidget_saveResponder = function(a, b, f) {
                "https:" === c.location.protocol && ("string" == typeof b && (b = b.replace("http:", "https:")), "string" == typeof f && (f = f.replace("http:", "https:")));
                var g;
                if ("function" == typeof a && (g = a.apply(d.launchData, [d.util.getImageId(d.controlsWidgetInstance.paintImgIdElem), b, f])), d.controlsWidgetInstance) {
                    var h = d.util.getImageElem(d.controlsWidgetInstance.paintImgIdElem);
                    h.avpw_prevURL = b, e.trigger("tool:close"), g && d.controlsWidgetInstance.messager.show("avpw_aviary_beensaved", !0), d.controlsWidgetInstance.paintWidget.dirty = !1, d.controlsWidgetInstance.saving = !1
                }
            }, d.controlsWidget_onImageSaved = function(a, b) {
                d.controlsWidget_saveResponder(d.launchData.onSave, a, b)
            }, d.controlsWidget_onHiResImageSaved = function(a) {
                d.controlsWidget_saveResponder(d.launchData.onSaveHiRes, a)
            }, d.ControlsWidget = function(a, b, c, f, g) {
                this.maxWidth = parseInt(d.launchData.maxSize), this.maxHeight = this.maxWidth, this.saving = !1, this.origURL = null, this.activeTools = c, this.quitCount = 0, d.usageTracker.setup(), this.paintImgIdElem = b, e.on("layout:resize", this.setupScrollPanels, this), this.layoutNotify(d.launchData.openType, "showView", ["main"]), a && this.initWithPaintWidget(a);
                var h = {
                        className: "avpw_canvas_spinner",
                        lines: 12,
                        length: 6,
                        width: 2,
                        radius: 6,
                        color: "#fff",
                        speed: .5,
                        trail: 70
                    },
                    i = {
                        className: "avpw_tool_spinner",
                        lines: 12,
                        length: 6,
                        width: 2,
                        radius: 6,
                        color: "#fff",
                        speed: .5,
                        trail: 70
                    };
                "mobile" != d.launchData.openType && (i.color = "#555", i.length = 4), this.waitThrobber = new d.Spinner(h), this.onEggWaitThrobber = new d.Spinner(i), this.toolManager = new d.ToolManager(this), this.assetManager = f, this.serverMessaging = g
            }, d.ControlsWidget.prototype.tool = {}, d.ControlsWidget.prototype.layout = {}, d.ControlsWidget.prototype.layoutNotify = function(a, b, c) {
                return this.objectNotify("layout", a, b, c)
            }, d.ControlsWidget.prototype.objectNotify = function(a, b, c, d) {
                if ("object" == typeof this[a][b]) {
                    var e = this[a][b];
                    if ("function" == typeof e[c]) {
                        var f = e[c];
                        return d || (d = []), f.apply(e, d)
                    }
                }
                return !0
            }, d.ControlsWidget.prototype.shutdown = function() {
                this.canvasUI && this.canvasUI.shutdown(), this.messager && this.messager.hide(), e.off("layout:resize", this.setupScrollPanels), this.shutdownAllTools(), this.unbindControls(), this.toolsPager && (this.toolsPager.shutdown(), this.toolsPager = null), this.paintWidget && (this.paintWidget.showWaitThrobber = null), d.usageTracker.shutdown(), this.waitThrobber.stop(), this.onEggWaitThrobber.stop(), this.waitThrobber = null, this.onEggWaitThrobber = null, this.showPanel(null), this.toolManager.shutdown(), this.toolManager = null
            }, d.ControlsWidget.prototype.initAllTools = function() {
                for (var a in this.activeTools) {
                    var b = this.activeTools[a];
                    this.tool.hasOwnProperty(b) && d.paintWidgetInstance.moduleLoaded(b, function(a) {
                        e.trigger("tool:init", a)
                    }.AV_bindInst(this))
                }
                d.launchData.forceCropPreset && d.paintWidgetInstance.moduleLoaded("forcecrop", function(a) {
                    e.trigger("tool:init", "forcecrop")
                }.AV_bindInst(this))
            }, d.ControlsWidget.prototype.shutdownAllTools = function() {
                for (var a in this.activeTools) {
                    var b = this.activeTools[a];
                    e.trigger("tool:shutdown", b)
                }
                d.launchData && d.launchData.forceCropPreset && e.trigger("tool:shutdown", "forcecrop")
            }, d.ControlsWidget.prototype.bindControls = function() {}, d.ControlsWidget.prototype.unbindControls = function() {}, d.ControlsWidget.prototype.initWithPaintWidget = function(a) {
                this.paintWidget = a, this.imageSizeTracker = new d.ImageSizeTracker(a.actions), d.featherUseFlash || this.initAllTools(), this.bindControls(), this.paintWidget.showWaitThrobber = this.showWaitThrobber.AV_bindInst(this)
            }, d.ControlsWidget.prototype.showWaitThrobber = function(a, c) {
                var e = 300,
                    f = this;
                if (a) {
                    var g = this.layoutNotify(d.launchData.openType, "getEmbedElement");
                    g.is(":visible") && (this.waitThrobber.spin(g[0]), avpw$(this.waitThrobber).fadeIn(e))
                } else avpw$(f.waitThrobber.el).fadeOut(e, f.waitThrobber.stop);
                c && b.setTimeout(c, 5)
            }, d.publicName2PanelMode = function(a) {
                return "stickers" === a && (a = "overlay"), "draw" === a && (a = "drawing"), "text" !== a || d.featherUseFlash || (a = "textwithfont"), a
            }, d.ControlsWidget.prototype.panelMode2WidgetMode = function(a) {
                switch (a) {
                    case "rotate":
                        return "rotate90";
                    case "greeneye":
                        return "redeye";
                    case "pinch":
                        return "bulge"
                }
                return a
            }, d.ControlsWidget.prototype.setupScrollPanels = function() {
                if (this.activeTools && this.activeTools.length) {
                    var a, b, c, e = this,
                        f = {},
                        g = this.layoutNotify(d.launchData.openType, "getDims").TOOLS_BROWSER_WIDTH,
                        h = function() {
                            e.toolsPager = new d.Pager(i), e.toolsPager.changePage()
                        },
                        i = {
                            itemCount: this.activeTools.length,
                            itemsPerPage: this.layoutNotify(d.launchData.openType, "getToolsPerPage"),
                            pageWidth: g,
                            leftArrow: avpw$("#avpw_lftArrow"),
                            rightArrow: avpw$("#avpw_rghtArrow"),
                            itemBuilder: function(c) {
                                return a = e.activeTools[c], b = d.util.getUserFriendlyToolName(a), b = d.getLocalizedString(b), d.template[d.launchData.layout].eggIcon({
                                    optionName: a,
                                    capOptionName: b
                                })
                            },
                            pageTemplate: d.template[d.launchData.layout].genericScrollPanel,
                            pipTemplate: d.template[d.launchData.layout].scrollPanelPip,
                            lastPageTemplate: c,
                            lastPageContents: f,
                            pageContainer: avpw$("#avpw_control_main_scrolling_region"),
                            pipContainer: avpw$("#avpw_tools_pager ul"),
                            onPageChange: function(a) {
                                d.usageTracker.addPageHit(a)
                            }
                        };
                    h(), avpw$("#avpw_control_main_scrolling_region").css("width", e.toolsPager.getPageCount() * g + "px"), this.assetManager.getAssets("PERMISSION", function(a) {
                        var b = !0;
                        if (a)
                            for (var c = 0; c < a.length; c++)
                                if ("whitelabel" === a[c]) {
                                    b = !1;
                                    break
                                }
                        b ? (avpw$("#avpw_powered_branding").html(d.template[d.launchData.layout].poweredByFooterLogo).find("a").css("cursor", "default"), e.toolsPager.shutdown(), h(), avpw$("#avpw_control_main_scrolling_region").css("width", e.toolsPager.getPageCount() * g + "px"), e.toolsPager.changePage()) : avpw$("#avpw_controls").addClass("avpw_white_label")
                    }), d.usageTracker.setPageCount(e.toolsPager.getPageCount())
                }
            }, d.ControlsWidget.prototype.messager = function() {
                var a, c, f, g = {},
                    h = 1e3,
                    i = {
                        show: function(e, f, i) {
                            a = a || avpw$("#avpw_messaging"), c = c || avpw$("#avpw_messaging_inner");
                            var j = g[e] || (g[e] = avpw$("#" + e));
                            c.append(j), a.fadeIn(150), f ? (a.data("needsConfirmation", !0), d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "disableControls")) : (a.data("needsConfirmation", !1), i || b.setTimeout(this.hide, h))
                        },
                        hide: function(c, e) {
                            if (a = a || avpw$("#avpw_messaging"), f = f || avpw$("#avpw_messages"), c) {
                                var h = g[c];
                                h && f.append(h)
                            } else avpw$.each(g, function(a, b) {
                                f.append(b)
                            });
                            a.data("needsConfirmation") ? (b.setTimeout(function() {
                                e && e()
                            }, 400), d.controlsWidgetInstance && d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "enableControls")) : (a.hide(), e && e())
                        },
                        addMessage: function(a) {
                            f = f || avpw$("#avpw_messages"), a && (f[0].innerHTML += a)
                        }
                    };
                return e.on("modal:show", i.show), e.on("modal:hide", i.hide), i
            }(), d.ControlsWidget.prototype.orientationChanged = function(a) {}, d.ControlsWidget.prototype.windowResized = function() {
                var a = null;
                return function(c) {
                    b.clearTimeout(a), a = b.setTimeout(function() {
                        e.trigger("layout:resize"), a = null
                    }, 500)
                }
            }(), d.ControlsWidget.prototype.Slider = function(a) {
                var b = !1,
                    c = function(c, d) {
                        !b && a.onstart && a.onstart.apply(this, [c, d])
                    },
                    d = function(c, d) {
                        !b && a.onchange && a.onchange.apply(this, [c, d])
                    },
                    e = function(c, d) {
                        !b && a.onslide && a.onslide.apply(this, [c, d])
                    },
                    f = avpw$(a.element).slider({
                        range: "min",
                        max: a.max,
                        min: a.min,
                        value: a.defaultValue || a.max / 2,
                        delay: a.delay
                    });
                return this.getValue = function() {
                    return f.slider("value")
                }, this.setValue = function(a) {
                    return f.slider("value", a)
                }, this.reset = function(c) {
                    b = !0, this.setValue(a.defaultValue), b = !1
                }, this.addListeners = function() {
                    f.bind("slidestart", c).bind("slidechange", d).bind("slide", e)
                }, this.removeListeners = function() {
                    f.unbind("slidestart").unbind("slide").unbind("slidechange")
                }, this.shutdown = function() {
                    f.slider("destroy")
                }, this
            }, d.ControlsWidget.prototype._drawUICircle = function(a, b, c, e, f) {
                d.featherUseFlash || this._drawUICircle_HTML(a, b, c, e, f)
            }, d.ControlsWidget.prototype._drawUICircle_HTML = function(a, b, c, e, f) {
                var g, h = avpw$(a)[0],
                    i = h.getContext("2d");
                i.clearRect(0, 0, h.width, h.height), f && "transparent" !== e && this._drawUIGrid(i, h.width, h.height), i.globalCompositeOperation = "source-over", null != c ? (i.strokeStyle = f && ("transparent" == c || d.util.color_is_white(c) || null == e) ? "#444" : c, g = 3) : (i.strokeStyle = "rgba(0,0,0,0)", g = 1), i.lineWidth = g, i.beginPath(), i.arc(h.width / 2, h.height / 2, b, 0, 2 * Math.PI, !0), i.stroke(), i.closePath(), null != e && (i.save(), i.clip(), f && "transparent" == e ? this._drawUIGrid(i, h.width, h.height) : (i.fillStyle = e, i.fillRect(0, 0, h.width, h.height)), i.restore())
            }, d.ControlsWidget.prototype._drawUIGrid = function(a, b, c, d) {
                var e, f;
                for (d || (d = 5), f = 0; c + d > f; f += d)
                    for (e = 0; c + d > e; e += d) a.fillStyle = 1 == (e + f & 1) ? "#fff" : "#ddd", a.fillRect(e, f, d, d)
            }, d.ControlsWidget.prototype.showPanel = function(a) {
                null != a && (avpw$(".avpw_controlpanel").each(function() {
                    avpw$(this).hide()
                }), avpw$("#avpw_controlpanel_" + a).show())
            }, d.ControlsWidget.prototype.save = function() {
                var a = null,
                    c = !0,
                    f = 1e3,
                    g = function() {
                        return {
                            apikey: d.launchData.apiKey,
                            timestamp: d.launchData.timestamp,
                            signature: d.launchData.signature,
                            salt: d.launchData.salt,
                            encryptionMethod: d.launchData.encryptionMethod
                        }
                    },
                    h = function(a, b, c) {
                        var e = d.controlsWidgetInstance;
                        if (e.layoutNotify(d.launchData.openType, "enableControls", [!0]), e.paintWidget.showWaitThrobber(!1), a) {
                            var f = avpw$(d.util.getImageElem(e.paintImgIdElem));
                            f.avpw_prevURL = a, d.controlsWidget_onImageSaved(a, b)
                        } else d.errorNotify("ERROR_SAVING", [d.build.imgrecvServer, c]), d.controlsWidgetInstance.saving = !1
                    },
                    i = function(a, b) {
                        var c = d.controlsWidgetInstance;
                        if (c.layoutNotify(d.launchData.openType, "enableControls", [!0]), c.paintWidget.showWaitThrobber(!1), a) {
                            var e = avpw$(d.util.getImageElem(c.paintImgIdElem));
                            e.avpw_prevURL = a, d.controlsWidget_onHiResImageSaved(a)
                        } else d.errorNotify("ERROR_SAVING", [d.build.asyncImgrecvBase, b]), d.controlsWidgetInstance.saving = !1
                    },
                    j = function(a, b) {
                        var c, e, f, g, i = "";
                        if ("string" == typeof a)
                            if (-1 === a.indexOf("---FEATHER-POSTMESSAGE---")) try {
                                e = a.split("<url>")[1].split("</url>")[0]
                            } catch (j) {
                                d.errorNotify("ERROR_SAVING", ["Error parsing response."])
                            } else c = a.split("---FEATHER-POSTMESSAGE---"), e = c[0], f = c[1];
                            else if (g = avpw$(a).find("error"), g.length > 0) i = g.text();
                        else {
                            var k = avpw$(a).find("url");
                            k && (e = k.text(), e = e.replace(/^\s+|\s+$/g, ""));
                            var l = avpw$(a).find("hiresurl");
                            l && (f = l.text(), f = f.replace(/^\s+|\s+$/g, ""))
                        }
                        var m = [e, f, i];
                        "function" == typeof b ? b.apply(this, m) : h.apply(this, m)
                    },
                    k = function(a, b) {
                        var c = d.S3Uploader.isCapable("image/" + ("" === d.launchData.fileFormat ? "png" : d.launchData.fileFormat)),
                            e = this;
                        e.paintWidget.exportImage(null, function(f) {
                            function k() {
                                d.controlsWidgetInstance.serverMessaging.sendMessage({
                                    id: "avpw_save_form",
                                    action: d.build.imgrecvServer,
                                    method: "POST",
                                    announcer: d.build.featherTargetAnnounce,
                                    origin: d.build.imgrecvBase,
                                    keyValues: d.util.extend(g(), {
                                        file: m,
                                        sessionid: d.usageTracker.getUUID(),
                                        actionlist: e.paintWidget.actions.exportJSON(!0),
                                        origurl: p,
                                        hiresurl: d.launchData.hiresUrl,
                                        contenttype: d.launchData.fileFormat,
                                        jpgquality: d.launchData.jpgQuality,
                                        debug: d.launchData.debug,
                                        asyncsave: d.launchData.asyncSave,
                                        usecustomfileexpiration: d.launchData.useCustomFileExpiration,
                                        encodedas: "base64text"
                                    }),
                                    callback: function() {
                                        (b || j).apply(this, arguments)
                                    }
                                })
                            }
                            var l, m, n = f.indexOf(";", 0),
                                o = f.indexOf(",", n);
                            l = f.slice(5, n), m = f.slice(o + 1), f = "";
                            var p = e.origURL;
                            p && 0 === p.indexOf("data:") && (p = ""), c ? d.S3Uploader.upload(l, m, function(b, c) {
                                b && k(), a ? i.call(this, c, null, b) : h.call(this, c, null, b)
                            }) : k()
                        })
                    },
                    l = function(a, b, c) {
                        var d = Math.round(b * c / 1e6 * 10) / 10,
                            f = ["didHitAzure:" + (a ? "Yes" : "No"), " width:" + b, " height:" + c, " megaPixels:" + d].join("");
                        e.trigger("usage:submit", "saveHiRes", f)
                    },
                    m = function() {
                        var e = d.paintWidgetInstance.getScaledSize(),
                            h = function() {
                                if (l(!0, e.hiresWidth, e.hiresHeight), !d.launchData.hiresUrl) return void d.errorNotify("ERROR_MISSING_HI_RES_URL");
                                var h = d.util.extend(g(), {
                                        actionlist: this.paintWidget.actions.exportJSON(!0),
                                        origurl: d.launchData.hiresUrl,
                                        fileformat: d.launchData.fileFormat,
                                        notificationmethod: "GET",
                                        backgroundcolor: "0xffffffff",
                                        jpgquality: d.launchData.jpgQuality
                                    }),
                                    j = function(d) {
                                        !d || d && "JobFailed" === d.JobStatusCode ? (i(null, d), b.clearInterval(a)) : d && "JobCompleted" === d.JobStatusCode && (b.clearInterval(a), i(d.JobStatus)), c = !0
                                    },
                                    k = function(e) {
                                        var h;
                                        e && e.JobId ? (h = e.JobId, a = b.setInterval(function() {
                                            c && d.controlsWidgetInstance.serverMessaging.sendMessage({
                                                id: "avpw_save_form",
                                                action: d.build.asyncImgrecvGetJobStatus,
                                                method: "POST",
                                                dataType: "json",
                                                announcer: d.build.asyncFeatherTargetAnnounce,
                                                origin: d.build.asyncImgrecvBase,
                                                keyValues: d.util.extend(g(), {
                                                    jobid: h
                                                }),
                                                callback: j
                                            }), c = !1
                                        }, f)) : i(null, e)
                                    };
                                d.controlsWidgetInstance.serverMessaging.sendMessage({
                                    id: "avpw_save_form",
                                    action: d.build.asyncImgrecvCreateJob,
                                    method: "POST",
                                    dataType: "json",
                                    announcer: d.build.asyncFeatherTargetAnnounce,
                                    origin: d.build.asyncImgrecvBase,
                                    keyValues: h,
                                    callback: k
                                })
                            },
                            j = this,
                            m = function() {
                                k.apply(j, [!0, function(a, b) {
                                    l(!1, e.hiresWidth, e.hiresHeight), i.apply(this, arguments)
                                }])
                            },
                            n = -1 !== navigator.userAgent.indexOf("MSIE");
                        if (n || d.launchData.forceHiResSave || d.launchData.hiresUrl !== d.launchData.url) h.call(this);
                        else {
                            var e = d.paintWidgetInstance.getScaledSize(),
                                o = d.launchData.maxSize,
                                p = d.launchData.hiresWidth,
                                q = d.launchData.hiresHeight;
                            p && q ? p > o && q > o ? h.call(this) : e.hiresWidth < o && e.hiresHeight < o ? m.call(this) : h.call(this) : h.call(this)
                        }
                    },
                    n = function(a, b, c) {
                        var e = this;
                        e.paintWidget.exportImage(c, function(c) {
                            var e = d.controlsWidgetInstance;
                            e.saving = !1, e.layoutNotify(d.launchData.openType, "enableControls", [!0]), e.paintWidget.showWaitThrobber(!1), a && "function" == typeof a && (b ? b = a(c) !== !1 : a(c)), b && d.util.nextFrame(function() {
                                d.controlsWidget_onImageSaved(e.origURL)
                            })
                        })
                    },
                    o = function(a, b, c, e) {
                        var f = !d.featherUseFlash;
                        f && this.layoutNotify(d.launchData.openType, "disableControls"), this.paintWidget.showWaitThrobber(f, function() {
                            switch (a) {
                                case "saveHiRes":
                                    m.call(g);
                                    break;
                                case "getImageData":
                                    n.call(g, b, c, e);
                                    break;
                                default:
                                    k.call(g)
                            }
                        });
                        var g = this;
                        return !1
                    };
                return function(a, b, c, f) {
                    return d.controlsWidgetInstance.loaderPhase < 2 ? !1 : this.saving ? !1 : (e.trigger("tool:commit"), e.trigger("tool:close"), this.saving = !0, d.prevActionList = this.paintWidget.actions.exportJSON(!0), d.launchData.postData && "string" != typeof d.launchData.postData && (d.launchData.postData = d.JSON.stringify(d.launchData.postData)), o.apply(this, [a, b, c, f]))
                }
            }(), d.ControlsWidget.prototype.onSaveButtonClicked = function(a) {
                if (e.trigger("usage:submit", "saveclicked"), "function" == typeof d.launchData.onSaveButtonClicked) {
                    var b = d.launchData.onSaveButtonClicked.apply(d.launchData, [d.util.getImageId(d.controlsWidgetInstance.paintImgIdElem)]);
                    if (b === !1) return !1
                }
                return d.controlsWidgetInstance.save()
            }, d.ControlsWidget.prototype.showAreYouSure = function() {
                this.messager.show("avpw_aviary_quitareyousure", !0)
            }, d.ControlsWidget.prototype.cancel = function(a) {
                this.quitCount++;
                var b = this.quitCount > 0 && this.paintWidget && this.paintWidget.dirty;
                if ("function" == typeof d.launchData.onCloseButtonClicked) {
                    var c = d.launchData.onCloseButtonClicked.apply(d.launchData, [b]);
                    if (c === !1) return !1
                }
                return b ? this.showAreYouSure() : d.paintWidgetCloser(), !1
            }, d.ControlsWidget.prototype.getScaledDims = function(a, b) {
                return d.util.getScaledDims(a, b, this.maxWidth, this.maxHeight)
            }, d.TransformStyle = function(a) {
                var b = this,
                    c = a || "";
                return b.set = function(a) {
                    if (c)
                        for (var b in a) {
                            var d = b + "\\([^\\)]*",
                                e = new RegExp(d),
                                f = !1,
                                g = function(c, d, e) {
                                    return f = !0, b + "(" + a[b]
                                };
                            c = c.replace(e, g), f || (c += " " + b + "(" + a[b] + ")")
                        } else
                            for (var b in a) c += " " + b + "(" + a[b] + ")"
                }, b.serialize = function() {
                    return c
                }, b
            }, a
        }(this, "undefined" != typeof window ? window : {}, "undefined" != typeof document ? document : {}), AV.errorNotify = function(a, b) {
            var c = {
                    BAD_IMAGE: {
                        code: 1,
                        message: "There was a problem loading your image provided to the `image` config key. Either it's not actually an image file or it doesn't really exist."
                    },
                    UNSUPPORTED: {
                        code: 2,
                        message: "It looks like you're using a browser that doesn't support the HTML canvas element (and also doesn't have Flash installed either). Please try accessing this page through a modern browser like Chrome, Firefox, Safari, or Internet Explorer (version 9 or higher). Your internets will thank you."
                    },
                    BAD_URL: {
                        code: 3,
                        message: "There was a problem loading your image provided by URI to the `url` config key. It is not reachable by the public (and our service at " + (AV.featherUseFlash ? AV.build.proxyServer : AV.build.imgrecvBase) + ")"
                    },
                    UNSUPPORTED_TOOL: {
                        code: 4,
                        message: "So sorry, but this tool is not available because it is not part of the set chosen with the `tools` config key. It's alternatively possible that your browser does not support this specific tool."
                    },
                    IMAGE_NOT_CLEAN: {
                        code: 5,
                        message: "Uh oh! We can't edit this image because the editor wasn't set up correctly to load external files via their address. You must either provide images from the same domain as the web page with the editor OR pass the external image address via the `url` config key in order for Aviary to be able to get permission from the browser to open it for editing. Sorry for the inconvenience!"
                    },
                    UNSUPPORTED_FONT: {
                        code: 6,
                        message: "So sorry, but this font looks to be unsupported by your browser or platform"
                    },
                    ERROR_SAVING: {
                        code: 7,
                        message: "There was a problem saving your photo. Please try again."
                    },
                    NO_APIKEY: {
                        code: 8,
                        message: "apiKey is required and not provided. See http://www.aviary.com/web-documentation#constructor-config-apikey."
                    },
                    ERROR_AUTHENTICATING: {
                        code: 9,
                        message: "There was a problem retrieving access to content from our server. Please ensure all authentication keys are present or do not attempt premium partner authentication."
                    },
                    ERROR_BAD_THEME: {
                        code: 10,
                        message: "Selected theme does not exist. Please use 'dark', 'light' or 'minimum' or see aviary.com/web for more info."
                    },
                    ERROR_BAD_IMAGE_WITHOUT_CORS: {
                        code: 11,
                        message: "The image URL you are trying to use is either not on the same domain or is not configured for CORS. See http://enable-cors.org/ for more info."
                    },
                    ERROR_SERVER_MESSAGING: {
                        code: 12,
                        message: "Error reaching Aviary services."
                    },
                    ERROR_BAD_AUTHENTICATION_PARAMETERS: {
                        code: 13,
                        message: "Invalid authenticationURL response. Please check the formatting the response."
                    },
                    BAD_FORCECROP_TOOLS: {
                        code: 14,
                        message: "If you're using the 'Force Crop' tool, the editor will disable the resize, orientation and crop tools so the user cannot change the intended forced size. It looks like the only tools you have enabled disabled by 'Force Crop'.."
                    },
                    ERROR_GET_ASSETS: {
                        code: 15,
                        message: "Error getting assets. Please check your authentication parameters."
                    },
                    ERROR_MISSING_HI_RES_URL: {
                        code: 16,
                        message: "Missing 'hiresUrl' from launch() method"
                    },
                    ERROR_WEBGL_LOST_CONTEXT: {
                        code: 17,
                        message: "WebGL Error: the GL lost context."
                    }
                },
                d = function(a) {},
                e = c[a],
                f = e.message;
            return "function" == typeof AV.launchData.onError && (e.args = b, f = AV.launchData.onError(e) || f), f && d(f), f
        },
        function(a, b, c) {
            "use strict";
            a.AV = a.AV || {};
            var d = a.AV,
                e = d.Events;
            a.Aviary = d, d.feather_loaded = !1, d.feather_loading = !1, d.build = d.build || {
                version: "",
                imgrecvServer: "imgrecvserver",
                flashGatewayServer: "",
                imgrecvBase: "",
                inAppPurchaseFrameURL: "",
                imgtrackServer: "imgtrackserver",
                filterServer: "",
                jsonp_imgserver: "",
                featherTargetAnnounce: "feather_target_announce_v3.html",
                proxyServer: "",
                feather_baseURL: "",
                feather_stickerURL: "",
                googleTracker: ""
            }, d.defaultTools = ["enhance", "effects", "frames", "overlays", "overlay", "orientation", "crop", "resize", "lighting", "color", "sharpness", "focus", "vignette", "blemish", "whiten", "redeye", "drawing", "colorsplash", "textwithfont", "meme"], d.glSupportedTools = ["enhance", "effects", "frames", "overlays", "overlay", "orientation", "crop", "resize", "lighting", "color", "sharpness", "focus", "vignette", "blemish", "whiten", "redeye", "drawing", "colorsplash", "textwithfont", "meme"], d.flashSupportedTools = ["enhance", "effects", "overlay", "crop", "resize", "orientation", "brightness", "contrast", "saturation", "sharpness", "drawing", "text", "redeye", "blemish"];
            var f = {};
            return f.image = null, f.apiKey = void 0, f.apiVersion = 4, f.appendTo = null, f.language = "en", f.theme = null, f.minimumStyling = !1, f.maxSize = 1024, f.noCloseButton = !1, f.launchDelay = 300, f.closeDelay = 300, f.forceCropPreset = null, f.forceHiResSave = !1, f.authenticationURL = null, f.tools = void 0, f.initTool = "", f.cropPresets = ["Custom", "Original", ["Square", "1:1"], "3:2", "3:5", "4:3", "4:5", "4:6", "5:7", "8:10", "16:9"], f.cropPresetDefault = "Custom", f.cropPresetsStrict = !1, f.url = null, f.enableCORS = !1, f.postUrl = void 0, f.postData = null, f.fileFormat = "", f.jpgQuality = 100, f.displayImageSize = !1, f.hiresMaxSize = 1e4, f.hiresWidth = null, f.hiresHeight = null, f.onLoad = void 0, f.onReady = void 0, f.onSaveButtonClicked = void 0, f.onSave = void 0, f.onSaveHiRes = void 0, f.onClose = void 0, f.onError = void 0, f.signature = null, f.timestamp = null, f.hiresUrl = void 0, f.isPremiumPartner = !0, f.useCustomFileExpiration = !1, f.allowInAppPurchase = !1, f.disableWebGL = !1, f.forceFlash = !1, f.forceSupport = !1, f.poweredByURL = "http://www.aviary.com", f.giveFeedbackURL = "http://support.aviary.com/", f.getWidgetURL = "https://creativesdk.adobe.com", f.debug = !1, f.asyncSave = !0, d.baseConfig = f,
                function(a) {
                    var b = function(a) {
                        return {
                            language: a.Feather_Language,
                            forceFlash: a.Feather_ForceFlash,
                            forceSupport: a.AV_Feather_ForceSupport,
                            onLoad: a.Feather_OnLoad,
                            onReady: a.Feather_OnLaunchComplete,
                            onClose: a.Feather_OnClose,
                            onSave: a.Feather_OnSave,
                            noCloseButton: a.Feather_NoCloseButton,
                            maxSize: a.Feather_MaxSize || a.Feather_MaxDisplaySize,
                            tools: a.Feather_EditOptions,
                            cropPresets: a.Feather_CropSizes,
                            resizePresets: a.Feather_ResizeSizes,
                            apiKey: a.Feather_APIKey,
                            hiresUrl: a.Feather_HiResURL,
                            postUrl: a.Feather_PostURL,
                            fileFormat: a.Feather_FileFormat || a.Feather_ContentType,
                            jpgQuality: a.Feather_FileQuality,
                            signature: a.Feather_Signature,
                            timestamp: a.Feather_Timestamp
                        }
                    };
                    if (d.baseConfig = d.util.extend(d.baseConfig, b(a)), "https:" === a.location.protocol || "chrome-extension:" === a.location.protocol) {
                        var c, e;
                        for (var f in d.build) d.build.hasOwnProperty(f) && (e = f.split("_SSL"), 2 === e.length && d.build[f] && (c = e[0], d.build[c] = d.build[f]))
                    }
                }(b), d.getLocalizedString = function(a) {
                    try {
                        var b = d.lang[d.launchData.language][a];
                        return void 0 === b && (b = a), b
                    } catch (c) {}
                    return a
                }, Function.prototype.AV_bindInst = function(a) {
                    var b = this;
                    return function() {
                        return b.apply(a, arguments)
                    }
                }, d.injectControls = function() {
                    var a, b;
                    if ("popup" === d.launchData.openType ? (a = "", b = d.template[d.launchData.layout].saveBlock()) : (a = d.template[d.launchData.layout].saveBlock(), b = ""), d.criticalLayoutStyles && !d.feather_loaded) {
                        var e = c.createElement("style");
                        e.type = "text/css";
                        var f = c.createTextNode(d.criticalLayoutStyles);
                        e.styleSheet ? e.styleSheet.cssText = f.nodeValue : e.appendChild(f);
                        var g = c.getElementsByTagName("head")[0];
                        g.appendChild(e)
                    }
                    var h = d.template[d.launchData.layout].controls({
                            internalSaveBlock: a,
                            externalSaveBlock: b
                        }),
                        i = c.createElement("div");
                    i.id = "avpw_holder";
                    var j = "";
                    d.featherUseFlash && (j = "avpw_flash "), d.msie && (j += "avpw_ie" + d.msie), j && (i.className = j);
                    var k = c.getElementsByTagName("body");
                    k && (k = k[0]), k || (k = c.documentElement), k.appendChild(i), i.innerHTML = h
                }, d.Feather = function(a) {
                    a || (a = {});
                    var f = this;
                    a.authenticationURL && (a.isPremiumPartner = !0, e.on("auth:update", function(a) {
                        g(a)
                    }));
                    var g = function(c) {
                            b.avpw$.ajax({
                                url: a.authenticationURL,
                                cache: !1,
                                type: "GET",
                                contentType: "application/json"
                            }).done(function(a) {
                                for (var b, e = ["salt", "timestamp", "signature", "encryptionMethod"], g = [], h = 0; h < e.length; h++) b = e[h], a[b] || g.push(b);
                                g.length > 0 && d.errorNotify("ERROR_BAD_AUTHENTICATION_PARAMETERS", [g.join(", ")]), f.updateConfig({
                                    salt: a.salt,
                                    timestamp: a.timestamp,
                                    signature: a.signature,
                                    encryptionMethod: a.encryptionMethod
                                }), c && c()
                            })
                        },
                        h = function() {
                            d.injectControls(), d.util.nextFrame(d.loadStageFinal)
                        },
                        i = function() {
                            "undefined" != typeof avpw$ ? b.avpw$(c).ready(h) : h()
                        };
                    a && (a.openType = "aviary", a.layout = "desktop"), a = a || {}, d.launchData = d.util.extend(d.baseConfig, a);
                    var j = function() {
                        function a(a) {
                            var b = d.build.feather_baseURL + "css/" + a;
                            d.util.loadFile(b + ".css", "css")
                        }
                        var b, c;
                        if (d.featherUseFlash = !d.featherCanvasOk() && d.featherFlashOk(), d.featherGLEnabled = d.launchData.forceGL || d.shouldUseWebGL(), d.featherUseFlash && (d.launchData.forceHiResSave = !0), d.launchData.language = d.launchData.language.toLowerCase(), !d.feather_loaded && !d.feather_loading) {
                            switch (d.feather_loading = !0, b = d.launchData.language || "en", c = "js/feathercontrols_", c += d.validLanguages && d.validLanguages[b] ? b + ".js" : "en.js", !d.launchData.theme && d.launchData.minimumStyling && (d.launchData.theme = "minimum"), "minimum" === d.launchData.theme && (d.launchData.minimumStyling = !0), d.launchData.theme || (d.launchData.theme = "dark"), d.launchData.theme) {
                                case "dark":
                                case "light":
                                case "minimum":
                                    break;
                                default:
                                    d.errorNotify("ERROR_BAD_THEME")
                            }
                            var e;
                            e = d.launchData.minimumStyling ? "feather_core_" : "feather_theme_aviary_", e += d.launchData.theme, a(e), d.build.bundled ? i() : d.util.loadFile(d.build.feather_baseURL + c, "js", i)
                        }
                    };
                    j();
                    var k = function() {
                        return d.paintWidgetInstance ? !1 : void d.paintWidgetLauncher(d.launchData.image, d.launchData.url)
                    };
                    return f.launch = function(a) {
                        if (!d.feather_loaded) return !1;
                        var b = c.getElementById("avpw_holder");
                        if (b || d.injectControls(), d.paintWidgetInstance) {
                            if (b) return !1;
                            f.close(!0)
                        }
                        if (d.launchData && (d.launchData.hiresWidth || d.launchData.hiresHeight) && (d.launchData.hiresWidth = null, d.launchData.hiresHeight = null), a && a.language && delete a.language, d.launchData = a ? d.util.extend(d.launchData, a) : d.launchData, !d.launchData.image) return d.errorNotify("BAD_IMAGE"), !1;
                        if (!d.launchData.apiKey) return d.errorNotify("NO_APIKEY"), !1;
                        if ("object" == typeof a.forceCropPreset ? (d.launchData.forceCropPreset = [a.forceCropPreset], d.launchData.initTool = "forcecrop") : d.launchData.forceCropPreset = null, d.launchData.initTool && (b.className += " avpw_init_hide"), d.featherUseFlash) k();
                        else {
                            if (!d.featherSupported()) return d.errorNotify("UNSUPPORTED") && (d.controlsWidgetInstance = new d.ControlsWidget, d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "placeControls", [d.util.getApiVersion(d.launchData) > 1 ? d.launchData.appendTo : void 0]), d.controlsWidgetInstance.bindControls(), c.getElementById("avpw_controls").style.display = "block", d.controlsWidgetInstance.messager.show("avpw_aviary_unsupported", !0)), !0;
                            d.util.nextFrame(k)
                        }
                        return !0
                    }, f.showWaitIndicator = function() {
                        return d.controlsWidgetInstance && d.controlsWidgetInstance.showWaitThrobber ? (d.controlsWidgetInstance.showWaitThrobber(!0), !0) : !1
                    }, f.hideWaitIndicator = function() {
                        return d.controlsWidgetInstance && d.controlsWidgetInstance.showWaitThrobber ? (d.controlsWidgetInstance.showWaitThrobber(!1), !0) : !1
                    }, f.getImageDimensions = function() {
                        var a = null;
                        return d.paintWidgetInstance && (a = d.paintWidgetInstance.getScaledSize(), d.launchData.hiresWidth && d.launchData.hiresHeight || (delete a.hiresWidth, delete a.hiresHeight)), a
                    }, f.save = function() {
                        return d.paintWidgetInstance ? d.controlsWidgetInstance.save() : !1
                    }, f.saveHiRes = function() {
                        return d.paintWidgetInstance ? d.launchData.authenticationURL ? (e.trigger("auth:update", function() {
                            d.controlsWidgetInstance.save("saveHiRes")
                        }), !0) : d.controlsWidgetInstance.save("saveHiRes") : !1
                    }, f.getImageData = function(a, b, c) {
                        return d.paintWidgetInstance ? d.controlsWidgetInstance.save("getImageData", a, b, c) : !1
                    }, f.close = function(a) {
                        return d.paintWidgetInstance ? void d.paintWidgetCloser(a) : !1
                    }, f.relaunch = function() {
                        return e.trigger("usage:interact", "api", "relaunch"), d.isRelaunched = !0, d.launchData ? void f.launch(d.launchData) : !1
                    }, f.activateTool = function(a) {
                        e.trigger("tool:open", a, d.controlsWidgetInstance)
                    }, f.replaceImage = function(a) {
                        return e.trigger("usage:interact", "api", "replaceImage"), d.launchData ? (f.close(!0), void d.util.nextFrame(function() {
                            d.launchData.url = a, f.launch(d.launchData)
                        })) : !1
                    }, f.updateConfig = function(a, b) {
                        if (!d.launchData) return !1;
                        if (a && "object" == typeof a)
                            for (var c in a) a.hasOwnProperty(c) && (d.launchData[c] = a[c]);
                        else {
                            if (!a || "string" != typeof a) return !1;
                            d.launchData[a] = b
                        }
                    }, f.getIsDirty = function() {
                        return d.paintWidgetInstance ? d.paintWidgetInstance.dirty : !1
                    }, f.getActionList = function() {
                        return d.paintWidgetInstance ? (e.trigger("tool:commit"), d.paintWidgetInstance.actions.exportJSON(!0)) : void 0
                    }, f.disableControls = function() {
                        d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "disableControls")
                    }, f.enableControls = function() {
                        d.controlsWidgetInstance.layoutNotify(d.launchData.openType, "enableControls")
                    }, f.on = function(a, b) {
                        e && a && b && "function" == typeof b && e.on(a, b)
                    }, f.off = function(a, b) {
                        e && a && b && "function" == typeof b && e.off(a, b)
                    }, f
                }, d.loadStageFinal = function() {
                    d.feather_loaded = !0;
                    var a = function() {
                        "function" == typeof d.launchData.onLoad && d.launchData.onLoad()
                    };
                    d.launchData.authenticationURL ? e.trigger("auth:update", a) : a()
                }, d.featherSupported = function() {
                    return d.featherCanvasOk() || d.featherFlashOk() || d.launchData.forceSupport
                }, d.featherFlashOk = function() {
                    return d.launchData.forceFlash ? !0 : b.avpw_swfobject && b.avpw_swfobject.hasFlashPlayerVersion(d.build.MINIMUM_FLASH_PLAYER_VERSION)
                }, d.featherCanvasOk = function() {
                    if (d.launchData.forceFlash) return !1;
                    var a = !!c.createElement("canvas").getContext,
                        e = "function" == typeof b.postMessage;
                    return a && e
                }, d.shouldUseWebGL = function() {
                    if (d.launchData.disableWebGL) return !1;
                    var a = !!navigator.userAgent.match(/Trident.*rv[ :]*11\./);
                    if (-1 === navigator.userAgent.indexOf("Chrome") && -1 === navigator.userAgent.indexOf("Firefox") && !a) return !1;
                    if (-1 !== navigator.userAgent.indexOf("Firefox")) {
                        var e = parseInt(navigator.userAgent.toLowerCase().split("firefox/")[1]);
                        if (!e || 33 > e) return !1
                    }
                    var f = c.createElement("canvas");
                    if ("undefined" == typeof b.WebGLRenderingContext) return !1;
                    if (!f || !f.getContext) return !1;
                    var g = f.getContext("webgl") || f.getContext("experimental-webgl");
                    if (!g) return !1;
                    var h = g.getParameter(g.MAX_TEXTURE_SIZE);
                    return !(d.launchData.maxSize > h)
                }, d.getFlashMovie = function(a) {
                    var d = b[a] || c[a];
                    return d
                }, d.msie = function() {
                    for (var a, b = 3, d = c.createElement("div"), e = d.getElementsByTagName("i"); d.innerHTML = "<!--[if gt IE " + ++b + "]><i></i><![endif]-->", e[0];);
                    return b > 4 ? b : a
                }(), d.firefox = function() {
                    var a;
                    return "Gecko" === b.navigator.product && (a = navigator.userAgent.split("Firefox/")[1], a = parseInt(a, 10)), a
                }(), d.PAGE_WIDTH = 360, d.setPageWidth = function(a) {
                    d.PAGE_WIDTH = a
                }, a
        }(this, "undefined" != typeof window ? window : {}, "undefined" != typeof document ? document : {}), AV.S3Uploader = function() {
            function a(a, b) {
                a = atob(a);
                for (var c = new ArrayBuffer(a.length), d = new Uint8Array(c), e = 0; e < a.length; e++) d[e] = a.charCodeAt(e);
                return new Blob([c], {
                    type: b
                })
            }
            var b = {},
                c = function() {
                    return AV.build.imgrecvBase + "s3signature"
                },
                d = function(a, b) {
                    var d = new XMLHttpRequest;
                    d.open("GET", c() + "?object_type=" + a), d.onreadystatechange = function() {
                        return 4 === d.readyState ? 200 === d.status ? b(null, JSON.parse(d.responseText)) : b("Could not get signed URL") : void 0
                    }, d.send()
                };
            return b.isCapable = function(a) {
                return "image/png" === a && "function" == typeof XMLHttpRequest && "function" == typeof Blob && !avpw$.browser.msie && !AV.util.isIE11()
            }, b.upload = function(b, c, e) {
                var f = a(c, b);
                d(b, function(a, b) {
                    if (!a && b) {
                        var c = new XMLHttpRequest;
                        c.open("PUT", b.signed_request), c.setRequestHeader("x-amz-acl", "public-read"), c.onload = function() {
                            200 === c.status && e(null, b.url)
                        }, c.onerror = function() {
                            e("Could not upload file")
                        }, c.send(f)
                    }
                })
            }, b
        }(), AV.support = function(a) {
            var b, c = a.navigator.userAgent,
                d = a.screen.width,
                e = (a.screen.height, {
                    0: /Android/i,
                    1: /webOS/i,
                    2: /iPhone/i,
                    3: /iPod/i,
                    4: /BlackBerry/i,
                    5: /iPad/i
                }),
                f = 0,
                g = 0,
                h = 0,
                i = 0;
            for (var j in e) c.match(e[j]) && (f = 1, b = parseInt(j));
            if (c.match(/AppleWebKit/i) && (g = 1), 0 === b && (h = 1), 1 === h) {
                var k = c.match(/Android [0-9].[0-9]/).toString();
                k && (i = parseFloat(k.split("Android ")[1]))
            }
            var l = {};
            return l.isAppleWebkit = function() {
                return 1 === g
            }, l.isMobileWebkit = function() {
                return 1 === g && d && (480 >= d || i > 0 && 2.3 >= i)
            }, l.isIPhoneOrIPod = function() {
                return 2 === b || 3 === b
            }, l.isAndroid = function() {
                return 1 === h
            }, l.getAndroidVersion = function() {
                return i
            }, l.getVendorProperty = function() {
                var a = {},
                    b = function(a, b) {
                        var c, d, e = ["webkit", "ms", "Moz", "O"],
                            f = a.style;
                        if (void 0 !== f[b]) return b;
                        for (b = b.charAt(0).toUpperCase() + b.slice(1), d = 0; d < e.length; d++)
                            if (c = e[d] + b, void 0 !== f[c]) return c
                    };
                return function(c) {
                    return a[c] || (a[c] = b(document.createElement("div"), c))
                }
            }(), l
        }(window)
}(window.AV || (window.AV = {}), window, document),
function() {
    "use strict";

    function a(a) {
        function b(b, d) {
            var f, p, q = b == window,
                r = d && void 0 !== d.message ? d.message : void 0;
            if (d = a.extend({}, a.blockUI.defaults, d || {}), !d.ignoreIfBlocked || !a(b).data("blockUI.isBlocked")) {
                if (d.overlayCSS = a.extend({}, a.blockUI.defaults.overlayCSS, d.overlayCSS || {}), f = a.extend({}, a.blockUI.defaults.css, d.css || {}), d.onOverlayClick && (d.overlayCSS.cursor = "pointer"), p = a.extend({}, a.blockUI.defaults.themedCSS, d.themedCSS || {}), r = void 0 === r ? d.message : r, q && n && c(window, {
                        fadeOut: 0
                    }), r && "string" != typeof r && (r.parentNode || r.jquery)) {
                    var s = r.jquery ? r[0] : r,
                        t = {};
                    a(b).data("blockUI.history", t), t.el = s, t.parent = s.parentNode, t.display = s.style.display, t.position = s.style.position, t.parent && t.parent.removeChild(s)
                }
                a(b).data("blockUI.onUnblock", d.onUnblock);
                var u, v, w, x, y = d.baseZ;
                u = a(k || d.forceIframe ? '<iframe class="blockUI" style="z-index:' + y++ + ';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="' + d.iframeSrc + '"></iframe>' : '<div class="blockUI" style="display:none"></div>'), v = a(d.theme ? '<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:' + y++ + ';display:none"></div>' : '<div class="blockUI blockOverlay" style="z-index:' + y++ + ';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>'), d.theme && q ? (x = '<div class="blockUI ' + d.blockMsgClass + ' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:' + (y + 10) + ';display:none;position:fixed">', d.title && (x += '<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">' + (d.title || "&nbsp;") + "</div>"), x += '<div class="ui-widget-content ui-dialog-content"></div>', x += "</div>") : d.theme ? (x = '<div class="blockUI ' + d.blockMsgClass + ' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:' + (y + 10) + ';display:none;position:absolute">', d.title && (x += '<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">' + (d.title || "&nbsp;") + "</div>"), x += '<div class="ui-widget-content ui-dialog-content"></div>', x += "</div>") : x = q ? '<div class="blockUI ' + d.blockMsgClass + ' blockPage" style="z-index:' + (y + 10) + ';display:none;position:fixed"></div>' : '<div class="blockUI ' + d.blockMsgClass + ' blockElement" style="z-index:' + (y + 10) + ';display:none;position:absolute"></div>', w = a(x), r && (d.theme ? (w.css(p), w.addClass("ui-widget-content")) : w.css(f)), d.theme || v.css(d.overlayCSS), v.css("position", q ? "fixed" : "absolute"), (k || d.forceIframe) && u.css("opacity", 0);
                var z = [u, v, w],
                    A = a(q ? "body" : b);
                a.each(z, function() {
                    this.appendTo(A)
                }), d.theme && d.draggable && a.fn.draggable && w.draggable({
                    handle: ".ui-dialog-titlebar",
                    cancel: "li"
                });
                var B = m && (!a.support.boxModel || a("object,embed", q ? null : b).length > 0);
                if (l || B) {
                    if (q && d.allowBodyStretch && a.support.boxModel && a("html,body").css("height", "100%"), (l || !a.support.boxModel) && !q) var C = i(b, "borderTopWidth"),
                        D = i(b, "borderLeftWidth"),
                        E = C ? "(0 - " + C + ")" : 0,
                        F = D ? "(0 - " + D + ")" : 0;
                    a.each(z, function(a, b) {
                        var c = b[0].style;
                        if (c.position = "absolute", 2 > a) q ? c.setExpression("height", "Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:" + d.quirksmodeOffsetHack + ') + "px"') : c.setExpression("height", 'this.parentNode.offsetHeight + "px"'), q ? c.setExpression("width", 'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"') : c.setExpression("width", 'this.parentNode.offsetWidth + "px"'), F && c.setExpression("left", F), E && c.setExpression("top", E);
                        else if (d.centerY) q && c.setExpression("top", '(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'), c.marginTop = 0;
                        else if (!d.centerY && q) {
                            var e = d.css && d.css.top ? parseInt(d.css.top, 10) : 0,
                                f = "((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + " + e + ') + "px"';
                            c.setExpression("top", f)
                        }
                    })
                }
                if (r && (d.theme ? w.find(".ui-widget-content").append(r) : w.append(r), (r.jquery || r.nodeType) && a(r).show()), (k || d.forceIframe) && d.showOverlay && u.show(), d.fadeIn) {
                    var G = d.onBlock ? d.onBlock : j,
                        H = d.showOverlay && !r ? G : j,
                        I = r ? G : j;
                    d.showOverlay && v._fadeIn(d.fadeIn, H), r && w._fadeIn(d.fadeIn, I)
                } else d.showOverlay && v.show(), r && w.show(), d.onBlock && d.onBlock();
                if (e(1, b, d), q ? (n = w[0], o = a(d.focusableElements, n), d.focusInput && setTimeout(g, 20)) : h(w[0], d.centerX, d.centerY), d.timeout) {
                    var J = setTimeout(function() {
                        q ? a.unblockUI(d) : a(b).unblock(d)
                    }, d.timeout);
                    a(b).data("blockUI.timeout", J)
                }
            }
        }

        function c(b, c) {
            var f, g = b == window,
                h = a(b),
                i = h.data("blockUI.history"),
                j = h.data("blockUI.timeout");
            j && (clearTimeout(j), h.removeData("blockUI.timeout")), c = a.extend({}, a.blockUI.defaults, c || {}), e(0, b, c), null === c.onUnblock && (c.onUnblock = h.data("blockUI.onUnblock"), h.removeData("blockUI.onUnblock"));
            var k;
            k = g ? a("body").children().filter(".blockUI").add("body > .blockUI") : h.find(">.blockUI"), c.cursorReset && (k.length > 1 && (k[1].style.cursor = c.cursorReset), k.length > 2 && (k[2].style.cursor = c.cursorReset)), g && (n = o = null), c.fadeOut ? (f = k.length, k.stop().fadeOut(c.fadeOut, function() {
                0 === --f && d(k, i, c, b)
            })) : d(k, i, c, b)
        }

        function d(b, c, d, e) {
            var f = a(e);
            if (!f.data("blockUI.isBlocked")) {
                b.each(function(a, b) {
                    this.parentNode && this.parentNode.removeChild(this)
                }), c && c.el && (c.el.style.display = c.display, c.el.style.position = c.position, c.parent && c.parent.appendChild(c.el), f.removeData("blockUI.history")), f.data("blockUI.static") && f.css("position", "static"), "function" == typeof d.onUnblock && d.onUnblock(e, d);
                var g = a(document.body),
                    h = g.width(),
                    i = g[0].style.width;
                g.width(h - 1).width(h), g[0].style.width = i
            }
        }

        function e(b, c, d) {
            var e = c == window,
                g = a(c);
            if ((b || (!e || n) && (e || g.data("blockUI.isBlocked"))) && (g.data("blockUI.isBlocked", b), e && d.bindEvents && (!b || d.showOverlay))) {
                var h = "mousedown mouseup keydown keypress keyup touchstart touchend touchmove";
                b ? a(document).bind(h, d, f) : a(document).unbind(h, f)
            }
        }

        function f(b) {
            if ("keydown" === b.type && b.keyCode && 9 == b.keyCode && n && b.data.constrainTabKey) {
                var c = o,
                    d = !b.shiftKey && b.target === c[c.length - 1],
                    e = b.shiftKey && b.target === c[0];
                if (d || e) return setTimeout(function() {
                    g(e)
                }, 10), !1
            }
            var f = b.data,
                h = a(b.target);
            return h.hasClass("blockOverlay") && f.onOverlayClick && f.onOverlayClick(b), h.parents("div." + f.blockMsgClass).length > 0 ? !0 : 0 === h.parents().children().filter("div.blockUI").length
        }

        function g(a) {
            if (o) {
                var b = o[a === !0 ? o.length - 1 : 0];
                b && b.focus()
            }
        }

        function h(a, b, c) {
            var d = a.parentNode,
                e = a.style,
                f = (d.offsetWidth - a.offsetWidth) / 2 - i(d, "borderLeftWidth"),
                g = (d.offsetHeight - a.offsetHeight) / 2 - i(d, "borderTopWidth");
            b && (e.left = f > 0 ? f + "px" : "0"), c && (e.top = g > 0 ? g + "px" : "0")
        }

        function i(b, c) {
            return parseInt(a.css(b, c), 10) || 0
        }
        a.fn._fadeIn = a.fn.fadeIn;
        var j = a.noop || function() {},
            k = /MSIE/.test(navigator.userAgent),
            l = /MSIE 6.0/.test(navigator.userAgent) && !/MSIE 8.0/.test(navigator.userAgent),
            m = (document.documentMode || 0, a.isFunction(document.createElement("div").style.setExpression));
        a.blockUI = function(a) {
            b(window, a)
        }, a.unblockUI = function(a) {
            c(window, a)
        }, a.growlUI = function(b, c, d, e) {
            var f = a('<div class="growlUI"></div>');
            b && f.append("<h1>" + b + "</h1>"), c && f.append("<h2>" + c + "</h2>"), void 0 === d && (d = 3e3);
            var g = function(b) {
                b = b || {}, a.blockUI({
                    message: f,
                    fadeIn: "undefined" != typeof b.fadeIn ? b.fadeIn : 700,
                    fadeOut: "undefined" != typeof b.fadeOut ? b.fadeOut : 1e3,
                    timeout: "undefined" != typeof b.timeout ? b.timeout : d,
                    centerY: !1,
                    showOverlay: !1,
                    onUnblock: e,
                    css: a.blockUI.defaults.growlCSS
                })
            };
            g();
            f.css("opacity");
            f.mouseover(function() {
                g({
                    fadeIn: 0,
                    timeout: 3e4
                });
                var b = a(".blockMsg");
                b.stop(), b.fadeTo(300, 1)
            }).mouseout(function() {
                a(".blockMsg").fadeOut(1e3)
            })
        }, a.fn.block = function(c) {
            if (this[0] === window) return a.blockUI(c), this;
            var d = a.extend({}, a.blockUI.defaults, c || {});
            return this.each(function() {
                var b = a(this);
                d.ignoreIfBlocked && b.data("blockUI.isBlocked") || b.unblock({
                    fadeOut: 0
                })
            }), this.each(function() {
                "static" == a.css(this, "position") && (this.style.position = "relative", a(this).data("blockUI.static", !0)), this.style.zoom = 1, b(this, c)
            })
        }, a.fn.unblock = function(b) {
            return this[0] === window ? (a.unblockUI(b), this) : this.each(function() {
                c(this, b)
            })
        }, a.blockUI.version = 2.66, a.blockUI.defaults = {
            message: "<h1>Please wait...</h1>",
            title: null,
            draggable: !0,
            theme: !1,
            css: {
                padding: 0,
                margin: 0,
                width: "30%",
                top: "40%",
                left: "35%",
                textAlign: "center",
                color: "#000",
                border: "3px solid #aaa",
                backgroundColor: "#fff",
                cursor: "wait"
            },
            themedCSS: {
                width: "30%",
                top: "40%",
                left: "35%"
            },
            overlayCSS: {
                backgroundColor: "#000",
                opacity: .6,
                cursor: "wait"
            },
            cursorReset: "default",
            growlCSS: {
                width: "350px",
                top: "10px",
                left: "",
                right: "10px",
                border: "none",
                padding: "5px",
                opacity: .6,
                cursor: "default",
                color: "#fff",
                backgroundColor: "#000",
                "-webkit-border-radius": "10px",
                "-moz-border-radius": "10px",
                "border-radius": "10px"
            },
            iframeSrc: /^https/i.test(window.location.href || "") ? "javascript:false" : "about:blank",
            forceIframe: !1,
            baseZ: 1e3,
            centerX: !0,
            centerY: !0,
            allowBodyStretch: !0,
            bindEvents: !0,
            constrainTabKey: !0,
            fadeIn: 200,
            fadeOut: 400,
            timeout: 0,
            showOverlay: !0,
            focusInput: !0,
            focusableElements: ":input:enabled:visible",
            onBlock: null,
            onUnblock: null,
            onOverlayClick: null,
            quirksmodeOffsetHack: 4,
            blockMsgClass: "blockMsg",
            ignoreIfBlocked: !1
        };
        var n = null,
            o = []
    }
    "function" == typeof define && define.amd && define.amd.jQuery ? define(["jquery"], a) : a(jQuery)
}(),
function(a) {
    function b(a) {
        this.init(a)
    }
    b.prototype = {
        value: 0,
        size: 100,
        startAngle: -Math.PI,
        thickness: "auto",
        fill: {
            gradient: ["#3aeabb", "#fdd250"]
        },
        emptyFill: "rgba(0, 0, 0, .1)",
        animation: {
            duration: 1200,
            easing: "circleProgressEasing"
        },
        animationStartValue: 0,
        reverse: !1,
        lineCap: "butt",
        constructor: b,
        el: null,
        canvas: null,
        ctx: null,
        radius: 0,
        arcFill: null,
        lastFrameValue: 0,
        init: function(b) {
            a.extend(this, b), this.radius = this.size / 2, this.initWidget(), this.initFill(), this.draw()
        },
        initWidget: function() {
            var b = this.canvas = this.canvas || a("<canvas>").prependTo(this.el)[0];
            b.width = this.size, b.height = this.size, this.ctx = b.getContext("2d")
        },
        initFill: function() {
            function b() {
                var b = a("<canvas>")[0];
                b.width = c.size, b.height = c.size, b.getContext("2d").drawImage(k, 0, 0, f, f), c.arcFill = c.ctx.createPattern(b, "no-repeat"), c.drawFrame(c.lastFrameValue)
            }
            var c = this,
                d = this.fill,
                e = this.ctx,
                f = this.size;
            if (!d) throw Error("The fill is not specified!");
            if (d.color && (this.arcFill = d.color), d.gradient) {
                var g = d.gradient;
                if (1 == g.length) this.arcFill = g[0];
                else if (1 < g.length) {
                    for (var h = d.gradientAngle || 0, e = e.createLinearGradient.apply(e, d.gradientDirection || [f / 2 * (1 - Math.cos(h)), f / 2 * (1 + Math.sin(h)), f / 2 * (1 + Math.cos(h)), f / 2 * (1 - Math.sin(h))]), h = 0; h < g.length; h++) {
                        var i = g[h],
                            j = h / (g.length - 1);
                        a.isArray(i) && (j = i[1], i = i[0]), e.addColorStop(j, i)
                    }
                    this.arcFill = e
                }
            }
            if (d.image) {
                var k;
                d.image instanceof Image ? k = d.image : (k = new Image, k.src = d.image), k.complete ? b() : k.onload = b
            }
        },
        draw: function() {
            this.animation ? this.drawAnimated(this.value) : this.drawFrame(this.value)
        },
        drawFrame: function(a) {
            this.lastFrameValue = a, this.ctx.clearRect(0, 0, this.size, this.size), this.drawEmptyArc(a), this.drawArc(a)
        },
        drawArc: function(a) {
            var b = this.ctx,
                c = this.radius,
                d = this.getThickness(),
                e = this.startAngle;
            b.save(), b.beginPath(), this.reverse ? b.arc(c, c, c - d / 2, e - 2 * Math.PI * a, e) : b.arc(c, c, c - d / 2, e, e + 2 * Math.PI * a), b.lineWidth = d, b.lineCap = this.lineCap, b.strokeStyle = this.arcFill, b.stroke(), b.restore()
        },
        drawEmptyArc: function(a) {
            var b = this.ctx,
                c = this.radius,
                d = this.getThickness(),
                e = this.startAngle;
            1 > a && (b.save(), b.beginPath(), 0 >= a ? b.arc(c, c, c - d / 2, 0, 2 * Math.PI) : this.reverse ? b.arc(c, c, c - d / 2, e, e - 2 * Math.PI * a) : b.arc(c, c, c - d / 2, e + 2 * Math.PI * a, e), b.lineWidth = d, b.strokeStyle = this.emptyFill, b.stroke(), b.restore())
        },
        drawAnimated: function(b) {
            var c = this,
                d = this.el,
                e = a(this.canvas);
            e.stop(!0, !1), d.trigger("circle-animation-start"), e.css({
                animationProgress: 0
            }).animate({
                animationProgress: 1
            }, a.extend({}, this.animation, {
                step: function(a) {
                    var e = c.animationStartValue * (1 - a) + b * a;
                    c.drawFrame(e), d.trigger("circle-animation-progress", [a, e])
                }
            })).promise().always(function() {
                d.trigger("circle-animation-end")
            })
        },
        getThickness: function() {
            return a.isNumeric(this.thickness) ? this.thickness : this.size / 14
        },
        getValue: function() {
            return this.value
        },
        setValue: function(a) {
            this.animation && (this.animationStartValue = this.lastFrameValue), this.value = a, this.draw()
        }
    }, a.circleProgress = {
        defaults: b.prototype
    }, a.easing.circleProgressEasing = function(a, b, c, d, e) {
        return 1 > (b /= e / 2) ? d / 2 * b * b * b + c : d / 2 * ((b -= 2) * b * b + 2) + c
    }, a.fn.circleProgress = function(c, d) {
        var e = this.data("circle-progress");
        if ("widget" == c) {
            if (!e) throw Error('Calling "widget" method on not initialized instance is forbidden');
            return e.canvas
        }
        if ("value" == c) {
            if (!e) throw Error('Calling "value" method on not initialized instance is forbidden');
            return "undefined" == typeof d ? e.getValue() : this.each(function() {
                a(this).data("circle-progress").setValue(d)
            })
        }
        return this.each(function() {
            var d = a(this),
                e = d.data("circle-progress"),
                f = a.isPlainObject(c) ? c : {};
            e ? e.init(f) : (e = a.extend({}, d.data()), "string" == typeof e.fill && (e.fill = JSON.parse(e.fill)), "string" == typeof e.animation && (e.animation = JSON.parse(e.animation)), f = a.extend(e, f), f.el = d, e = new b(f), d.data("circle-progress", e))
        })
    }
}(jQuery);
var fabric = fabric || {
    version: "1.6.0-rc.1"
};
"undefined" != typeof exports && (exports.fabric = fabric), "undefined" != typeof document && "undefined" != typeof window ? (fabric.document = document, fabric.window = window, window.fabric = fabric) : (fabric.document = require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"), fabric.document.createWindow ? fabric.window = fabric.document.createWindow() : fabric.window = fabric.document.parentWindow), fabric.isTouchSupported = "ontouchstart" in fabric.document.documentElement, fabric.isLikelyNode = "undefined" != typeof Buffer && "undefined" == typeof window, fabric.SHARED_ATTRIBUTES = ["display", "transform", "fill", "fill-opacity", "fill-rule", "opacity", "stroke", "stroke-dasharray", "stroke-linecap", "stroke-linejoin", "stroke-miterlimit", "stroke-opacity", "stroke-width", "id"], fabric.DPI = 96, fabric.reNum = "(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)", fabric.devicePixelRatio = fabric.window.devicePixelRatio || fabric.window.webkitDevicePixelRatio || fabric.window.mozDevicePixelRatio || 1,
    function() {
        function a(a, b) {
            this.__eventListeners[a] && (b ? fabric.util.removeFromArray(this.__eventListeners[a], b) : this.__eventListeners[a].length = 0)
        }

        function b(a, b) {
            if (this.__eventListeners || (this.__eventListeners = {}), 1 === arguments.length)
                for (var c in a) this.on(c, a[c]);
            else this.__eventListeners[a] || (this.__eventListeners[a] = []), this.__eventListeners[a].push(b);
            return this
        }

        function c(b, c) {
            if (this.__eventListeners) {
                if (0 === arguments.length) this.__eventListeners = {};
                else if (1 === arguments.length && "object" == typeof arguments[0])
                    for (var d in b) a.call(this, d, b[d]);
                else a.call(this, b, c);
                return this
            }
        }

        function d(a, b) {
            if (this.__eventListeners) {
                var c = this.__eventListeners[a];
                if (c) {
                    for (var d = 0, e = c.length; e > d; d++) c[d].call(this, b || {});
                    return this
                }
            }
        }
        fabric.Observable = {
            observe: b,
            stopObserving: c,
            fire: d,
            on: b,
            off: c,
            trigger: d
        }
    }(), fabric.Collection = {
        add: function() {
            this._objects.push.apply(this._objects, arguments);
            for (var a = 0, b = arguments.length; b > a; a++) this._onObjectAdded(arguments[a]);
            return this.renderOnAddRemove && this.renderAll(), this
        },
        insertAt: function(a, b, c) {
            var d = this.getObjects();
            return c ? d[b] = a : d.splice(b, 0, a), this._onObjectAdded(a), this.renderOnAddRemove && this.renderAll(), this
        },
        remove: function() {
            for (var a, b = this.getObjects(), c = 0, d = arguments.length; d > c; c++) a = b.indexOf(arguments[c]), -1 !== a && (b.splice(a, 1), this._onObjectRemoved(arguments[c]));
            return this.renderOnAddRemove && this.renderAll(), this
        },
        forEachObject: function(a, b) {
            for (var c = this.getObjects(), d = c.length; d--;) a.call(b, c[d], d, c);
            return this
        },
        getObjects: function(a) {
            return "undefined" == typeof a ? this._objects : this._objects.filter(function(b) {
                return b.type === a
            })
        },
        item: function(a) {
            return this.getObjects()[a]
        },
        isEmpty: function() {
            return 0 === this.getObjects().length
        },
        size: function() {
            return this.getObjects().length
        },
        contains: function(a) {
            return this.getObjects().indexOf(a) > -1
        },
        complexity: function() {
            return this.getObjects().reduce(function(a, b) {
                return a += b.complexity ? b.complexity() : 0
            }, 0)
        }
    },
    function(a) {
        var b = Math.sqrt,
            c = Math.atan2,
            d = Math.PI / 180;
        fabric.util = {
            removeFromArray: function(a, b) {
                var c = a.indexOf(b);
                return -1 !== c && a.splice(c, 1), a
            },
            getRandomInt: function(a, b) {
                return Math.floor(Math.random() * (b - a + 1)) + a
            },
            degreesToRadians: function(a) {
                return a * d
            },
            radiansToDegrees: function(a) {
                return a / d
            },
            rotatePoint: function(a, b, c) {
                a.subtractEquals(b);
                var d = Math.sin(c),
                    e = Math.cos(c),
                    f = a.x * e - a.y * d,
                    g = a.x * d + a.y * e;
                return new fabric.Point(f, g).addEquals(b)
            },
            transformPoint: function(a, b, c) {
                return c ? new fabric.Point(b[0] * a.x + b[2] * a.y, b[1] * a.x + b[3] * a.y) : new fabric.Point(b[0] * a.x + b[2] * a.y + b[4], b[1] * a.x + b[3] * a.y + b[5])
            },
            invertTransform: function(a) {
                var b = 1 / (a[0] * a[3] - a[1] * a[2]),
                    c = [b * a[3], -b * a[1], -b * a[2], b * a[0]],
                    d = fabric.util.transformPoint({
                        x: a[4],
                        y: a[5]
                    }, c, !0);
                return c[4] = -d.x, c[5] = -d.y, c
            },
            toFixed: function(a, b) {
                return parseFloat(Number(a).toFixed(b))
            },
            parseUnit: function(a, b) {
                var c = /\D{0,2}$/.exec(a),
                    d = parseFloat(a);
                switch (b || (b = fabric.Text.DEFAULT_SVG_FONT_SIZE), c[0]) {
                    case "mm":
                        return d * fabric.DPI / 25.4;
                    case "cm":
                        return d * fabric.DPI / 2.54;
                    case "in":
                        return d * fabric.DPI;
                    case "pt":
                        return d * fabric.DPI / 72;
                    case "pc":
                        return d * fabric.DPI / 72 * 12;
                    case "em":
                        return d * b;
                    default:
                        return d
                }
            },
            falseFunction: function() {
                return !1
            },
            getKlass: function(a, b) {
                return a = fabric.util.string.camelize(a.charAt(0).toUpperCase() + a.slice(1)), fabric.util.resolveNamespace(b)[a]
            },
            resolveNamespace: function(b) {
                if (!b) return fabric;
                for (var c = b.split("."), d = c.length, e = a || fabric.window, f = 0; d > f; ++f) e = e[c[f]];
                return e
            },
            loadImage: function(a, b, c, d, e) {
                if (!a) return void(b && b.call(c, a));
                a = W2P.MODEL.server.taskServer + "?t=fetchimage&path=" + encodeURIComponent(a.split("https://").join("//").split("http://").join("//")), a += e || "";
                var f = fabric.util.createImage();
                f.onload = function() {
                    b && b.call(c, f), f = f.onload = f.onerror = null
                }, f.onerror = function() {
                    fabric.log("Error loading " + f.src), b && b.call(c, null, !0), f = f.onload = f.onerror = null
                }, 0 !== a.indexOf("data") && "undefined" != typeof d && (f.crossOrigin = d), f.src = a
            },
            enlivenObjects: function(a, b, c, d) {
                function e() {
                    ++g === h && b && b(f)
                }
                a = a || [];
                var f = [],
                    g = 0,
                    h = a.length;
                return h ? void a.forEach(function(a, b) {
                    if (!a || !a.type) return void e();
                    var g = fabric.util.getKlass(a.type, c);
                    g.async ? g.fromObject(a, function(c, g) {
                        g || (f[b] = c, d && d(a, f[b])), e()
                    }) : (f[b] = g.fromObject(a), d && d(a, f[b]), e())
                }) : void(b && b(f))
            },
            groupSVGElements: function(a, b, c) {
                var d;
                return d = new fabric.PathGroup(a, b), "undefined" != typeof c && d.setSourcePath(c), d
            },
            populateWithProperties: function(a, b, c) {
                if (c && "[object Array]" === Object.prototype.toString.call(c))
                    for (var d = 0, e = c.length; e > d; d++) c[d] in a && (b[c[d]] = a[c[d]])
            },
            drawDashedLine: function(a, d, e, f, g, h) {
                var i = f - d,
                    j = g - e,
                    k = b(i * i + j * j),
                    l = c(j, i),
                    m = h.length,
                    n = 0,
                    o = !0;
                for (a.save(), a.translate(d, e), a.moveTo(0, 0), a.rotate(l), d = 0; k > d;) d += h[n++ % m], d > k && (d = k), a[o ? "lineTo" : "moveTo"](d, 0), o = !o;
                a.restore()
            },
            createCanvasElement: function(a) {
                return a || (a = fabric.document.createElement("canvas")), a.getContext || "undefined" == typeof G_vmlCanvasManager || G_vmlCanvasManager.initElement(a), a
            },
            createImage: function() {
                return fabric.isLikelyNode ? new(require("canvas").Image) : fabric.document.createElement("img")
            },
            createAccessors: function(a) {
                for (var b = a.prototype, c = b.stateProperties.length; c--;) {
                    var d = b.stateProperties[c],
                        e = d.charAt(0).toUpperCase() + d.slice(1),
                        f = "set" + e,
                        g = "get" + e;
                    b[g] || (b[g] = function(a) {
                        return new Function('return this.get("' + a + '")')
                    }(d)), b[f] || (b[f] = function(a) {
                        return new Function("value", 'return this.set("' + a + '", value)')
                    }(d))
                }
            },
            clipContext: function(a, b) {
                b.save(), b.beginPath(), a.clipTo(b), b.clip()
            },
            multiplyTransformMatrices: function(a, b) {
                return [a[0] * b[0] + a[2] * b[1], a[1] * b[0] + a[3] * b[1], a[0] * b[2] + a[2] * b[3], a[1] * b[2] + a[3] * b[3], a[0] * b[4] + a[2] * b[5] + a[4], a[1] * b[4] + a[3] * b[5] + a[5]]
            },
            getFunctionBody: function(a) {
                return (String(a).match(/function[^{]*\{([\s\S]*)\}/) || {})[1]
            },
            isTransparent: function(a, b, c, d) {
                d > 0 && (b > d ? b -= d : b = 0, c > d ? c -= d : c = 0);
                for (var e = !0, f = a.getImageData(b, c, 2 * d || 1, 2 * d || 1), g = 3, h = f.data.length; h > g; g += 4) {
                    var i = f.data[g];
                    if (e = 0 >= i, e === !1) break
                }
                return f = null, e
            }
        }
    }("undefined" != typeof exports ? exports : this),
    function() {
        function a(a, d, f, g, i, j, k) {
            var l = h.call(arguments);
            if (e[l]) return e[l];
            var m = Math.PI,
                n = k * m / 180,
                o = Math.sin(n),
                p = Math.cos(n),
                q = 0,
                r = 0;
            f = Math.abs(f), g = Math.abs(g);
            var s = -p * a * .5 - o * d * .5,
                t = -p * d * .5 + o * a * .5,
                u = f * f,
                v = g * g,
                w = t * t,
                x = s * s,
                y = u * v - u * w - v * x,
                z = 0;
            if (0 > y) {
                var A = Math.sqrt(1 - y / (u * v));
                f *= A, g *= A
            } else z = (i === j ? -1 : 1) * Math.sqrt(y / (u * w + v * x));
            var B = z * f * t / g,
                C = -z * g * s / f,
                D = p * B - o * C + .5 * a,
                E = o * B + p * C + .5 * d,
                F = c(1, 0, (s - B) / f, (t - C) / g),
                G = c((s - B) / f, (t - C) / g, (-s - B) / f, (-t - C) / g);
            0 === j && G > 0 ? G -= 2 * m : 1 === j && 0 > G && (G += 2 * m);
            for (var H = Math.ceil(Math.abs(G / m * 2)), I = [], J = G / H, K = 8 / 3 * Math.sin(J / 4) * Math.sin(J / 4) / Math.sin(J / 2), L = F + J, M = 0; H > M; M++) I[M] = b(F, L, p, o, f, g, D, E, K, q, r), q = I[M][4], r = I[M][5], F = L, L += J;
            return e[l] = I, I
        }

        function b(a, b, c, d, e, g, i, j, k, l, m) {
            var n = h.call(arguments);
            if (f[n]) return f[n];
            var o = Math.cos(a),
                p = Math.sin(a),
                q = Math.cos(b),
                r = Math.sin(b),
                s = c * e * q - d * g * r + i,
                t = d * e * q + c * g * r + j,
                u = l + k * (-c * e * p - d * g * o),
                v = m + k * (-d * e * p + c * g * o),
                w = s + k * (c * e * r + d * g * q),
                x = t + k * (d * e * r - c * g * q);
            return f[n] = [u, v, w, x, s, t], f[n]
        }

        function c(a, b, c, d) {
            var e = Math.atan2(b, a),
                f = Math.atan2(d, c);
            return f >= e ? f - e : 2 * Math.PI - (e - f)
        }

        function d(a, b, c, d, e, f, i, j) {
            var k = h.call(arguments);
            if (g[k]) return g[k];
            var l, m, n, o, p, q, r, s, t = Math.sqrt,
                u = Math.min,
                v = Math.max,
                w = Math.abs,
                x = [],
                y = [
                    [],
                    []
                ];
            m = 6 * a - 12 * c + 6 * e, l = -3 * a + 9 * c - 9 * e + 3 * i, n = 3 * c - 3 * a;
            for (var z = 0; 2 > z; ++z)
                if (z > 0 && (m = 6 * b - 12 * d + 6 * f, l = -3 * b + 9 * d - 9 * f + 3 * j, n = 3 * d - 3 * b), w(l) < 1e-12) {
                    if (w(m) < 1e-12) continue;
                    o = -n / m, o > 0 && 1 > o && x.push(o)
                } else r = m * m - 4 * n * l, 0 > r || (s = t(r), p = (-m + s) / (2 * l), p > 0 && 1 > p && x.push(p), q = (-m - s) / (2 * l), q > 0 && 1 > q && x.push(q));
            for (var A, B, C, D = x.length, E = D; D--;) o = x[D], C = 1 - o, A = C * C * C * a + 3 * C * C * o * c + 3 * C * o * o * e + o * o * o * i, y[0][D] = A, B = C * C * C * b + 3 * C * C * o * d + 3 * C * o * o * f + o * o * o * j, y[1][D] = B;
            y[0][E] = a, y[1][E] = b, y[0][E + 1] = i, y[1][E + 1] = j;
            var F = [{
                x: u.apply(null, y[0]),
                y: u.apply(null, y[1])
            }, {
                x: v.apply(null, y[0]),
                y: v.apply(null, y[1])
            }];
            return g[k] = F, F
        }
        var e = {},
            f = {},
            g = {},
            h = Array.prototype.join;
        fabric.util.drawArc = function(b, c, d, e) {
            for (var f = e[0], g = e[1], h = e[2], i = e[3], j = e[4], k = e[5], l = e[6], m = [
                    [],
                    [],
                    [],
                    []
                ], n = a(k - c, l - d, f, g, i, j, h), o = 0, p = n.length; p > o; o++) m[o][0] = n[o][0] + c, m[o][1] = n[o][1] + d, m[o][2] = n[o][2] + c, m[o][3] = n[o][3] + d, m[o][4] = n[o][4] + c, m[o][5] = n[o][5] + d, b.bezierCurveTo.apply(b, m[o])
        }, fabric.util.getBoundsOfArc = function(b, c, e, f, g, h, i, j, k) {
            for (var l = 0, m = 0, n = [], o = [], p = a(j - b, k - c, e, f, h, i, g), q = [
                    [],
                    []
                ], r = 0, s = p.length; s > r; r++) n = d(l, m, p[r][0], p[r][1], p[r][2], p[r][3], p[r][4], p[r][5]), q[0].x = n[0].x + b, q[0].y = n[0].y + c, q[1].x = n[1].x + b, q[1].y = n[1].y + c, o.push(q[0]), o.push(q[1]), l = p[r][4], m = p[r][5];
            return o
        }, fabric.util.getBoundsOfCurve = d
    }(),
    function() {
        function a(a, b) {
            for (var c = e.call(arguments, 2), d = [], f = 0, g = a.length; g > f; f++) d[f] = c.length ? a[f][b].apply(a[f], c) : a[f][b].call(a[f]);
            return d
        }

        function b(a, b) {
            return d(a, b, function(a, b) {
                return a >= b
            })
        }

        function c(a, b) {
            return d(a, b, function(a, b) {
                return b > a
            })
        }

        function d(a, b, c) {
            if (a && 0 !== a.length) {
                var d = a.length - 1,
                    e = b ? a[d][b] : a[d];
                if (b)
                    for (; d--;) c(a[d][b], e) && (e = a[d][b]);
                else
                    for (; d--;) c(a[d], e) && (e = a[d]);
                return e
            }
        }
        var e = Array.prototype.slice;
        Array.prototype.indexOf || (Array.prototype.indexOf = function(a) {
            if (void 0 === this || null === this) throw new TypeError;
            var b = Object(this),
                c = b.length >>> 0;
            if (0 === c) return -1;
            var d = 0;
            if (arguments.length > 0 && (d = Number(arguments[1]), d !== d ? d = 0 : 0 !== d && d !== Number.POSITIVE_INFINITY && d !== Number.NEGATIVE_INFINITY && (d = (d > 0 || -1) * Math.floor(Math.abs(d)))), d >= c) return -1;
            for (var e = d >= 0 ? d : Math.max(c - Math.abs(d), 0); c > e; e++)
                if (e in b && b[e] === a) return e;
            return -1
        }), Array.prototype.forEach || (Array.prototype.forEach = function(a, b) {
            for (var c = 0, d = this.length >>> 0; d > c; c++) c in this && a.call(b, this[c], c, this)
        }), Array.prototype.map || (Array.prototype.map = function(a, b) {
            for (var c = [], d = 0, e = this.length >>> 0; e > d; d++) d in this && (c[d] = a.call(b, this[d], d, this));
            return c
        }), Array.prototype.every || (Array.prototype.every = function(a, b) {
            for (var c = 0, d = this.length >>> 0; d > c; c++)
                if (c in this && !a.call(b, this[c], c, this)) return !1;
            return !0
        }), Array.prototype.some || (Array.prototype.some = function(a, b) {
            for (var c = 0, d = this.length >>> 0; d > c; c++)
                if (c in this && a.call(b, this[c], c, this)) return !0;
            return !1
        }), Array.prototype.filter || (Array.prototype.filter = function(a, b) {
            for (var c, d = [], e = 0, f = this.length >>> 0; f > e; e++) e in this && (c = this[e], a.call(b, c, e, this) && d.push(c));
            return d
        }), Array.prototype.reduce || (Array.prototype.reduce = function(a) {
            var b, c = this.length >>> 0,
                d = 0;
            if (arguments.length > 1) b = arguments[1];
            else
                for (;;) {
                    if (d in this) {
                        b = this[d++];
                        break
                    }
                    if (++d >= c) throw new TypeError
                }
            for (; c > d; d++) d in this && (b = a.call(null, b, this[d], d, this));
            return b
        }), fabric.util.array = {
            invoke: a,
            min: c,
            max: b
        }
    }(),
    function() {
        function a(a, b) {
            for (var c in b) a[c] = b[c];
            return a
        }

        function b(b) {
            return a({}, b)
        }
        fabric.util.object = {
            extend: a,
            clone: b
        }
    }(),
    function() {
        function a(a) {
            return a.replace(/-+(.)?/g, function(a, b) {
                return b ? b.toUpperCase() : ""
            })
        }

        function b(a, b) {
            return a.charAt(0).toUpperCase() + (b ? a.slice(1) : a.slice(1).toLowerCase())
        }

        function c(a) {
            return a.replace(/&/g, "&amp;").replace(/"/g, "&quot;").replace(/'/g, "&apos;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
        }
        String.prototype.trim || (String.prototype.trim = function() {
            return this.replace(/^[\s\xA0]+/, "").replace(/[\s\xA0]+$/, "")
        }), fabric.util.string = {
            camelize: a,
            capitalize: b,
            escapeXml: c
        }
    }(),
    function() {
        var a = Array.prototype.slice,
            b = Function.prototype.apply,
            c = function() {};
        Function.prototype.bind || (Function.prototype.bind = function(d) {
            var e, f = this,
                g = a.call(arguments, 1);
            return e = g.length ? function() {
                return b.call(f, this instanceof c ? this : d, g.concat(a.call(arguments)))
            } : function() {
                return b.call(f, this instanceof c ? this : d, arguments)
            }, c.prototype = this.prototype, e.prototype = new c, e
        })
    }(),
    function() {
        function a() {}

        function b(a) {
            var b = this.constructor.superclass.prototype[a];
            return arguments.length > 1 ? b.apply(this, d.call(arguments, 1)) : b.call(this)
        }

        function c() {
            function c() {
                this.initialize.apply(this, arguments)
            }
            var f = null,
                h = d.call(arguments, 0);
            "function" == typeof h[0] && (f = h.shift()), c.superclass = f, c.subclasses = [], f && (a.prototype = f.prototype, c.prototype = new a, f.subclasses.push(c));
            for (var i = 0, j = h.length; j > i; i++) g(c, h[i], f);
            return c.prototype.initialize || (c.prototype.initialize = e), c.prototype.constructor = c, c.prototype.callSuper = b, c
        }
        var d = Array.prototype.slice,
            e = function() {},
            f = function() {
                for (var a in {
                        toString: 1
                    })
                    if ("toString" === a) return !1;
                return !0
            }(),
            g = function(a, b, c) {
                for (var d in b) d in a.prototype && "function" == typeof a.prototype[d] && (b[d] + "").indexOf("callSuper") > -1 ? a.prototype[d] = function(a) {
                    return function() {
                        var d = this.constructor.superclass;
                        this.constructor.superclass = c;
                        var e = b[a].apply(this, arguments);
                        return this.constructor.superclass = d, "initialize" !== a ? e : void 0
                    }
                }(d) : a.prototype[d] = b[d], f && (b.toString !== Object.prototype.toString && (a.prototype.toString = b.toString), b.valueOf !== Object.prototype.valueOf && (a.prototype.valueOf = b.valueOf))
            };
        fabric.util.createClass = c
    }(),
    function() {
        function a(a) {
            var b, c, d = Array.prototype.slice.call(arguments, 1),
                e = d.length;
            for (c = 0; e > c; c++)
                if (b = typeof a[d[c]], !/^(?:function|object|unknown)$/.test(b)) return !1;
            return !0
        }

        function b(a, b) {
            return {
                handler: b,
                wrappedHandler: c(a, b)
            }
        }

        function c(a, b) {
            return function(c) {
                b.call(g(a), c || fabric.window.event)
            }
        }

        function d(a, b) {
            return function(c) {
                if (p[a] && p[a][b])
                    for (var d = p[a][b], e = 0, f = d.length; f > e; e++) d[e].call(this, c || fabric.window.event)
            }
        }

        function e(a) {
            a || (a = fabric.window.event);
            var b = a.target || (typeof a.srcElement !== i ? a.srcElement : null),
                c = fabric.util.getScrollLeftTop(b);
            return {
                x: q(a) + c.left,
                y: r(a) + c.top
            }
        }

        function f(a, b, c) {
            var d = "touchend" === a.type ? "changedTouches" : "touches";
            return a[d] && a[d][0] ? a[d][0][b] - (a[d][0][b] - a[d][0][c]) || a[c] : a[c]
        }
        var g, h, i = "unknown",
            j = function() {
                var a = 0;
                return function(b) {
                    return b.__uniqueID || (b.__uniqueID = "uniqueID__" + a++)
                }
            }();
        ! function() {
            var a = {};
            g = function(b) {
                return a[b]
            }, h = function(b, c) {
                a[b] = c
            }
        }();
        var k, l, m = a(fabric.document.documentElement, "addEventListener", "removeEventListener") && a(fabric.window, "addEventListener", "removeEventListener"),
            n = a(fabric.document.documentElement, "attachEvent", "detachEvent") && a(fabric.window, "attachEvent", "detachEvent"),
            o = {},
            p = {};
        m ? (k = function(a, b, c) {
            a.addEventListener(b, c, !1)
        }, l = function(a, b, c) {
            a.removeEventListener(b, c, !1)
        }) : n ? (k = function(a, c, d) {
            var e = j(a);
            h(e, a), o[e] || (o[e] = {}), o[e][c] || (o[e][c] = []);
            var f = b(e, d);
            o[e][c].push(f), a.attachEvent("on" + c, f.wrappedHandler)
        }, l = function(a, b, c) {
            var d, e = j(a);
            if (o[e] && o[e][b])
                for (var f = 0, g = o[e][b].length; g > f; f++) d = o[e][b][f], d && d.handler === c && (a.detachEvent("on" + b, d.wrappedHandler), o[e][b][f] = null)
        }) : (k = function(a, b, c) {
            var e = j(a);
            if (p[e] || (p[e] = {}), !p[e][b]) {
                p[e][b] = [];
                var f = a["on" + b];
                f && p[e][b].push(f), a["on" + b] = d(e, b)
            }
            p[e][b].push(c)
        }, l = function(a, b, c) {
            var d = j(a);
            if (p[d] && p[d][b])
                for (var e = p[d][b], f = 0, g = e.length; g > f; f++) e[f] === c && e.splice(f, 1)
        }), fabric.util.addListener = k, fabric.util.removeListener = l;
        var q = function(a) {
                return typeof a.clientX !== i ? a.clientX : 0
            },
            r = function(a) {
                return typeof a.clientY !== i ? a.clientY : 0
            };
        fabric.isTouchSupported && (q = function(a) {
            return f(a, "pageX", "clientX")
        }, r = function(a) {
            return f(a, "pageY", "clientY")
        }), fabric.util.getPointer = e, fabric.util.object.extend(fabric.util, fabric.Observable)
    }(),
    function() {
        function a(a, b) {
            var c = a.style;
            if (!c) return a;
            if ("string" == typeof b) return a.style.cssText += ";" + b, b.indexOf("opacity") > -1 ? f(a, b.match(/opacity:\s*(\d?\.?\d*)/)[1]) : a;
            for (var d in b)
                if ("opacity" === d) f(a, b[d]);
                else {
                    var e = "float" === d || "cssFloat" === d ? "undefined" == typeof c.styleFloat ? "cssFloat" : "styleFloat" : d;
                    c[e] = b[d]
                }
            return a
        }
        var b = fabric.document.createElement("div"),
            c = "string" == typeof b.style.opacity,
            d = "string" == typeof b.style.filter,
            e = /alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,
            f = function(a) {
                return a
            };
        c ? f = function(a, b) {
            return a.style.opacity = b, a
        } : d && (f = function(a, b) {
            var c = a.style;
            return a.currentStyle && !a.currentStyle.hasLayout && (c.zoom = 1), e.test(c.filter) ? (b = b >= .9999 ? "" : "alpha(opacity=" + 100 * b + ")", c.filter = c.filter.replace(e, b)) : c.filter += " alpha(opacity=" + 100 * b + ")", a
        }), fabric.util.setStyle = a
    }(),
    function() {
        function a(a) {
            return "string" == typeof a ? fabric.document.getElementById(a) : a
        }

        function b(a, b) {
            var c = fabric.document.createElement(a);
            for (var d in b) "class" === d ? c.className = b[d] : "for" === d ? c.htmlFor = b[d] : c.setAttribute(d, b[d]);
            return c
        }

        function c(a, b) {
            a && -1 === (" " + a.className + " ").indexOf(" " + b + " ") && (a.className += (a.className ? " " : "") + b)
        }

        function d(a, c, d) {
            return "string" == typeof c && (c = b(c, d)), a.parentNode && a.parentNode.replaceChild(c, a), c.appendChild(a), c
        }

        function e(a) {
            for (var b = 0, c = 0, d = fabric.document.documentElement, e = fabric.document.body || {
                    scrollLeft: 0,
                    scrollTop: 0
                }; a && a.parentNode && (a = a.parentNode, a === fabric.document ? (b = e.scrollLeft || d.scrollLeft || 0, c = e.scrollTop || d.scrollTop || 0) : (b += a.scrollLeft || 0, c += a.scrollTop || 0), 1 !== a.nodeType || "fixed" !== fabric.util.getElementStyle(a, "position")););
            return {
                left: b,
                top: c
            }
        }

        function f(a) {
            var b, c, d = a && a.ownerDocument,
                f = {
                    left: 0,
                    top: 0
                },
                g = {
                    left: 0,
                    top: 0
                },
                h = {
                    borderLeftWidth: "left",
                    borderTopWidth: "top",
                    paddingLeft: "left",
                    paddingTop: "top"
                };
            if (!d) return g;
            for (var i in h) g[h[i]] += parseInt(k(a, i), 10) || 0;
            return b = d.documentElement, "undefined" != typeof a.getBoundingClientRect && (f = a.getBoundingClientRect()), c = e(a), {
                left: f.left + c.left - (b.clientLeft || 0) + g.left,
                top: f.top + c.top - (b.clientTop || 0) + g.top
            }
        }
        var g, h = Array.prototype.slice,
            i = function(a) {
                return h.call(a, 0)
            };
        try {
            g = i(fabric.document.childNodes) instanceof Array
        } catch (j) {}
        g || (i = function(a) {
            for (var b = new Array(a.length), c = a.length; c--;) b[c] = a[c];
            return b
        });
        var k;
        k = fabric.document.defaultView && fabric.document.defaultView.getComputedStyle ? function(a, b) {
                var c = fabric.document.defaultView.getComputedStyle(a, null);
                return c ? c[b] : void 0
            } : function(a, b) {
                var c = a.style[b];
                return !c && a.currentStyle && (c = a.currentStyle[b]), c
            },
            function() {
                function a(a) {
                    return "undefined" != typeof a.onselectstart && (a.onselectstart = fabric.util.falseFunction), d ? a.style[d] = "none" : "string" == typeof a.unselectable && (a.unselectable = "on"), a
                }

                function b(a) {
                    return "undefined" != typeof a.onselectstart && (a.onselectstart = null), d ? a.style[d] = "" : "string" == typeof a.unselectable && (a.unselectable = ""), a
                }
                var c = fabric.document.documentElement.style,
                    d = "userSelect" in c ? "userSelect" : "MozUserSelect" in c ? "MozUserSelect" : "WebkitUserSelect" in c ? "WebkitUserSelect" : "KhtmlUserSelect" in c ? "KhtmlUserSelect" : "";
                fabric.util.makeElementUnselectable = a, fabric.util.makeElementSelectable = b
            }(),
            function() {
                function a(a, b) {
                    var c = fabric.document.getElementsByTagName("head")[0],
                        d = fabric.document.createElement("script"),
                        e = !0;
                    d.onload = d.onreadystatechange = function(a) {
                        if (e) {
                            if ("string" == typeof this.readyState && "loaded" !== this.readyState && "complete" !== this.readyState) return;
                            e = !1, b(a || fabric.window.event), d = d.onload = d.onreadystatechange = null
                        }
                    }, d.src = a, c.appendChild(d)
                }
                fabric.util.getScript = a
            }(), fabric.util.getById = a, fabric.util.toArray = i, fabric.util.makeElement = b, fabric.util.addClass = c, fabric.util.wrapElement = d, fabric.util.getScrollLeftTop = e, fabric.util.getElementOffset = f, fabric.util.getElementStyle = k
    }(),
    function() {
        function a(a, b) {
            return a + (/\?/.test(a) ? "&" : "?") + b
        }

        function b() {}

        function c(c, e) {
            e || (e = {});
            var f, g = e.method ? e.method.toUpperCase() : "GET",
                h = e.onComplete || function() {},
                i = d();
            return i.onreadystatechange = function() {
                4 === i.readyState && (h(i), i.onreadystatechange = b)
            }, "GET" === g && (f = null, "string" == typeof e.parameters && (c = a(c, e.parameters))), i.open(g, c, !0), "POST" !== g && "PUT" !== g || i.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"), i.send(f), i
        }
        var d = function() {
            for (var a = [function() {
                    return new ActiveXObject("Microsoft.XMLHTTP")
                }, function() {
                    return new ActiveXObject("Msxml2.XMLHTTP")
                }, function() {
                    return new ActiveXObject("Msxml2.XMLHTTP.3.0")
                }, function() {
                    return new XMLHttpRequest
                }], b = a.length; b--;) try {
                var c = a[b]();
                if (c) return a[b]
            } catch (d) {}
        }();
        fabric.util.request = c
    }(), fabric.log = function() {}, fabric.warn = function() {}, "undefined" != typeof console && ["log", "warn"].forEach(function(a) {
        "undefined" != typeof console[a] && "function" == typeof console[a].apply && (fabric[a] = function() {
            return console[a].apply(console, arguments)
        })
    }),
    function() {
        function a(a) {
            b(function(c) {
                a || (a = {});
                var d, e = c || +new Date,
                    f = a.duration || 500,
                    g = e + f,
                    h = a.onChange || function() {},
                    i = a.abort || function() {
                        return !1
                    },
                    j = a.easing || function(a, b, c, d) {
                        return -c * Math.cos(a / d * (Math.PI / 2)) + c + b
                    },
                    k = "startValue" in a ? a.startValue : 0,
                    l = "endValue" in a ? a.endValue : 100,
                    m = a.byValue || l - k;
                a.onStart && a.onStart(),
                    function n(c) {
                        d = c || +new Date;
                        var l = d > g ? f : d - e;
                        return i() ? void(a.onComplete && a.onComplete()) : (h(j(l, k, m, f)), d > g ? void(a.onComplete && a.onComplete()) : void b(n))
                    }(e)
            })
        }

        function b() {
            return c.apply(fabric.window, arguments)
        }
        var c = fabric.window.requestAnimationFrame || fabric.window.webkitRequestAnimationFrame || fabric.window.mozRequestAnimationFrame || fabric.window.oRequestAnimationFrame || fabric.window.msRequestAnimationFrame || function(a) {
            fabric.window.setTimeout(a, 1e3 / 60)
        };
        fabric.util.animate = a, fabric.util.requestAnimFrame = b
    }(),
    function() {
        function a(a, b, c, d) {
            return a < Math.abs(b) ? (a = b, d = c / 4) : d = c / (2 * Math.PI) * Math.asin(b / a), {
                a: a,
                c: b,
                p: c,
                s: d
            }
        }

        function b(a, b, c) {
            return a.a * Math.pow(2, 10 * (b -= 1)) * Math.sin((b * c - a.s) * (2 * Math.PI) / a.p)
        }

        function c(a, b, c, d) {
            return c * ((a = a / d - 1) * a * a + 1) + b
        }

        function d(a, b, c, d) {
            return a /= d / 2, 1 > a ? c / 2 * a * a * a + b : c / 2 * ((a -= 2) * a * a + 2) + b
        }

        function e(a, b, c, d) {
            return c * (a /= d) * a * a * a + b
        }

        function f(a, b, c, d) {
            return -c * ((a = a / d - 1) * a * a * a - 1) + b
        }

        function g(a, b, c, d) {
            return a /= d / 2, 1 > a ? c / 2 * a * a * a * a + b : -c / 2 * ((a -= 2) * a * a * a - 2) + b
        }

        function h(a, b, c, d) {
            return c * (a /= d) * a * a * a * a + b
        }

        function i(a, b, c, d) {
            return c * ((a = a / d - 1) * a * a * a * a + 1) + b
        }

        function j(a, b, c, d) {
            return a /= d / 2, 1 > a ? c / 2 * a * a * a * a * a + b : c / 2 * ((a -= 2) * a * a * a * a + 2) + b
        }

        function k(a, b, c, d) {
            return -c * Math.cos(a / d * (Math.PI / 2)) + c + b
        }

        function l(a, b, c, d) {
            return c * Math.sin(a / d * (Math.PI / 2)) + b
        }

        function m(a, b, c, d) {
            return -c / 2 * (Math.cos(Math.PI * a / d) - 1) + b
        }

        function n(a, b, c, d) {
            return 0 === a ? b : c * Math.pow(2, 10 * (a / d - 1)) + b
        }

        function o(a, b, c, d) {
            return a === d ? b + c : c * (-Math.pow(2, -10 * a / d) + 1) + b
        }

        function p(a, b, c, d) {
            return 0 === a ? b : a === d ? b + c : (a /= d / 2, 1 > a ? c / 2 * Math.pow(2, 10 * (a - 1)) + b : c / 2 * (-Math.pow(2, -10 * --a) + 2) + b)
        }

        function q(a, b, c, d) {
            return -c * (Math.sqrt(1 - (a /= d) * a) - 1) + b
        }

        function r(a, b, c, d) {
            return c * Math.sqrt(1 - (a = a / d - 1) * a) + b
        }

        function s(a, b, c, d) {
            return a /= d / 2, 1 > a ? -c / 2 * (Math.sqrt(1 - a * a) - 1) + b : c / 2 * (Math.sqrt(1 - (a -= 2) * a) + 1) + b
        }

        function t(c, d, e, f) {
            var g = 1.70158,
                h = 0,
                i = e;
            if (0 === c) return d;
            if (c /= f, 1 === c) return d + e;
            h || (h = .3 * f);
            var j = a(i, e, h, g);
            return -b(j, c, f) + d
        }

        function u(b, c, d, e) {
            var f = 1.70158,
                g = 0,
                h = d;
            if (0 === b) return c;
            if (b /= e, 1 === b) return c + d;
            g || (g = .3 * e);
            var i = a(h, d, g, f);
            return i.a * Math.pow(2, -10 * b) * Math.sin((b * e - i.s) * (2 * Math.PI) / i.p) + i.c + c
        }

        function v(c, d, e, f) {
            var g = 1.70158,
                h = 0,
                i = e;
            if (0 === c) return d;
            if (c /= f / 2, 2 === c) return d + e;
            h || (h = f * (.3 * 1.5));
            var j = a(i, e, h, g);
            return 1 > c ? -.5 * b(j, c, f) + d : j.a * Math.pow(2, -10 * (c -= 1)) * Math.sin((c * f - j.s) * (2 * Math.PI) / j.p) * .5 + j.c + d
        }

        function w(a, b, c, d, e) {
            return void 0 === e && (e = 1.70158), c * (a /= d) * a * ((e + 1) * a - e) + b
        }

        function x(a, b, c, d, e) {
            return void 0 === e && (e = 1.70158), c * ((a = a / d - 1) * a * ((e + 1) * a + e) + 1) + b
        }

        function y(a, b, c, d, e) {
            return void 0 === e && (e = 1.70158), a /= d / 2, 1 > a ? c / 2 * (a * a * (((e *= 1.525) + 1) * a - e)) + b : c / 2 * ((a -= 2) * a * (((e *= 1.525) + 1) * a + e) + 2) + b
        }

        function z(a, b, c, d) {
            return c - A(d - a, 0, c, d) + b
        }

        function A(a, b, c, d) {
            return (a /= d) < 1 / 2.75 ? c * (7.5625 * a * a) + b : 2 / 2.75 > a ? c * (7.5625 * (a -= 1.5 / 2.75) * a + .75) + b : 2.5 / 2.75 > a ? c * (7.5625 * (a -= 2.25 / 2.75) * a + .9375) + b : c * (7.5625 * (a -= 2.625 / 2.75) * a + .984375) + b
        }

        function B(a, b, c, d) {
            return d / 2 > a ? .5 * z(2 * a, 0, c, d) + b : .5 * A(2 * a - d, 0, c, d) + .5 * c + b
        }
        fabric.util.ease = {
            easeInQuad: function(a, b, c, d) {
                return c * (a /= d) * a + b
            },
            easeOutQuad: function(a, b, c, d) {
                return -c * (a /= d) * (a - 2) + b
            },
            easeInOutQuad: function(a, b, c, d) {
                return a /= d / 2, 1 > a ? c / 2 * a * a + b : -c / 2 * (--a * (a - 2) - 1) + b
            },
            easeInCubic: function(a, b, c, d) {
                return c * (a /= d) * a * a + b
            },
            easeOutCubic: c,
            easeInOutCubic: d,
            easeInQuart: e,
            easeOutQuart: f,
            easeInOutQuart: g,
            easeInQuint: h,
            easeOutQuint: i,
            easeInOutQuint: j,
            easeInSine: k,
            easeOutSine: l,
            easeInOutSine: m,
            easeInExpo: n,
            easeOutExpo: o,
            easeInOutExpo: p,
            easeInCirc: q,
            easeOutCirc: r,
            easeInOutCirc: s,
            easeInElastic: t,
            easeOutElastic: u,
            easeInOutElastic: v,
            easeInBack: w,
            easeOutBack: x,
            easeInOutBack: y,
            easeInBounce: z,
            easeOutBounce: A,
            easeInOutBounce: B
        }
    }(),
    function(a) {
        "use strict";

        function b(a) {
            return a in A ? A[a] : a
        }

        function c(a, b, c, d) {
            var e, f = "[object Array]" === Object.prototype.toString.call(b);
            return "fill" !== a && "stroke" !== a || "none" !== b ? "strokeDashArray" === a ? b = b.replace(/,/g, " ").split(/\s+/).map(function(a) {
                return parseFloat(a)
            }) : "transformMatrix" === a ? b = c && c.transformMatrix ? v(c.transformMatrix, p.parseTransformAttribute(b)) : p.parseTransformAttribute(b) : "visible" === a ? (b = "none" !== b && "hidden" !== b, c && c.visible === !1 && (b = !1)) : "originX" === a ? b = "start" === b ? "left" : "end" === b ? "right" : "center" : e = f ? b.map(u) : u(b, d) : b = "", !f && isNaN(e) ? b : e
        }

        function d(a) {
            for (var b in B)
                if (a[b] && "undefined" != typeof a[B[b]] && 0 !== a[b].indexOf("url(")) {
                    var c = new p.Color(a[b]);
                    a[b] = c.setAlpha(t(c.getAlpha() * a[B[b]], 2)).toRgba()
                }
            return a
        }

        function e(a, d) {
            var e, f;
            a.replace(/;\s*$/, "").split(";").forEach(function(a) {
                var g = a.split(":");
                e = b(g[0].trim().toLowerCase()), f = c(e, g[1].trim()), d[e] = f
            })
        }

        function f(a, d) {
            var e, f;
            for (var g in a) "undefined" != typeof a[g] && (e = b(g.toLowerCase()), f = c(e, a[g]), d[e] = f)
        }

        function g(a, b) {
            var c = {};
            for (var d in p.cssRules[b])
                if (h(a, d.split(" ")))
                    for (var e in p.cssRules[b][d]) c[e] = p.cssRules[b][d][e];
            return c
        }

        function h(a, b) {
            var c, d = !0;
            return c = j(a, b.pop()), c && b.length && (d = i(a, b)), c && d && 0 === b.length
        }

        function i(a, b) {
            for (var c, d = !0; a.parentNode && 1 === a.parentNode.nodeType && b.length;) d && (c = b.pop()), a = a.parentNode, d = j(a, c);
            return 0 === b.length
        }

        function j(a, b) {
            var c, d = a.nodeName,
                e = a.getAttribute("class"),
                f = a.getAttribute("id");
            if (c = new RegExp("^" + d, "i"), b = b.replace(c, ""), f && b.length && (c = new RegExp("#" + f + "(?![a-zA-Z\\-]+)", "i"), b = b.replace(c, "")), e && b.length) {
                e = e.split(" ");
                for (var g = e.length; g--;) c = new RegExp("\\." + e[g] + "(?![a-zA-Z\\-]+)", "i"), b = b.replace(c, "")
            }
            return 0 === b.length
        }

        function k(a, b) {
            var c;
            if (a.getElementById && (c = a.getElementById(b)), c) return c;
            var d, e, f, g = a.getElementsByTagName("*");
            for (e = 0; e < g.length; e++)
                if (d = g[e], f === d.getAttribute("id")) return d
        }

        function l(a) {
            for (var b = a.getElementsByTagName("use"), c = 0; b.length && c < b.length;) {
                var d, e, f, g, h, i = b[c],
                    j = i.getAttribute("xlink:href").substr(1),
                    l = i.getAttribute("x") || 0,
                    n = i.getAttribute("y") || 0,
                    o = k(a, j).cloneNode(!0),
                    p = (o.getAttribute("transform") || "") + " translate(" + l + ", " + n + ")",
                    q = b.length;
                if (m(o), /^svg$/i.test(o.nodeName)) {
                    var r = o.ownerDocument.createElement("g");
                    for (f = 0, g = o.attributes, h = g.length; h > f; f++) e = g.item(f), r.setAttribute(e.nodeName, e.nodeValue);
                    for (; null != o.firstChild;) r.appendChild(o.firstChild);
                    o = r
                }
                for (f = 0, g = i.attributes, h = g.length; h > f; f++) e = g.item(f), "x" !== e.nodeName && "y" !== e.nodeName && "xlink:href" !== e.nodeName && ("transform" === e.nodeName ? p = e.nodeValue + " " + p : o.setAttribute(e.nodeName, e.nodeValue));
                o.setAttribute("transform", p), o.setAttribute("instantiated_by_use", "1"), o.removeAttribute("id"), d = i.parentNode, d.replaceChild(o, i), b.length === q && c++
            }
        }

        function m(a) {
            var b, c, d, e, f = a.getAttribute("viewBox"),
                g = 1,
                h = 1,
                i = 0,
                j = 0,
                k = a.getAttribute("width"),
                l = a.getAttribute("height"),
                m = !f || !x.test(a.tagName) || !(f = f.match(C)),
                n = !k || !l || "100%" === k || "100%" === l,
                o = m && n,
                p = {};
            if (p.width = 0, p.height = 0, p.toBeParsed = o, o) return p;
            if (m) return p.width = u(k), p.height = u(l), p;
            if (i = -parseFloat(f[1]), j = -parseFloat(f[2]), b = parseFloat(f[3]), c = parseFloat(f[4]), n ? (p.width = b, p.height = c) : (p.width = u(k), p.height = u(l), g = p.width / b, h = p.height / c), h = g = g > h ? h : g, 1 === g && 1 === h && 0 === i && 0 === j) return p;
            if (d = " matrix(" + g + " 0 0 " + h + " " + i * g + " " + j * h + ") ", "svg" === a.tagName) {
                for (e = a.ownerDocument.createElement("g"); null != a.firstChild;) e.appendChild(a.firstChild);
                a.appendChild(e)
            } else e = a, d = e.getAttribute("transform") + d;
            return e.setAttribute("transform", d), p
        }

        function n(a) {
            var b = a.objects,
                c = a.options;
            return b = b.map(function(a) {
                return p[r(a.type)].fromObject(a)
            }), {
                objects: b,
                options: c
            }
        }

        function o(a, b, c) {
            b[c] && b[c].toSVG && a.push('<pattern x="0" y="0" id="', c, 'Pattern" ', 'width="', b[c].source.width, '" height="', b[c].source.height, '" patternUnits="userSpaceOnUse">', '<image x="0" y="0" ', 'width="', b[c].source.width, '" height="', b[c].source.height, '" xlink:href="', b[c].source.src, '"></image></pattern>')
        }
        var p = a.fabric || (a.fabric = {}),
            q = p.util.object.extend,
            r = p.util.string.capitalize,
            s = p.util.object.clone,
            t = p.util.toFixed,
            u = p.util.parseUnit,
            v = p.util.multiplyTransformMatrices,
            w = /^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,
            x = /^(symbol|image|marker|pattern|view|svg)$/i,
            y = /^(?:pattern|defs|symbol|metadata)$/i,
            z = /^(symbol|g|a|svg)$/i,
            A = {
                cx: "left",
                x: "left",
                r: "radius",
                cy: "top",
                y: "top",
                display: "visible",
                visibility: "visible",
                transform: "transformMatrix",
                "fill-opacity": "fillOpacity",
                "fill-rule": "fillRule",
                "font-family": "fontFamily",
                "font-size": "fontSize",
                "font-style": "fontStyle",
                "font-weight": "fontWeight",
                "stroke-dasharray": "strokeDashArray",
                "stroke-linecap": "strokeLineCap",
                "stroke-linejoin": "strokeLineJoin",
                "stroke-miterlimit": "strokeMiterLimit",
                "stroke-opacity": "strokeOpacity",
                "stroke-width": "strokeWidth",
                "text-decoration": "textDecoration",
                "text-anchor": "originX"
            },
            B = {
                stroke: "strokeOpacity",
                fill: "fillOpacity"
            };
        p.cssRules = {}, p.gradientDefs = {}, p.parseTransformAttribute = function() {
            function a(a, b) {
                var c = b[0];
                a[0] = Math.cos(c), a[1] = Math.sin(c), a[2] = -Math.sin(c), a[3] = Math.cos(c)
            }

            function b(a, b) {
                var c = b[0],
                    d = 2 === b.length ? b[1] : b[0];
                a[0] = c, a[3] = d
            }

            function c(a, b) {
                a[2] = Math.tan(p.util.degreesToRadians(b[0]))
            }

            function d(a, b) {
                a[1] = Math.tan(p.util.degreesToRadians(b[0]))
            }

            function e(a, b) {
                a[4] = b[0], 2 === b.length && (a[5] = b[1])
            }
            var f = [1, 0, 0, 1, 0, 0],
                g = p.reNum,
                h = "(?:\\s+,?\\s*|,\\s*)",
                i = "(?:(skewX)\\s*\\(\\s*(" + g + ")\\s*\\))",
                j = "(?:(skewY)\\s*\\(\\s*(" + g + ")\\s*\\))",
                k = "(?:(rotate)\\s*\\(\\s*(" + g + ")(?:" + h + "(" + g + ")" + h + "(" + g + "))?\\s*\\))",
                l = "(?:(scale)\\s*\\(\\s*(" + g + ")(?:" + h + "(" + g + "))?\\s*\\))",
                m = "(?:(translate)\\s*\\(\\s*(" + g + ")(?:" + h + "(" + g + "))?\\s*\\))",
                n = "(?:(matrix)\\s*\\(\\s*(" + g + ")" + h + "(" + g + ")" + h + "(" + g + ")" + h + "(" + g + ")" + h + "(" + g + ")" + h + "(" + g + ")\\s*\\))",
                o = "(?:" + n + "|" + m + "|" + l + "|" + k + "|" + i + "|" + j + ")",
                q = "(?:" + o + "(?:" + h + o + ")*)",
                r = "^\\s*(?:" + q + "?)\\s*$",
                s = new RegExp(r),
                t = new RegExp(o, "g");
            return function(g) {
                var h = f.concat(),
                    i = [];
                if (!g || g && !s.test(g)) return h;
                g.replace(t, function(g) {
                    var j = new RegExp(o).exec(g).filter(function(a) {
                            return "" !== a && null != a
                        }),
                        k = j[1],
                        l = j.slice(2).map(parseFloat);
                    switch (k) {
                        case "translate":
                            e(h, l);
                            break;
                        case "rotate":
                            l[0] = p.util.degreesToRadians(l[0]), a(h, l);
                            break;
                        case "scale":
                            b(h, l);
                            break;
                        case "skewX":
                            c(h, l);
                            break;
                        case "skewY":
                            d(h, l);
                            break;
                        case "matrix":
                            h = l
                    }
                    i.push(h.concat()), h = f.concat()
                });
                for (var j = i[0]; i.length > 1;) i.shift(), j = p.util.multiplyTransformMatrices(j, i[0]);
                return j
            }
        }();
        var C = new RegExp("^\\s*(" + p.reNum + "+)\\s*,?\\s*(" + p.reNum + "+)\\s*,?\\s*(" + p.reNum + "+)\\s*,?\\s*(" + p.reNum + "+)\\s*$");
        p.parseSVGDocument = function() {
            function a(a, b) {
                for (; a && (a = a.parentNode);)
                    if (b.test(a.nodeName) && !a.getAttribute("instantiated_by_use")) return !0;
                return !1
            }
            return function(b, c, d) {
                if (b) {
                    l(b);
                    var e = new Date,
                        f = p.Object.__uid++,
                        g = m(b),
                        h = p.util.toArray(b.getElementsByTagName("*"));
                    if (g.svgUid = f, 0 === h.length && p.isLikelyNode) {
                        h = b.selectNodes('//*[name(.)!="svg"]');
                        for (var i = [], j = 0, k = h.length; k > j; j++) i[j] = h[j];
                        h = i
                    }
                    var n = h.filter(function(b) {
                        return m(b), w.test(b.tagName) && !a(b, y)
                    });
                    if (!n || n && !n.length) return void(c && c([], {}));
                    p.gradientDefs[f] = p.getGradientDefs(b), p.cssRules[f] = p.getCSSRules(b), p.parseElements(n, function(a) {
                        p.documentParsingTime = new Date - e, c && c(a, g)
                    }, s(g), d)
                }
            }
        }();
        var D = {
                has: function(a, b) {
                    b(!1)
                },
                get: function() {},
                set: function() {}
            },
            E = new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*(" + p.reNum + "(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|" + p.reNum + "))?\\s+(.*)");
        q(p, {
            parseFontDeclaration: function(a, b) {
                var c = a.match(E);
                if (c) {
                    var d = c[1],
                        e = c[3],
                        f = c[4],
                        g = c[5],
                        h = c[6];
                    d && (b.fontStyle = d), e && (b.fontWeight = isNaN(parseFloat(e)) ? e : parseFloat(e)), f && (b.fontSize = u(f)), h && (b.fontFamily = h), g && (b.lineHeight = "normal" === g ? 1 : g)
                }
            },
            getGradientDefs: function(a) {
                var b, c, d, e, f = a.getElementsByTagName("linearGradient"),
                    g = a.getElementsByTagName("radialGradient"),
                    h = 0,
                    i = [],
                    j = {},
                    k = {};
                for (i.length = f.length + g.length, c = f.length; c--;) i[h++] = f[c];
                for (c = g.length; c--;) i[h++] = g[c];
                for (; h--;) b = i[h], e = b.getAttribute("xlink:href"), d = b.getAttribute("id"), e && (k[d] = e.substr(1)), j[d] = b;
                for (d in k) {
                    var l = j[k[d]].cloneNode(!0);
                    for (b = j[d]; l.firstChild;) b.appendChild(l.firstChild)
                }
                return j
            },
            parseAttributes: function(a, e, f) {
                if (a) {
                    var h, i, j = {};
                    "undefined" == typeof f && (f = a.getAttribute("svgUid")), a.parentNode && z.test(a.parentNode.nodeName) && (j = p.parseAttributes(a.parentNode, e, f)), i = j && j.fontSize || a.getAttribute("font-size") || p.Text.DEFAULT_SVG_FONT_SIZE;
                    var k = e.reduce(function(d, e) {
                        return h = a.getAttribute(e), h && (e = b(e), h = c(e, h, j, i), d[e] = h), d
                    }, {});
                    return k = q(k, q(g(a, f), p.parseStyleAttribute(a))), k.font && p.parseFontDeclaration(k.font, k), d(q(j, k))
                }
            },
            parseElements: function(a, b, c, d) {
                new p.ElementsParser(a, b, c, d).parse()
            },
            parseStyleAttribute: function(a) {
                var b = {},
                    c = a.getAttribute("style");
                return c ? ("string" == typeof c ? e(c, b) : f(c, b), b) : b
            },
            parsePointsAttribute: function(a) {
                if (!a) return null;
                a = a.replace(/,/g, " ").trim(), a = a.split(/\s+/);
                var b, c, d = [];
                for (b = 0, c = a.length; c > b; b += 2) d.push({
                    x: parseFloat(a[b]),
                    y: parseFloat(a[b + 1])
                });
                return d
            },
            getCSSRules: function(a) {
                for (var d, e = a.getElementsByTagName("style"), f = {}, g = 0, h = e.length; h > g; g++) {
                    var i = e[g].textContent;
                    i = i.replace(/\/\*[\s\S]*?\*\//g, ""), "" !== i.trim() && (d = i.match(/[^{]*\{[\s\S]*?\}/g), d = d.map(function(a) {
                        return a.trim()
                    }), d.forEach(function(a) {
                        for (var d = a.match(/([\s\S]*?)\s*\{([^}]*)\}/), e = {}, g = d[2].trim(), h = g.replace(/;$/, "").split(/\s*;\s*/), i = 0, j = h.length; j > i; i++) {
                            var k = h[i].split(/\s*:\s*/),
                                l = b(k[0]),
                                m = c(l, k[1], k[0]);
                            e[l] = m
                        }
                        a = d[1], a.split(",").forEach(function(a) {
                            a = a.replace(/^svg/i, "").trim(), "" !== a && (f[a] = p.util.object.clone(e))
                        })
                    }))
                }
                return f
            },
            loadSVGFromURL: function(a, b, c) {
                function d(d) {
                    var e = d.responseXML;
                    e && !e.documentElement && p.window.ActiveXObject && d.responseText && (e = new ActiveXObject("Microsoft.XMLDOM"), e.async = "false", e.loadXML(d.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i, ""))), e && e.documentElement && p.parseSVGDocument(e.documentElement, function(c, d) {
                        D.set(a, {
                            objects: p.util.array.invoke(c, "toObject"),
                            options: d
                        }), b(c, d)
                    }, c)
                }
                a = a.replace(/^\n\s*/, "").trim(), D.has(a, function(c) {
                    c ? D.get(a, function(a) {
                        var c = n(a);
                        b(c.objects, c.options)
                    }) : new p.util.request(a, {
                        method: "get",
                        onComplete: d
                    })
                })
            },
            loadSVGFromString: function(a, b, c) {
                a = a.trim();
                var d;
                if ("undefined" != typeof DOMParser) {
                    var e = new DOMParser;
                    e && e.parseFromString && (d = e.parseFromString(a, "text/xml"))
                } else p.window.ActiveXObject && (d = new ActiveXObject("Microsoft.XMLDOM"), d.async = "false", d.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i, "")));
                p.parseSVGDocument(d.documentElement, function(a, c) {
                    b(a, c)
                }, c)
            },
            createSVGFontFacesMarkup: function(a) {
                for (var b = "", c = 0, d = a.length; d > c; c++) "text" === a[c].type && a[c].path && (b += ["@font-face {", "font-family: ", a[c].fontFamily, "; ", "src: url('", a[c].path, "')", "}"].join(""));
                return b && (b = ['<style type="text/css">', "<![CDATA[", b, "]]>", "</style>"].join("")), b
            },
            createSVGRefElementsMarkup: function(a) {
                var b = [];
                return o(b, a, "backgroundColor"), o(b, a, "overlayColor"), b.join("")
            }
        })
    }("undefined" != typeof exports ? exports : this), fabric.ElementsParser = function(a, b, c, d) {
        this.elements = a, this.callback = b, this.options = c, this.reviver = d, this.svgUid = c && c.svgUid || 0
    }, fabric.ElementsParser.prototype.parse = function() {
        this.instances = new Array(this.elements.length), this.numElements = this.elements.length, this.createObjects()
    }, fabric.ElementsParser.prototype.createObjects = function() {
        for (var a = 0, b = this.elements.length; b > a; a++) this.elements[a].setAttribute("svgUid", this.svgUid),
            function(a, b) {
                setTimeout(function() {
                    a.createObject(a.elements[b], b)
                }, 0)
            }(this, a)
    }, fabric.ElementsParser.prototype.createObject = function(a, b) {
        var c = fabric[fabric.util.string.capitalize(a.tagName)];
        if (c && c.fromElement) try {
            this._createObject(c, a, b)
        } catch (d) {
            fabric.log(d)
        } else this.checkIfDone()
    }, fabric.ElementsParser.prototype._createObject = function(a, b, c) {
        if (a.async) a.fromElement(b, this.createCallback(c, b), this.options);
        else {
            var d = a.fromElement(b, this.options);
            this.resolveGradient(d, "fill"), this.resolveGradient(d, "stroke"), this.reviver && this.reviver(b, d), this.instances[c] = d, this.checkIfDone()
        }
    }, fabric.ElementsParser.prototype.createCallback = function(a, b) {
        var c = this;
        return function(d) {
            c.resolveGradient(d, "fill"), c.resolveGradient(d, "stroke"), c.reviver && c.reviver(b, d), c.instances[a] = d, c.checkIfDone()
        }
    }, fabric.ElementsParser.prototype.resolveGradient = function(a, b) {
        var c = a.get(b);
        if (/^url\(/.test(c)) {
            var d = c.slice(5, c.length - 1);
            fabric.gradientDefs[this.svgUid][d] && a.set(b, fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][d], a))
        }
    }, fabric.ElementsParser.prototype.checkIfDone = function() {
        0 === --this.numElements && (this.instances = this.instances.filter(function(a) {
            return null != a
        }), this.callback(this.instances))
    },
    function(a) {
        "use strict";

        function b(a, b) {
            this.x = a, this.y = b
        }
        var c = a.fabric || (a.fabric = {});
        return c.Point ? void c.warn("fabric.Point is already defined") : (c.Point = b, void(b.prototype = {
            constructor: b,
            add: function(a) {
                return new b(this.x + a.x, this.y + a.y)
            },
            addEquals: function(a) {
                return this.x += a.x, this.y += a.y, this
            },
            scalarAdd: function(a) {
                return new b(this.x + a, this.y + a)
            },
            scalarAddEquals: function(a) {
                return this.x += a, this.y += a, this
            },
            subtract: function(a) {
                return new b(this.x - a.x, this.y - a.y)
            },
            subtractEquals: function(a) {
                return this.x -= a.x, this.y -= a.y, this
            },
            scalarSubtract: function(a) {
                return new b(this.x - a, this.y - a)
            },
            scalarSubtractEquals: function(a) {
                return this.x -= a, this.y -= a, this
            },
            multiply: function(a) {
                return new b(this.x * a, this.y * a)
            },
            multiplyEquals: function(a) {
                return this.x *= a, this.y *= a, this
            },
            divide: function(a) {
                return new b(this.x / a, this.y / a)
            },
            divideEquals: function(a) {
                return this.x /= a, this.y /= a, this
            },
            eq: function(a) {
                return this.x === a.x && this.y === a.y
            },
            lt: function(a) {
                return this.x < a.x && this.y < a.y
            },
            lte: function(a) {
                return this.x <= a.x && this.y <= a.y
            },
            gt: function(a) {
                return this.x > a.x && this.y > a.y
            },
            gte: function(a) {
                return this.x >= a.x && this.y >= a.y
            },
            lerp: function(a, c) {
                return new b(this.x + (a.x - this.x) * c, this.y + (a.y - this.y) * c)
            },
            distanceFrom: function(a) {
                var b = this.x - a.x,
                    c = this.y - a.y;
                return Math.sqrt(b * b + c * c)
            },
            midPointFrom: function(a) {
                return new b(this.x + (a.x - this.x) / 2, this.y + (a.y - this.y) / 2)
            },
            min: function(a) {
                return new b(Math.min(this.x, a.x), Math.min(this.y, a.y))
            },
            max: function(a) {
                return new b(Math.max(this.x, a.x), Math.max(this.y, a.y))
            },
            toString: function() {
                return this.x + "," + this.y
            },
            setXY: function(a, b) {
                this.x = a, this.y = b
            },
            setFromPoint: function(a) {
                this.x = a.x, this.y = a.y
            },
            swap: function(a) {
                var b = this.x,
                    c = this.y;
                this.x = a.x, this.y = a.y, a.x = b, a.y = c
            }
        }))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";

        function b(a) {
            this.status = a, this.points = []
        }
        var c = a.fabric || (a.fabric = {});
        return c.Intersection ? void c.warn("fabric.Intersection is already defined") : (c.Intersection = b, c.Intersection.prototype = {
            appendPoint: function(a) {
                this.points.push(a)
            },
            appendPoints: function(a) {
                this.points = this.points.concat(a)
            }
        }, c.Intersection.intersectLineLine = function(a, d, e, f) {
            var g, h = (f.x - e.x) * (a.y - e.y) - (f.y - e.y) * (a.x - e.x),
                i = (d.x - a.x) * (a.y - e.y) - (d.y - a.y) * (a.x - e.x),
                j = (f.y - e.y) * (d.x - a.x) - (f.x - e.x) * (d.y - a.y);
            if (0 !== j) {
                var k = h / j,
                    l = i / j;
                k >= 0 && 1 >= k && l >= 0 && 1 >= l ? (g = new b("Intersection"), g.points.push(new c.Point(a.x + k * (d.x - a.x), a.y + k * (d.y - a.y)))) : g = new b
            } else g = new b(0 === h || 0 === i ? "Coincident" : "Parallel");
            return g
        }, c.Intersection.intersectLinePolygon = function(a, c, d) {
            for (var e = new b, f = d.length, g = 0; f > g; g++) {
                var h = d[g],
                    i = d[(g + 1) % f],
                    j = b.intersectLineLine(a, c, h, i);
                e.appendPoints(j.points)
            }
            return e.points.length > 0 && (e.status = "Intersection"), e
        }, c.Intersection.intersectPolygonPolygon = function(a, c) {
            for (var d = new b, e = a.length, f = 0; e > f; f++) {
                var g = a[f],
                    h = a[(f + 1) % e],
                    i = b.intersectLinePolygon(g, h, c);
                d.appendPoints(i.points)
            }
            return d.points.length > 0 && (d.status = "Intersection"), d
        }, void(c.Intersection.intersectPolygonRectangle = function(a, d, e) {
            var f = d.min(e),
                g = d.max(e),
                h = new c.Point(g.x, f.y),
                i = new c.Point(f.x, g.y),
                j = b.intersectLinePolygon(f, h, a),
                k = b.intersectLinePolygon(h, g, a),
                l = b.intersectLinePolygon(g, i, a),
                m = b.intersectLinePolygon(i, f, a),
                n = new b;
            return n.appendPoints(j.points), n.appendPoints(k.points), n.appendPoints(l.points), n.appendPoints(m.points), n.points.length > 0 && (n.status = "Intersection"), n
        }))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";

        function b(a) {
            a ? this._tryParsingColor(a) : this.setSource([0, 0, 0, 1])
        }

        function c(a, b, c) {
            return 0 > c && (c += 1), c > 1 && (c -= 1), 1 / 6 > c ? a + 6 * (b - a) * c : .5 > c ? b : 2 / 3 > c ? a + (b - a) * (2 / 3 - c) * 6 : a
        }
        var d = a.fabric || (a.fabric = {});
        return d.Color ? void d.warn("fabric.Color is already defined.") : (d.Color = b, d.Color.prototype = {
            _tryParsingColor: function(a) {
                var c;
                return a in b.colorNameMap && (a = b.colorNameMap[a]), "transparent" === a ? void this.setSource([255, 255, 255, 0]) : (c = b.sourceFromHex(a), c || (c = b.sourceFromRgb(a)), c || (c = b.sourceFromHsl(a)), void(c && this.setSource(c)))
            },
            _rgbToHsl: function(a, b, c) {
                a /= 255, b /= 255, c /= 255;
                var e, f, g, h = d.util.array.max([a, b, c]),
                    i = d.util.array.min([a, b, c]);
                if (g = (h + i) / 2, h === i) e = f = 0;
                else {
                    var j = h - i;
                    switch (f = g > .5 ? j / (2 - h - i) : j / (h + i), h) {
                        case a:
                            e = (b - c) / j + (c > b ? 6 : 0);
                            break;
                        case b:
                            e = (c - a) / j + 2;
                            break;
                        case c:
                            e = (a - b) / j + 4
                    }
                    e /= 6
                }
                return [Math.round(360 * e), Math.round(100 * f), Math.round(100 * g)]
            },
            getSource: function() {
                return this._source
            },
            setSource: function(a) {
                this._source = a
            },
            toRgb: function() {
                var a = this.getSource();
                return "rgb(" + a[0] + "," + a[1] + "," + a[2] + ")"
            },
            toRgba: function() {
                var a = this.getSource();
                return "rgba(" + a[0] + "," + a[1] + "," + a[2] + "," + a[3] + ")"
            },
            toHsl: function() {
                var a = this.getSource(),
                    b = this._rgbToHsl(a[0], a[1], a[2]);
                return "hsl(" + b[0] + "," + b[1] + "%," + b[2] + "%)"
            },
            toHsla: function() {
                var a = this.getSource(),
                    b = this._rgbToHsl(a[0], a[1], a[2]);
                return "hsla(" + b[0] + "," + b[1] + "%," + b[2] + "%," + a[3] + ")"
            },
            toHex: function() {
                var a, b, c, d = this.getSource();
                return a = d[0].toString(16), a = 1 === a.length ? "0" + a : a, b = d[1].toString(16), b = 1 === b.length ? "0" + b : b, c = d[2].toString(16), c = 1 === c.length ? "0" + c : c, a.toUpperCase() + b.toUpperCase() + c.toUpperCase()
            },
            getAlpha: function() {
                return this.getSource()[3]
            },
            setAlpha: function(a) {
                var b = this.getSource();
                return b[3] = a, this.setSource(b), this
            },
            toGrayscale: function() {
                var a = this.getSource(),
                    b = parseInt((.3 * a[0] + .59 * a[1] + .11 * a[2]).toFixed(0), 10),
                    c = a[3];
                return this.setSource([b, b, b, c]), this
            },
            toBlackWhite: function(a) {
                var b = this.getSource(),
                    c = (.3 * b[0] + .59 * b[1] + .11 * b[2]).toFixed(0),
                    d = b[3];
                return a = a || 127, c = Number(c) < Number(a) ? 0 : 255, this.setSource([c, c, c, d]), this
            },
            overlayWith: function(a) {
                a instanceof b || (a = new b(a));
                for (var c = [], d = this.getAlpha(), e = .5, f = this.getSource(), g = a.getSource(), h = 0; 3 > h; h++) c.push(Math.round(f[h] * (1 - e) + g[h] * e));
                return c[3] = d, this.setSource(c), this
            }
        }, d.Color.reRGBa = /^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/, d.Color.reHSLa = /^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/, d.Color.reHex = /^#?([0-9a-f]{6}|[0-9a-f]{3})$/i, d.Color.colorNameMap = {
            aqua: "#00FFFF",
            black: "#000000",
            blue: "#0000FF",
            fuchsia: "#FF00FF",
            gray: "#808080",
            green: "#008000",
            lime: "#00FF00",
            maroon: "#800000",
            navy: "#000080",
            olive: "#808000",
            orange: "#FFA500",
            purple: "#800080",
            red: "#FF0000",
            silver: "#C0C0C0",
            teal: "#008080",
            white: "#FFFFFF",
            yellow: "#FFFF00"
        }, d.Color.fromRgb = function(a) {
            return b.fromSource(b.sourceFromRgb(a))
        }, d.Color.sourceFromRgb = function(a) {
            var c = a.match(b.reRGBa);
            if (c) {
                var d = parseInt(c[1], 10) / (/%$/.test(c[1]) ? 100 : 1) * (/%$/.test(c[1]) ? 255 : 1),
                    e = parseInt(c[2], 10) / (/%$/.test(c[2]) ? 100 : 1) * (/%$/.test(c[2]) ? 255 : 1),
                    f = parseInt(c[3], 10) / (/%$/.test(c[3]) ? 100 : 1) * (/%$/.test(c[3]) ? 255 : 1);
                return [parseInt(d, 10), parseInt(e, 10), parseInt(f, 10), c[4] ? parseFloat(c[4]) : 1]
            }
        }, d.Color.fromRgba = b.fromRgb, d.Color.fromHsl = function(a) {
            return b.fromSource(b.sourceFromHsl(a))
        }, d.Color.sourceFromHsl = function(a) {
            var d = a.match(b.reHSLa);
            if (d) {
                var e, f, g, h = (parseFloat(d[1]) % 360 + 360) % 360 / 360,
                    i = parseFloat(d[2]) / (/%$/.test(d[2]) ? 100 : 1),
                    j = parseFloat(d[3]) / (/%$/.test(d[3]) ? 100 : 1);
                if (0 === i) e = f = g = j;
                else {
                    var k = .5 >= j ? j * (i + 1) : j + i - j * i,
                        l = 2 * j - k;
                    e = c(l, k, h + 1 / 3), f = c(l, k, h), g = c(l, k, h - 1 / 3)
                }
                return [Math.round(255 * e), Math.round(255 * f), Math.round(255 * g), d[4] ? parseFloat(d[4]) : 1]
            }
        }, d.Color.fromHsla = b.fromHsl, d.Color.fromHex = function(a) {
            return b.fromSource(b.sourceFromHex(a))
        }, d.Color.sourceFromHex = function(a) {
            if (a.match(b.reHex)) {
                var c = a.slice(a.indexOf("#") + 1),
                    d = 3 === c.length,
                    e = d ? c.charAt(0) + c.charAt(0) : c.substring(0, 2),
                    f = d ? c.charAt(1) + c.charAt(1) : c.substring(2, 4),
                    g = d ? c.charAt(2) + c.charAt(2) : c.substring(4, 6);
                return [parseInt(e, 16), parseInt(f, 16), parseInt(g, 16), 1]
            }
        }, void(d.Color.fromSource = function(a) {
            var c = new b;
            return c.setSource(a), c
        }))
    }("undefined" != typeof exports ? exports : this),
    function() {
        function a(a) {
            var b, c, d, e = a.getAttribute("style"),
                f = a.getAttribute("offset");
            if (f = parseFloat(f) / (/%$/.test(f) ? 100 : 1), f = 0 > f ? 0 : f > 1 ? 1 : f, e) {
                var g = e.split(/\s*;\s*/);
                "" === g[g.length - 1] && g.pop();
                for (var h = g.length; h--;) {
                    var i = g[h].split(/\s*:\s*/),
                        j = i[0].trim(),
                        k = i[1].trim();
                    "stop-color" === j ? b = k : "stop-opacity" === j && (d = k)
                }
            }
            return b || (b = a.getAttribute("stop-color") || "rgb(0,0,0)"), d || (d = a.getAttribute("stop-opacity")), b = new fabric.Color(b), c = b.getAlpha(), d = isNaN(parseFloat(d)) ? 1 : parseFloat(d), d *= c, {
                offset: f,
                color: b.toRgb(),
                opacity: d
            }
        }

        function b(a) {
            return {
                x1: a.getAttribute("x1") || 0,
                y1: a.getAttribute("y1") || 0,
                x2: a.getAttribute("x2") || "100%",
                y2: a.getAttribute("y2") || 0
            }
        }

        function c(a) {
            return {
                x1: a.getAttribute("fx") || a.getAttribute("cx") || "50%",
                y1: a.getAttribute("fy") || a.getAttribute("cy") || "50%",
                r1: 0,
                x2: a.getAttribute("cx") || "50%",
                y2: a.getAttribute("cy") || "50%",
                r2: a.getAttribute("r") || "50%"
            }
        }

        function d(a, b, c) {
            var d, e = 0,
                f = 1,
                g = "";
            for (var h in b) d = parseFloat(b[h], 10), f = "string" == typeof b[h] && /^\d+%$/.test(b[h]) ? .01 : 1, "x1" === h || "x2" === h || "r2" === h ? (f *= "objectBoundingBox" === c ? a.width : 1, e = "objectBoundingBox" === c ? a.left || 0 : 0) : "y1" !== h && "y2" !== h || (f *= "objectBoundingBox" === c ? a.height : 1, e = "objectBoundingBox" === c ? a.top || 0 : 0), b[h] = d * f + e;
            if ("ellipse" === a.type && null !== b.r2 && "objectBoundingBox" === c && a.rx !== a.ry) {
                var i = a.ry / a.rx;
                g = " scale(1, " + i + ")", b.y1 && (b.y1 /= i), b.y2 && (b.y2 /= i)
            }
            return g
        }
        fabric.Gradient = fabric.util.createClass({
            offsetX: 0,
            offsetY: 0,
            initialize: function(a) {
                a || (a = {});
                var b = {};
                this.id = fabric.Object.__uid++, this.type = a.type || "linear", b = {
                    x1: a.coords.x1 || 0,
                    y1: a.coords.y1 || 0,
                    x2: a.coords.x2 || 0,
                    y2: a.coords.y2 || 0
                }, "radial" === this.type && (b.r1 = a.coords.r1 || 0, b.r2 = a.coords.r2 || 0), this.coords = b, this.colorStops = a.colorStops.slice(), a.gradientTransform && (this.gradientTransform = a.gradientTransform), this.offsetX = a.offsetX || this.offsetX, this.offsetY = a.offsetY || this.offsetY
            },
            addColorStop: function(a) {
                for (var b in a) {
                    var c = new fabric.Color(a[b]);
                    this.colorStops.push({
                        offset: b,
                        color: c.toRgb(),
                        opacity: c.getAlpha()
                    })
                }
                return this
            },
            toObject: function() {
                return {
                    type: this.type,
                    coords: this.coords,
                    colorStops: this.colorStops,
                    offsetX: this.offsetX,
                    offsetY: this.offsetY
                }
            },
            toSVG: function(a) {
                var b, c, d = fabric.util.object.clone(this.coords);
                if (this.colorStops.sort(function(a, b) {
                        return a.offset - b.offset
                    }), !a.group || "shape" !== a.group.type)
                    for (var e in d) "x1" === e || "x2" === e || "r2" === e ? d[e] += this.offsetX - a.width / 2 : "y1" !== e && "y2" !== e || (d[e] += this.offsetY - a.height / 2);
                c = 'id="SVGID_' + this.id + '" gradientUnits="userSpaceOnUse"', this.gradientTransform && (c += ' gradientTransform="matrix(' + this.gradientTransform.join(" ") + ')" '), "linear" === this.type ? b = ["<linearGradient ", c, ' x1="', d.x1, '" y1="', d.y1, '" x2="', d.x2, '" y2="', d.y2, '">\n'] : "radial" === this.type && (b = ["<radialGradient ", c, ' cx="', d.x2, '" cy="', d.y2, '" r="', d.r2, '" fx="', d.x1, '" fy="', d.y1, '">\n']);
                for (var f = 0; f < this.colorStops.length; f++) b.push("<stop ", 'offset="', 100 * this.colorStops[f].offset + "%", '" style="stop-color:', this.colorStops[f].color, null != this.colorStops[f].opacity ? ";stop-opacity: " + this.colorStops[f].opacity : ";", '"/>\n');
                return b.push("linear" === this.type ? "</linearGradient>\n" : "</radialGradient>\n"), b.join("")
            },
            toLive: function(a, b) {
                var c, d, e = fabric.util.object.clone(this.coords);
                if (this.type) {
                    if (b.group && "shape" === b.group.type)
                        for (d in e) "x1" === d || "x2" === d ? e[d] += -this.offsetX + b.width / 2 : "y1" !== d && "y2" !== d || (e[d] += -this.offsetY + b.height / 2);
                    "linear" === this.type ? c = a.createLinearGradient(e.x1, e.y1, e.x2, e.y2) : "radial" === this.type && (c = a.createRadialGradient(e.x1, e.y1, e.r1, e.x2, e.y2, e.r2));
                    for (var f = 0, g = this.colorStops.length; g > f; f++) {
                        var h = this.colorStops[f].color,
                            i = this.colorStops[f].opacity,
                            j = this.colorStops[f].offset;
                        "undefined" != typeof i && (h = new fabric.Color(h).setAlpha(i).toRgba()), c.addColorStop(parseFloat(j), h)
                    }
                    return c
                }
            }
        }), fabric.util.object.extend(fabric.Gradient, {
            fromElement: function(e, f) {
                var g, h = e.getElementsByTagName("stop"),
                    i = "linearGradient" === e.nodeName ? "linear" : "radial",
                    j = e.getAttribute("gradientUnits") || "objectBoundingBox",
                    k = e.getAttribute("gradientTransform"),
                    l = [],
                    m = {};
                "linear" === i ? m = b(e) : "radial" === i && (m = c(e));
                for (var n = h.length; n--;) l.push(a(h[n]));
                g = d(f, m, j);
                var o = new fabric.Gradient({
                    type: i,
                    coords: m,
                    colorStops: l,
                    offsetX: -f.left,
                    offsetY: -f.top
                });
                return (k || "" !== g) && (o.gradientTransform = fabric.parseTransformAttribute((k || "") + g)), o
            },
            forObject: function(a, b) {
                return b || (b = {}), d(a, b.coords, "userSpaceOnUse"), new fabric.Gradient(b)
            }
        })
    }(), fabric.Pattern = fabric.util.createClass({
        repeat: "repeat",
        offsetX: 0,
        offsetY: 0,
        initialize: function(a) {
            if (a || (a = {}), this.id = fabric.Object.__uid++, a.source)
                if ("string" == typeof a.source)
                    if ("undefined" != typeof fabric.util.getFunctionBody(a.source)) this.source = new Function(fabric.util.getFunctionBody(a.source));
                    else {
                        var b = this;
                        this.source = fabric.util.createImage(), fabric.util.loadImage(a.source, function(a) {
                            b.source = a
                        })
                    }
            else this.source = a.source;
            a.repeat && (this.repeat = a.repeat), a.offsetX && (this.offsetX = a.offsetX), a.offsetY && (this.offsetY = a.offsetY)
        },
        toObject: function() {
            var a;
            return "function" == typeof this.source ? a = String(this.source) : "string" == typeof this.source.src ? a = this.source.src : "object" == typeof this.source && this.source.toDataURL && (a = this.source.toDataURL()), {
                source: a,
                repeat: this.repeat,
                offsetX: this.offsetX,
                offsetY: this.offsetY
            }
        },
        toSVG: function(a) {
            var b = "function" == typeof this.source ? this.source() : this.source,
                c = b.width / a.getWidth(),
                d = b.height / a.getHeight(),
                e = this.offsetX / a.getWidth(),
                f = this.offsetY / a.getHeight(),
                g = "";
            return "repeat-x" !== this.repeat && "no-repeat" !== this.repeat || (d = 1), "repeat-y" !== this.repeat && "no-repeat" !== this.repeat || (c = 1), b.src ? g = b.src : b.toDataURL && (g = b.toDataURL()), '<pattern id="SVGID_' + this.id + '" x="' + e + '" y="' + f + '" width="' + c + '" height="' + d + '">\n<image x="0" y="0" width="' + b.width + '" height="' + b.height + '" xlink:href="' + g + '"></image>\n</pattern>\n'
        },
        toLive: function(a) {
            var b = "function" == typeof this.source ? this.source() : this.source;
            if (!b) return "";
            if ("undefined" != typeof b.src) {
                if (!b.complete) return "";
                if (0 === b.naturalWidth || 0 === b.naturalHeight) return ""
            }
            return a.createPattern(b, this.repeat)
        }
    }),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.toFixed;
        return b.Shadow ? void b.warn("fabric.Shadow is already defined.") : (b.Shadow = b.util.createClass({
            color: "rgb(0,0,0)",
            blur: 0,
            offsetX: 0,
            offsetY: 0,
            affectStroke: !1,
            includeDefaultValues: !0,
            initialize: function(a) {
                "string" == typeof a && (a = this._parseShadow(a));
                for (var c in a) this[c] = a[c];
                this.id = b.Object.__uid++
            },
            _parseShadow: function(a) {
                var c = a.trim(),
                    d = b.Shadow.reOffsetsAndBlur.exec(c) || [],
                    e = c.replace(b.Shadow.reOffsetsAndBlur, "") || "rgb(0,0,0)";
                return {
                    color: e.trim(),
                    offsetX: parseInt(d[1], 10) || 0,
                    offsetY: parseInt(d[2], 10) || 0,
                    blur: parseInt(d[3], 10) || 0
                }
            },
            toString: function() {
                return [this.offsetX, this.offsetY, this.blur, this.color].join("px ")
            },
            toSVG: function(a) {
                var b = 40,
                    d = 40;
                return a.width && a.height && (b = 100 * c((Math.abs(this.offsetX) + this.blur) / a.width, 2) + 20, d = 100 * c((Math.abs(this.offsetY) + this.blur) / a.height, 2) + 20), '<filter id="SVGID_' + this.id + '" y="-' + d + '%" height="' + (100 + 2 * d) + '%" x="-' + b + '%" width="' + (100 + 2 * b) + '%" >\n	<feGaussianBlur in="SourceAlpha" stdDeviation="' + c(this.blur ? this.blur / 2 : 0, 3) + '"></feGaussianBlur>\n	<feOffset dx="' + this.offsetX + '" dy="' + this.offsetY + '" result="oBlur" ></feOffset>\n	<feFlood flood-color="' + this.color + '"/>\n	<feComposite in2="oBlur" operator="in" />\n	<feMerge>\n		<feMergeNode></feMergeNode>\n		<feMergeNode in="SourceGraphic"></feMergeNode>\n	</feMerge>\n</filter>\n'
            },
            toObject: function() {
                if (this.includeDefaultValues) return {
                    color: this.color,
                    blur: this.blur,
                    offsetX: this.offsetX,
                    offsetY: this.offsetY
                };
                var a = {},
                    c = b.Shadow.prototype;
                return this.color !== c.color && (a.color = this.color), this.blur !== c.blur && (a.blur = this.blur), this.offsetX !== c.offsetX && (a.offsetX = this.offsetX), this.offsetY !== c.offsetY && (a.offsetY = this.offsetY), a
            }
        }), void(b.Shadow.reOffsetsAndBlur = /(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))
    }("undefined" != typeof exports ? exports : this),
    function() {
        "use strict";
        if (fabric.StaticCanvas) return void fabric.warn("fabric.StaticCanvas is already defined.");
        var a = fabric.util.object.extend,
            b = fabric.util.getElementOffset,
            c = fabric.util.removeFromArray,
            d = new Error("Could not initialize `canvas` element");
        fabric.StaticCanvas = fabric.util.createClass({
            initialize: function(a, b) {
                b || (b = {}), this._initStatic(a, b), fabric.StaticCanvas.activeInstance = this
            },
            backgroundColor: "",
            backgroundImage: null,
            overlayColor: "",
            overlayImage: null,
            includeDefaultValues: !0,
            stateful: !0,
            renderOnAddRemove: !0,
            clipTo: null,
            controlsAboveOverlay: !1,
            allowTouchScrolling: !1,
            imageSmoothingEnabled: !0,
            preserveObjectStacking: !1,
            viewportTransform: [1, 0, 0, 1, 0, 0],
            onBeforeScaleRotate: function() {},
            enableRetinaScaling: !0,
            _initStatic: function(a, b) {
                this._objects = [], this._createLowerCanvas(a), this._initOptions(b), this._setImageSmoothing(), this.interactive || this._initRetinaScaling(), b.overlayImage && this.setOverlayImage(b.overlayImage, this.renderAll.bind(this)), b.backgroundImage && this.setBackgroundImage(b.backgroundImage, this.renderAll.bind(this)), b.backgroundColor && this.setBackgroundColor(b.backgroundColor, this.renderAll.bind(this)), b.overlayColor && this.setOverlayColor(b.overlayColor, this.renderAll.bind(this)), this.calcOffset()
            },
            _initRetinaScaling: function() {
                1 !== fabric.devicePixelRatio && this.enableRetinaScaling && (this.lowerCanvasEl.setAttribute("width", this.width * fabric.devicePixelRatio), this.lowerCanvasEl.setAttribute("height", this.height * fabric.devicePixelRatio), this.contextContainer.scale(fabric.devicePixelRatio, fabric.devicePixelRatio))
            },
            calcOffset: function() {
                return this._offset = b(this.lowerCanvasEl), this
            },
            setOverlayImage: function(a, b, c) {
                return this.__setBgOverlayImage("overlayImage", a, b, c)
            },
            setBackgroundImage: function(a, b, c) {
                return this.__setBgOverlayImage("backgroundImage", a, b, c)
            },
            setOverlayColor: function(a, b) {
                return this.__setBgOverlayColor("overlayColor", a, b)
            },
            setBackgroundColor: function(a, b) {
                return this.__setBgOverlayColor("backgroundColor", a, b)
            },
            _setImageSmoothing: function() {
                var a = this.getContext();
                return "undefined" != typeof a.imageSmoothingEnabled ? void(a.imageSmoothingEnabled = this.imageSmoothingEnabled) : (a.webkitImageSmoothingEnabled = this.imageSmoothingEnabled, a.mozImageSmoothingEnabled = this.imageSmoothingEnabled, a.msImageSmoothingEnabled = this.imageSmoothingEnabled, void(a.oImageSmoothingEnabled = this.imageSmoothingEnabled))
            },
            __setBgOverlayImage: function(a, b, c, d) {
                return "string" == typeof b ? fabric.util.loadImage(b, function(b) {
                    this[a] = new fabric.Image(b, d), c && c()
                }, this, d && d.crossOrigin) : (d && b.setOptions(d), this[a] = b, c && c()), this
            },
            __setBgOverlayColor: function(a, b, c) {
                if (b && b.source) {
                    var d = this;
                    fabric.util.loadImage(b.source, function(e) {
                        d[a] = new fabric.Pattern({
                            source: e,
                            repeat: b.repeat,
                            offsetX: b.offsetX,
                            offsetY: b.offsetY
                        }), c && c()
                    })
                } else this[a] = b, c && c();
                return this
            },
            _createCanvasElement: function() {
                var a = fabric.document.createElement("canvas");
                if (a.style || (a.style = {}), !a) throw d;
                return this._initCanvasElement(a), a
            },
            _initCanvasElement: function(a) {
                if (fabric.util.createCanvasElement(a), "undefined" == typeof a.getContext) throw d
            },
            _initOptions: function(a) {
                for (var b in a) this[b] = a[b];
                this.width = this.width || parseInt(this.lowerCanvasEl.width, 10) || 0, this.height = this.height || parseInt(this.lowerCanvasEl.height, 10) || 0, this.lowerCanvasEl.style && (this.lowerCanvasEl.width = this.width, this.lowerCanvasEl.height = this.height, this.lowerCanvasEl.style.width = this.width + "px", this.lowerCanvasEl.style.height = this.height + "px", this.viewportTransform = this.viewportTransform.slice())
            },
            _createLowerCanvas: function(a) {
                this.lowerCanvasEl = fabric.util.getById(a) || this._createCanvasElement(), this._initCanvasElement(this.lowerCanvasEl), fabric.util.addClass(this.lowerCanvasEl, "lower-canvas"), this.interactive && this._applyCanvasStyle(this.lowerCanvasEl), this.contextContainer = this.lowerCanvasEl.getContext("2d")
            },
            getWidth: function() {
                return this.width
            },
            getHeight: function() {
                return this.height
            },
            setWidth: function(a, b) {
                return this.setDimensions({
                    width: a
                }, b)
            },
            setHeight: function(a, b) {
                return this.setDimensions({
                    height: a
                }, b)
            },
            setDimensions: function(a, b) {
                var c;
                b = b || {};
                for (var d in a) c = a[d], b.cssOnly || (this._setBackstoreDimension(d, a[d]), c += "px"), b.backstoreOnly || this._setCssDimension(d, c);
                return this._setImageSmoothing(), this.calcOffset(), b.cssOnly || this.renderAll(), this
            },
            _setBackstoreDimension: function(a, b) {
                return this.lowerCanvasEl[a] = b, this.upperCanvasEl && (this.upperCanvasEl[a] = b), this.cacheCanvasEl && (this.cacheCanvasEl[a] = b), this[a] = b, this
            },
            _setCssDimension: function(a, b) {
                return this.lowerCanvasEl.style[a] = b, this.upperCanvasEl && (this.upperCanvasEl.style[a] = b), this.wrapperEl && (this.wrapperEl.style[a] = b), this
            },
            getZoom: function() {
                return Math.sqrt(this.viewportTransform[0] * this.viewportTransform[3])
            },
            setViewportTransform: function(a) {
                var b = this.getActiveGroup();
                this.viewportTransform = a, this.renderAll();
                for (var c = 0, d = this._objects.length; d > c; c++) this._objects[c].setCoords();
                return b && b.setCoords(), this
            },
            zoomToPoint: function(a, b) {
                var c = a;
                a = fabric.util.transformPoint(a, fabric.util.invertTransform(this.viewportTransform)), this.viewportTransform[0] = b, this.viewportTransform[3] = b;
                var d = fabric.util.transformPoint(a, this.viewportTransform);
                this.viewportTransform[4] += c.x - d.x, this.viewportTransform[5] += c.y - d.y, this.renderAll();
                for (var e = 0, f = this._objects.length; f > e; e++) this._objects[e].setCoords();
                return this
            },
            setZoom: function(a) {
                return this.zoomToPoint(new fabric.Point(0, 0), a), this
            },
            absolutePan: function(a) {
                this.viewportTransform[4] = -a.x, this.viewportTransform[5] = -a.y, this.renderAll();
                for (var b = 0, c = this._objects.length; c > b; b++) this._objects[b].setCoords();
                return this
            },
            relativePan: function(a) {
                return this.absolutePan(new fabric.Point(-a.x - this.viewportTransform[4], -a.y - this.viewportTransform[5]))
            },
            getElement: function() {
                return this.lowerCanvasEl
            },
            getActiveObject: function() {
                return null
            },
            getActiveGroup: function() {
                return null
            },
            _draw: function(a, b) {
                if (b) {
                    a.save();
                    var c = this.viewportTransform;
                    a.transform(c[0], c[1], c[2], c[3], c[4], c[5]), this._shouldRenderObject(b) && b.render(a), a.restore(), this.controlsAboveOverlay || b._renderControls(a)
                }
            },
            _shouldRenderObject: function(a) {
                return a ? a !== this.getActiveGroup() || !this.preserveObjectStacking : !1
            },
            _onObjectAdded: function(a) {
                this.stateful && a.setupState(), a._set("canvas", this), a.setCoords(), this.fire("object:added", {
                    target: a
                }), a.fire("added")
            },
            _onObjectRemoved: function(a) {
                this.getActiveObject() === a && (this.fire("before:selection:cleared", {
                    target: a
                }), this._discardActiveObject(), this.fire("selection:cleared")), this.fire("object:removed", {
                    target: a
                }), a.fire("removed")
            },
            clearContext: function(a) {
                return a.clearRect(0, 0, this.width, this.height), this
            },
            getContext: function() {
                return this.contextContainer
            },
            clear: function() {
                return this._objects.length = 0, this.discardActiveGroup && this.discardActiveGroup(), this.discardActiveObject && this.discardActiveObject(), this.clearContext(this.contextContainer), this.contextTop && this.clearContext(this.contextTop), this.fire("canvas:cleared"), this.renderAll(), this
            },
            renderAll: function(a) {
                var b = this[a === !0 && this.interactive ? "contextTop" : "contextContainer"],
                    c = this.getActiveGroup();
                return this.contextTop && this.selection && !this._groupSelector && this.clearContext(this.contextTop), a || this.clearContext(b), this.fire("before:render"), this.clipTo && fabric.util.clipContext(this, b), this._renderBackground(b), this._renderObjects(b, c), this._renderActiveGroup(b, c), this.clipTo && b.restore(), this._renderOverlay(b), this.controlsAboveOverlay && this.interactive && this.drawControls(b), this.fire("after:render"), this
            },
            _renderObjects: function(a, b) {
                var c, d;
                if (!b || this.preserveObjectStacking)
                    for (c = 0, d = this._objects.length; d > c; ++c) this._draw(a, this._objects[c]);
                else
                    for (c = 0, d = this._objects.length; d > c; ++c) this._objects[c] && !b.contains(this._objects[c]) && this._draw(a, this._objects[c])
            },
            _renderActiveGroup: function(a, b) {
                if (b) {
                    var c = [];
                    this.forEachObject(function(a) {
                        b.contains(a) && c.push(a)
                    }), b._set("_objects", c.reverse()), this._draw(a, b)
                }
            },
            _renderBackground: function(a) {
                this.backgroundColor && (a.fillStyle = this.backgroundColor.toLive ? this.backgroundColor.toLive(a) : this.backgroundColor, a.fillRect(this.backgroundColor.offsetX || 0, this.backgroundColor.offsetY || 0, this.width, this.height)), this.backgroundImage && this._draw(a, this.backgroundImage)
            },
            _renderOverlay: function(a) {
                this.overlayColor && (a.fillStyle = this.overlayColor.toLive ? this.overlayColor.toLive(a) : this.overlayColor, a.fillRect(this.overlayColor.offsetX || 0, this.overlayColor.offsetY || 0, this.width, this.height)), this.overlayImage && this._draw(a, this.overlayImage)
            },
            renderTop: function() {
                var a = this.contextTop || this.contextContainer;
                this.clearContext(a), this.selection && this._groupSelector && this._drawSelection();
                var b = this.getActiveGroup();
                return b && b.render(a), this._renderOverlay(a), this.fire("after:render"), this
            },
            getCenter: function() {
                return {
                    top: this.getHeight() / 2,
                    left: this.getWidth() / 2
                }
            },
            centerObjectH: function(a) {
                return this._centerObject(a, new fabric.Point(this.getCenter().left, a.getCenterPoint().y)), this.renderAll(), this
            },
            centerObjectV: function(a) {
                return this._centerObject(a, new fabric.Point(a.getCenterPoint().x, this.getCenter().top)), this.renderAll(), this
            },
            centerObject: function(a) {
                var b = this.getCenter();
                return this._centerObject(a, new fabric.Point(b.left, b.top)), this.renderAll(), this
            },
            _centerObject: function(a, b) {
                return a.setPositionByOrigin(b, "center", "center"), this
            },
            toDatalessJSON: function(a) {
                return this.toDatalessObject(a)
            },
            toObject: function(a) {
                return this._toObjectMethod("toObject", a)
            },
            toDatalessObject: function(a) {
                return this._toObjectMethod("toDatalessObject", a)
            },
            _toObjectMethod: function(b, c) {
                var d = {
                    objects: this._toObjects(b, c)
                };
                return a(d, this.__serializeBgOverlay()), fabric.util.populateWithProperties(this, d, c), d
            },
            _toObjects: function(a, b) {
                return this.getObjects().map(function(c) {
                    return this._toObject(c, a, b)
                }, this)
            },
            _toObject: function(a, b, c) {
                var d;
                this.includeDefaultValues || (d = a.includeDefaultValues, a.includeDefaultValues = !1);
                var e = this._realizeGroupTransformOnObject(a),
                    f = a[b](c);
                return this.includeDefaultValues || (a.includeDefaultValues = d), this._unwindGroupTransformOnObject(a, e), f
            },
            _realizeGroupTransformOnObject: function(a) {
                var b = ["angle", "flipX", "flipY", "height", "left", "scaleX", "scaleY", "top", "width"];
                if (a.group && a.group === this.getActiveGroup()) {
                    var c = {};
                    return b.forEach(function(b) {
                        c[b] = a[b]
                    }), this.getActiveGroup().realizeTransform(a), c
                }
                return null
            },
            _unwindGroupTransformOnObject: function(a, b) {
                b && a.set(b)
            },
            __serializeBgOverlay: function() {
                var a = {
                    background: this.backgroundColor && this.backgroundColor.toObject ? this.backgroundColor.toObject() : this.backgroundColor
                };
                return this.overlayColor && (a.overlay = this.overlayColor.toObject ? this.overlayColor.toObject() : this.overlayColor), this.backgroundImage && (a.backgroundImage = this.backgroundImage.toObject()), this.overlayImage && (a.overlayImage = this.overlayImage.toObject()), a
            },
            svgViewportTransformation: !0,
            toSVG: function(a, b) {
                a || (a = {});
                var c = [];
                return this._setSVGPreamble(c, a), this._setSVGHeader(c, a), this._setSVGBgOverlayColor(c, "backgroundColor"), this._setSVGBgOverlayImage(c, "backgroundImage"), this._setSVGObjects(c, b), this._setSVGBgOverlayColor(c, "overlayColor"), this._setSVGBgOverlayImage(c, "overlayImage"), c.push("</svg>"), c.join("")
            },
            _setSVGPreamble: function(a, b) {
                b.suppressPreamble || a.push('<?xml version="1.0" encoding="', b.encoding || "UTF-8", '" standalone="no" ?>', '<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ', '"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')
            },
            _setSVGHeader: function(a, b) {
                var c, d, e;
                b.viewBox ? (c = b.viewBox.width, d = b.viewBox.height) : (c = this.width, d = this.height, this.svgViewportTransformation || (e = this.viewportTransform, c /= e[0], d /= e[3])), a.push("<svg ", 'xmlns="http://www.w3.org/2000/svg" ', 'xmlns:xlink="http://www.w3.org/1999/xlink" ', 'version="1.1" ', 'width="', c, '" ', 'height="', d, '" ', this.backgroundColor && !this.backgroundColor.toLive ? 'style="background-color: ' + this.backgroundColor + '" ' : null, b.viewBox ? 'viewBox="' + b.viewBox.x + " " + b.viewBox.y + " " + b.viewBox.width + " " + b.viewBox.height + '" ' : null, 'xml:space="preserve">', "<desc>Created with Fabric.js ", fabric.version, "</desc>", "<defs>", fabric.createSVGFontFacesMarkup(this.getObjects()), fabric.createSVGRefElementsMarkup(this), "</defs>")
            },
            _setSVGObjects: function(a, b) {
                for (var c = 0, d = this.getObjects(), e = d.length; e > c; c++) {
                    var f = d[c],
                        g = this._realizeGroupTransformOnObject(f);
                    a.push(f.toSVG(b)), this._unwindGroupTransformOnObject(f, g)
                }
            },
            _setSVGBgOverlayImage: function(a, b) {
                this[b] && this[b].toSVG && a.push(this[b].toSVG())
            },
            _setSVGBgOverlayColor: function(a, b) {
                this[b] && this[b].source ? a.push('<rect x="', this[b].offsetX, '" y="', this[b].offsetY, '" ', 'width="', "repeat-y" === this[b].repeat || "no-repeat" === this[b].repeat ? this[b].source.width : this.width, '" height="', "repeat-x" === this[b].repeat || "no-repeat" === this[b].repeat ? this[b].source.height : this.height, '" fill="url(#' + b + 'Pattern)"', "></rect>") : this[b] && "overlayColor" === b && a.push('<rect x="0" y="0" ', 'width="', this.width, '" height="', this.height, '" fill="', this[b], '"', "></rect>")
            },
            sendToBack: function(a) {
                return c(this._objects, a), this._objects.unshift(a), this.renderAll && this.renderAll()
            },
            bringToFront: function(a) {
                return c(this._objects, a), this._objects.push(a), this.renderAll && this.renderAll()
            },
            sendBackwards: function(a, b) {
                var d = this._objects.indexOf(a);
                if (0 !== d) {
                    var e = this._findNewLowerIndex(a, d, b);
                    c(this._objects, a), this._objects.splice(e, 0, a), this.renderAll && this.renderAll()
                }
                return this
            },
            _findNewLowerIndex: function(a, b, c) {
                var d;
                if (c) {
                    d = b;
                    for (var e = b - 1; e >= 0; --e) {
                        var f = a.intersectsWithObject(this._objects[e]) || a.isContainedWithinObject(this._objects[e]) || this._objects[e].isContainedWithinObject(a);
                        if (f) {
                            d = e;
                            break
                        }
                    }
                } else d = b - 1;
                return d
            },
            bringForward: function(a, b) {
                var d = this._objects.indexOf(a);
                if (d !== this._objects.length - 1) {
                    var e = this._findNewUpperIndex(a, d, b);
                    c(this._objects, a), this._objects.splice(e, 0, a), this.renderAll && this.renderAll()
                }
                return this
            },
            _findNewUpperIndex: function(a, b, c) {
                var d;
                if (c) {
                    d = b;
                    for (var e = b + 1; e < this._objects.length; ++e) {
                        var f = a.intersectsWithObject(this._objects[e]) || a.isContainedWithinObject(this._objects[e]) || this._objects[e].isContainedWithinObject(a);
                        if (f) {
                            d = e;
                            break
                        }
                    }
                } else d = b + 1;
                return d
            },
            moveTo: function(a, b) {
                return c(this._objects, a), this._objects.splice(b, 0, a), this.renderAll && this.renderAll()
            },
            dispose: function() {
                return this.clear(), this.interactive && this.removeListeners(), this
            },
            toString: function() {
                return "#<fabric.Canvas (" + this.complexity() + "): { objects: " + this.getObjects().length + " }>"
            }
        }), a(fabric.StaticCanvas.prototype, fabric.Observable), a(fabric.StaticCanvas.prototype, fabric.Collection), a(fabric.StaticCanvas.prototype, fabric.DataURLExporter), a(fabric.StaticCanvas, {
            EMPTY_JSON: '{"objects": [], "background": "white"}',
            supports: function(a) {
                var b = fabric.util.createCanvasElement();
                if (!b || !b.getContext) return null;
                var c = b.getContext("2d");
                if (!c) return null;
                switch (a) {
                    case "getImageData":
                        return "undefined" != typeof c.getImageData;
                    case "setLineDash":
                        return "undefined" != typeof c.setLineDash;
                    case "toDataURL":
                        return "undefined" != typeof b.toDataURL;
                    case "toDataURLWithQuality":
                        try {
                            return b.toDataURL("image/jpeg", 0), !0
                        } catch (d) {}
                        return !1;
                    default:
                        return null
                }
            }
        }), fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject
    }(), fabric.BaseBrush = fabric.util.createClass({
        color: "rgb(0, 0, 0)",
        width: 1,
        shadow: null,
        strokeLineCap: "round",
        strokeLineJoin: "round",
        strokeDashArray: null,
        setShadow: function(a) {
            return this.shadow = new fabric.Shadow(a), this
        },
        _setBrushStyles: function() {
            var a = this.canvas.contextTop;
            a.strokeStyle = this.color, a.lineWidth = this.width, a.lineCap = this.strokeLineCap, a.lineJoin = this.strokeLineJoin, this.strokeDashArray && fabric.StaticCanvas.supports("setLineDash") && a.setLineDash(this.strokeDashArray)
        },
        _setShadow: function() {
            if (this.shadow) {
                var a = this.canvas.contextTop;
                a.shadowColor = this.shadow.color, a.shadowBlur = this.shadow.blur, a.shadowOffsetX = this.shadow.offsetX, a.shadowOffsetY = this.shadow.offsetY
            }
        },
        _resetShadow: function() {
            var a = this.canvas.contextTop;
            a.shadowColor = "", a.shadowBlur = a.shadowOffsetX = a.shadowOffsetY = 0
        }
    }),
    function() {
        fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, {
            initialize: function(a) {
                this.canvas = a, this._points = []
            },
            onMouseDown: function(a) {
                this._prepareForDrawing(a), this._captureDrawingPath(a), this._render()
            },
            onMouseMove: function(a) {
                this._captureDrawingPath(a), this.canvas.clearContext(this.canvas.contextTop), this._render()
            },
            onMouseUp: function() {
                this._finalizeAndAddPath()
            },
            _prepareForDrawing: function(a) {
                var b = new fabric.Point(a.x, a.y);
                this._reset(), this._addPoint(b), this.canvas.contextTop.moveTo(b.x, b.y)
            },
            _addPoint: function(a) {
                this._points.push(a)
            },
            _reset: function() {
                this._points.length = 0, this._setBrushStyles(), this._setShadow()
            },
            _captureDrawingPath: function(a) {
                var b = new fabric.Point(a.x, a.y);
                this._addPoint(b)
            },
            _render: function() {
                var a = this.canvas.contextTop,
                    b = this.canvas.viewportTransform,
                    c = this._points[0],
                    d = this._points[1];
                a.save(), a.transform(b[0], b[1], b[2], b[3], b[4], b[5]), a.beginPath(), 2 === this._points.length && c.x === d.x && c.y === d.y && (c.x -= .5, d.x += .5), a.moveTo(c.x, c.y);
                for (var e = 1, f = this._points.length; f > e; e++) {
                    var g = c.midPointFrom(d);
                    a.quadraticCurveTo(c.x, c.y, g.x, g.y), c = this._points[e], d = this._points[e + 1]
                }
                a.lineTo(c.x, c.y), a.stroke(), a.restore()
            },
            convertPointsToSVGPath: function(a) {
                var b = [],
                    c = new fabric.Point(a[0].x, a[0].y),
                    d = new fabric.Point(a[1].x, a[1].y);
                b.push("M ", a[0].x, " ", a[0].y, " ");
                for (var e = 1, f = a.length; f > e; e++) {
                    var g = c.midPointFrom(d);
                    b.push("Q ", c.x, " ", c.y, " ", g.x, " ", g.y, " "), c = new fabric.Point(a[e].x, a[e].y), e + 1 < a.length && (d = new fabric.Point(a[e + 1].x, a[e + 1].y))
                }
                return b.push("L ", c.x, " ", c.y, " "), b
            },
            createPath: function(a) {
                var b = new fabric.Path(a, {
                    fill: null,
                    stroke: this.color,
                    strokeWidth: this.width,
                    strokeLineCap: this.strokeLineCap,
                    strokeLineJoin: this.strokeLineJoin,
                    strokeDashArray: this.strokeDashArray,
                    originX: "center",
                    originY: "center"
                });
                return this.shadow && (this.shadow.affectStroke = !0, b.setShadow(this.shadow)), b
            },
            _finalizeAndAddPath: function() {
                var a = this.canvas.contextTop;
                a.closePath();
                var b = this.convertPointsToSVGPath(this._points).join("");
                if ("M 0 0 Q 0 0 0 0 L 0 0" === b) return void this.canvas.renderAll();
                var c = this.createPath(b);
                this.canvas.add(c), c.setCoords(), this.canvas.clearContext(this.canvas.contextTop), this._resetShadow(), this.canvas.renderAll(), this.canvas.fire("path:created", {
                    path: c
                })
            }
        })
    }(), fabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, {
        width: 10,
        initialize: function(a) {
            this.canvas = a, this.points = []
        },
        drawDot: function(a) {
            var b = this.addPoint(a),
                c = this.canvas.contextTop,
                d = this.canvas.viewportTransform;
            c.save(), c.transform(d[0], d[1], d[2], d[3], d[4], d[5]), c.fillStyle = b.fill, c.beginPath(), c.arc(b.x, b.y, b.radius, 0, 2 * Math.PI, !1), c.closePath(), c.fill(), c.restore()
        },
        onMouseDown: function(a) {
            this.points.length = 0, this.canvas.clearContext(this.canvas.contextTop), this._setShadow(), this.drawDot(a)
        },
        onMouseMove: function(a) {
            this.drawDot(a)
        },
        onMouseUp: function() {
            var a = this.canvas.renderOnAddRemove;
            this.canvas.renderOnAddRemove = !1;
            for (var b = [], c = 0, d = this.points.length; d > c; c++) {
                var e = this.points[c],
                    f = new fabric.Circle({
                        radius: e.radius,
                        left: e.x,
                        top: e.y,
                        originX: "center",
                        originY: "center",
                        fill: e.fill
                    });
                this.shadow && f.setShadow(this.shadow), b.push(f)
            }
            var g = new fabric.Group(b, {
                originX: "center",
                originY: "center"
            });
            g.canvas = this.canvas, this.canvas.add(g), this.canvas.fire("path:created", {
                path: g
            }), this.canvas.clearContext(this.canvas.contextTop), this._resetShadow(), this.canvas.renderOnAddRemove = a, this.canvas.renderAll()
        },
        addPoint: function(a) {
            var b = new fabric.Point(a.x, a.y),
                c = fabric.util.getRandomInt(Math.max(0, this.width - 20), this.width + 20) / 2,
                d = new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0, 100) / 100).toRgba();
            return b.radius = c, b.fill = d, this.points.push(b), b
        }
    }), fabric.SprayBrush = fabric.util.createClass(fabric.BaseBrush, {
        width: 10,
        density: 20,
        dotWidth: 1,
        dotWidthVariance: 1,
        randomOpacity: !1,
        optimizeOverlapping: !0,
        initialize: function(a) {
            this.canvas = a, this.sprayChunks = []
        },
        onMouseDown: function(a) {
            this.sprayChunks.length = 0, this.canvas.clearContext(this.canvas.contextTop), this._setShadow(), this.addSprayChunk(a), this.render()
        },
        onMouseMove: function(a) {
            this.addSprayChunk(a), this.render()
        },
        onMouseUp: function() {
            var a = this.canvas.renderOnAddRemove;
            this.canvas.renderOnAddRemove = !1;
            for (var b = [], c = 0, d = this.sprayChunks.length; d > c; c++)
                for (var e = this.sprayChunks[c], f = 0, g = e.length; g > f; f++) {
                    var h = new fabric.Rect({
                        width: e[f].width,
                        height: e[f].width,
                        left: e[f].x + 1,
                        top: e[f].y + 1,
                        originX: "center",
                        originY: "center",
                        fill: this.color
                    });
                    this.shadow && h.setShadow(this.shadow), b.push(h)
                }
            this.optimizeOverlapping && (b = this._getOptimizedRects(b));
            var i = new fabric.Group(b, {
                originX: "center",
                originY: "center"
            });
            i.canvas = this.canvas, this.canvas.add(i), this.canvas.fire("path:created", {
                path: i
            }), this.canvas.clearContext(this.canvas.contextTop), this._resetShadow(), this.canvas.renderOnAddRemove = a, this.canvas.renderAll()
        },
        _getOptimizedRects: function(a) {
            for (var b, c = {}, d = 0, e = a.length; e > d; d++) b = a[d].left + "" + a[d].top, c[b] || (c[b] = a[d]);
            var f = [];
            for (b in c) f.push(c[b]);
            return f
        },
        render: function() {
            var a = this.canvas.contextTop;
            a.fillStyle = this.color;
            var b = this.canvas.viewportTransform;
            a.save(), a.transform(b[0], b[1], b[2], b[3], b[4], b[5]);
            for (var c = 0, d = this.sprayChunkPoints.length; d > c; c++) {
                var e = this.sprayChunkPoints[c];
                "undefined" != typeof e.opacity && (a.globalAlpha = e.opacity), a.fillRect(e.x, e.y, e.width, e.width)
            }
            a.restore()
        },
        addSprayChunk: function(a) {
            this.sprayChunkPoints = [];
            for (var b, c, d, e = this.width / 2, f = 0; f < this.density; f++) {
                b = fabric.util.getRandomInt(a.x - e, a.x + e), c = fabric.util.getRandomInt(a.y - e, a.y + e), d = this.dotWidthVariance ? fabric.util.getRandomInt(Math.max(1, this.dotWidth - this.dotWidthVariance), this.dotWidth + this.dotWidthVariance) : this.dotWidth;
                var g = new fabric.Point(b, c);
                g.width = d, this.randomOpacity && (g.opacity = fabric.util.getRandomInt(0, 100) / 100), this.sprayChunkPoints.push(g)
            }
            this.sprayChunks.push(this.sprayChunkPoints)
        }
    }), fabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, {
        getPatternSrc: function() {
            var a = 20,
                b = 5,
                c = fabric.document.createElement("canvas"),
                d = c.getContext("2d");
            return c.width = c.height = a + b, d.fillStyle = this.color, d.beginPath(), d.arc(a / 2, a / 2, a / 2, 0, 2 * Math.PI, !1), d.closePath(), d.fill(), c
        },
        getPatternSrcFunction: function() {
            return String(this.getPatternSrc).replace("this.color", '"' + this.color + '"')
        },
        getPattern: function() {
            return this.canvas.contextTop.createPattern(this.source || this.getPatternSrc(), "repeat")
        },
        _setBrushStyles: function() {
            this.callSuper("_setBrushStyles"), this.canvas.contextTop.strokeStyle = this.getPattern()
        },
        createPath: function(a) {
            var b = this.callSuper("createPath", a);
            return b.stroke = new fabric.Pattern({
                source: this.source || this.getPatternSrcFunction()
            }), b
        }
    }),
    function() {
        var a = fabric.util.getPointer,
            b = fabric.util.degreesToRadians,
            c = fabric.util.radiansToDegrees,
            d = Math.atan2,
            e = Math.abs,
            f = .5;
        fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, {
            initialize: function(a, b) {
                b || (b = {}), this._initStatic(a, b), this._initInteractive(), this._createCacheCanvas(), fabric.Canvas.activeInstance = this
            },
            uniScaleTransform: !1,
            centeredScaling: !1,
            centeredRotation: !1,
            interactive: !0,
            selection: !0,
            selectionColor: "rgba(100, 100, 255, 0.3)",
            selectionDashArray: [],
            selectionBorderColor: "rgba(255, 255, 255, 0.3)",
            selectionLineWidth: 1,
            hoverCursor: "move",
            moveCursor: "move",
            defaultCursor: "default",
            freeDrawingCursor: "crosshair",
            rotationCursor: "crosshair",
            containerClass: "canvas-container",
            perPixelTargetFind: !1,
            targetFindTolerance: 0,
            skipTargetFind: !1,
            isDrawingMode: !1,
            _initInteractive: function() {
                this._currentTransform = null, this._groupSelector = null, this._initWrapperElement(), this._createUpperCanvas(), this._initEventListeners(), this._initRetinaScaling(), this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this), this.calcOffset()
            },
            _resetCurrentTransform: function(a) {
                var b = this._currentTransform;
                b.target.set({
                    scaleX: b.original.scaleX,
                    scaleY: b.original.scaleY,
                    left: b.original.left,
                    top: b.original.top
                }), this._shouldCenterTransform(a, b.target) ? "rotate" === b.action ? this._setOriginToCenter(b.target) : ("center" !== b.originX && ("right" === b.originX ? b.mouseXSign = -1 : b.mouseXSign = 1), "center" !== b.originY && ("bottom" === b.originY ? b.mouseYSign = -1 : b.mouseYSign = 1), b.originX = "center", b.originY = "center") : (b.originX = b.original.originX, b.originY = b.original.originY)
            },
            containsPoint: function(a, b) {
                var c = this.getPointer(a, !0),
                    d = this._normalizePointer(b, c);
                return b.containsPoint(d) || b._findTargetCorner(c)
            },
            _normalizePointer: function(a, b) {
                var c, d = this.getActiveGroup(),
                    e = b.x,
                    f = b.y,
                    g = d && "group" !== a.type && d.contains(a);
                return g && (c = fabric.util.transformPoint(d.getCenterPoint(), this.viewportTransform, !0), e -= c.x, f -= c.y, e /= d.scaleX, f /= d.scaleY), {
                    x: e,
                    y: f
                }
            },
            isTargetTransparent: function(a, b, c) {
                var d = a.hasBorders,
                    e = a.transparentCorners;
                a.hasBorders = a.transparentCorners = !1, this._draw(this.contextCache, a), a.hasBorders = d, a.transparentCorners = e;
                var f = fabric.util.isTransparent(this.contextCache, b, c, this.targetFindTolerance);
                return this.clearContext(this.contextCache), f
            },
            _shouldClearSelection: function(a, b) {
                var c = this.getActiveGroup(),
                    d = this.getActiveObject();
                return !b || b && c && !c.contains(b) && c !== b && !a.shiftKey || b && !b.evented || b && !b.selectable && d && d !== b
            },
            _shouldCenterTransform: function(a, b) {
                if (b) {
                    var c, d = this._currentTransform;
                    return "scale" === d.action || "scaleX" === d.action || "scaleY" === d.action ? c = this.centeredScaling || b.centeredScaling : "rotate" === d.action && (c = this.centeredRotation || b.centeredRotation), c ? !a.altKey : a.altKey
                }
            },
            _getOriginFromCorner: function(a, b) {
                var c = {
                    x: a.originX,
                    y: a.originY
                };
                return "ml" === b || "tl" === b || "bl" === b ? c.x = "right" : "mr" !== b && "tr" !== b && "br" !== b || (c.x = "left"), "tl" === b || "mt" === b || "tr" === b ? c.y = "bottom" : "bl" !== b && "mb" !== b && "br" !== b || (c.y = "top"), c
            },
            _getActionFromCorner: function(a, b) {
                var c = "drag";
                return b && (c = "ml" === b || "mr" === b ? "scaleX" : "mt" === b || "mb" === b ? "scaleY" : "mtr" === b ? "rotate" : "scale"), c
            },
            _setupCurrentTransform: function(a, c) {
                if (c) {
                    var d = this.getPointer(a),
                        e = c._findTargetCorner(this.getPointer(a, !0)),
                        f = this._getActionFromCorner(c, e),
                        g = this._getOriginFromCorner(c, e);
                    this._currentTransform = {
                        target: c,
                        action: f,
                        scaleX: c.scaleX,
                        scaleY: c.scaleY,
                        offsetX: d.x - c.left,
                        offsetY: d.y - c.top,
                        originX: g.x,
                        originY: g.y,
                        ex: d.x,
                        ey: d.y,
                        left: c.left,
                        top: c.top,
                        theta: b(c.angle),
                        width: c.width * c.scaleX,
                        mouseXSign: 1,
                        mouseYSign: 1
                    }, this._currentTransform.original = {
                        left: c.left,
                        top: c.top,
                        scaleX: c.scaleX,
                        scaleY: c.scaleY,
                        originX: g.x,
                        originY: g.y
                    }, this._resetCurrentTransform(a)
                }
            },
            _translateObject: function(a, b) {
                var c = this._currentTransform.target;
                c.get("lockMovementX") || c.set("left", a - this._currentTransform.offsetX), c.get("lockMovementY") || c.set("top", b - this._currentTransform.offsetY)
            },
            _scaleObject: function(a, b, c) {
                var d = this._currentTransform,
                    e = d.target,
                    f = e.get("lockScalingX"),
                    g = e.get("lockScalingY"),
                    h = e.get("lockScalingFlip");
                if (!f || !g) {
                    var i = e.translateToOriginPoint(e.getCenterPoint(), d.originX, d.originY),
                        j = e.toLocalPoint(new fabric.Point(a, b), d.originX, d.originY);
                    this._setLocalMouse(j, d), this._setObjectScale(j, d, f, g, c, h), e.setPositionByOrigin(i, d.originX, d.originY)
                }
            },
            _setObjectScale: function(a, b, c, d, e, f) {
                var g = b.target,
                    h = !1,
                    i = !1,
                    j = g._getNonTransformedDimensions();
                b.newScaleX = a.x / j.x, b.newScaleY = a.y / j.y, f && b.newScaleX <= 0 && b.newScaleX < g.scaleX && (h = !0), f && b.newScaleY <= 0 && b.newScaleY < g.scaleY && (i = !0), "equally" !== e || c || d ? e ? "x" !== e || g.get("lockUniScaling") ? "y" !== e || g.get("lockUniScaling") || i || d || g.set("scaleY", b.newScaleY) : h || c || g.set("scaleX", b.newScaleX) : (h || c || g.set("scaleX", b.newScaleX), i || d || g.set("scaleY", b.newScaleY)) : h || i || this._scaleObjectEqually(a, g, b), h || i || this._flipObject(b, e)
            },
            _scaleObjectEqually: function(a, b, c) {
                var d = a.y + a.x,
                    e = b._getNonTransformedDimensions(),
                    f = e.y * c.original.scaleY + e.x * c.original.scaleX;
                c.newScaleX = c.original.scaleX * d / f, c.newScaleY = c.original.scaleY * d / f, b.set("scaleX", c.newScaleX), b.set("scaleY", c.newScaleY)
            },
            _flipObject: function(a, b) {
                a.newScaleX < 0 && "y" !== b && ("left" === a.originX ? a.originX = "right" : "right" === a.originX && (a.originX = "left")), a.newScaleY < 0 && "x" !== b && ("top" === a.originY ? a.originY = "bottom" : "bottom" === a.originY && (a.originY = "top"))
            },
            _setLocalMouse: function(a, b) {
                var c = b.target;
                "right" === b.originX ? a.x *= -1 : "center" === b.originX && (a.x *= 2 * b.mouseXSign, a.x < 0 && (b.mouseXSign = -b.mouseXSign)), "bottom" === b.originY ? a.y *= -1 : "center" === b.originY && (a.y *= 2 * b.mouseYSign, a.y < 0 && (b.mouseYSign = -b.mouseYSign)), e(a.x) > c.padding ? a.x < 0 ? a.x += c.padding : a.x -= c.padding : a.x = 0, e(a.y) > c.padding ? a.y < 0 ? a.y += c.padding : a.y -= c.padding : a.y = 0
            },
            _rotateObject: function(a, b) {
                var e = this._currentTransform;
                if (!e.target.get("lockRotation")) {
                    var f = d(e.ey - e.top, e.ex - e.left),
                        g = d(b - e.top, a - e.left),
                        h = c(g - f + e.theta);
                    0 > h && (h = 360 + h), e.target.angle = h % 360
                }
            },
            setCursor: function(a) {
                this.upperCanvasEl.style.cursor = a
            },
            _resetObjectTransform: function(a) {
                a.scaleX = 1, a.scaleY = 1, a.setAngle(0)
            },
            _drawSelection: function() {
                var a = this.contextTop,
                    b = this._groupSelector,
                    c = b.left,
                    d = b.top,
                    g = e(c),
                    h = e(d);
                if (a.fillStyle = this.selectionColor, a.fillRect(b.ex - (c > 0 ? 0 : -c), b.ey - (d > 0 ? 0 : -d), g, h), a.lineWidth = this.selectionLineWidth, a.strokeStyle = this.selectionBorderColor, this.selectionDashArray.length > 1) {
                    var i = b.ex + f - (c > 0 ? 0 : g),
                        j = b.ey + f - (d > 0 ? 0 : h);
                    a.beginPath(), fabric.util.drawDashedLine(a, i, j, i + g, j, this.selectionDashArray), fabric.util.drawDashedLine(a, i, j + h - 1, i + g, j + h - 1, this.selectionDashArray), fabric.util.drawDashedLine(a, i, j, i, j + h, this.selectionDashArray), fabric.util.drawDashedLine(a, i + g - 1, j, i + g - 1, j + h, this.selectionDashArray), a.closePath(), a.stroke()
                } else a.strokeRect(b.ex + f - (c > 0 ? 0 : g), b.ey + f - (d > 0 ? 0 : h), g, h)
            },
            _isLastRenderedObject: function(a) {
                return this.controlsAboveOverlay && this.lastRenderedObjectWithControlsAboveOverlay && this.lastRenderedObjectWithControlsAboveOverlay.visible && this.containsPoint(a, this.lastRenderedObjectWithControlsAboveOverlay) && this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a, !0))
            },
            findTarget: function(a, b) {
                if (!this.skipTargetFind) {
                    if (this._isLastRenderedObject(a)) return this.lastRenderedObjectWithControlsAboveOverlay;
                    var c = this.getActiveGroup();
                    if (c && !b && this.containsPoint(a, c)) return c;
                    var d = this._searchPossibleTargets(a, b);
                    return this._fireOverOutEvents(d, a), d
                }
            },
            _fireOverOutEvents: function(a, b) {
                a ? this._hoveredTarget !== a && (this._hoveredTarget && (this.fire("mouse:out", {
                    target: this._hoveredTarget,
                    e: b
                }), this._hoveredTarget.fire("mouseout")), this.fire("mouse:over", {
                    target: a,
                    e: b
                }), a.fire("mouseover"), this._hoveredTarget = a) : this._hoveredTarget && (this.fire("mouse:out", {
                    target: this._hoveredTarget,
                    e: b
                }), this._hoveredTarget.fire("mouseout"), this._hoveredTarget = null)
            },
            _checkTarget: function(a, b, c) {
                if (b && b.visible && b.evented && this.containsPoint(a, b)) {
                    if (!this.perPixelTargetFind && !b.perPixelTargetFind || b.isEditing) return !0;
                    var d = this.isTargetTransparent(b, c.x, c.y);
                    if (!d) return !0
                }
            },
            _searchPossibleTargets: function(a, b) {
                for (var c, d = this.getPointer(a, !0), e = this._objects.length; e--;)
                    if ((!this._objects[e].group || b) && this._checkTarget(a, this._objects[e], d)) {
                        this.relatedTarget = this._objects[e], c = this._objects[e];
                        break
                    }
                return c
            },
            getPointer: function(b, c, d) {
                d || (d = this.upperCanvasEl);
                var e, f = a(b),
                    g = d.getBoundingClientRect(),
                    h = g.width || 0,
                    i = g.height || 0;
                return h && i || ("top" in g && "bottom" in g && (i = Math.abs(g.top - g.bottom)), "right" in g && "left" in g && (h = Math.abs(g.right - g.left))), this.calcOffset(), f.x = f.x - this._offset.left, f.y = f.y - this._offset.top, c || (f = fabric.util.transformPoint(f, fabric.util.invertTransform(this.viewportTransform))), e = 0 === h || 0 === i ? {
                    width: 1,
                    height: 1
                } : {
                    width: d.width / h,
                    height: d.height / i
                }, {
                    x: f.x * e.width,
                    y: f.y * e.height
                }
            },
            _createUpperCanvas: function() {
                var a = this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/, "");
                this.upperCanvasEl = this._createCanvasElement(), fabric.util.addClass(this.upperCanvasEl, "upper-canvas " + a), this.wrapperEl.appendChild(this.upperCanvasEl), this._copyCanvasStyle(this.lowerCanvasEl, this.upperCanvasEl), this._applyCanvasStyle(this.upperCanvasEl), this.contextTop = this.upperCanvasEl.getContext("2d")
            },
            _createCacheCanvas: function() {
                this.cacheCanvasEl = this._createCanvasElement(), this.cacheCanvasEl.setAttribute("width", this.width), this.cacheCanvasEl.setAttribute("height", this.height), this.contextCache = this.cacheCanvasEl.getContext("2d")
            },
            _initWrapperElement: function() {
                this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, "div", {
                    "class": this.containerClass
                }), fabric.util.setStyle(this.wrapperEl, {
                    width: this.getWidth() + "px",
                    height: this.getHeight() + "px",
                    position: "relative"
                }), fabric.util.makeElementUnselectable(this.wrapperEl)
            },
            _applyCanvasStyle: function(a) {
                var b = this.getWidth() || a.width,
                    c = this.getHeight() || a.height;
                fabric.util.setStyle(a, {
                    position: "absolute",
                    width: b + "px",
                    height: c + "px",
                    left: 0,
                    top: 0
                }), a.width = b, a.height = c, fabric.util.makeElementUnselectable(a)
            },
            _copyCanvasStyle: function(a, b) {
                b.style.cssText = a.style.cssText
            },
            getSelectionContext: function() {
                return this.contextTop
            },
            getSelectionElement: function() {
                return this.upperCanvasEl
            },
            _setActiveObject: function(a) {
                this._activeObject && this._activeObject.set("active", !1), this._activeObject = a, a.set("active", !0)
            },
            setActiveObject: function(a, b) {
                return this._setActiveObject(a), this.renderAll(), this.fire("object:selected", {
                    target: a,
                    e: b
                }), a.fire("selected", {
                    e: b
                }), this
            },
            getActiveObject: function() {
                return this._activeObject
            },
            _discardActiveObject: function() {
                this._activeObject && this._activeObject.set("active", !1), this._activeObject = null
            },
            discardActiveObject: function(a) {
                return this._discardActiveObject(), this.renderAll(), this.fire("selection:cleared", {
                    e: a
                }), this
            },
            _setActiveGroup: function(a) {
                this._activeGroup = a, a && a.set("active", !0)
            },
            setActiveGroup: function(a, b) {
                return this._setActiveGroup(a), a && (this.fire("object:selected", {
                    target: a,
                    e: b
                }), a.fire("selected", {
                    e: b
                })), this
            },
            getActiveGroup: function() {
                return this._activeGroup
            },
            _discardActiveGroup: function() {
                var a = this.getActiveGroup();
                a && a.destroy(), this.setActiveGroup(null)
            },
            discardActiveGroup: function(a) {
                return this._discardActiveGroup(), this.fire("selection:cleared", {
                    e: a
                }), this
            },
            deactivateAll: function() {
                for (var a = this.getObjects(), b = 0, c = a.length; c > b; b++) a[b].set("active", !1);
                return this._discardActiveGroup(), this._discardActiveObject(), this
            },
            deactivateAllWithDispatch: function(a) {
                var b = this.getActiveGroup() || this.getActiveObject();
                return b && this.fire("before:selection:cleared", {
                    target: b,
                    e: a
                }), this.deactivateAll(), b && this.fire("selection:cleared", {
                    e: a
                }), this
            },
            drawControls: function(a) {
                var b = this.getActiveGroup();
                b ? this._drawGroupControls(a, b) : this._drawObjectsControls(a)
            },
            _drawGroupControls: function(a, b) {
                b._renderControls(a)
            },
            _drawObjectsControls: function(a) {
                for (var b = 0, c = this._objects.length; c > b; ++b) this._objects[b] && this._objects[b].active && (this._objects[b]._renderControls(a), this.lastRenderedObjectWithControlsAboveOverlay = this._objects[b])
            }
        });
        for (var g in fabric.StaticCanvas) "prototype" !== g && (fabric.Canvas[g] = fabric.StaticCanvas[g]);
        fabric.isTouchSupported && (fabric.Canvas.prototype._setCursorFromEvent = function() {}), fabric.Element = fabric.Canvas
    }(),
    function() {
        var a = {
                mt: 0,
                tr: 1,
                mr: 2,
                br: 3,
                mb: 4,
                bl: 5,
                ml: 6,
                tl: 7
            },
            b = fabric.util.addListener,
            c = fabric.util.removeListener;
        fabric.util.object.extend(fabric.Canvas.prototype, {
            cursorMap: ["n-resize", "ne-resize", "e-resize", "se-resize", "s-resize", "sw-resize", "w-resize", "nw-resize"],
            _initEventListeners: function() {
                this._bindEvents(), b(fabric.window, "resize", this._onResize), b(this.upperCanvasEl, "mousedown", this._onMouseDown), b(this.upperCanvasEl, "mousemove", this._onMouseMove), b(this.upperCanvasEl, "mousewheel", this._onMouseWheel), b(this.upperCanvasEl, "touchstart", this._onMouseDown), b(this.upperCanvasEl, "touchmove", this._onMouseMove), "undefined" != typeof eventjs && "add" in eventjs && (eventjs.add(this.upperCanvasEl, "gesture", this._onGesture), eventjs.add(this.upperCanvasEl, "drag", this._onDrag), eventjs.add(this.upperCanvasEl, "orientation", this._onOrientationChange), eventjs.add(this.upperCanvasEl, "shake", this._onShake), eventjs.add(this.upperCanvasEl, "longpress", this._onLongPress))
            },
            _bindEvents: function() {
                this._onMouseDown = this._onMouseDown.bind(this), this._onMouseMove = this._onMouseMove.bind(this), this._onMouseUp = this._onMouseUp.bind(this), this._onResize = this._onResize.bind(this), this._onGesture = this._onGesture.bind(this), this._onDrag = this._onDrag.bind(this), this._onShake = this._onShake.bind(this), this._onLongPress = this._onLongPress.bind(this), this._onOrientationChange = this._onOrientationChange.bind(this), this._onMouseWheel = this._onMouseWheel.bind(this)
            },
            removeListeners: function() {
                c(fabric.window, "resize", this._onResize), c(this.upperCanvasEl, "mousedown", this._onMouseDown), c(this.upperCanvasEl, "mousemove", this._onMouseMove), c(this.upperCanvasEl, "mousewheel", this._onMouseWheel), c(this.upperCanvasEl, "touchstart", this._onMouseDown), c(this.upperCanvasEl, "touchmove", this._onMouseMove), "undefined" != typeof eventjs && "remove" in eventjs && (eventjs.remove(this.upperCanvasEl, "gesture", this._onGesture), eventjs.remove(this.upperCanvasEl, "drag", this._onDrag), eventjs.remove(this.upperCanvasEl, "orientation", this._onOrientationChange), eventjs.remove(this.upperCanvasEl, "shake", this._onShake), eventjs.remove(this.upperCanvasEl, "longpress", this._onLongPress))
            },
            _onGesture: function(a, b) {
                this.__onTransformGesture && this.__onTransformGesture(a, b)
            },
            _onDrag: function(a, b) {
                this.__onDrag && this.__onDrag(a, b)
            },
            _onMouseWheel: function(a, b) {
                this.__onMouseWheel && this.__onMouseWheel(a, b)
            },
            _onOrientationChange: function(a, b) {
                this.__onOrientationChange && this.__onOrientationChange(a, b)
            },
            _onShake: function(a, b) {
                this.__onShake && this.__onShake(a, b)
            },
            _onLongPress: function(a, b) {
                this.__onLongPress && this.__onLongPress(a, b)
            },
            _onMouseDown: function(a) {
                this.__onMouseDown(a), b(fabric.document, "touchend", this._onMouseUp), b(fabric.document, "touchmove", this._onMouseMove), c(this.upperCanvasEl, "mousemove", this._onMouseMove), c(this.upperCanvasEl, "touchmove", this._onMouseMove), "touchstart" === a.type ? c(this.upperCanvasEl, "mousedown", this._onMouseDown) : (b(fabric.document, "mouseup", this._onMouseUp), b(fabric.document, "mousemove", this._onMouseMove))
            },
            _onMouseUp: function(a) {
                if (this.__onMouseUp(a), c(fabric.document, "mouseup", this._onMouseUp), c(fabric.document, "touchend", this._onMouseUp), c(fabric.document, "mousemove", this._onMouseMove), c(fabric.document, "touchmove", this._onMouseMove), b(this.upperCanvasEl, "mousemove", this._onMouseMove), b(this.upperCanvasEl, "touchmove", this._onMouseMove), "touchend" === a.type) {
                    var d = this;
                    setTimeout(function() {
                        b(d.upperCanvasEl, "mousedown", d._onMouseDown)
                    }, 400)
                }
            },
            _onMouseMove: function(a) {
                !this.allowTouchScrolling && a.preventDefault && a.preventDefault(), this.__onMouseMove(a)
            },
            _onResize: function() {
                this.calcOffset()
            },
            _shouldRender: function(a, b) {
                var c = this.getActiveGroup() || this.getActiveObject();
                return !!(a && (a.isMoving || a !== c) || !a && c || !a && !c && !this._groupSelector || b && this._previousPointer && this.selection && (b.x !== this._previousPointer.x || b.y !== this._previousPointer.y))
            },
            __onMouseUp: function(a) {
                var b;
                if (this.isDrawingMode && this._isCurrentlyDrawing) return void this._onMouseUpInDrawingMode(a);
                this._currentTransform ? (this._finalizeCurrentTransform(), b = this._currentTransform.target) : b = this.findTarget(a, !0);
                var c = this._shouldRender(b, this.getPointer(a));
                this._maybeGroupObjects(a), b && (b.isMoving = !1), c && this.renderAll(), this._handleCursorAndEvent(a, b)
            },
            _handleCursorAndEvent: function(a, b) {
                this._setCursorFromEvent(a, b);
                var c = this;
                setTimeout(function() {
                    c._setCursorFromEvent(a, b)
                }, 50), this.fire("mouse:up", {
                    target: b,
                    e: a
                }), b && b.fire("mouseup", {
                    e: a
                })
            },
            _finalizeCurrentTransform: function() {
                var a = this._currentTransform,
                    b = a.target;
                b._scaling && (b._scaling = !1), b.setCoords(), this.stateful && b.hasStateChanged() && (this.fire("object:modified", {
                    target: b
                }), b.fire("modified")), this._restoreOriginXY(b)
            },
            _restoreOriginXY: function(a) {
                if (this._previousOriginX && this._previousOriginY) {
                    var b = a.translateToOriginPoint(a.getCenterPoint(), this._previousOriginX, this._previousOriginY);
                    a.originX = this._previousOriginX, a.originY = this._previousOriginY, a.left = b.x, a.top = b.y, this._previousOriginX = null, this._previousOriginY = null
                }
            },
            _onMouseDownInDrawingMode: function(a) {
                this._isCurrentlyDrawing = !0, this.discardActiveObject(a).renderAll(), this.clipTo && fabric.util.clipContext(this, this.contextTop);
                var b = fabric.util.invertTransform(this.viewportTransform),
                    c = fabric.util.transformPoint(this.getPointer(a, !0), b);
                this.freeDrawingBrush.onMouseDown(c), this.fire("mouse:down", {
                    e: a
                });
                var d = this.findTarget(a);
                "undefined" != typeof d && d.fire("mousedown", {
                    e: a,
                    target: d
                })
            },
            _onMouseMoveInDrawingMode: function(a) {
                if (this._isCurrentlyDrawing) {
                    var b = fabric.util.invertTransform(this.viewportTransform),
                        c = fabric.util.transformPoint(this.getPointer(a, !0), b);
                    this.freeDrawingBrush.onMouseMove(c)
                }
                this.setCursor(this.freeDrawingCursor), this.fire("mouse:move", {
                    e: a
                });
                var d = this.findTarget(a);
                "undefined" != typeof d && d.fire("mousemove", {
                    e: a,
                    target: d
                })
            },
            _onMouseUpInDrawingMode: function(a) {
                this._isCurrentlyDrawing = !1, this.clipTo && this.contextTop.restore(), this.freeDrawingBrush.onMouseUp(), this.fire("mouse:up", {
                    e: a
                });
                var b = this.findTarget(a);
                "undefined" != typeof b && b.fire("mouseup", {
                    e: a,
                    target: b
                })
            },
            __onMouseDown: function(a) {
                var b = "which" in a ? 1 === a.which : 1 === a.button;
                if (b || fabric.isTouchSupported) {
                    if (this.isDrawingMode) return void this._onMouseDownInDrawingMode(a);
                    if (!this._currentTransform) {
                        var c = this.findTarget(a),
                            d = this.getPointer(a, !0);
                        this._previousPointer = d;
                        var e = this._shouldRender(c, d),
                            f = this._shouldGroup(a, c);
                        this._shouldClearSelection(a, c) ? this._clearSelection(a, c, d) : f && (this._handleGrouping(a, c), c = this.getActiveGroup()), c && c.selectable && !f && (this._beforeTransform(a, c), this._setupCurrentTransform(a, c)), e && this.renderAll(), this.fire("mouse:down", {
                            target: c,
                            e: a
                        }), c && c.fire("mousedown", {
                            e: a
                        })
                    }
                }
            },
            _beforeTransform: function(a, b) {
                this.stateful && b.saveState(), b._findTargetCorner(this.getPointer(a)) && this.onBeforeScaleRotate(b), b !== this.getActiveGroup() && b !== this.getActiveObject() && (this.deactivateAll(), this.setActiveObject(b, a))
            },
            _clearSelection: function(a, b, c) {
                this.deactivateAllWithDispatch(a), b && b.selectable ? this.setActiveObject(b, a) : this.selection && (this._groupSelector = {
                    ex: c.x,
                    ey: c.y,
                    top: 0,
                    left: 0
                })
            },
            _setOriginToCenter: function(a) {
                this._previousOriginX = this._currentTransform.target.originX, this._previousOriginY = this._currentTransform.target.originY;
                var b = a.getCenterPoint();
                a.originX = "center", a.originY = "center", a.left = b.x, a.top = b.y, this._currentTransform.left = a.left, this._currentTransform.top = a.top
            },
            _setCenterToOrigin: function(a) {
                var b = a.translateToOriginPoint(a.getCenterPoint(), this._previousOriginX, this._previousOriginY);
                a.originX = this._previousOriginX, a.originY = this._previousOriginY, a.left = b.x, a.top = b.y, this._previousOriginX = null, this._previousOriginY = null
            },
            __onMouseMove: function(a) {
                var b, c;
                if (this.isDrawingMode) return void this._onMouseMoveInDrawingMode(a);
                if (!("undefined" != typeof a.touches && a.touches.length > 1)) {
                    var d = this._groupSelector;
                    d ? (c = this.getPointer(a, !0), d.left = c.x - d.ex, d.top = c.y - d.ey, this.renderTop()) : this._currentTransform ? this._transformObject(a) : (b = this.findTarget(a), !b || b && !b.selectable ? this.setCursor(this.defaultCursor) : this._setCursorFromEvent(a, b)), this.fire("mouse:move", {
                        target: b,
                        e: a
                    }), b && b.fire("mousemove", {
                        e: a
                    })
                }
            },
            _transformObject: function(a) {
                var b = this.getPointer(a),
                    c = this._currentTransform;
                c.reset = !1, c.target.isMoving = !0, this._beforeScaleTransform(a, c), this._performTransformAction(a, c, b), this.renderAll()
            },
            _performTransformAction: function(a, b, c) {
                var d = c.x,
                    e = c.y,
                    f = b.target,
                    g = b.action;
                "rotate" === g ? (this._rotateObject(d, e), this._fire("rotating", f, a)) : "scale" === g ? (this._onScale(a, b, d, e), this._fire("scaling", f, a)) : "scaleX" === g ? (this._scaleObject(d, e, "x"), this._fire("scaling", f, a)) : "scaleY" === g ? (this._scaleObject(d, e, "y"), this._fire("scaling", f, a)) : (this._translateObject(d, e), this._fire("moving", f, a), this.setCursor(this.moveCursor))
            },
            _fire: function(a, b, c) {
                this.fire("object:" + a, {
                    target: b,
                    e: c
                }), b.fire(a, {
                    e: c
                })
            },
            _beforeScaleTransform: function(a, b) {
                if ("scale" === b.action || "scaleX" === b.action || "scaleY" === b.action) {
                    var c = this._shouldCenterTransform(a, b.target);
                    (c && ("center" !== b.originX || "center" !== b.originY) || !c && "center" === b.originX && "center" === b.originY) && (this._resetCurrentTransform(a), b.reset = !0)
                }
            },
            _onScale: function(a, b, c, d) {
                !a.shiftKey && !this.uniScaleTransform || b.target.get("lockUniScaling") ? (b.reset || "scale" !== b.currentAction || this._resetCurrentTransform(a, b.target), b.currentAction = "scaleEqually", this._scaleObject(c, d, "equally")) : (b.currentAction = "scale", this._scaleObject(c, d))
            },
            _setCursorFromEvent: function(a, b) {
                if (!b || !b.selectable) return this.setCursor(this.defaultCursor), !1;
                var c = this.getActiveGroup(),
                    d = b._findTargetCorner && (!c || !c.contains(b)) && b._findTargetCorner(this.getPointer(a, !0));
                return d ? this._setCornerCursor(d, b) : this.setCursor(b.hoverCursor || this.hoverCursor), !0
            },
            _setCornerCursor: function(b, c) {
                if (b in a) this.setCursor(this._getRotatedCornerCursor(b, c));
                else {
                    if ("mtr" !== b || !c.hasRotatingPoint) return this.setCursor(this.defaultCursor), !1;
                    this.setCursor(this.rotationCursor)
                }
            },
            _getRotatedCornerCursor: function(b, c) {
                var d = Math.round(c.getAngle() % 360 / 45);
                return 0 > d && (d += 8), d += a[b], d %= 8, this.cursorMap[d]
            }
        })
    }(),
    function() {
        var a = Math.min,
            b = Math.max;
        fabric.util.object.extend(fabric.Canvas.prototype, {
            _shouldGroup: function(a, b) {
                var c = this.getActiveObject();
                return a.shiftKey && (this.getActiveGroup() || c && c !== b) && this.selection
            },
            _handleGrouping: function(a, b) {
                b === this.getActiveGroup() && (b = this.findTarget(a, !0), !b || b.isType("group")) || (this.getActiveGroup() ? this._updateActiveGroup(b, a) : this._createActiveGroup(b, a), this._activeGroup && this._activeGroup.saveCoords())
            },
            _updateActiveGroup: function(a, b) {
                var c = this.getActiveGroup();
                if (c.contains(a)) {
                    if (c.removeWithUpdate(a), this._resetObjectTransform(c), a.set("active", !1), 1 === c.size()) return this.discardActiveGroup(b), void this.setActiveObject(c.item(0))
                } else c.addWithUpdate(a), this._resetObjectTransform(c);
                this.fire("selection:created", {
                    target: c,
                    e: b
                }), c.set("active", !0)
            },
            _createActiveGroup: function(a, b) {
                if (this._activeObject && a !== this._activeObject) {
                    var c = this._createGroup(a);
                    c.addWithUpdate(), this.setActiveGroup(c), this._activeObject = null, this.fire("selection:created", {
                        target: c,
                        e: b
                    })
                }
                a.set("active", !0)
            },
            _createGroup: function(a) {
                var b = this.getObjects(),
                    c = b.indexOf(this._activeObject) < b.indexOf(a),
                    d = c ? [this._activeObject, a] : [a, this._activeObject];
                return new fabric.Group(d, {
                    canvas: this
                })
            },
            _groupSelectedObjects: function(a) {
                var b = this._collectObjects();
                1 === b.length ? this.setActiveObject(b[0], a) : b.length > 1 && (b = new fabric.Group(b.reverse(), {
                    canvas: this
                }), b.addWithUpdate(), this.setActiveGroup(b, a), b.saveCoords(), this.fire("selection:created", {
                    target: b
                }), this.renderAll())
            },
            _collectObjects: function() {
                for (var c, d = [], e = this._groupSelector.ex, f = this._groupSelector.ey, g = e + this._groupSelector.left, h = f + this._groupSelector.top, i = new fabric.Point(a(e, g), a(f, h)), j = new fabric.Point(b(e, g), b(f, h)), k = e === g && f === h, l = this._objects.length; l-- && (c = this._objects[l], !(c && c.selectable && c.visible && (c.intersectsWithRect(i, j) || c.isContainedWithinRect(i, j) || c.containsPoint(i) || c.containsPoint(j)) && (c.set("active", !0), d.push(c), k))););
                return d
            },
            _maybeGroupObjects: function(a) {
                this.selection && this._groupSelector && this._groupSelectedObjects(a);
                var b = this.getActiveGroup();
                b && (b.setObjectsCoords().setCoords(), b.isMoving = !1, this.setCursor(this.defaultCursor)), this._groupSelector = null, this._currentTransform = null
            }
        })
    }(), fabric.util.object.extend(fabric.StaticCanvas.prototype, {
        toDataURL: function(a) {
            a || (a = {});
            var b = a.format || "png",
                c = a.quality || 1,
                d = a.multiplier || 1,
                e = {
                    left: a.left,
                    top: a.top,
                    width: a.width,
                    height: a.height
                };
            return 1 !== d ? this.__toDataURLWithMultiplier(b, c, e, d) : this.__toDataURL(b, c, e)
        },
        __toDataURL: function(a, b, c) {
            this.renderAll(!0);
            var d = this.upperCanvasEl || this.lowerCanvasEl,
                e = this.__getCroppedCanvas(d, c);
            "jpg" === a && (a = "jpeg");
            var f = fabric.StaticCanvas.supports("toDataURLWithQuality") ? (e || d).toDataURL("image/" + a, b) : (e || d).toDataURL("image/" + a);
            return this.contextTop && this.clearContext(this.contextTop), this.renderAll(), e && (e = null), f
        },
        __getCroppedCanvas: function(a, b) {
            var c, d, e = "left" in b || "top" in b || "width" in b || "height" in b;
            return e && (c = fabric.util.createCanvasElement(), d = c.getContext("2d"), c.width = b.width || this.width, c.height = b.height || this.height, d.drawImage(a, -b.left || 0, -b.top || 0)), c
        },
        __toDataURLWithMultiplier: function(a, b, c, d) {
            var e = this.getWidth(),
                f = this.getHeight(),
                g = e * d,
                h = f * d,
                i = this.getActiveObject(),
                j = this.getActiveGroup(),
                k = this.contextTop || this.contextContainer;
            d > 1 && this.setWidth(g).setHeight(h), k.scale(d, d), c.left && (c.left *= d), c.top && (c.top *= d), c.width ? c.width *= d : 1 > d && (c.width = g), c.height ? c.height *= d : 1 > d && (c.height = h), j ? this._tempRemoveBordersControlsFromGroup(j) : i && this.deactivateAll && this.deactivateAll(), this.renderAll(!0);
            var l = this.__toDataURL(a, b, c);
            return this.width = e, this.height = f, k.scale(1 / d, 1 / d), this.setWidth(e).setHeight(f), j ? this._restoreBordersControlsOnGroup(j) : i && this.setActiveObject && this.setActiveObject(i), this.contextTop && this.clearContext(this.contextTop), this.renderAll(), l
        },
        toDataURLWithMultiplier: function(a, b, c) {
            return this.toDataURL({
                format: a,
                multiplier: b,
                quality: c
            })
        },
        _tempRemoveBordersControlsFromGroup: function(a) {
            a.origHasControls = a.hasControls, a.origBorderColor = a.borderColor, a.hasControls = !0, a.borderColor = "rgba(0,0,0,0)", a.forEachObject(function(a) {
                a.origBorderColor = a.borderColor, a.borderColor = "rgba(0,0,0,0)"
            })
        },
        _restoreBordersControlsOnGroup: function(a) {
            a.hideControls = a.origHideControls, a.borderColor = a.origBorderColor, a.forEachObject(function(a) {
                a.borderColor = a.origBorderColor, delete a.origBorderColor
            })
        }
    }), fabric.util.object.extend(fabric.StaticCanvas.prototype, {
        loadFromDatalessJSON: function(a, b, c) {
            return this.loadFromJSON(a, b, c)
        },
        loadFromJSON: function(a, b, c) {
            if (a) {
                var d = "string" == typeof a ? JSON.parse(a) : a;
                this.clear();
                var e = this;
                return this._enlivenObjects(d.objects, function() {
                    e._setBgOverlay(d, b)
                }, c), this
            }
        },
        _setBgOverlay: function(a, b) {
            var c = this,
                d = {
                    backgroundColor: !1,
                    overlayColor: !1,
                    backgroundImage: !1,
                    overlayImage: !1
                };
            if (!(a.backgroundImage || a.overlayImage || a.background || a.overlay)) return void(b && b());
            var e = function() {
                d.backgroundImage && d.overlayImage && d.backgroundColor && d.overlayColor && (c.renderAll(), b && b())
            };
            this.__setBgOverlay("backgroundImage", a.backgroundImage, d, e), this.__setBgOverlay("overlayImage", a.overlayImage, d, e), this.__setBgOverlay("backgroundColor", a.background, d, e), this.__setBgOverlay("overlayColor", a.overlay, d, e), e()
        },
        __setBgOverlay: function(a, b, c, d) {
            var e = this;
            return b ? void("backgroundImage" === a || "overlayImage" === a ? fabric.Image.fromObject(b, function(b) {
                e[a] = b, c[a] = !0, d && d()
            }) : this["set" + fabric.util.string.capitalize(a, !0)](b, function() {
                c[a] = !0, d && d()
            })) : void(c[a] = !0)
        },
        _enlivenObjects: function(a, b, c) {
            var d = this;
            if (!a || 0 === a.length) return void(b && b());
            var e = this.renderOnAddRemove;
            this.renderOnAddRemove = !1, fabric.util.enlivenObjects(a, function(a) {
                a.forEach(function(a, b) {
                    d.insertAt(a, b, !0)
                }), d.renderOnAddRemove = e, b && b()
            }, null, c)
        },
        _toDataURL: function(a, b) {
            this.clone(function(c) {
                b(c.toDataURL(a))
            })
        },
        _toDataURLWithMultiplier: function(a, b, c) {
            this.clone(function(d) {
                c(d.toDataURLWithMultiplier(a, b))
            })
        },
        clone: function(a, b) {
            var c = JSON.stringify(this.toJSON(b));
            this.cloneWithoutData(function(b) {
                b.loadFromJSON(c, function() {
                    a && a(b)
                })
            })
        },
        cloneWithoutData: function(a) {
            var b = fabric.document.createElement("canvas");
            b.width = this.getWidth(), b.height = this.getHeight();
            var c = new fabric.Canvas(b);
            c.clipTo = this.clipTo, this.backgroundImage ? (c.setBackgroundImage(this.backgroundImage.src, function() {
                c.renderAll(), a && a(c)
            }), c.backgroundImageOpacity = this.backgroundImageOpacity, c.backgroundImageStretch = this.backgroundImageStretch) : a && a(c)
        }
    }),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend,
            d = b.util.toFixed,
            e = b.util.string.capitalize,
            f = b.util.degreesToRadians,
            g = b.StaticCanvas.supports("setLineDash");
        b.Object || (b.Object = b.util.createClass({
            type: "object",
            originX: "left",
            originY: "top",
            top: 0,
            left: 0,
            width: 0,
            height: 0,
            scaleX: 1,
            scaleY: 1,
            flipX: !1,
            flipY: !1,
            opacity: 1,
            angle: 0,
            cornerSize: 12,
            transparentCorners: !0,
            hoverCursor: null,
            padding: 0,
            borderColor: "rgba(102,153,255,0.75)",
            cornerColor: "rgba(102,153,255,0.5)",
            centeredScaling: !1,
            centeredRotation: !0,
            fill: "rgb(0,0,0)",
            fillRule: "nonzero",
            globalCompositeOperation: "source-over",
            backgroundColor: "",
            stroke: null,
            strokeWidth: 1,
            strokeDashArray: null,
            strokeLineCap: "butt",
            strokeLineJoin: "miter",
            strokeMiterLimit: 10,
            shadow: null,
            borderOpacityWhenMoving: .4,
            borderScaleFactor: 1,
            transformMatrix: null,
            minScaleLimit: .01,
            maxScaleLimit: null,
            maxOpacityLimit: 1,
            beforeScaleFnc: void 0,
            selectable: !0,
            evented: !0,
            visible: !0,
            hasControls: !0,
            hasBorders: !0,
            hasRotatingPoint: !0,
            rotatingPointOffset: 30,
            perPixelTargetFind: !1,
            includeDefaultValues: !0,
            clipTo: null,
            lockMovementX: !1,
            lockMovementY: !1,
            lockRotation: !1,
            lockScalingX: !1,
            lockScalingY: !1,
            lockUniScaling: !1,
            lockScalingFlip: !1,
            stateProperties: "top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor alignX alignY meetOrSlice".split(" "),
            initialize: function(a) {
                a && this.setOptions(a)
            },
            _initGradient: function(a) {
                !a.fill || !a.fill.colorStops || a.fill instanceof b.Gradient || this.set("fill", new b.Gradient(a.fill)), !a.stroke || !a.stroke.colorStops || a.stroke instanceof b.Gradient || this.set("stroke", new b.Gradient(a.stroke))
            },
            _initPattern: function(a) {
                !a.fill || !a.fill.source || a.fill instanceof b.Pattern || this.set("fill", new b.Pattern(a.fill)), !a.stroke || !a.stroke.source || a.stroke instanceof b.Pattern || this.set("stroke", new b.Pattern(a.stroke))
            },
            _initClipping: function(a) {
                if (a.clipTo && "string" == typeof a.clipTo) {
                    var c = b.util.getFunctionBody(a.clipTo);
                    "undefined" != typeof c && (this.clipTo = new Function("ctx", c))
                }
            },
            setOptions: function(a) {
                for (var b in a) this.set(b, a[b]);
                this._initGradient(a), this._initPattern(a), this._initClipping(a)
            },
            transform: function(a, b) {
                this.group && this.canvas.preserveObjectStacking && this.group === this.canvas._activeGroup && this.group.transform(a);
                var c = b ? this._getLeftTopCoords() : this.getCenterPoint();
                a.translate(c.x, c.y), a.rotate(f(this.angle)), a.scale(this.scaleX * (this.flipX ? -1 : 1), this.scaleY * (this.flipY ? -1 : 1))
            },
            toObject: function(a) {
                var c = b.Object.NUM_FRACTION_DIGITS,
                    e = {
                        type: this.type,
                        originX: this.originX,
                        originY: this.originY,
                        left: d(this.left, c),
                        top: d(this.top, c),
                        width: d(this.width, c),
                        height: d(this.height, c),
                        fill: this.fill && this.fill.toObject ? this.fill.toObject() : this.fill,
                        stroke: this.stroke && this.stroke.toObject ? this.stroke.toObject() : this.stroke,
                        strokeWidth: d(this.strokeWidth, c),
                        strokeDashArray: this.strokeDashArray,
                        strokeLineCap: this.strokeLineCap,
                        strokeLineJoin: this.strokeLineJoin,
                        strokeMiterLimit: d(this.strokeMiterLimit, c),
                        scaleX: d(this.scaleX, c),
                        scaleY: d(this.scaleY, c),
                        angle: d(this.getAngle(), c),
                        flipX: this.flipX,
                        flipY: this.flipY,
                        opacity: d(this.opacity, c),
                        shadow: this.shadow && this.shadow.toObject ? this.shadow.toObject() : this.shadow,
                        visible: this.visible,
                        clipTo: this.clipTo && String(this.clipTo),
                        backgroundColor: this.backgroundColor,
                        fillRule: this.fillRule,
                        globalCompositeOperation: this.globalCompositeOperation,
                        transformMatrix: this.transformMatrix
                    };
                return this.includeDefaultValues || (e = this._removeDefaultValues(e)), b.util.populateWithProperties(this, e, a), e
            },
            toDatalessObject: function(a) {
                return this.toObject(a)
            },
            _removeDefaultValues: function(a) {
                var c = b.util.getKlass(a.type).prototype,
                    d = c.stateProperties;
                return d.forEach(function(b) {
                    a[b] === c[b] && delete a[b];
                    var d = "[object Array]" === Object.prototype.toString.call(a[b]) && "[object Array]" === Object.prototype.toString.call(c[b]);
                    d && 0 === a[b].length && 0 === c[b].length && delete a[b]
                }), a
            },
            toString: function() {
                return "#<fabric." + e(this.type) + ">"
            },
            get: function(a) {
                return this[a]
            },
            _setObject: function(a) {
                for (var b in a) this._set(b, a[b])
            },
            set: function(a, b) {
                return "object" == typeof a ? this._setObject(a) : "function" == typeof b && "clipTo" !== a ? this._set(a, b(this.get(a))) : this._set(a, b), this
            },
            _set: function(a, c) {
                var e = "scaleX" === a || "scaleY" === a;
                return e && (c = this._constrainScale(c, a)), "scaleX" === a && 0 > c ? (this.flipX = !this.flipX, c *= -1) : "scaleY" === a && 0 > c ? (this.flipY = !this.flipY, c *= -1) : "width" === a || "height" === a ? this.minScaleLimit = d(Math.min(.1, 1 / Math.max(this.width, this.height)), 2) : "shadow" !== a || !c || c instanceof b.Shadow || (c = new b.Shadow(c)), "opacity" === a && (c = this._constrainOpacity(c, a)), this[a] = c, this
            },
            setOnGroup: function() {},
            toggle: function(a) {
                var b = this.get(a);
                return "boolean" == typeof b && this.set(a, !b), this
            },
            setSourcePath: function(a) {
                return this.sourcePath = a, this
            },
            getViewportTransform: function() {
                return this.canvas && this.canvas.viewportTransform ? this.canvas.viewportTransform : [1, 0, 0, 1, 0, 0]
            },
            render: function(a, c) {
                0 === this.width && 0 === this.height || !this.visible || (a.save(), this._setupCompositeOperation(a), c || this.transform(a), this._setStrokeStyles(a), this._setFillStyles(a), this.transformMatrix && a.transform.apply(a, this.transformMatrix), this._setOpacity(a), this._setShadow(a), this.clipTo && b.util.clipContext(this, a), this._render(a, c), this.clipTo && a.restore(), a.restore())
            },
            _setOpacity: function(a) {
                this.group && this.group._setOpacity(a), a.globalAlpha *= this.opacity
            },
            _setStrokeStyles: function(a) {
                this.stroke && (a.lineWidth = this.strokeWidth, a.lineCap = this.strokeLineCap, a.lineJoin = this.strokeLineJoin, a.miterLimit = this.strokeMiterLimit, a.strokeStyle = this.stroke.toLive ? this.stroke.toLive(a, this) : this.stroke)
            },
            _setFillStyles: function(a) {
                this.fill && (a.fillStyle = this.fill.toLive ? this.fill.toLive(a, this) : this.fill)
            },
            _renderControls: function(a, c) {
                if (this.active && !c) {
                    var d = this.getViewportTransform();
                    a.save();
                    var e;
                    this.group && (e = b.util.transformPoint(this.group.getCenterPoint(), d), a.translate(e.x, e.y), a.rotate(f(this.group.angle))), e = b.util.transformPoint(this.getCenterPoint(), d, null != this.group), this.group && (e.x *= this.group.scaleX, e.y *= this.group.scaleY), a.translate(e.x, e.y), a.rotate(f(this.angle)), this.drawBorders(a), this.drawControls(a), a.restore()
                }
            },
            _setShadow: function(a) {
                if (this.shadow) {
                    var b = this.canvas && this.canvas.viewportTransform[0] || 1,
                        c = this.canvas && this.canvas.viewportTransform[3] || 1;
                    a.shadowColor = this.shadow.color, a.shadowBlur = this.shadow.blur * (b + c) * (this.scaleX + this.scaleY) / 4, a.shadowOffsetX = this.shadow.offsetX * b * this.scaleX, a.shadowOffsetY = this.shadow.offsetY * c * this.scaleY
                }
            },
            _removeShadow: function(a) {
                this.shadow && (a.shadowColor = "", a.shadowBlur = a.shadowOffsetX = a.shadowOffsetY = 0)
            },
            _renderFill: function(a) {
                if (this.fill) {
                    if (a.save(), this.fill.gradientTransform) {
                        var b = this.fill.gradientTransform;
                        a.transform.apply(a, b)
                    }
                    this.fill.toLive && a.translate(-this.width / 2 + this.fill.offsetX || 0, -this.height / 2 + this.fill.offsetY || 0), "evenodd" === this.fillRule ? a.fill("evenodd") : a.fill(), a.restore()
                }
            },
            _renderStroke: function(a) {
                if (this.stroke && 0 !== this.strokeWidth) {
                    if (this.shadow && !this.shadow.affectStroke && this._removeShadow(a), a.save(), this.strokeDashArray) 1 & this.strokeDashArray.length && this.strokeDashArray.push.apply(this.strokeDashArray, this.strokeDashArray), g ? (a.setLineDash(this.strokeDashArray), this._stroke && this._stroke(a)) : this._renderDashedStroke && this._renderDashedStroke(a), a.stroke();
                    else {
                        if (this.stroke.gradientTransform) {
                            var b = this.stroke.gradientTransform;
                            a.transform.apply(a, b)
                        }
                        this._stroke ? this._stroke(a) : a.stroke()
                    }
                    a.restore()
                }
            },
            clone: function(a, c) {
                return this.constructor.fromObject ? this.constructor.fromObject(this.toObject(c), a) : new b.Object(this.toObject(c))
            },
            cloneAsImage: function(a) {
                var c = this.toDataURL();
                return b.util.loadImage(c, function(c) {
                    a && a(new b.Image(c))
                }), this
            },
            toDataURL: function(a) {
                a || (a = {});
                var c = b.util.createCanvasElement(),
                    d = this.getBoundingRect();
                c.width = d.width, c.height = d.height, b.util.wrapElement(c, "div");
                var e = new b.StaticCanvas(c);
                "jpg" === a.format && (a.format = "jpeg"), "jpeg" === a.format && (e.backgroundColor = "#fff");
                var f = {
                    active: this.get("active"),
                    left: this.getLeft(),
                    top: this.getTop()
                };
                this.set("active", !1), this.setPositionByOrigin(new b.Point(c.width / 2, c.height / 2), "center", "center");
                var g = this.canvas;
                e.add(this);
                var h = e.toDataURL(a);
                return this.set(f).setCoords(), this.canvas = g, e.dispose(), e = null, h
            },
            isType: function(a) {
                return this.type === a
            },
            complexity: function() {
                return 0
            },
            toJSON: function(a) {
                return this.toObject(a)
            },
            setGradient: function(a, c) {
                c || (c = {});
                var d = {
                    colorStops: []
                };
                d.type = c.type || (c.r1 || c.r2 ? "radial" : "linear"), d.coords = {
                    x1: c.x1,
                    y1: c.y1,
                    x2: c.x2,
                    y2: c.y2
                }, (c.r1 || c.r2) && (d.coords.r1 = c.r1, d.coords.r2 = c.r2);
                for (var e in c.colorStops) {
                    var f = new b.Color(c.colorStops[e]);
                    d.colorStops.push({
                        offset: e,
                        color: f.toRgb(),
                        opacity: f.getAlpha()
                    })
                }
                return this.set(a, b.Gradient.forObject(this, d))
            },
            setPatternFill: function(a) {
                return this.set("fill", new b.Pattern(a))
            },
            setShadow: function(a) {
                return this.set("shadow", a ? new b.Shadow(a) : null)
            },
            setColor: function(a) {
                return this.set("fill", a), this
            },
            setAngle: function(a) {
                var b = ("center" !== this.originX || "center" !== this.originY) && this.centeredRotation;
                return b && this._setOriginToCenter(), this.set("angle", a), b && this._resetOrigin(), this
            },
            centerH: function() {
                return this.canvas.centerObjectH(this), this
            },
            centerV: function() {
                return this.canvas.centerObjectV(this), this
            },
            center: function() {
                return this.canvas.centerObject(this), this
            },
            remove: function() {
                return this.canvas.remove(this), this
            },
            getLocalPointer: function(a, c) {
                c = c || this.canvas.getPointer(a);
                var d = new b.Point(c.x, c.y),
                    e = this._getLeftTopCoords();
                return this.angle && (d = b.util.rotatePoint(d, e, b.util.degreesToRadians(-this.angle))), {
                    x: d.x - e.x,
                    y: d.y - e.y
                }
            },
            _setupCompositeOperation: function(a) {
                this.globalCompositeOperation && (a.globalCompositeOperation = this.globalCompositeOperation)
            }
        }), b.util.createAccessors(b.Object), b.Object.prototype.rotate = b.Object.prototype.setAngle, c(b.Object.prototype, b.Observable), b.Object.NUM_FRACTION_DIGITS = 2, b.Object.__uid = 0)
    }("undefined" != typeof exports ? exports : this),
    function() {
        var a = fabric.util.degreesToRadians,
            b = {
                left: -.5,
                center: 0,
                right: .5
            },
            c = {
                top: -.5,
                center: 0,
                bottom: .5
            };
        fabric.util.object.extend(fabric.Object.prototype, {
            translateToGivenOrigin: function(a, d, e, f, g) {
                var h, i = a.x,
                    j = a.y,
                    k = b[f] - b[d],
                    l = c[g] - c[e];
                return (k || l) && (h = this._getTransformedDimensions(), i = a.x + k * h.x, j = a.y + l * h.y), new fabric.Point(i, j)
            },
            translateToCenterPoint: function(b, c, d) {
                var e = this.translateToGivenOrigin(b, c, d, "center", "center");
                return this.angle ? fabric.util.rotatePoint(e, b, a(this.angle)) : e
            },
            translateToOriginPoint: function(b, c, d) {
                var e = this.translateToGivenOrigin(b, "center", "center", c, d);
                return this.angle ? fabric.util.rotatePoint(e, b, a(this.angle)) : e
            },
            getCenterPoint: function() {
                var a = new fabric.Point(this.left, this.top);
                return this.translateToCenterPoint(a, this.originX, this.originY)
            },
            getPointByOrigin: function(a, b) {
                var c = this.getCenterPoint();
                return this.translateToOriginPoint(c, a, b)
            },
            toLocalPoint: function(b, c, d) {
                var e, f, g = this.getCenterPoint();
                return e = c && d ? this.translateToGivenOrigin(g, "center", "center", c, d) : new fabric.Point(this.left, this.top), f = new fabric.Point(b.x, b.y), this.angle && (f = fabric.util.rotatePoint(f, g, -a(this.angle))), f.subtractEquals(e)
            },
            setPositionByOrigin: function(a, b, c) {
                var d = this.translateToCenterPoint(a, b, c),
                    e = this.translateToOriginPoint(d, this.originX, this.originY);
                this.set("left", e.x), this.set("top", e.y)
            },
            adjustPosition: function(c) {
                var d = a(this.angle),
                    e = this.getWidth(),
                    f = Math.cos(d) * e,
                    g = Math.sin(d) * e;
                this.left += f * (b[c] - b[this.originX]), this.top += g * (b[c] - b[this.originX]), this.setCoords(), this.originX = c
            },
            _setOriginToCenter: function() {
                this._originalOriginX = this.originX, this._originalOriginY = this.originY;
                var a = this.getCenterPoint();
                this.originX = "center", this.originY = "center", this.left = a.x, this.top = a.y
            },
            _resetOrigin: function() {
                var a = this.translateToOriginPoint(this.getCenterPoint(), this._originalOriginX, this._originalOriginY);
                this.originX = this._originalOriginX, this.originY = this._originalOriginY, this.left = a.x, this.top = a.y, this._originalOriginX = null, this._originalOriginY = null
            },
            _getLeftTopCoords: function() {
                return this.translateToOriginPoint(this.getCenterPoint(), "left", "top")
            }
        })
    }(),
    function() {
        function a(a) {
            return [new fabric.Point(a.tl.x, a.tl.y), new fabric.Point(a.tr.x, a.tr.y), new fabric.Point(a.br.x, a.br.y), new fabric.Point(a.bl.x, a.bl.y)]
        }
        var b = fabric.util.degreesToRadians;
        fabric.util.object.extend(fabric.Object.prototype, {
            oCoords: null,
            intersectsWithRect: function(b, c) {
                var d = a(this.oCoords),
                    e = fabric.Intersection.intersectPolygonRectangle(d, b, c);
                return "Intersection" === e.status
            },
            intersectsWithObject: function(b) {
                var c = fabric.Intersection.intersectPolygonPolygon(a(this.oCoords), a(b.oCoords));
                return "Intersection" === c.status
            },
            isContainedWithinObject: function(a) {
                var b = a.getBoundingRect(),
                    c = new fabric.Point(b.left, b.top),
                    d = new fabric.Point(b.left + b.width, b.top + b.height);
                return this.isContainedWithinRect(c, d)
            },
            isContainedWithinRect: function(a, b) {
                var c = this.getBoundingRect();
                return c.left >= a.x && c.left + c.width <= b.x && c.top >= a.y && c.top + c.height <= b.y
            },
            containsPoint: function(a) {
                var b = this._getImageLines(this.oCoords),
                    c = this._findCrossPoints(a, b);
                return 0 !== c && c % 2 === 1
            },
            _getImageLines: function(a) {
                return {
                    topline: {
                        o: a.tl,
                        d: a.tr
                    },
                    rightline: {
                        o: a.tr,
                        d: a.br
                    },
                    bottomline: {
                        o: a.br,
                        d: a.bl
                    },
                    leftline: {
                        o: a.bl,
                        d: a.tl
                    }
                }
            },
            _findCrossPoints: function(a, b) {
                var c, d, e, f, g, h, i, j = 0;
                for (var k in b)
                    if (i = b[k], !(i.o.y < a.y && i.d.y < a.y || i.o.y >= a.y && i.d.y >= a.y || (i.o.x === i.d.x && i.o.x >= a.x ? (g = i.o.x, h = a.y) : (c = 0, d = (i.d.y - i.o.y) / (i.d.x - i.o.x), e = a.y - c * a.x, f = i.o.y - d * i.o.x, g = -(e - f) / (c - d), h = e + c * g), g >= a.x && (j += 1), 2 !== j))) break;
                return j
            },
            getBoundingRectWidth: function() {
                return this.getBoundingRect().width
            },
            getBoundingRectHeight: function() {
                return this.getBoundingRect().height
            },
            getBoundingRect: function() {
                this.oCoords || this.setCoords();
                var a = [this.oCoords.tl.x, this.oCoords.tr.x, this.oCoords.br.x, this.oCoords.bl.x],
                    b = fabric.util.array.min(a),
                    c = fabric.util.array.max(a),
                    d = Math.abs(b - c),
                    e = [this.oCoords.tl.y, this.oCoords.tr.y, this.oCoords.br.y, this.oCoords.bl.y],
                    f = fabric.util.array.min(e),
                    g = fabric.util.array.max(e),
                    h = Math.abs(f - g);
                return {
                    left: b,
                    top: f,
                    width: d,
                    height: h
                }
            },
            getWidth: function() {
                return this.width * this.scaleX
            },
            getHeight: function() {
                return this.height * this.scaleY
            },
            _constrainOpacity: function(a, b) {
                return a > this.maxOpacityLimit ? this.maxOpacityLimit : a
            },
            _constrainScale: function(a, b) {
                return "function" == typeof this.beforeScaleFnc && (a = this.beforeScaleFnc(a, this.__corner, b)), Math.abs(a) < this.minScaleLimit ? 0 > a ? -this.minScaleLimit : this.minScaleLimit : this.maxScaleLimit && Math.abs(a) > this.maxScaleLimit ? 0 > a ? -this.maxScaleLimit : this.maxScaleLimit : a
            },
            scale: function(a) {
                return a = this._constrainScale(a), 0 > a && (this.flipX = !this.flipX, this.flipY = !this.flipY, a *= -1), this.scaleX = a, this.scaleY = a, this.setCoords(), this
            },
            scaleToWidth: function(a) {
                var b = this.getBoundingRect().width / this.getWidth();
                return this.scale(a / this.width / b)
            },
            scaleToHeight: function(a) {
                var b = this.getBoundingRect().height / this.getHeight();
                return this.scale(a / this.height / b)
            },
            setCoords: function() {
                var a = b(this.angle),
                    c = this.getViewportTransform(),
                    d = this._calculateCurrentDimensions(),
                    e = d.x,
                    f = d.y;
                0 > e && (e = Math.abs(e));
                var g = Math.sin(a),
                    h = Math.cos(a),
                    i = e > 0 ? Math.atan(f / e) : 0,
                    j = e / Math.cos(i) / 2,
                    k = Math.cos(i + a) * j,
                    l = Math.sin(i + a) * j,
                    m = fabric.util.transformPoint(this.getCenterPoint(), c),
                    n = new fabric.Point(m.x - k, m.y - l),
                    o = new fabric.Point(n.x + e * h, n.y + e * g),
                    p = new fabric.Point(n.x - f * g, n.y + f * h),
                    q = new fabric.Point(m.x + k, m.y + l),
                    r = new fabric.Point((n.x + p.x) / 2, (n.y + p.y) / 2),
                    s = new fabric.Point((o.x + n.x) / 2, (o.y + n.y) / 2),
                    t = new fabric.Point((q.x + o.x) / 2, (q.y + o.y) / 2),
                    u = new fabric.Point((q.x + p.x) / 2, (q.y + p.y) / 2),
                    v = new fabric.Point(s.x + g * this.rotatingPointOffset, s.y - h * this.rotatingPointOffset);
                return this.oCoords = {
                    tl: n,
                    tr: o,
                    br: q,
                    bl: p,
                    ml: r,
                    mt: s,
                    mr: t,
                    mb: u,
                    mtr: v
                }, this._setCornerCoords && this._setCornerCoords(), this
            },
            _calcDimensionsTransformMatrix: function() {
                return [this.scaleX, 0, 0, this.scaleY, 0, 0]
            }
        })
    }(), fabric.util.object.extend(fabric.Object.prototype, {
        sendToBack: function() {
            return this.group ? fabric.StaticCanvas.prototype.sendToBack.call(this.group, this) : this.canvas.sendToBack(this), this
        },
        bringToFront: function() {
            return this.group ? fabric.StaticCanvas.prototype.bringToFront.call(this.group, this) : this.canvas.bringToFront(this), this
        },
        sendBackwards: function(a) {
            return this.group ? fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, a) : this.canvas.sendBackwards(this, a), this
        },
        bringForward: function(a) {
            return this.group ? fabric.StaticCanvas.prototype.bringForward.call(this.group, this, a) : this.canvas.bringForward(this, a), this
        },
        moveTo: function(a) {
            return this.group ? fabric.StaticCanvas.prototype.moveTo.call(this.group, this, a) : this.canvas.moveTo(this, a), this
        }
    }), fabric.util.object.extend(fabric.Object.prototype, {
        getSvgStyles: function() {
            var a = this.fill ? this.fill.toLive ? "url(#SVGID_" + this.fill.id + ")" : this.fill : "none",
                b = this.fillRule,
                c = this.stroke ? this.stroke.toLive ? "url(#SVGID_" + this.stroke.id + ")" : this.stroke : "none",
                d = this.strokeWidth ? this.strokeWidth : "0",
                e = this.strokeDashArray ? this.strokeDashArray.join(" ") : "none",
                f = this.strokeLineCap ? this.strokeLineCap : "butt",
                g = this.strokeLineJoin ? this.strokeLineJoin : "miter",
                h = this.strokeMiterLimit ? this.strokeMiterLimit : "4",
                i = "undefined" != typeof this.opacity ? this.opacity : "1",
                j = this.visible ? "" : " visibility: hidden;",
                k = this.shadow ? "filter: url(#SVGID_" + this.shadow.id + ");" : "";
            return ["stroke: ", c, "; ", "stroke-width: ", d, "; ", "stroke-dasharray: ", e, "; ", "stroke-linecap: ", f, "; ", "stroke-linejoin: ", g, "; ", "stroke-miterlimit: ", h, "; ", "fill: ", a, "; ", "fill-rule: ", b, "; ", "opacity: ", i, ";", k, j].join("")
        },
        getSvgTransform: function() {
            if (this.group && "shape" === this.group.type) return "";
            var a = fabric.util.toFixed,
                b = this.getAngle(),
                c = !this.canvas || this.canvas.svgViewportTransformation ? this.getViewportTransform() : [1, 0, 0, 1, 0, 0],
                d = fabric.util.transformPoint(this.getCenterPoint(), c),
                e = fabric.Object.NUM_FRACTION_DIGITS,
                f = "shape" === this.type ? "" : "translate(" + a(d.x, e) + " " + a(d.y, e) + ")",
                g = 0 !== b ? " rotate(" + a(b, e) + ")" : "",
                h = 1 === this.scaleX && 1 === this.scaleY && 1 === c[0] && 1 === c[3] ? "" : " scale(" + a(this.scaleX * c[0], e) + " " + a(this.scaleY * c[3], e) + ")",
                i = "shape" === this.type ? this.width * c[0] : 0,
                j = this.flipX ? " matrix(-1 0 0 1 " + i + " 0) " : "",
                k = "shape" === this.type ? this.height * c[3] : 0,
                l = this.flipY ? " matrix(1 0 0 -1 0 " + k + ")" : "";
            return [f, g, h, j, l].join("")
        },
        getSvgTransformMatrix: function() {
            return this.transformMatrix ? " matrix(" + this.transformMatrix.join(" ") + ") " : ""
        },
        _createBaseSVGMarkup: function() {
            var a = [];
            return this.fill && this.fill.toLive && a.push(this.fill.toSVG(this, !1)), this.stroke && this.stroke.toLive && a.push(this.stroke.toSVG(this, !1)), this.shadow && a.push(this.shadow.toSVG(this)), a
        }
    }), fabric.util.object.extend(fabric.Object.prototype, {
        hasStateChanged: function() {
            return this.stateProperties.some(function(a) {
                return this.get(a) !== this.originalState[a]
            }, this)
        },
        saveState: function(a) {
            return this.stateProperties.forEach(function(a) {
                this.originalState[a] = this.get(a)
            }, this), a && a.stateProperties && a.stateProperties.forEach(function(a) {
                this.originalState[a] = this.get(a)
            }, this), this
        },
        setupState: function() {
            return this.originalState = {}, this.saveState(), this
        }
    }),
    function() {
        var a = fabric.util.degreesToRadians,
            b = function() {
                return "undefined" != typeof G_vmlCanvasManager
            };
        fabric.util.object.extend(fabric.Object.prototype, {
            _controlsVisibility: null,
            _findTargetCorner: function(a) {
                if (!this.hasControls || !this.active) return !1;
                var b, c, d = a.x,
                    e = a.y;
                for (var f in this.oCoords)
                    if (this.isControlVisible(f) && ("mtr" !== f || this.hasRotatingPoint) && (!this.get("lockUniScaling") || "mt" !== f && "mr" !== f && "mb" !== f && "ml" !== f) && (c = this._getImageLines(this.oCoords[f].corner), b = this._findCrossPoints({
                            x: d,
                            y: e
                        }, c), 0 !== b && b % 2 === 1)) return this.__corner = f, f;
                return !1
            },
            _setCornerCoords: function() {
                var b, c, d = this.oCoords,
                    e = a(45 - this.angle),
                    f = .707106 * this.cornerSize,
                    g = f * Math.cos(e),
                    h = f * Math.sin(e);
                for (var i in d) b = d[i].x, c = d[i].y, d[i].corner = {
                    tl: {
                        x: b - h,
                        y: c - g
                    },
                    tr: {
                        x: b + g,
                        y: c - h
                    },
                    bl: {
                        x: b - g,
                        y: c + h
                    },
                    br: {
                        x: b + h,
                        y: c + g
                    }
                }
            },
            _getNonTransformedDimensions: function() {
                var a = this.strokeWidth,
                    b = this.width,
                    c = this.height,
                    d = !0,
                    e = !0;
                return "line" === this.type && "butt" === this.strokeLineCap && (e = b, d = c), e && (c += 0 > c ? -a : a), d && (b += 0 > b ? -a : a), {
                    x: b,
                    y: c
                }
            },
            _getTransformedDimensions: function(a) {
                a || (a = this._getNonTransformedDimensions());
                var b = this._calcDimensionsTransformMatrix();
                return fabric.util.transformPoint(a, b, !0)
            },
            _calculateCurrentDimensions: function() {
                var a = this.getViewportTransform(),
                    b = this._getTransformedDimensions(),
                    c = b.x,
                    d = b.y;
                return c += 2 * this.padding, d += 2 * this.padding, fabric.util.transformPoint(new fabric.Point(c, d), a, !0)
            },
            drawBorders: function(a) {
                if (!this.hasBorders) return this;
                a.save(), a.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1, a.strokeStyle = this.borderColor, a.lineWidth = 1 / this.borderScaleFactor;
                var b = this._calculateCurrentDimensions(),
                    c = b.x,
                    d = b.y;
                if (this.group && (c *= this.group.scaleX, d *= this.group.scaleY), a.strokeRect(~~-(c / 2) - .5, ~~-(d / 2) - .5, ~~c + 1, ~~d + 1), this.hasRotatingPoint && this.isControlVisible("mtr") && !this.get("lockRotation") && this.hasControls) {
                    var e = -d / 2;
                    a.beginPath(), a.moveTo(0, e), a.lineTo(0, e - this.rotatingPointOffset), a.closePath(), a.stroke()
                }
                return a.restore(), this
            },
            drawControls: function(a) {
                if (!this.hasControls) return this;
                var b = this._calculateCurrentDimensions(),
                    c = b.x,
                    d = b.y,
                    e = this.cornerSize / 2,
                    f = -(c / 2) - e,
                    g = -(d / 2) - e,
                    h = this.padding,
                    i = this.transparentCorners ? "strokeRect" : "fillRect";
                if (a.save(), a.lineWidth = 1, a.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1, a.strokeStyle = a.fillStyle = this.cornerColor, this._drawControl("tl", a, i, f, g), this._drawControl("tr", a, i, f + c, g), this._drawControl("bl", a, i, f, g + d), this._drawControl("br", a, i, f + c, g + d), this.get("lockUniScaling") || (this._drawControl("mt", a, i, f + c / 2, g), this._drawControl("mb", a, i, f + c / 2, g + d), this._drawControl("mr", a, i, f + c, g + d / 2), this._drawControl("ml", a, i, f, g + d / 2)), this.hasRotatingPoint) {
                    var j = new Image;
                    j.src = W2P.MODEL.server.rscBaseUrl + "images/icons/icnRotate.png", this._drawControl("mtr", a, i, f + c / 2 - e + 7, g - this.rotatingPointOffset - this.cornerSize / 2 - h, j)
                }
                return a.restore(), this
            },
            _drawControl: function(a, c, d, e, f, g) {
                var h = this.cornerSize;
                this.isControlVisible(a) && (b() || this.transparentCorners || c.clearRect(e, f, h, h), c[d](e, f, h, h), g ? c.drawImage(g, e, f, h, h) : (c.fillRect(e, f, h, h), c.strokeRect(e, f, h, h)))
            },
            isControlVisible: function(a) {
                return this._getControlsVisibility()[a]
            },
            setControlVisible: function(a, b) {
                return this._getControlsVisibility()[a] = b, this
            },
            setControlsVisibility: function(a) {
                a || (a = {});
                for (var b in a) this.setControlVisible(b, a[b]);
                return this
            },
            _getControlsVisibility: function() {
                return this._controlsVisibility || (this._controlsVisibility = {
                    tl: !0,
                    tr: !0,
                    br: !0,
                    bl: !0,
                    ml: !0,
                    mt: !0,
                    mr: !0,
                    mb: !0,
                    mtr: !0
                }), this._controlsVisibility
            }
        })
    }(), fabric.util.object.extend(fabric.StaticCanvas.prototype, {
        FX_DURATION: 500,
        fxCenterObjectH: function(a, b) {
            b = b || {};
            var c = function() {},
                d = b.onComplete || c,
                e = b.onChange || c,
                f = this;
            return fabric.util.animate({
                startValue: a.get("left"),
                endValue: this.getCenter().left,
                duration: this.FX_DURATION,
                onChange: function(b) {
                    a.set("left", b), f.renderAll(), e()
                },
                onComplete: function() {
                    a.setCoords(), d()
                }
            }), this
        },
        fxCenterObjectV: function(a, b) {
            b = b || {};
            var c = function() {},
                d = b.onComplete || c,
                e = b.onChange || c,
                f = this;
            return fabric.util.animate({
                startValue: a.get("top"),
                endValue: this.getCenter().top,
                duration: this.FX_DURATION,
                onChange: function(b) {
                    a.set("top", b), f.renderAll(), e()
                },
                onComplete: function() {
                    a.setCoords(), d()
                }
            }), this
        },
        fxRemove: function(a, b) {
            b = b || {};
            var c = function() {},
                d = b.onComplete || c,
                e = b.onChange || c,
                f = this;
            return fabric.util.animate({
                startValue: a.get("opacity"),
                endValue: 0,
                duration: this.FX_DURATION,
                onStart: function() {
                    a.set("active", !1)
                },
                onChange: function(b) {
                    a.set("opacity", b), f.renderAll(), e()
                },
                onComplete: function() {
                    f.remove(a), d()
                }
            }), this
        }
    }), fabric.util.object.extend(fabric.Object.prototype, {
        animate: function() {
            if (arguments[0] && "object" == typeof arguments[0]) {
                var a, b, c = [];
                for (a in arguments[0]) c.push(a);
                for (var d = 0, e = c.length; e > d; d++) a = c[d], b = d !== e - 1, this._animate(a, arguments[0][a], arguments[1], b)
            } else this._animate.apply(this, arguments);
            return this
        },
        _animate: function(a, b, c, d) {
            var e, f = this;
            b = b.toString(), c = c ? fabric.util.object.clone(c) : {}, ~a.indexOf(".") && (e = a.split("."));
            var g = e ? this.get(e[0])[e[1]] : this.get(a);
            "from" in c || (c.from = g), b = ~b.indexOf("=") ? g + parseFloat(b.replace("=", "")) : parseFloat(b), fabric.util.animate({
                startValue: c.from,
                endValue: b,
                byValue: c.by,
                easing: c.easing,
                duration: c.duration,
                abort: c.abort && function() {
                    return c.abort.call(f)
                },
                onChange: function(b) {
                    e ? f[e[0]][e[1]] = b : f.set(a, b), d || c.onChange && c.onChange()
                },
                onComplete: function() {
                    d || (f.setCoords(), c.onComplete && c.onComplete())
                }
            })
        }
    }),
    function(a) {
        "use strict";

        function b(a, b) {
            var c = a.origin,
                d = a.axis1,
                e = a.axis2,
                f = a.dimension,
                g = b.nearest,
                h = b.center,
                i = b.farthest;
            return function() {
                switch (this.get(c)) {
                    case g:
                        return Math.min(this.get(d), this.get(e));
                    case h:
                        return Math.min(this.get(d), this.get(e)) + .5 * this.get(f);
                    case i:
                        return Math.max(this.get(d), this.get(e))
                }
            }
        }
        var c = a.fabric || (a.fabric = {}),
            d = c.util.object.extend,
            e = {
                x1: 1,
                x2: 1,
                y1: 1,
                y2: 1
            },
            f = c.StaticCanvas.supports("setLineDash");
        return c.Line ? void c.warn("fabric.Line is already defined") : (c.Line = c.util.createClass(c.Object, {
            type: "line",
            x1: 0,
            y1: 0,
            x2: 0,
            y2: 0,
            initialize: function(a, b) {
                b = b || {}, a || (a = [0, 0, 0, 0]), this.callSuper("initialize", b), this.set("x1", a[0]), this.set("y1", a[1]), this.set("x2", a[2]), this.set("y2", a[3]), this._setWidthHeight(b)
            },
            _setWidthHeight: function(a) {
                a || (a = {}), this.width = Math.abs(this.x2 - this.x1), this.height = Math.abs(this.y2 - this.y1), this.left = "left" in a ? a.left : this._getLeftToOriginX(), this.top = "top" in a ? a.top : this._getTopToOriginY()
            },
            _set: function(a, b) {
                return this.callSuper("_set", a, b), "undefined" != typeof e[a] && this._setWidthHeight(), this
            },
            _getLeftToOriginX: b({
                origin: "originX",
                axis1: "x1",
                axis2: "x2",
                dimension: "width"
            }, {
                nearest: "left",
                center: "center",
                farthest: "right"
            }),
            _getTopToOriginY: b({
                origin: "originY",
                axis1: "y1",
                axis2: "y2",
                dimension: "height"
            }, {
                nearest: "top",
                center: "center",
                farthest: "bottom"
            }),
            _render: function(a, b) {
                if (a.beginPath(), b) {
                    var c = this.getCenterPoint();
                    a.translate(c.x - this.strokeWidth / 2, c.y - this.strokeWidth / 2)
                }
                if (!this.strokeDashArray || this.strokeDashArray && f) {
                    var d = this.calcLinePoints();
                    a.moveTo(d.x1, d.y1), a.lineTo(d.x2, d.y2)
                }
                a.lineWidth = this.strokeWidth;
                var e = a.strokeStyle;
                a.strokeStyle = this.stroke || a.fillStyle, this.stroke && this._renderStroke(a), a.strokeStyle = e
            },
            _renderDashedStroke: function(a) {
                var b = this.calcLinePoints();
                a.beginPath(), c.util.drawDashedLine(a, b.x1, b.y1, b.x2, b.y2, this.strokeDashArray), a.closePath()
            },
            toObject: function(a) {
                return d(this.callSuper("toObject", a), this.calcLinePoints())
            },
            calcLinePoints: function() {
                var a = this.x1 <= this.x2 ? -1 : 1,
                    b = this.y1 <= this.y2 ? -1 : 1,
                    c = a * this.width * .5,
                    d = b * this.height * .5,
                    e = a * this.width * -.5,
                    f = b * this.height * -.5;
                return {
                    x1: c,
                    x2: e,
                    y1: d,
                    y2: f
                }
            },
            toSVG: function(a) {
                var b = this._createBaseSVGMarkup(),
                    c = {
                        x1: this.x1,
                        x2: this.x2,
                        y1: this.y1,
                        y2: this.y2
                    };
                return this.group && "shape" === this.group.type || (c = this.calcLinePoints()), b.push("<line ", 'x1="', c.x1, '" y1="', c.y1, '" x2="', c.x2, '" y2="', c.y2, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '"/>\n'), a ? a(b.join("")) : b.join("")
            },
            complexity: function() {
                return 1
            }
        }), c.Line.ATTRIBUTE_NAMES = c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")), c.Line.fromElement = function(a, b) {
            var e = c.parseAttributes(a, c.Line.ATTRIBUTE_NAMES),
                f = [e.x1 || 0, e.y1 || 0, e.x2 || 0, e.y2 || 0];
            return new c.Line(f, d(e, b))
        }, void(c.Line.fromObject = function(a) {
            var b = [a.x1, a.y1, a.x2, a.y2];
            return new c.Line(b, a)
        }))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";

        function b(a) {
            return "radius" in a && a.radius >= 0
        }
        var c = a.fabric || (a.fabric = {}),
            d = Math.PI,
            e = c.util.object.extend;
        return c.Circle ? void c.warn("fabric.Circle is already defined.") : (c.Circle = c.util.createClass(c.Object, {
            type: "circle",
            radius: 0,
            startAngle: 0,
            endAngle: 2 * d,
            initialize: function(a) {
                a = a || {}, this.callSuper("initialize", a), this.set("radius", a.radius || 0), this.startAngle = a.startAngle || this.startAngle, this.endAngle = a.endAngle || this.endAngle
            },
            _set: function(a, b) {
                return this.callSuper("_set", a, b), "radius" === a && this.setRadius(b), this
            },
            toObject: function(a) {
                return e(this.callSuper("toObject", a), {
                    radius: this.get("radius"),
                    startAngle: this.startAngle,
                    endAngle: this.endAngle
                })
            },
            toSVG: function(a) {
                var b = this._createBaseSVGMarkup(),
                    c = 0,
                    e = 0,
                    f = (this.endAngle - this.startAngle) % (2 * d);
                if (0 === f) this.group && "shape" === this.group.type && (c = this.left + this.radius, e = this.top + this.radius), b.push("<circle ", 'cx="' + c + '" cy="' + e + '" ', 'r="', this.radius, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), " ", this.getSvgTransformMatrix(), '"/>\n');
                else {
                    var g = Math.cos(this.startAngle) * this.radius,
                        h = Math.sin(this.startAngle) * this.radius,
                        i = Math.cos(this.endAngle) * this.radius,
                        j = Math.sin(this.endAngle) * this.radius,
                        k = f > d ? "1" : "0";
                    b.push('<path d="M ' + g + " " + h, " A " + this.radius + " " + this.radius, " 0 ", +k + " 1", " " + i + " " + j, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), " ", this.getSvgTransformMatrix(), '"/>\n')
                }
                return a ? a(b.join("")) : b.join("")
            },
            _render: function(a, b) {
                a.beginPath(), a.arc(b ? this.left + this.radius : 0, b ? this.top + this.radius : 0, this.radius, this.startAngle, this.endAngle, !1), this._renderFill(a), this._renderStroke(a)
            },
            getRadiusX: function() {
                return this.get("radius") * this.get("scaleX")
            },
            getRadiusY: function() {
                return this.get("radius") * this.get("scaleY")
            },
            setRadius: function(a) {
                return this.radius = a, this.set("width", 2 * a).set("height", 2 * a)
            },
            complexity: function() {
                return 1
            }
        }), c.Circle.ATTRIBUTE_NAMES = c.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")), c.Circle.fromElement = function(a, d) {
            d || (d = {});
            var f = c.parseAttributes(a, c.Circle.ATTRIBUTE_NAMES);
            if (!b(f)) throw new Error("value of `r` attribute is required and can not be negative");
            f.left = f.left || 0, f.top = f.top || 0;
            var g = new c.Circle(e(f, d));
            return g.left -= g.radius, g.top -= g.radius, g
        }, void(c.Circle.fromObject = function(a) {
            return new c.Circle(a)
        }))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {});
        return b.Triangle ? void b.warn("fabric.Triangle is already defined") : (b.Triangle = b.util.createClass(b.Object, {
            type: "triangle",
            initialize: function(a) {
                a = a || {}, this.callSuper("initialize", a), this.set("width", a.width || 100).set("height", a.height || 100)
            },
            _render: function(a) {
                var b = this.width / 2,
                    c = this.height / 2;
                a.beginPath(), a.moveTo(-b, c), a.lineTo(0, -c), a.lineTo(b, c), a.closePath(), this._renderFill(a), this._renderStroke(a)
            },
            _renderDashedStroke: function(a) {
                var c = this.width / 2,
                    d = this.height / 2;
                a.beginPath(), b.util.drawDashedLine(a, -c, d, 0, -d, this.strokeDashArray), b.util.drawDashedLine(a, 0, -d, c, d, this.strokeDashArray), b.util.drawDashedLine(a, c, d, -c, d, this.strokeDashArray), a.closePath()
            },
            toSVG: function(a) {
                var b = this._createBaseSVGMarkup(),
                    c = this.width / 2,
                    d = this.height / 2,
                    e = [-c + " " + d, "0 " + -d, c + " " + d].join(",");
                return b.push("<polygon ", 'points="', e, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), '"/>'), a ? a(b.join("")) : b.join("")
            },
            complexity: function() {
                return 1
            }
        }), void(b.Triangle.fromObject = function(a) {
            return new b.Triangle(a)
        }))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = 2 * Math.PI,
            d = b.util.object.extend;
        return b.Ellipse ? void b.warn("fabric.Ellipse is already defined.") : (b.Ellipse = b.util.createClass(b.Object, {
            type: "ellipse",
            rx: 0,
            ry: 0,
            initialize: function(a) {
                a = a || {}, this.callSuper("initialize", a), this.set("rx", a.rx || 0), this.set("ry", a.ry || 0)
            },
            _set: function(a, b) {
                switch (this.callSuper("_set", a, b), a) {
                    case "rx":
                        this.rx = b, this.set("width", 2 * b);
                        break;
                    case "ry":
                        this.ry = b, this.set("height", 2 * b)
                }
                return this
            },
            getRx: function() {
                return this.get("rx") * this.get("scaleX")
            },
            getRy: function() {
                return this.get("ry") * this.get("scaleY")
            },
            toObject: function(a) {
                return d(this.callSuper("toObject", a), {
                    rx: this.get("rx"),
                    ry: this.get("ry")
                })
            },
            toSVG: function(a) {
                var b = this._createBaseSVGMarkup(),
                    c = 0,
                    d = 0;
                return this.group && "shape" === this.group.type && (c = this.left + this.rx, d = this.top + this.ry), b.push("<ellipse ", 'cx="', c, '" cy="', d, '" ', 'rx="', this.rx, '" ry="', this.ry, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '"/>\n'), a ? a(b.join("")) : b.join("")
            },
            _render: function(a, b) {
                a.beginPath(), a.save(), a.transform(1, 0, 0, this.ry / this.rx, 0, 0), a.arc(b ? this.left + this.rx : 0, b ? (this.top + this.ry) * this.rx / this.ry : 0, this.rx, 0, c, !1), a.restore(), this._renderFill(a), this._renderStroke(a)
            },
            complexity: function() {
                return 1
            }
        }), b.Ellipse.ATTRIBUTE_NAMES = b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")), b.Ellipse.fromElement = function(a, c) {
            c || (c = {});
            var e = b.parseAttributes(a, b.Ellipse.ATTRIBUTE_NAMES);
            e.left = e.left || 0, e.top = e.top || 0;
            var f = new b.Ellipse(d(e, c));
            return f.top -= f.ry, f.left -= f.rx, f
        }, void(b.Ellipse.fromObject = function(a) {
            return new b.Ellipse(a)
        }))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        if (b.Rect) return void b.warn("fabric.Rect is already defined");
        var d = b.Object.prototype.stateProperties.concat();
        d.push("rx", "ry", "x", "y"), b.Rect = b.util.createClass(b.Object, {
            stateProperties: d,
            type: "rect",
            rx: 0,
            ry: 0,
            strokeDashArray: null,
            initialize: function(a) {
                a = a || {}, this.callSuper("initialize", a), this._initRxRy()
            },
            _initRxRy: function() {
                this.rx && !this.ry ? this.ry = this.rx : this.ry && !this.rx && (this.rx = this.ry)
            },
            _render: function(a, b) {
                if (1 === this.width && 1 === this.height) return void a.fillRect(0, 0, 1, 1);
                var c = this.rx ? Math.min(this.rx, this.width / 2) : 0,
                    d = this.ry ? Math.min(this.ry, this.height / 2) : 0,
                    e = this.width,
                    f = this.height,
                    g = b ? this.left : -this.width / 2,
                    h = b ? this.top : -this.height / 2,
                    i = 0 !== c || 0 !== d,
                    j = .4477152502;
                a.beginPath(), a.moveTo(g + c, h), a.lineTo(g + e - c, h), i && a.bezierCurveTo(g + e - j * c, h, g + e, h + j * d, g + e, h + d), a.lineTo(g + e, h + f - d), i && a.bezierCurveTo(g + e, h + f - j * d, g + e - j * c, h + f, g + e - c, h + f), a.lineTo(g + c, h + f), i && a.bezierCurveTo(g + j * c, h + f, g, h + f - j * d, g, h + f - d), a.lineTo(g, h + d), i && a.bezierCurveTo(g, h + j * d, g + j * c, h, g + c, h), a.closePath(), this._renderFill(a), this._renderStroke(a)
            },
            _renderDashedStroke: function(a) {
                var c = -this.width / 2,
                    d = -this.height / 2,
                    e = this.width,
                    f = this.height;
                a.beginPath(), b.util.drawDashedLine(a, c, d, c + e, d, this.strokeDashArray), b.util.drawDashedLine(a, c + e, d, c + e, d + f, this.strokeDashArray), b.util.drawDashedLine(a, c + e, d + f, c, d + f, this.strokeDashArray), b.util.drawDashedLine(a, c, d + f, c, d, this.strokeDashArray), a.closePath()
            },
            toObject: function(a) {
                var b = c(this.callSuper("toObject", a), {
                    rx: this.get("rx") || 0,
                    ry: this.get("ry") || 0
                });
                return this.includeDefaultValues || this._removeDefaultValues(b), b
            },
            toSVG: function(a) {
                var b = this._createBaseSVGMarkup(),
                    c = this.left,
                    d = this.top;
                return this.group && "shape" === this.group.type || (c = -this.width / 2, d = -this.height / 2), b.push("<rect ", 'x="', c, '" y="', d, '" rx="', this.get("rx"), '" ry="', this.get("ry"), '" width="', this.width, '" height="', this.height, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '"/>\n'), a ? a(b.join("")) : b.join("")
            },
            complexity: function() {
                return 1
            }
        }), b.Rect.ATTRIBUTE_NAMES = b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")), b.Rect.fromElement = function(a, d) {
            if (!a) return null;
            d = d || {};
            var e = b.parseAttributes(a, b.Rect.ATTRIBUTE_NAMES);
            e.left = e.left || 0, e.top = e.top || 0;
            var f = new b.Rect(c(d ? b.util.object.clone(d) : {}, e));
            return f.visible = f.width > 0 && f.height > 0, f
        }, b.Rect.fromObject = function(a) {
            return new b.Rect(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {});
        return b.Polyline ? void b.warn("fabric.Polyline is already defined") : (b.Polyline = b.util.createClass(b.Object, {
            type: "polyline",
            points: null,
            minX: 0,
            minY: 0,
            initialize: function(a, c) {
                return b.Polygon.prototype.initialize.call(this, a, c)
            },
            _calcDimensions: function() {
                return b.Polygon.prototype._calcDimensions.call(this)
            },
            _applyPointOffset: function() {
                return b.Polygon.prototype._applyPointOffset.call(this)
            },
            toObject: function(a) {
                return b.Polygon.prototype.toObject.call(this, a)
            },
            toSVG: function(a) {
                return b.Polygon.prototype.toSVG.call(this, a)
            },
            _render: function(a) {
                b.Polygon.prototype.commonRender.call(this, a) && (this._renderFill(a), this._renderStroke(a))
            },
            _renderDashedStroke: function(a) {
                var c, d;
                a.beginPath();
                for (var e = 0, f = this.points.length; f > e; e++) c = this.points[e], d = this.points[e + 1] || c, b.util.drawDashedLine(a, c.x, c.y, d.x, d.y, this.strokeDashArray)
            },
            complexity: function() {
                return this.get("points").length
            }
        }), b.Polyline.ATTRIBUTE_NAMES = b.SHARED_ATTRIBUTES.concat(), b.Polyline.fromElement = function(a, c) {
            if (!a) return null;
            c || (c = {});
            var d = b.parsePointsAttribute(a.getAttribute("points")),
                e = b.parseAttributes(a, b.Polyline.ATTRIBUTE_NAMES);
            return new b.Polyline(d, b.util.object.extend(e, c))
        }, void(b.Polyline.fromObject = function(a) {
            var c = a.points;
            return new b.Polyline(c, a, !0)
        }))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend,
            d = b.util.array.min,
            e = b.util.array.max,
            f = b.util.toFixed;
        return b.Polygon ? void b.warn("fabric.Polygon is already defined") : (b.Polygon = b.util.createClass(b.Object, {
            type: "polygon",
            points: null,
            minX: 0,
            minY: 0,
            initialize: function(a, b) {
                b = b || {}, this.points = a || [], this.callSuper("initialize", b), this._calcDimensions(), "top" in b || (this.top = this.minY), "left" in b || (this.left = this.minX)
            },
            _calcDimensions: function() {
                var a = this.points,
                    b = d(a, "x"),
                    c = d(a, "y"),
                    f = e(a, "x"),
                    g = e(a, "y");
                this.width = f - b || 0, this.height = g - c || 0, this.minX = b || 0, this.minY = c || 0
            },
            _applyPointOffset: function() {
                this.points.forEach(function(a) {
                    a.x -= this.minX + this.width / 2, a.y -= this.minY + this.height / 2
                }, this)
            },
            toObject: function(a) {
                return c(this.callSuper("toObject", a), {
                    points: this.points.concat()
                })
            },
            toSVG: function(a) {
                for (var b = [], c = this._createBaseSVGMarkup(), d = 0, e = this.points.length; e > d; d++) b.push(f(this.points[d].x, 2), ",", f(this.points[d].y, 2), " ");
                return c.push("<", this.type, " ", 'points="', b.join(""), '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), " ", this.getSvgTransformMatrix(), '"/>\n'), a ? a(c.join("")) : c.join("")
            },
            _render: function(a) {
                this.commonRender(a) && (this._renderFill(a), (this.stroke || this.strokeDashArray) && (a.closePath(), this._renderStroke(a)))
            },
            commonRender: function(a) {
                var b, c = this.points.length;
                if (!c || isNaN(this.points[c - 1].y)) return !1;
                a.beginPath(), this._applyPointOffset && (this.group && "shape" === this.group.type || this._applyPointOffset(), this._applyPointOffset = null), a.moveTo(this.points[0].x, this.points[0].y);
                for (var d = 0; c > d; d++) b = this.points[d], a.lineTo(b.x, b.y);
                return !0
            },
            _renderDashedStroke: function(a) {
                b.Polyline.prototype._renderDashedStroke.call(this, a), a.closePath()
            },
            complexity: function() {
                return this.points.length
            }
        }), b.Polygon.ATTRIBUTE_NAMES = b.SHARED_ATTRIBUTES.concat(), b.Polygon.fromElement = function(a, d) {
            if (!a) return null;
            d || (d = {});
            var e = b.parsePointsAttribute(a.getAttribute("points")),
                f = b.parseAttributes(a, b.Polygon.ATTRIBUTE_NAMES);
            return new b.Polygon(e, c(f, d))
        }, void(b.Polygon.fromObject = function(a) {
            return new b.Polygon(a.points, a, !0)
        }))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.array.min,
            d = b.util.array.max,
            e = b.util.object.extend,
            f = Object.prototype.toString,
            g = b.util.drawArc,
            h = {
                m: 2,
                l: 2,
                h: 1,
                v: 1,
                c: 6,
                s: 4,
                q: 4,
                t: 2,
                a: 7
            },
            i = {
                m: "l",
                M: "L"
            };
        return b.Path ? void b.warn("fabric.Path is already defined") : (b.Path = b.util.createClass(b.Object, {
            type: "path",
            path: null,
            minX: 0,
            minY: 0,
            initialize: function(a, b) {
                b = b || {}, this.setOptions(b), a || (a = []);
                var c = "[object Array]" === f.call(a);
                this.path = c ? a : a.match && a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi), this.path && (c || (this.path = this._parsePath()), this._setPositionDimensions(b), b.sourcePath && this.setSourcePath(b.sourcePath))
            },
            _setPositionDimensions: function(a) {
                var b = this._parseDimensions();
                this.minX = b.left, this.minY = b.top, this.width = b.width, this.height = b.height, "undefined" == typeof a.left && (this.left = b.left + ("center" === this.originX ? this.width / 2 : "right" === this.originX ? this.width : 0)), "undefined" == typeof a.top && (this.top = b.top + ("center" === this.originY ? this.height / 2 : "bottom" === this.originY ? this.height : 0)), this.pathOffset = this.pathOffset || {
                    x: this.minX + this.width / 2,
                    y: this.minY + this.height / 2
                }
            },
            _render: function(a) {
                var b, c, d, e = null,
                    f = 0,
                    h = 0,
                    i = 0,
                    j = 0,
                    k = 0,
                    l = 0,
                    m = -this.pathOffset.x,
                    n = -this.pathOffset.y;
                this.group && "shape" === this.group.type && (m = 0, n = 0), a.beginPath();
                for (var o = 0, p = this.path.length; p > o; ++o) {
                    switch (b = this.path[o], b[0]) {
                        case "l":
                            i += b[1], j += b[2], a.lineTo(i + m, j + n);
                            break;
                        case "L":
                            i = b[1], j = b[2], a.lineTo(i + m, j + n);
                            break;
                        case "h":
                            i += b[1], a.lineTo(i + m, j + n);
                            break;
                        case "H":
                            i = b[1], a.lineTo(i + m, j + n);
                            break;
                        case "v":
                            j += b[1], a.lineTo(i + m, j + n);
                            break;
                        case "V":
                            j = b[1], a.lineTo(i + m, j + n);
                            break;
                        case "m":
                            i += b[1], j += b[2], f = i, h = j, a.moveTo(i + m, j + n);
                            break;
                        case "M":
                            i = b[1], j = b[2], f = i, h = j, a.moveTo(i + m, j + n);
                            break;
                        case "c":
                            c = i + b[5], d = j + b[6], k = i + b[3], l = j + b[4], a.bezierCurveTo(i + b[1] + m, j + b[2] + n, k + m, l + n, c + m, d + n), i = c, j = d;
                            break;
                        case "C":
                            i = b[5], j = b[6], k = b[3], l = b[4], a.bezierCurveTo(b[1] + m, b[2] + n, k + m, l + n, i + m, j + n);
                            break;
                        case "s":
                            c = i + b[3], d = j + b[4], null === e[0].match(/[CcSs]/) ? (k = i, l = j) : (k = 2 * i - k, l = 2 * j - l), a.bezierCurveTo(k + m, l + n, i + b[1] + m, j + b[2] + n, c + m, d + n), k = i + b[1], l = j + b[2], i = c, j = d;
                            break;
                        case "S":
                            c = b[3], d = b[4], null === e[0].match(/[CcSs]/) ? (k = i, l = j) : (k = 2 * i - k, l = 2 * j - l), a.bezierCurveTo(k + m, l + n, b[1] + m, b[2] + n, c + m, d + n), i = c, j = d, k = b[1], l = b[2];
                            break;
                        case "q":
                            c = i + b[3], d = j + b[4], k = i + b[1], l = j + b[2], a.quadraticCurveTo(k + m, l + n, c + m, d + n), i = c, j = d;
                            break;
                        case "Q":
                            c = b[3], d = b[4], a.quadraticCurveTo(b[1] + m, b[2] + n, c + m, d + n), i = c, j = d, k = b[1], l = b[2];
                            break;
                        case "t":
                            c = i + b[1], d = j + b[2], null === e[0].match(/[QqTt]/) ? (k = i, l = j) : (k = 2 * i - k, l = 2 * j - l), a.quadraticCurveTo(k + m, l + n, c + m, d + n), i = c, j = d;
                            break;
                        case "T":
                            c = b[1], d = b[2], null === e[0].match(/[QqTt]/) ? (k = i, l = j) : (k = 2 * i - k, l = 2 * j - l), a.quadraticCurveTo(k + m, l + n, c + m, d + n), i = c, j = d;
                            break;
                        case "a":
                            g(a, i + m, j + n, [b[1], b[2], b[3], b[4], b[5], b[6] + i + m, b[7] + j + n]), i += b[6], j += b[7];
                            break;
                        case "A":
                            g(a, i + m, j + n, [b[1], b[2], b[3], b[4], b[5], b[6] + m, b[7] + n]), i = b[6], j = b[7];
                            break;
                        case "z":
                        case "Z":
                            i = f, j = h, a.closePath()
                    }
                    e = b
                }
                this._renderFill(a), this._renderStroke(a)
            },
            toString: function() {
                return "#<fabric.Path (" + this.complexity() + '): { "top": ' + this.top + ', "left": ' + this.left + " }>"
            },
            toObject: function(a) {
                var b = e(this.callSuper("toObject", a), {
                    path: this.path.map(function(a) {
                        return a.slice()
                    }),
                    pathOffset: this.pathOffset
                });
                return this.sourcePath && (b.sourcePath = this.sourcePath), this.transformMatrix && (b.transformMatrix = this.transformMatrix), b
            },
            toDatalessObject: function(a) {
                var b = this.toObject(a);
                return this.sourcePath && (b.path = this.sourcePath), delete b.sourcePath, b
            },
            toSVG: function(a) {
                for (var b = [], c = this._createBaseSVGMarkup(), d = "", e = 0, f = this.path.length; f > e; e++) b.push(this.path[e].join(" "));
                var g = b.join(" ");
                return this.group && "shape" === this.group.type || (d = " translate(" + -this.pathOffset.x + ", " + -this.pathOffset.y + ") "), c.push("<path ", 'd="', g, '" style="', this.getSvgStyles(), '" transform="', this.getSvgTransform(), d, this.getSvgTransformMatrix(), '" stroke-linecap="round" ', "/>\n"), a ? a(c.join("")) : c.join("")
            },
            complexity: function() {
                return this.path.length
            },
            _parsePath: function() {
                for (var a, b, c, d, e, f = [], g = [], j = /([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi, k = 0, l = this.path.length; l > k; k++) {
                    for (a = this.path[k], d = a.slice(1).trim(), g.length = 0; c = j.exec(d);) g.push(c[0]);
                    e = [a.charAt(0)];
                    for (var m = 0, n = g.length; n > m; m++) b = parseFloat(g[m]), isNaN(b) || e.push(b);
                    var o = e[0],
                        p = h[o.toLowerCase()],
                        q = i[o] || o;
                    if (e.length - 1 > p)
                        for (var r = 1, s = e.length; s > r; r += p) f.push([o].concat(e.slice(r, r + p))), o = q;
                    else f.push(e)
                }
                return f
            },
            _parseDimensions: function() {
                for (var a, e, f, g, h = [], i = [], j = null, k = 0, l = 0, m = 0, n = 0, o = 0, p = 0, q = 0, r = this.path.length; r > q; ++q) {
                    switch (a = this.path[q], a[0]) {
                        case "l":
                            m += a[1], n += a[2], g = [];
                            break;
                        case "L":
                            m = a[1], n = a[2], g = [];
                            break;
                        case "h":
                            m += a[1], g = [];
                            break;
                        case "H":
                            m = a[1], g = [];
                            break;
                        case "v":
                            n += a[1], g = [];
                            break;
                        case "V":
                            n = a[1], g = [];
                            break;
                        case "m":
                            m += a[1], n += a[2], k = m, l = n, g = [];
                            break;
                        case "M":
                            m = a[1], n = a[2], k = m, l = n, g = [];
                            break;
                        case "c":
                            e = m + a[5], f = n + a[6], o = m + a[3], p = n + a[4], g = b.util.getBoundsOfCurve(m, n, m + a[1], n + a[2], o, p, e, f), m = e, n = f;
                            break;
                        case "C":
                            m = a[5], n = a[6], o = a[3], p = a[4], g = b.util.getBoundsOfCurve(m, n, a[1], a[2], o, p, m, n);
                            break;
                        case "s":
                            e = m + a[3], f = n + a[4], null === j[0].match(/[CcSs]/) ? (o = m, p = n) : (o = 2 * m - o, p = 2 * n - p), g = b.util.getBoundsOfCurve(m, n, o, p, m + a[1], n + a[2], e, f), o = m + a[1], p = n + a[2], m = e, n = f;
                            break;
                        case "S":
                            e = a[3], f = a[4], null === j[0].match(/[CcSs]/) ? (o = m, p = n) : (o = 2 * m - o, p = 2 * n - p), g = b.util.getBoundsOfCurve(m, n, o, p, a[1], a[2], e, f), m = e, n = f, o = a[1], p = a[2];
                            break;
                        case "q":
                            e = m + a[3], f = n + a[4], o = m + a[1], p = n + a[2], g = b.util.getBoundsOfCurve(m, n, o, p, o, p, e, f), m = e, n = f;
                            break;
                        case "Q":
                            o = a[1], p = a[2], g = b.util.getBoundsOfCurve(m, n, o, p, o, p, a[3], a[4]), m = a[3], n = a[4];
                            break;
                        case "t":
                            e = m + a[1], f = n + a[2], null === j[0].match(/[QqTt]/) ? (o = m, p = n) : (o = 2 * m - o, p = 2 * n - p), g = b.util.getBoundsOfCurve(m, n, o, p, o, p, e, f), m = e, n = f;
                            break;
                        case "T":
                            e = a[1], f = a[2], null === j[0].match(/[QqTt]/) ? (o = m, p = n) : (o = 2 * m - o, p = 2 * n - p), g = b.util.getBoundsOfCurve(m, n, o, p, o, p, e, f), m = e, n = f;
                            break;
                        case "a":
                            g = b.util.getBoundsOfArc(m, n, a[1], a[2], a[3], a[4], a[5], a[6] + m, a[7] + n), m += a[6], n += a[7];
                            break;
                        case "A":
                            g = b.util.getBoundsOfArc(m, n, a[1], a[2], a[3], a[4], a[5], a[6], a[7]), m = a[6], n = a[7];
                            break;
                        case "z":
                        case "Z":
                            m = k, n = l
                    }
                    j = a, g.forEach(function(a) {
                        h.push(a.x), i.push(a.y)
                    }), h.push(m), i.push(n)
                }
                var s = c(h) || 0,
                    t = c(i) || 0,
                    u = d(h) || 0,
                    v = d(i) || 0,
                    w = u - s,
                    x = v - t,
                    y = {
                        left: s,
                        top: t,
                        width: w,
                        height: x
                    };
                return y
            }
        }), b.Path.fromObject = function(a, c) {
            "string" == typeof a.path ? b.loadSVGFromURL(a.path, function(d) {
                var e = d[0],
                    f = a.path;
                delete a.path, b.util.object.extend(e, a), e.setSourcePath(f), c(e)
            }) : c(new b.Path(a.path, a))
        }, b.Path.ATTRIBUTE_NAMES = b.SHARED_ATTRIBUTES.concat(["d"]), b.Path.fromElement = function(a, c, d) {
            var f = b.parseAttributes(a, b.Path.ATTRIBUTE_NAMES);
            c && c(new b.Path(f.d, e(f, d)))
        }, void(b.Path.async = !0))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend,
            d = b.util.array.invoke,
            e = b.Object.prototype.toObject;
        return b.PathGroup ? void b.warn("fabric.PathGroup is already defined") : (b.PathGroup = b.util.createClass(b.Path, {
            type: "shape",
            fill: "",
            initialize: function(a, b) {
                b = b || {}, this.paths = a || [];
                for (var c = this.paths.length; c--;) this.paths[c].group = this;
                b.toBeParsed && (this.parseDimensionsFromPaths(b), delete b.toBeParsed), this.setOptions(b), this.setCoords(), b.sourcePath && this.setSourcePath(b.sourcePath)
            },
            parseDimensionsFromPaths: function(a) {
                for (var c, d, e, f, g, h, i = [], j = [], k = this.paths.length; k--;) {
                    e = this.paths[k], f = e.height + e.strokeWidth, g = e.width + e.strokeWidth, c = [{
                        x: e.left,
                        y: e.top
                    }, {
                        x: e.left + g,
                        y: e.top
                    }, {
                        x: e.left,
                        y: e.top + f
                    }, {
                        x: e.left + g,
                        y: e.top + f
                    }], h = this.paths[k].transformMatrix;
                    for (var l = 0; l < c.length; l++) d = c[l], h && (d = b.util.transformPoint(d, h, !1)), i.push(d.x), j.push(d.y)
                }
                a.width = Math.max.apply(null, i), a.height = Math.max.apply(null, j)
            },
            render: function(a) {
                if (this.visible) {
                    a.save(), this.transformMatrix && a.transform.apply(a, this.transformMatrix), this.transform(a), this._setShadow(a), this.clipTo && b.util.clipContext(this, a), a.translate(-this.width / 2, -this.height / 2);
                    for (var c = 0, d = this.paths.length; d > c; ++c) this.paths[c].render(a, !0);
                    this.clipTo && a.restore(), a.restore()
                }
            },
            _set: function(a, b) {
                if ("fill" === a && b && this.isSameColor())
                    for (var c = this.paths.length; c--;) this.paths[c]._set(a, b);
                return this.callSuper("_set", a, b)
            },
            toObject: function(a) {
                var b = c(e.call(this, a), {
                    paths: d(this.getObjects(), "toObject", a)
                });
                return this.sourcePath && (b.sourcePath = this.sourcePath), b
            },
            toDatalessObject: function(a) {
                var b = this.toObject(a);
                return this.sourcePath && (b.paths = this.sourcePath), b
            },
            toSVG: function(a) {
                for (var b = this.getObjects(), c = this.getPointByOrigin("left", "top"), d = "translate(" + c.x + " " + c.y + ")", e = ["<g ", 'style="', this.getSvgStyles(), '" ', 'transform="', this.getSvgTransformMatrix(), d, this.getSvgTransform(), '" ', ">\n"], f = 0, g = b.length; g > f; f++) e.push(b[f].toSVG(a));
                return e.push("</g>\n"), a ? a(e.join("")) : e.join("")
            },
            toString: function() {
                return "#<fabric.PathGroup (" + this.complexity() + "): { top: " + this.top + ", left: " + this.left + " }>"
            },
            isSameColor: function() {
                var a = (this.getObjects()[0].get("fill") || "").toLowerCase();
                return this.getObjects().every(function(b) {
                    return (b.get("fill") || "").toLowerCase() === a
                })
            },
            complexity: function() {
                return this.paths.reduce(function(a, b) {
                    return a + (b && b.complexity ? b.complexity() : 0)
                }, 0)
            },
            getObjects: function() {
                return this.paths
            }
        }), b.PathGroup.fromObject = function(a, c) {
            "string" == typeof a.paths ? b.loadSVGFromURL(a.paths, function(d) {
                var e = a.paths;
                delete a.paths;
                var f = b.util.groupSVGElements(d, a, e);
                c(f)
            }) : b.util.enlivenObjects(a.paths, function(d) {
                delete a.paths, c(new b.PathGroup(d, a))
            })
        }, void(b.PathGroup.async = !0))
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend,
            d = b.util.array.min,
            e = b.util.array.max,
            f = b.util.array.invoke;
        if (!b.Group) {
            var g = {
                lockMovementX: !0,
                lockMovementY: !0,
                lockRotation: !0,
                lockScalingX: !0,
                lockScalingY: !0,
                lockUniScaling: !0
            };
            b.Group = b.util.createClass(b.Object, b.Collection, {
                type: "group",
                strokeWidth: 0,
                initialize: function(a, b, c) {
                    b = b || {}, this._objects = [], c && this.callSuper("initialize", b), this._objects = a || [];
                    for (var d = this._objects.length; d--;) this._objects[d].group = this;
                    this.originalState = {}, b.originX && (this.originX = b.originX), b.originY && (this.originY = b.originY), c ? this._updateObjectsCoords(!0) : (this._calcBounds(), this._updateObjectsCoords(), this.callSuper("initialize", b)), this.setCoords(), this.saveCoords()
                },
                _updateObjectsCoords: function(a) {
                    for (var b = this._objects.length; b--;) this._updateObjectCoords(this._objects[b], a)
                },
                _updateObjectCoords: function(a, b) {
                    if (a.__origHasControls = a.hasControls, a.hasControls = !1, !b) {
                        var c = a.getLeft(),
                            d = a.getTop(),
                            e = this.getCenterPoint();
                        a.set({
                            originalLeft: c,
                            originalTop: d,
                            left: c - e.x,
                            top: d - e.y
                        }), a.setCoords()
                    }
                },
                toString: function() {
                    return "#<fabric.Group: (" + this.complexity() + ")>"
                },
                addWithUpdate: function(a) {
                    return this._restoreObjectsState(), a && (this._objects.push(a), a.group = this, a._set("canvas", this.canvas)), this.forEachObject(this._setObjectActive, this), this._calcBounds(), this._updateObjectsCoords(), this
                },
                _setObjectActive: function(a) {
                    a.set("active", !0), a.group = this
                },
                removeWithUpdate: function(a) {
                    return this._moveFlippedObject(a), this._restoreObjectsState(), this.forEachObject(this._setObjectActive, this), this.remove(a), this._calcBounds(), this._updateObjectsCoords(), this
                },
                _onObjectAdded: function(a) {
                    a.group = this, a._set("canvas", this.canvas)
                },
                _onObjectRemoved: function(a) {
                    delete a.group, a.set("active", !1)
                },
                delegatedProperties: {
                    fill: !0,
                    opacity: !0,
                    fontFamily: !0,
                    fontWeight: !0,
                    fontSize: !0,
                    fontStyle: !0,
                    lineHeight: !0,
                    textDecoration: !0,
                    textAlign: !0,
                    backgroundColor: !0
                },
                _set: function(a, b) {
                    var c = this._objects.length;
                    if (this.delegatedProperties[a] || "canvas" === a)
                        for (; c--;) this._objects[c].set(a, b);
                    else
                        for (; c--;) this._objects[c].setOnGroup(a, b);
                    this.callSuper("_set", a, b)
                },
                toObject: function(a) {
                    return c(this.callSuper("toObject", a), {
                        objects: f(this._objects, "toObject", a)
                    })
                },
                render: function(a) {
                    if (this.visible) {
                        a.save(), this.transformMatrix && a.transform.apply(a, this.transformMatrix), this.transform(a), this.clipTo && b.util.clipContext(this, a);
                        for (var c = 0, d = this._objects.length; d > c; c++) this._renderObject(this._objects[c], a);
                        this.clipTo && a.restore(), a.restore()
                    }
                },
                _renderControls: function(a, b) {
                    this.callSuper("_renderControls", a, b);
                    for (var c = 0, d = this._objects.length; d > c; c++) this._objects[c]._renderControls(a)
                },
                _renderObject: function(a, b) {
                    if (a.visible) {
                        var c = a.hasRotatingPoint;
                        a.hasRotatingPoint = !1, a.render(b), a.hasRotatingPoint = c
                    }
                },
                _restoreObjectsState: function() {
                    return this._objects.forEach(this._restoreObjectState, this), this
                },
                realizeTransform: function(a) {
                    return this._moveFlippedObject(a), this._setObjectPosition(a), a
                },
                _moveFlippedObject: function(a) {
                    var b = a.get("originX"),
                        c = a.get("originY"),
                        d = a.getCenterPoint();
                    a.set({
                        originX: "center",
                        originY: "center",
                        left: d.x,
                        top: d.y
                    }), this._toggleFlipping(a);
                    var e = a.getPointByOrigin(b, c);
                    return a.set({
                        originX: b,
                        originY: c,
                        left: e.x,
                        top: e.y
                    }), this
                },
                _toggleFlipping: function(a) {
                    this.flipX && (a.toggle("flipX"), a.set("left", -a.get("left")), a.setAngle(-a.getAngle())), this.flipY && (a.toggle("flipY"), a.set("top", -a.get("top")), a.setAngle(-a.getAngle()))
                },
                _restoreObjectState: function(a) {
                    return this._setObjectPosition(a), a.setCoords(), a.hasControls = a.__origHasControls, delete a.__origHasControls, a.set("active", !1), a.setCoords(), delete a.group, this
                },
                _setObjectPosition: function(a) {
                    var b = this.getCenterPoint(),
                        c = this._getRotatedLeftTop(a);
                    a.set({
                        angle: a.getAngle() + this.getAngle(),
                        left: b.x + c.left,
                        top: b.y + c.top,
                        scaleX: a.get("scaleX") * this.get("scaleX"),
                        scaleY: a.get("scaleY") * this.get("scaleY")
                    })
                },
                _getRotatedLeftTop: function(a) {
                    var b = this.getAngle() * (Math.PI / 180);
                    return {
                        left: -Math.sin(b) * a.getTop() * this.get("scaleY") + Math.cos(b) * a.getLeft() * this.get("scaleX"),
                        top: Math.cos(b) * a.getTop() * this.get("scaleY") + Math.sin(b) * a.getLeft() * this.get("scaleX")
                    }
                },
                destroy: function() {
                    return this._objects.forEach(this._moveFlippedObject, this), this._restoreObjectsState()
                },
                saveCoords: function() {
                    return this._originalLeft = this.get("left"), this._originalTop = this.get("top"), this
                },
                hasMoved: function() {
                    return this._originalLeft !== this.get("left") || this._originalTop !== this.get("top")
                },
                setObjectsCoords: function() {
                    return this.forEachObject(function(a) {
                        a.setCoords()
                    }), this
                },
                _calcBounds: function(a) {
                    for (var b, c, d, e = [], f = [], g = ["tr", "br", "bl", "tl"], h = 0, i = this._objects.length, j = g.length; i > h; ++h)
                        for (b = this._objects[h], b.setCoords(), d = 0; j > d; d++) c = g[d], e.push(b.oCoords[c].x), f.push(b.oCoords[c].y);
                    this.set(this._getBounds(e, f, a))
                },
                _getBounds: function(a, c, f) {
                    var g = b.util.invertTransform(this.getViewportTransform()),
                        h = b.util.transformPoint(new b.Point(d(a), d(c)), g),
                        i = b.util.transformPoint(new b.Point(e(a), e(c)), g),
                        j = {
                            width: i.x - h.x || 0,
                            height: i.y - h.y || 0
                        };
                    return f || (j.left = h.x || 0, j.top = h.y || 0, "center" === this.originX && (j.left += j.width / 2), "right" === this.originX && (j.left += j.width), "center" === this.originY && (j.top += j.height / 2), "bottom" === this.originY && (j.top += j.height)), j
                },
                toSVG: function(a) {
                    for (var b = ["<g ", 'transform="', this.getSvgTransform(), '">\n'], c = 0, d = this._objects.length; d > c; c++) b.push(this._objects[c].toSVG(a));
                    return b.push("</g>\n"), a ? a(b.join("")) : b.join("")
                },
                get: function(a) {
                    if (a in g) {
                        if (this[a]) return this[a];
                        for (var b = 0, c = this._objects.length; c > b; b++)
                            if (this._objects[b][a]) return !0;
                        return !1
                    }
                    return a in this.delegatedProperties ? this._objects[0] && this._objects[0].get(a) : this[a]
                }
            }), b.Group.fromObject = function(a, c) {
                b.util.enlivenObjects(a.objects, function(d) {
                    delete a.objects, c && c(new b.Group(d, a, !0))
                })
            }, b.Group.async = !0
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = fabric.util.object.extend;
        return a.fabric || (a.fabric = {}), a.fabric.Image ? void fabric.warn("fabric.Image is already defined.") : (fabric.Image = fabric.util.createClass(fabric.Object, {
            type: "image",
            crossOrigin: "",
            alignX: "none",
            alignY: "none",
            meetOrSlice: "meet",
            _lastScaleX: 1,
            _lastScaleY: 1,
            initialize: function(a, b) {
                b || (b = {}), this.filters = [], this.resizeFilters = [], this.callSuper("initialize", b), this._initElement(a, b)
            },
            getElement: function() {
                return this._element
            },
            setElement: function(a, b, c) {
                return this._element = a, this._originalElement = a, this._initConfig(c), 0 !== this.filters.length ? this.applyFilters(b) : b && b(), this
            },
            setCrossOrigin: function(a) {
                return this.crossOrigin = a, this._element.crossOrigin = a, this
            },
            getOriginalSize: function() {
                var a = this.getElement();
                return {
                    width: a.width,
                    height: a.height
                }
            },
            _stroke: function(a) {
                a.save(), this._setStrokeStyles(a), a.beginPath(), a.strokeRect(-this.width / 2, -this.height / 2, this.width, this.height), a.closePath(), a.restore()
            },
            _renderDashedStroke: function(a) {
                var b = -this.width / 2,
                    c = -this.height / 2,
                    d = this.width,
                    e = this.height;
                a.save(), this._setStrokeStyles(a), a.beginPath(), fabric.util.drawDashedLine(a, b, c, b + d, c, this.strokeDashArray), fabric.util.drawDashedLine(a, b + d, c, b + d, c + e, this.strokeDashArray), fabric.util.drawDashedLine(a, b + d, c + e, b, c + e, this.strokeDashArray), fabric.util.drawDashedLine(a, b, c + e, b, c, this.strokeDashArray), a.closePath(), a.restore()
            },
            toObject: function(a) {
                var c = [];
                this.filters.forEach(function(a) {
                    a && c.push(a.toObject())
                });
                var d = b(this.callSuper("toObject", a), {
                    src: this._originalElement.src || this._originalElement._src,
                    filters: c,
                    crossOrigin: this.crossOrigin,
                    alignX: this.alignX,
                    alignY: this.alignY,
                    meetOrSlice: this.meetOrSlice
                });
                return this.resizeFilters.length > 0 && (d.resizeFilters = this.resizeFilters.map(function(a) {
                    return a && a.toObject()
                })), this.includeDefaultValues || this._removeDefaultValues(d), d
            },
            toSVG: function(a) {
                var b = [],
                    c = -this.width / 2,
                    d = -this.height / 2,
                    e = "none";
                if (this.group && "shape" === this.group.type && (c = this.left, d = this.top), "none" !== this.alignX && "none" !== this.alignY && (e = "x" + this.alignX + "Y" + this.alignY + " " + this.meetOrSlice), b.push('<g transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '">\n', '<image xlink:href="', this.getSvgSrc(), '" x="', c, '" y="', d, '" style="', this.getSvgStyles(), '" width="', this.width, '" height="', this.height, '" preserveAspectRatio="', e, '"', "></image>\n"), this.stroke || this.strokeDashArray) {
                    var f = this.fill;
                    this.fill = null, b.push("<rect ", 'x="', c, '" y="', d, '" width="', this.width, '" height="', this.height, '" style="', this.getSvgStyles(), '"/>\n'), this.fill = f
                }
                return b.push("</g>\n"), a ? a(b.join("")) : b.join("")
            },
            getSrc: function() {
                return this.getElement() ? this.getElement().src || this.getElement()._src : void 0
            },
            setSrc: function(a, b, c) {
                fabric.util.loadImage(a, function(a) {
                    return this.setElement(a, b, c)
                }, this, c && c.crossOrigin)
            },
            toString: function() {
                return '#<fabric.Image: { src: "' + this.getSrc() + '" }>'
            },
            clone: function(a, b) {
                this.constructor.fromObject(this.toObject(b), a)
            },
            applyFilters: function(a, b, c, d) {
                if (b = b || this.filters, c = c || this._originalElement) {
                    var e = c,
                        f = fabric.util.createCanvasElement(),
                        g = fabric.util.createImage(),
                        h = this;
                    return f.width = e.width, f.height = e.height, f.getContext("2d").drawImage(e, 0, 0, e.width, e.height), 0 === b.length ? (this._element = c, a && a(), f) : (b.forEach(function(a) {
                        a && a.applyTo(f, a.scaleX || h.scaleX, a.scaleY || h.scaleY), !d && a && "Resize" === a.type && (h.width *= a.scaleX, h.height *= a.scaleY)
                    }), g.width = f.width, g.height = f.height, fabric.isLikelyNode ? (g.src = f.toBuffer(void 0, fabric.Image.pngCompression), h._element = g, !d && (h._filteredEl = g), a && a()) : (g.onload = function() {
                        h._element = g, !d && (h._filteredEl = g), a && a(), g.onload = f = e = null
                    }, g.src = f.toDataURL("image/png")), f)
                }
            },
            _render: function(a, b) {
                var c, d, e, f = this._findMargins();
                c = b ? this.left : -this.width / 2, d = b ? this.top : -this.height / 2, "slice" === this.meetOrSlice && (a.beginPath(), a.rect(c, d, this.width, this.height), a.clip()), this.isMoving === !1 && this.resizeFilters.length && this._needsResize() ? (this._lastScaleX = this.scaleX, this._lastScaleY = this.scaleY, e = this.applyFilters(null, this.resizeFilters, this._filteredEl || this._originalElement, !0)) : e = this._element, e && a.drawImage(e, c + f.marginX, d + f.marginY, f.width, f.height), this._renderStroke(a)
            },
            _needsResize: function() {
                return this.scaleX !== this._lastScaleX || this.scaleY !== this._lastScaleY
            },
            _findMargins: function() {
                var a, b, c = this.width,
                    d = this.height,
                    e = 0,
                    f = 0;
                return "none" === this.alignX && "none" === this.alignY || (a = [this.width / this._element.width, this.height / this._element.height], b = "meet" === this.meetOrSlice ? Math.min.apply(null, a) : Math.max.apply(null, a), c = this._element.width * b, d = this._element.height * b, "Mid" === this.alignX && (e = (this.width - c) / 2), "Max" === this.alignX && (e = this.width - c), "Mid" === this.alignY && (f = (this.height - d) / 2), "Max" === this.alignY && (f = this.height - d)), {
                    width: c,
                    height: d,
                    marginX: e,
                    marginY: f
                }
            },
            _resetWidthHeight: function() {
                var a = this.getElement();
                this.set("width", a.width), this.set("height", a.height)
            },
            _initElement: function(a, b) {
                this.setElement(fabric.util.getById(a), null, b), fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS)
            },
            _initConfig: function(a) {
                a || (a = {}), this.setOptions(a), this._setWidthHeight(a), this._element && this.crossOrigin && (this._element.crossOrigin = this.crossOrigin)
            },
            _initFilters: function(a, b) {
                a && a.length ? fabric.util.enlivenObjects(a, function(a) {
                    b && b(a)
                }, "fabric.Image.filters") : b && b()
            },
            _setWidthHeight: function(a) {
                this.width = "width" in a ? a.width : this.getElement() ? this.getElement().width || 0 : 0, this.height = "height" in a ? a.height : this.getElement() ? this.getElement().height || 0 : 0
            },
            complexity: function() {
                return 1
            }
        }), fabric.Image.CSS_CANVAS = "canvas-img", fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc, fabric.Image.fromObject = function(a, b) {
            fabric.util.loadImage(a.src, function(c) {
                fabric.Image.prototype._initFilters.call(a, a.filters, function(d) {
                    a.filters = d || [], fabric.Image.prototype._initFilters.call(a, a.resizeFilters, function(d) {
                        a.resizeFilters = d || [];
                        var e = new fabric.Image(c, a);
                        b && b(e)
                    })
                })
            }, null, a.crossOrigin)
        }, fabric.Image.fromURL = function(a, b, c) {
            fabric.util.loadImage(a, function(a) {
                b && b(new fabric.Image(a, c))
            }, null, c && c.crossOrigin)
        }, fabric.Image.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")), fabric.Image.fromElement = function(a, c, d) {
            var e, f, g, h = fabric.parseAttributes(a, fabric.Image.ATTRIBUTE_NAMES),
                i = "xMidYMid",
                j = "meet";
            h.preserveAspectRatio && (g = h.preserveAspectRatio.split(" ")), g && g.length && (j = g.pop(), "meet" !== j && "slice" !== j ? (i = j, j = "meet") : g.length && (i = g.pop())), e = "none" !== i ? i.slice(1, 4) : "none", f = "none" !== i ? i.slice(5, 8) : "none", h.alignX = e, h.alignY = f, h.meetOrSlice = j, fabric.Image.fromURL(h["xlink:href"], c, b(d ? fabric.util.object.clone(d) : {}, h))
        }, fabric.Image.async = !0, void(fabric.Image.pngCompression = 1))
    }("undefined" != typeof exports ? exports : this), fabric.util.object.extend(fabric.Object.prototype, {
        _getAngleValueForStraighten: function() {
            var a = this.getAngle() % 360;
            return a > 0 ? 90 * Math.round((a - 1) / 90) : 90 * Math.round(a / 90)
        },
        straighten: function() {
            return this.setAngle(this._getAngleValueForStraighten()), this
        },
        fxStraighten: function(a) {
            a = a || {};
            var b = function() {},
                c = a.onComplete || b,
                d = a.onChange || b,
                e = this;
            return fabric.util.animate({
                startValue: this.get("angle"),
                endValue: this._getAngleValueForStraighten(),
                duration: this.FX_DURATION,
                onChange: function(a) {
                    e.setAngle(a), d()
                },
                onComplete: function() {
                    e.setCoords(), c()
                },
                onStart: function() {
                    e.set("active", !1)
                }
            }), this
        }
    }), fabric.util.object.extend(fabric.StaticCanvas.prototype, {
        straightenObject: function(a) {
            return a.straighten(), this.renderAll(), this
        },
        fxStraightenObject: function(a) {
            return a.fxStraighten({
                onChange: this.renderAll.bind(this)
            }), this
        }
    }), fabric.Image.filters = fabric.Image.filters || {}, fabric.Image.filters.BaseFilter = fabric.util.createClass({
        type: "BaseFilter",
        initialize: function(a) {
            a && this.setOptions(a)
        },
        setOptions: function(a) {
            for (var b in a) this[b] = a[b]
        },
        toObject: function() {
            return {
                type: this.type
            }
        },
        toJSON: function() {
            return this.toObject()
        }
    }),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        b.Image.filters.Brightness = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Brightness",
            initialize: function(a) {
                a = a || {}, this.brightness = a.brightness || 0
            },
            applyTo: function(a) {
                for (var b = a.getContext("2d"), c = b.getImageData(0, 0, a.width, a.height), d = c.data, e = this.brightness, f = 0, g = d.length; g > f; f += 4) d[f] += e, d[f + 1] += e, d[f + 2] += e;
                b.putImageData(c, 0, 0)
            },
            toObject: function() {
                return c(this.callSuper("toObject"), {
                    brightness: this.brightness
                })
            }
        }), b.Image.filters.Brightness.fromObject = function(a) {
            return new b.Image.filters.Brightness(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        b.Image.filters.Convolute = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Convolute",
            initialize: function(a) {
                a = a || {}, this.opaque = a.opaque, this.matrix = a.matrix || [0, 0, 0, 0, 1, 0, 0, 0, 0];
                var c = b.util.createCanvasElement();
                this.tmpCtx = c.getContext("2d")
            },
            _createImageData: function(a, b) {
                return this.tmpCtx.createImageData(a, b)
            },
            applyTo: function(a) {
                for (var b = this.matrix, c = a.getContext("2d"), d = c.getImageData(0, 0, a.width, a.height), e = Math.round(Math.sqrt(b.length)), f = Math.floor(e / 2), g = d.data, h = d.width, i = d.height, j = h, k = i, l = this._createImageData(j, k), m = l.data, n = this.opaque ? 1 : 0, o = 0; k > o; o++)
                    for (var p = 0; j > p; p++) {
                        for (var q = o, r = p, s = 4 * (o * j + p), t = 0, u = 0, v = 0, w = 0, x = 0; e > x; x++)
                            for (var y = 0; e > y; y++) {
                                var z = q + x - f,
                                    A = r + y - f;
                                if (!(0 > z || z > i || 0 > A || A > h)) {
                                    var B = 4 * (z * h + A),
                                        C = b[x * e + y];
                                    t += g[B] * C, u += g[B + 1] * C, v += g[B + 2] * C, w += g[B + 3] * C
                                }
                            }
                        m[s] = t, m[s + 1] = u, m[s + 2] = v, m[s + 3] = w + n * (255 - w)
                    }
                c.putImageData(l, 0, 0)
            },
            toObject: function() {
                return c(this.callSuper("toObject"), {
                    opaque: this.opaque,
                    matrix: this.matrix
                })
            }
        }), b.Image.filters.Convolute.fromObject = function(a) {
            return new b.Image.filters.Convolute(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        b.Image.filters.GradientTransparency = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "GradientTransparency",
            initialize: function(a) {
                a = a || {}, this.threshold = a.threshold || 100
            },
            applyTo: function(a) {
                for (var b = a.getContext("2d"), c = b.getImageData(0, 0, a.width, a.height), d = c.data, e = this.threshold, f = d.length, g = 0, h = d.length; h > g; g += 4) d[g + 3] = e + 255 * (f - g) / f;
                b.putImageData(c, 0, 0)
            },
            toObject: function() {
                return c(this.callSuper("toObject"), {
                    threshold: this.threshold
                })
            }
        }), b.Image.filters.GradientTransparency.fromObject = function(a) {
            return new b.Image.filters.GradientTransparency(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {});
        b.Image.filters.Grayscale = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Grayscale",
            applyTo: function(a) {
                for (var b, c = a.getContext("2d"), d = c.getImageData(0, 0, a.width, a.height), e = d.data, f = d.width * d.height * 4, g = 0; f > g;) b = (e[g] + e[g + 1] + e[g + 2]) / 3,
                    e[g] = b, e[g + 1] = b, e[g + 2] = b, g += 4;
                c.putImageData(d, 0, 0)
            }
        }), b.Image.filters.Grayscale.fromObject = function() {
            return new b.Image.filters.Grayscale
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {});
        b.Image.filters.Invert = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Invert",
            applyTo: function(a) {
                var b, c = a.getContext("2d"),
                    d = c.getImageData(0, 0, a.width, a.height),
                    e = d.data,
                    f = e.length;
                for (b = 0; f > b; b += 4) e[b] = 255 - e[b], e[b + 1] = 255 - e[b + 1], e[b + 2] = 255 - e[b + 2];
                c.putImageData(d, 0, 0)
            }
        }), b.Image.filters.Invert.fromObject = function() {
            return new b.Image.filters.Invert
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        b.Image.filters.Mask = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Mask",
            initialize: function(a) {
                a = a || {}, this.mask = a.mask, this.channel = [0, 1, 2, 3].indexOf(a.channel) > -1 ? a.channel : 0
            },
            applyTo: function(a) {
                if (this.mask) {
                    var c, d = a.getContext("2d"),
                        e = d.getImageData(0, 0, a.width, a.height),
                        f = e.data,
                        g = this.mask.getElement(),
                        h = b.util.createCanvasElement(),
                        i = this.channel,
                        j = e.width * e.height * 4;
                    h.width = g.width, h.height = g.height, h.getContext("2d").drawImage(g, 0, 0, g.width, g.height);
                    var k = h.getContext("2d").getImageData(0, 0, g.width, g.height),
                        l = k.data;
                    for (c = 0; j > c; c += 4) f[c + 3] = l[c + i];
                    d.putImageData(e, 0, 0)
                }
            },
            toObject: function() {
                return c(this.callSuper("toObject"), {
                    mask: this.mask.toObject(),
                    channel: this.channel
                })
            }
        }), b.Image.filters.Mask.fromObject = function(a, c) {
            b.util.loadImage(a.mask.src, function(d) {
                a.mask = new b.Image(d, a.mask), c && c(new b.Image.filters.Mask(a))
            })
        }, b.Image.filters.Mask.async = !0
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        b.Image.filters.Noise = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Noise",
            initialize: function(a) {
                a = a || {}, this.noise = a.noise || 0
            },
            applyTo: function(a) {
                for (var b, c = a.getContext("2d"), d = c.getImageData(0, 0, a.width, a.height), e = d.data, f = this.noise, g = 0, h = e.length; h > g; g += 4) b = (.5 - Math.random()) * f, e[g] += b, e[g + 1] += b, e[g + 2] += b;
                c.putImageData(d, 0, 0)
            },
            toObject: function() {
                return c(this.callSuper("toObject"), {
                    noise: this.noise
                })
            }
        }), b.Image.filters.Noise.fromObject = function(a) {
            return new b.Image.filters.Noise(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        b.Image.filters.Pixelate = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Pixelate",
            initialize: function(a) {
                a = a || {}, this.blocksize = a.blocksize || 4
            },
            applyTo: function(a) {
                var b, c, d, e, f, g, h, i = a.getContext("2d"),
                    j = i.getImageData(0, 0, a.width, a.height),
                    k = j.data,
                    l = j.height,
                    m = j.width;
                for (c = 0; l > c; c += this.blocksize)
                    for (d = 0; m > d; d += this.blocksize) {
                        b = 4 * c * m + 4 * d, e = k[b], f = k[b + 1], g = k[b + 2], h = k[b + 3];
                        for (var n = c, o = c + this.blocksize; o > n; n++)
                            for (var p = d, q = d + this.blocksize; q > p; p++) b = 4 * n * m + 4 * p, k[b] = e, k[b + 1] = f, k[b + 2] = g, k[b + 3] = h
                    }
                i.putImageData(j, 0, 0)
            },
            toObject: function() {
                return c(this.callSuper("toObject"), {
                    blocksize: this.blocksize
                })
            }
        }), b.Image.filters.Pixelate.fromObject = function(a) {
            return new b.Image.filters.Pixelate(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        b.Image.filters.RemoveWhite = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "RemoveWhite",
            initialize: function(a) {
                a = a || {}, this.threshold = a.threshold || 30, this.distance = a.distance || 20
            },
            applyTo: function(a) {
                for (var b, c, d, e = a.getContext("2d"), f = e.getImageData(0, 0, a.width, a.height), g = f.data, h = this.threshold, i = this.distance, j = 255 - h, k = Math.abs, l = 0, m = g.length; m > l; l += 4) b = g[l], c = g[l + 1], d = g[l + 2], b > j && c > j && d > j && k(b - c) < i && k(b - d) < i && k(c - d) < i && (g[l + 3] = 1);
                e.putImageData(f, 0, 0)
            },
            toObject: function() {
                return c(this.callSuper("toObject"), {
                    threshold: this.threshold,
                    distance: this.distance
                })
            }
        }), b.Image.filters.RemoveWhite.fromObject = function(a) {
            return new b.Image.filters.RemoveWhite(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {});
        b.Image.filters.Sepia = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Sepia",
            applyTo: function(a) {
                var b, c, d = a.getContext("2d"),
                    e = d.getImageData(0, 0, a.width, a.height),
                    f = e.data,
                    g = f.length;
                for (b = 0; g > b; b += 4) c = .3 * f[b] + .59 * f[b + 1] + .11 * f[b + 2], f[b] = c + 100, f[b + 1] = c + 50, f[b + 2] = c + 255;
                d.putImageData(e, 0, 0)
            }
        }), b.Image.filters.Sepia.fromObject = function() {
            return new b.Image.filters.Sepia
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {});
        b.Image.filters.Sepia2 = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Sepia2",
            applyTo: function(a) {
                var b, c, d, e, f = a.getContext("2d"),
                    g = f.getImageData(0, 0, a.width, a.height),
                    h = g.data,
                    i = h.length;
                for (b = 0; i > b; b += 4) c = h[b], d = h[b + 1], e = h[b + 2], h[b] = (.393 * c + .769 * d + .189 * e) / 1.351, h[b + 1] = (.349 * c + .686 * d + .168 * e) / 1.203, h[b + 2] = (.272 * c + .534 * d + .131 * e) / 2.14;
                f.putImageData(g, 0, 0)
            }
        }), b.Image.filters.Sepia2.fromObject = function() {
            return new b.Image.filters.Sepia2
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        b.Image.filters.Tint = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Tint",
            initialize: function(a) {
                a = a || {}, this.color = a.color || "#000000", this.opacity = "undefined" != typeof a.opacity ? a.opacity : new b.Color(this.color).getAlpha()
            },
            applyTo: function(a) {
                var c, d, e, f, g, h, i, j, k, l = a.getContext("2d"),
                    m = l.getImageData(0, 0, a.width, a.height),
                    n = m.data,
                    o = n.length;
                for (k = new b.Color(this.color).getSource(), d = k[0] * this.opacity, e = k[1] * this.opacity, f = k[2] * this.opacity, j = 1 - this.opacity, c = 0; o > c; c += 4) g = n[c], h = n[c + 1], i = n[c + 2], n[c] = d + g * j, n[c + 1] = e + h * j, n[c + 2] = f + i * j;
                l.putImageData(m, 0, 0)
            },
            toObject: function() {
                return c(this.callSuper("toObject"), {
                    color: this.color,
                    opacity: this.opacity
                })
            }
        }), b.Image.filters.Tint.fromObject = function(a) {
            return new b.Image.filters.Tint(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend;
        b.Image.filters.Multiply = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Multiply",
            initialize: function(a) {
                a = a || {}, this.color = a.color || "#000000"
            },
            applyTo: function(a) {
                var c, d, e = a.getContext("2d"),
                    f = e.getImageData(0, 0, a.width, a.height),
                    g = f.data,
                    h = g.length;
                for (d = new b.Color(this.color).getSource(), c = 0; h > c; c += 4) g[c] *= d[0] / 255, g[c + 1] *= d[1] / 255, g[c + 2] *= d[2] / 255;
                e.putImageData(f, 0, 0)
            },
            toObject: function() {
                return c(this.callSuper("toObject"), {
                    color: this.color
                })
            }
        }), b.Image.filters.Multiply.fromObject = function(a) {
            return new b.Image.filters.Multiply(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric;
        b.Image.filters.Blend = b.util.createClass({
            type: "Blend",
            initialize: function(a) {
                a = a || {}, this.color = a.color || "#000", this.image = a.image || !1, this.mode = a.mode || "multiply", this.alpha = a.alpha || 1
            },
            applyTo: function(a) {
                var c, d, e, f, g, h, i, j, k, l, m = a.getContext("2d"),
                    n = m.getImageData(0, 0, a.width, a.height),
                    o = n.data,
                    p = !1;
                if (this.image) {
                    p = !0;
                    var q = b.util.createCanvasElement();
                    q.width = this.image.width, q.height = this.image.height;
                    var r = new b.StaticCanvas(q);
                    r.add(this.image);
                    var s = r.getContext("2d");
                    l = s.getImageData(0, 0, r.width, r.height).data
                } else l = new b.Color(this.color).getSource(), c = l[0] * this.alpha, d = l[1] * this.alpha, e = l[2] * this.alpha;
                for (var t = 0, u = o.length; u > t; t += 4) switch (f = o[t], g = o[t + 1], h = o[t + 2], p && (c = l[t] * this.alpha, d = l[t + 1] * this.alpha, e = l[t + 2] * this.alpha), this.mode) {
                    case "multiply":
                        o[t] = f * c / 255, o[t + 1] = g * d / 255, o[t + 2] = h * e / 255;
                        break;
                    case "screen":
                        o[t] = 1 - (1 - f) * (1 - c), o[t + 1] = 1 - (1 - g) * (1 - d), o[t + 2] = 1 - (1 - h) * (1 - e);
                        break;
                    case "add":
                        o[t] = Math.min(255, f + c), o[t + 1] = Math.min(255, g + d), o[t + 2] = Math.min(255, h + e);
                        break;
                    case "diff":
                    case "difference":
                        o[t] = Math.abs(f - c), o[t + 1] = Math.abs(g - d), o[t + 2] = Math.abs(h - e);
                        break;
                    case "subtract":
                        i = f - c, j = g - d, k = h - e, o[t] = 0 > i ? 0 : i, o[t + 1] = 0 > j ? 0 : j, o[t + 2] = 0 > k ? 0 : k;
                        break;
                    case "darken":
                        o[t] = Math.min(f, c), o[t + 1] = Math.min(g, d), o[t + 2] = Math.min(h, e);
                        break;
                    case "lighten":
                        o[t] = Math.max(f, c), o[t + 1] = Math.max(g, d), o[t + 2] = Math.max(h, e)
                }
                m.putImageData(n, 0, 0)
            },
            toObject: function() {
                return {
                    color: this.color,
                    image: this.image,
                    mode: this.mode,
                    alpha: this.alpha
                }
            }
        }), b.Image.filters.Blend.fromObject = function(a) {
            return new b.Image.filters.Blend(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = Math.pow,
            d = Math.floor,
            e = Math.sqrt,
            f = Math.abs,
            g = Math.max,
            h = Math.round,
            i = Math.sin,
            j = Math.ceil;
        b.Image.filters.Resize = b.util.createClass(b.Image.filters.BaseFilter, {
            type: "Resize",
            resizeType: "hermite",
            scaleX: 0,
            scaleY: 0,
            lanczosLobes: 3,
            applyTo: function(a, b, c) {
                this.rcpScaleX = 1 / b, this.rcpScaleY = 1 / c;
                var d, e = a.width,
                    f = a.height,
                    g = h(e * b),
                    i = h(f * c);
                "sliceHack" === this.resizeType && (d = this.sliceByTwo(a, e, f, g, i)), "hermite" === this.resizeType && (d = this.hermiteFastResize(a, e, f, g, i)), "bilinear" === this.resizeType && (d = this.bilinearFiltering(a, e, f, g, i)), "lanczos" === this.resizeType && (d = this.lanczosResize(a, e, f, g, i)), a.width = g, a.height = i, a.getContext("2d").putImageData(d, 0, 0)
            },
            sliceByTwo: function(a, c, e, f, h) {
                var i, j = a.getContext("2d"),
                    k = .5,
                    l = .5,
                    m = 1,
                    n = 1,
                    o = !1,
                    p = !1,
                    q = c,
                    r = e,
                    s = b.util.createCanvasElement(),
                    t = s.getContext("2d");
                for (f = d(f), h = d(h), s.width = g(f, c), s.height = g(h, e), f > c && (k = 2, m = -1), h > e && (l = 2, n = -1), i = j.getImageData(0, 0, c, e), a.width = g(f, c), a.height = g(h, e), j.putImageData(i, 0, 0); !o || !p;) c = q, e = r, f * m < d(q * k * m) ? q = d(q * k) : (q = f, o = !0), h * n < d(r * l * n) ? r = d(r * l) : (r = h, p = !0), i = j.getImageData(0, 0, c, e), t.putImageData(i, 0, 0), j.clearRect(0, 0, q, r), j.drawImage(s, 0, 0, c, e, 0, 0, q, r);
                return j.getImageData(0, 0, f, h)
            },
            lanczosResize: function(a, b, g, h, k) {
                function l(a) {
                    return function(b) {
                        if (b > a) return 0;
                        if (b *= Math.PI, f(b) < 1e-16) return 1;
                        var c = b / a;
                        return i(b) * i(c) / b / c
                    }
                }

                function m(a) {
                    var i, j, l, n, o, C, D, E, F, G, H;
                    for (A.x = (a + .5) * t, B.x = d(A.x), i = 0; k > i; i++) {
                        for (A.y = (i + .5) * u, B.y = d(A.y), o = 0, C = 0, D = 0, E = 0, F = 0, j = B.x - x; j <= B.x + x; j++)
                            if (!(0 > j || j >= b)) {
                                G = d(1e3 * f(j - A.x)), z[G] || (z[G] = {});
                                for (var I = B.y - y; I <= B.y + y; I++) 0 > I || I >= g || (H = d(1e3 * f(I - A.y)), z[G][H] || (z[G][H] = s(e(c(G * v, 2) + c(H * w, 2)) / 1e3)), l = z[G][H], l > 0 && (n = 4 * (I * b + j), o += l, C += l * q[n], D += l * q[n + 1], E += l * q[n + 2], F += l * q[n + 3]))
                            }
                        n = 4 * (i * h + a), r[n] = C / o, r[n + 1] = D / o, r[n + 2] = E / o, r[n + 3] = F / o
                    }
                    return ++a < h ? m(a) : p
                }
                var n = a.getContext("2d"),
                    o = n.getImageData(0, 0, b, g),
                    p = n.getImageData(0, 0, h, k),
                    q = o.data,
                    r = p.data,
                    s = l(this.lanczosLobes),
                    t = this.rcpScaleX,
                    u = this.rcpScaleY,
                    v = 2 / this.rcpScaleX,
                    w = 2 / this.rcpScaleY,
                    x = j(t * this.lanczosLobes / 2),
                    y = j(u * this.lanczosLobes / 2),
                    z = {},
                    A = {},
                    B = {};
                return m(0)
            },
            bilinearFiltering: function(a, b, c, e, f) {
                var g, h, i, j, k, l, m, n, o, p, q, r, s, t = 0,
                    u = this.rcpScaleX,
                    v = this.rcpScaleY,
                    w = a.getContext("2d"),
                    x = 4 * (b - 1),
                    y = w.getImageData(0, 0, b, c),
                    z = y.data,
                    A = w.getImageData(0, 0, e, f),
                    B = A.data;
                for (m = 0; f > m; m++)
                    for (n = 0; e > n; n++)
                        for (k = d(u * n), l = d(v * m), o = u * n - k, p = v * m - l, s = 4 * (l * b + k), q = 0; 4 > q; q++) g = z[s + q], h = z[s + 4 + q], i = z[s + x + q], j = z[s + x + 4 + q], r = g * (1 - o) * (1 - p) + h * o * (1 - p) + i * p * (1 - o) + j * o * p, B[t++] = r;
                return A
            },
            hermiteFastResize: function(a, b, c, g, h) {
                for (var i = this.rcpScaleX, k = this.rcpScaleY, l = j(i / 2), m = j(k / 2), n = a.getContext("2d"), o = n.getImageData(0, 0, b, c), p = o.data, q = n.getImageData(0, 0, g, h), r = q.data, s = 0; h > s; s++)
                    for (var t = 0; g > t; t++) {
                        for (var u = 4 * (t + s * g), v = 0, w = 0, x = 0, y = 0, z = 0, A = 0, B = 0, C = (s + .5) * k, D = d(s * k);
                            (s + 1) * k > D; D++)
                            for (var E = f(C - (D + .5)) / m, F = (t + .5) * i, G = E * E, H = d(t * i);
                                (t + 1) * i > H; H++) {
                                var I = f(F - (H + .5)) / l,
                                    J = e(G + I * I);
                                J > 1 && -1 > J || (v = 2 * J * J * J - 3 * J * J + 1, v > 0 && (I = 4 * (H + D * b), B += v * p[I + 3], x += v, p[I + 3] < 255 && (v = v * p[I + 3] / 250), y += v * p[I], z += v * p[I + 1], A += v * p[I + 2], w += v))
                            }
                        r[u] = y / w, r[u + 1] = z / w, r[u + 2] = A / w, r[u + 3] = B / x
                    }
                return q
            },
            toObject: function() {
                return {
                    type: this.type,
                    scaleX: this.scaleX,
                    scaleY: this.scaleY,
                    resizeType: this.resizeType,
                    lanczosLobes: this.lanczosLobes
                }
            }
        }), b.Image.filters.Resize.fromObject = function(a) {
            return new b.Image.filters.Resize(a)
        }
    }("undefined" != typeof exports ? exports : this),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.extend,
            d = b.util.object.clone,
            e = b.util.toFixed,
            f = b.StaticCanvas.supports("setLineDash"),
            g = b.Object.NUM_FRACTION_DIGITS;
        if (b.Text) return void b.warn("fabric.Text is already defined");
        var h = b.Object.prototype.stateProperties.concat();
        h.push("fontFamily", "fontWeight", "fontSize", "text", "textDecoration", "textAlign", "fontStyle", "lineHeight", "textBackgroundColor"), b.Text = b.util.createClass(b.Object, {
            _dimensionAffectingProps: {
                fontSize: !0,
                fontWeight: !0,
                fontFamily: !0,
                fontStyle: !0,
                lineHeight: !0,
                stroke: !0,
                strokeWidth: !0,
                text: !0,
                textAlign: !0
            },
            _reNewline: /\r?\n/,
            _reSpacesAndTabs: /[ \t\r]+/g,
            type: "text",
            fontSize: 40,
            fontWeight: "normal",
            fontFamily: "Times New Roman",
            textDecoration: "",
            textAlign: "left",
            fontStyle: "",
            lineHeight: 1.16,
            textBackgroundColor: "",
            stateProperties: h,
            stroke: null,
            shadow: null,
            _fontSizeFraction: .25,
            _fontSizeMult: 1.13,
            initialize: function(a, b) {
                b = b || {}, this.text = a, this.__skipDimension = !0, this.setOptions(b), this.__skipDimension = !1, this._initDimensions()
            },
            _initDimensions: function(a) {
                this.__skipDimension || (a || (a = b.util.createCanvasElement().getContext("2d"), this._setTextStyles(a)), this._textLines = this._splitTextIntoLines(), this._clearCache(), this._cacheLinesWidth = "justify" !== this.textAlign, this.width = this._getTextWidth(a), this._cacheLinesWidth = !0, this.height = this._getTextHeight(a))
            },
            toString: function() {
                return "#<fabric.Text (" + this.complexity() + '): { "text": "' + this.text + '", "fontFamily": "' + this.fontFamily + '" }>'
            },
            _render: function(a) {
                this.clipTo && b.util.clipContext(this, a), this._setOpacity(a), this._setShadow(a), this._setupCompositeOperation(a), this._renderTextBackground(a), this._setStrokeStyles(a), this._setFillStyles(a), this._renderText(a), this._renderTextDecoration(a), this.clipTo && a.restore()
            },
            _renderText: function(a) {
                this._translateForTextAlign(a), this._renderTextFill(a), this._renderTextStroke(a), this._translateForTextAlign(a, !0)
            },
            _translateForTextAlign: function(a, b) {
                if ("left" !== this.textAlign && "justify" !== this.textAlign) {
                    var c = b ? -1 : 1;
                    a.translate("center" === this.textAlign ? c * this.width / 2 : c * this.width, 0)
                }
            },
            _setTextStyles: function(a) {
                a.textBaseline = "alphabetic", this.skipTextAlign || (a.textAlign = this.textAlign), a.font = this._getFontDeclaration()
            },
            _getTextHeight: function() {
                return this._textLines.length * this._getHeightOfLine()
            },
            _getTextWidth: function(a) {
                for (var b = this._getLineWidth(a, 0), c = 1, d = this._textLines.length; d > c; c++) {
                    var e = this._getLineWidth(a, c);
                    e > b && (b = e)
                }
                return b
            },
            _renderChars: function(a, b, c, d, e) {
                var f = a.slice(0, -4);
                if (this[f].toLive) {
                    var g = -this.width / 2 + this[f].offsetX || 0,
                        h = -this.height / 2 + this[f].offsetY || 0;
                    b.save(), b.translate(g, h), d -= g, e -= h
                }
                b[a](c, d, e), this[f].toLive && b.restore()
            },
            _renderTextLine: function(a, b, c, d, e, f) {
                e -= this.fontSize * this._fontSizeFraction;
                var g = this._getLineWidth(b, f);
                if ("justify" !== this.textAlign || this.width < g) return void this._renderChars(a, b, c, d, e, f);
                for (var h, i = c.split(/\s+/), j = this._getWidthOfWords(b, c, f), k = this.width - j, l = i.length - 1, m = l > 0 ? k / l : 0, n = 0, o = 0, p = 0, q = i.length; q > p; p++) {
                    for (;
                        " " === c[o] && o < c.length;) o++;
                    h = i[p], this._renderChars(a, b, h, d + n, e, f, o), n += b.measureText(h).width + m, o += h.length
                }
            },
            _getWidthOfWords: function(a, b) {
                return a.measureText(b.replace(/\s+/g, "")).width
            },
            _getLeftOffset: function() {
                return -this.width / 2
            },
            _getTopOffset: function() {
                return -this.height / 2
            },
            _renderTextFill: function(a) {
                if (this.fill || this._skipFillStrokeCheck)
                    for (var b = 0, c = 0, d = this._textLines.length; d > c; c++) {
                        var e = this._getHeightOfLine(a, c),
                            f = e / this.lineHeight;
                        this._renderTextLine("fillText", a, this._textLines[c], this._getLeftOffset(), this._getTopOffset() + b + f, c), b += e
                    }
            },
            _renderTextStroke: function(a) {
                if (this.stroke && 0 !== this.strokeWidth || this._skipFillStrokeCheck) {
                    var b = 0;
                    this.shadow && !this.shadow.affectStroke && this._removeShadow(a), a.save(), this.strokeDashArray && (1 & this.strokeDashArray.length && this.strokeDashArray.push.apply(this.strokeDashArray, this.strokeDashArray), f && a.setLineDash(this.strokeDashArray)), a.beginPath();
                    for (var c = 0, d = this._textLines.length; d > c; c++) {
                        var e = this._getHeightOfLine(a, c),
                            g = e / this.lineHeight;
                        this._renderTextLine("strokeText", a, this._textLines[c], this._getLeftOffset(), this._getTopOffset() + b + g, c), b += e
                    }
                    a.closePath(), a.restore()
                }
            },
            _getHeightOfLine: function() {
                return this.fontSize * this._fontSizeMult * this.lineHeight
            },
            _renderTextBackground: function(a) {
                this._renderTextBoxBackground(a), this._renderTextLinesBackground(a)
            },
            _renderTextBoxBackground: function(a) {
                this.backgroundColor && (a.fillStyle = this.backgroundColor, a.fillRect(this._getLeftOffset(), this._getTopOffset(), this.width, this.height))
            },
            _renderTextLinesBackground: function(a) {
                if (this.textBackgroundColor) {
                    var b, c, d = 0,
                        e = this._getHeightOfLine();
                    a.fillStyle = this.textBackgroundColor;
                    for (var f = 0, g = this._textLines.length; g > f; f++) "" !== this._textLines[f] && (b = this._getLineWidth(a, f), c = this._getLineLeftOffset(b), a.fillRect(this._getLeftOffset() + c, this._getTopOffset() + d, b, this.fontSize * this._fontSizeMult)), d += e
                }
            },
            _getLineLeftOffset: function(a) {
                return "center" === this.textAlign ? (this.width - a) / 2 : "right" === this.textAlign ? this.width - a : 0
            },
            _clearCache: function() {
                this.__lineWidths = [], this.__lineHeights = []
            },
            _shouldClearCache: function() {
                var a = !1;
                if (this._forceClearCache) return this._forceClearCache = !1, !0;
                for (var b in this._dimensionAffectingProps) this["__" + b] !== this[b] && (this["__" + b] = this[b], a = !0);
                return a
            },
            _getLineWidth: function(a, b) {
                if (this.__lineWidths[b]) return this.__lineWidths[b];
                var c, d, e = this._textLines[b];
                return "" === e ? c = 0 : "justify" === this.textAlign && this._cacheLinesWidth ? (d = e.split(" "), c = d.length > 1 ? this.width : a.measureText(e).width) : c = a.measureText(e).width, this._cacheLinesWidth && (this.__lineWidths[b] = c), c
            },
            _renderTextDecoration: function(a) {
                function b(b) {
                    var e, f, g, h, i, j, k, l = 0;
                    for (e = 0, f = d._textLines.length; f > e; e++) {
                        for (i = d._getLineWidth(a, e), j = d._getLineLeftOffset(i), k = d._getHeightOfLine(a, e), g = 0, h = b.length; h > g; g++) a.fillRect(d._getLeftOffset() + j, l + (d._fontSizeMult - 1 + b[g]) * d.fontSize - c, i, d.fontSize / 15);
                        l += k
                    }
                }
                if (this.textDecoration) {
                    var c = this.height / 2,
                        d = this,
                        e = [];
                    this.textDecoration.indexOf("underline") > -1 && e.push(.85), this.textDecoration.indexOf("line-through") > -1 && e.push(.43), this.textDecoration.indexOf("overline") > -1 && e.push(-.12), e.length > 0 && b(e)
                }
            },
            _getFontDeclaration: function() {
                return [b.isLikelyNode ? this.fontWeight : this.fontStyle, b.isLikelyNode ? this.fontStyle : this.fontWeight, this.fontSize + "px", b.isLikelyNode ? '"' + this.fontFamily + '"' : this.fontFamily].join(" ")
            },
            render: function(a, b) {
                this.visible && (a.save(), this._setTextStyles(a), this._shouldClearCache() && this._initDimensions(a), b || this.transform(a), this.transformMatrix && a.transform.apply(a, this.transformMatrix), this.group && "shape" === this.group.type && a.translate(this.left, this.top), this._render(a), a.restore())
            },
            _splitTextIntoLines: function() {
                return this.text.split(this._reNewline)
            },
            toObject: function(a) {
                var b = c(this.callSuper("toObject", a), {
                    text: this.text,
                    fontSize: this.fontSize,
                    fontWeight: this.fontWeight,
                    fontFamily: this.fontFamily,
                    fontStyle: this.fontStyle,
                    lineHeight: this.lineHeight,
                    textDecoration: this.textDecoration,
                    textAlign: this.textAlign,
                    textBackgroundColor: this.textBackgroundColor
                });
                return this.includeDefaultValues || this._removeDefaultValues(b), b
            },
            toSVG: function(a) {
                var b = this._createBaseSVGMarkup(),
                    c = this._getSVGLeftTopOffsets(this.ctx),
                    d = this._getSVGTextAndBg(c.textTop, c.textLeft);
                return this._wrapSVGTextAndBg(b, d), a ? a(b.join("")) : b.join("")
            },
            _getSVGLeftTopOffsets: function(a) {
                var b = this._getHeightOfLine(a, 0),
                    c = -this.width / 2,
                    d = 0;
                return {
                    textLeft: c + (this.group && "shape" === this.group.type ? this.left : 0),
                    textTop: d + (this.group && "shape" === this.group.type ? -this.top : 0),
                    lineTop: b
                }
            },
            _wrapSVGTextAndBg: function(a, b) {
                a.push('	<g transform="', this.getSvgTransform(), this.getSvgTransformMatrix(), '">\n', b.textBgRects.join(""), "		<text ", this.fontFamily ? 'font-family="' + this.fontFamily.replace(/"/g, "'") + '" ' : "", this.fontSize ? 'font-size="' + this.fontSize + '" ' : "", this.fontStyle ? 'font-style="' + this.fontStyle + '" ' : "", this.fontWeight ? 'font-weight="' + this.fontWeight + '" ' : "", this.textDecoration ? 'text-decoration="' + this.textDecoration + '" ' : "", 'style="', this.getSvgStyles(), '" >', b.textSpans.join(""), "</text>\n", "	</g>\n")
            },
            _getSVGTextAndBg: function(a, b) {
                var c = [],
                    d = [],
                    e = 0;
                this._setSVGBg(d);
                for (var f = 0, g = this._textLines.length; g > f; f++) this.textBackgroundColor && this._setSVGTextLineBg(d, f, b, a, e), this._setSVGTextLineText(f, c, e, b, a, d), e += this._getHeightOfLine(this.ctx, f);
                return {
                    textSpans: c,
                    textBgRects: d
                }
            },
            _setSVGTextLineText: function(a, c, d, f, h) {
                var i = this.fontSize * (this._fontSizeMult - this._fontSizeFraction) - h + d - this.height / 2;
                c.push('<tspan x="', e(f + this._getLineLeftOffset(this._getLineWidth(this.ctx, a)), g), '" ', 'y="', e(i, g), '" ', this._getFillAttributes(this.fill), ">", b.util.string.escapeXml(this._textLines[a]), "</tspan>")
            },
            _setSVGTextLineBg: function(a, b, c, d, f) {
                a.push("		<rect ", this._getFillAttributes(this.textBackgroundColor), ' x="', e(c + this._getLineLeftOffset(this._getLineWidth(this.ctx, b)), g), '" y="', e(f - this.height / 2, g), '" width="', e(this._getLineWidth(this.ctx, b), g), '" height="', e(this._getHeightOfLine(this.ctx, b) / this.lineHeight, g), '"></rect>\n')
            },
            _setSVGBg: function(a) {
                this.backgroundColor && a.push("		<rect ", this._getFillAttributes(this.backgroundColor), ' x="', e(-this.width / 2, g), '" y="', e(-this.height / 2, g), '" width="', e(this.width, g), '" height="', e(this.height, g), '"></rect>\n')
            },
            _getFillAttributes: function(a) {
                var c = a && "string" == typeof a ? new b.Color(a) : "";
                return c && c.getSource() && 1 !== c.getAlpha() ? 'opacity="' + c.getAlpha() + '" fill="' + c.setAlpha(1).toRgb() + '"' : 'fill="' + a + '"'
            },
            _set: function(a, b) {
                this.callSuper("_set", a, b), a in this._dimensionAffectingProps && (this._initDimensions(), this.setCoords())
            },
            complexity: function() {
                return 1
            }
        }), b.Text.ATTRIBUTE_NAMES = b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")), b.Text.DEFAULT_SVG_FONT_SIZE = 16, b.Text.fromElement = function(a, c) {
            if (!a) return null;
            var d = b.parseAttributes(a, b.Text.ATTRIBUTE_NAMES);
            c = b.util.object.extend(c ? b.util.object.clone(c) : {}, d), c.top = c.top || 0, c.left = c.left || 0, "dx" in d && (c.left += d.dx), "dy" in d && (c.top += d.dy), "fontSize" in c || (c.fontSize = b.Text.DEFAULT_SVG_FONT_SIZE), c.originX || (c.originX = "left");
            var e = a.textContent.replace(/^\s+|\s+$|\n+/g, "").replace(/\s+/g, " "),
                f = new b.Text(e, c),
                g = 0;
            return "left" === f.originX && (g = f.getWidth() / 2), "right" === f.originX && (g = -f.getWidth() / 2), f.set({
                left: f.getLeft() + g,
                top: f.getTop() - f.getHeight() / 2 + f.fontSize * (.18 + f._fontSizeFraction)
            }), f
        }, b.Text.fromObject = function(a) {
            return new b.Text(a.text, d(a))
        }, b.util.createAccessors(b.Text)
    }("undefined" != typeof exports ? exports : this),
    function() {
        var a = fabric.util.object.clone;
        fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, {
            type: "i-text",
            selectionStart: 0,
            selectionEnd: 0,
            selectionColor: "rgba(17,119,255,0.3)",
            isEditing: !1,
            editable: !0,
            editingBorderColor: "rgba(102,153,255,0.25)",
            cursorWidth: 2,
            cursorColor: "#333",
            cursorDelay: 1e3,
            cursorDuration: 600,
            styles: null,
            caching: !0,
            _skipFillStrokeCheck: !1,
            _reSpace: /\s|\n/,
            _currentCursorOpacity: 0,
            _selectionDirection: null,
            _abortCursorAnimation: !1,
            _charWidthsCache: {},
            initialize: function(a, b) {
                this.styles = b ? b.styles || {} : {}, this.callSuper("initialize", a, b), this.initBehavior()
            },
            _clearCache: function() {
                this.callSuper("_clearCache"), this.__maxFontHeights = [], this.__widthOfSpace = []
            },
            isEmptyStyles: function() {
                if (!this.styles) return !0;
                var a = this.styles;
                for (var b in a)
                    for (var c in a[b])
                        for (var d in a[b][c]) return !1;
                return !0
            },
            setSelectionStart: function(a) {
                a = Math.max(a, 0), this.selectionStart !== a && (this.fire("selection:changed"), this.canvas && this.canvas.fire("text:selection:changed", {
                    target: this
                }), this.selectionStart = a), this._updateTextarea()
            },
            setSelectionEnd: function(a) {
                a = Math.min(a, this.text.length), this.selectionEnd !== a && (this.fire("selection:changed"), this.canvas && this.canvas.fire("text:selection:changed", {
                    target: this
                }), this.selectionEnd = a), this._updateTextarea()
            },
            getSelectionStyles: function(a, b) {
                if (2 === arguments.length) {
                    for (var c = [], d = a; b > d; d++) c.push(this.getSelectionStyles(d));
                    return c
                }
                var e = this.get2DCursorLocation(a),
                    f = this._getStyleDeclaration(e.lineIndex, e.charIndex);
                return f || {}
            },
            setSelectionStyles: function(a) {
                if (this.selectionStart === this.selectionEnd) this._extendStyles(this.selectionStart, a);
                else
                    for (var b = this.selectionStart; b < this.selectionEnd; b++) this._extendStyles(b, a);
                return this._forceClearCache = !0, this
            },
            _extendStyles: function(a, b) {
                var c = this.get2DCursorLocation(a);
                this._getLineStyle(c.lineIndex) || this._setLineStyle(c.lineIndex, {}), this._getStyleDeclaration(c.lineIndex, c.charIndex) || this._setStyleDeclaration(c.lineIndex, c.charIndex, {}), fabric.util.object.extend(this._getStyleDeclaration(c.lineIndex, c.charIndex), b)
            },
            _render: function(a) {
                this.callSuper("_render", a), this.ctx = a, this.isEditing && this.renderCursorOrSelection()
            },
            renderCursorOrSelection: function() {
                if (this.active) {
                    var a, b, c = this.text.split("");
                    this.canvas.contextTop ? (b = this.canvas.contextTop, b.save(), b.transform.apply(b, this.canvas.viewportTransform), this.transform(b), this.transformMatrix && b.transform.apply(b, this.transformMatrix)) : (b = this.ctx, b.save()), this.selectionStart === this.selectionEnd ? (a = this._getCursorBoundaries(c, "cursor"), this.renderCursor(a, b)) : (a = this._getCursorBoundaries(c, "selection"), this.renderSelection(c, a, b)), b.restore()
                }
            },
            get2DCursorLocation: function(a) {
                "undefined" == typeof a && (a = this.selectionStart);
                for (var b = this._textLines.length, c = 0; b > c; c++) {
                    if (a <= this._textLines[c].length) return {
                        lineIndex: c,
                        charIndex: a
                    };
                    a -= this._textLines[c].length + 1
                }
                return {
                    lineIndex: c - 1,
                    charIndex: this._textLines[c - 1].length < a ? this._textLines[c - 1].length : a
                }
            },
            getCurrentCharStyle: function(a, b) {
                var c = this._getStyleDeclaration(a, 0 === b ? 0 : b - 1);
                return {
                    fontSize: c && c.fontSize || this.fontSize,
                    fill: c && c.fill || this.fill,
                    textBackgroundColor: c && c.textBackgroundColor || this.textBackgroundColor,
                    textDecoration: c && c.textDecoration || this.textDecoration,
                    fontFamily: c && c.fontFamily || this.fontFamily,
                    fontWeight: c && c.fontWeight || this.fontWeight,
                    fontStyle: c && c.fontStyle || this.fontStyle,
                    stroke: c && c.stroke || this.stroke,
                    strokeWidth: c && c.strokeWidth || this.strokeWidth
                }
            },
            getCurrentCharFontSize: function(a, b) {
                var c = this._getStyleDeclaration(a, 0 === b ? 0 : b - 1);
                return c && c.fontSize ? c.fontSize : this.fontSize
            },
            getCurrentCharColor: function(a, b) {
                var c = this._getStyleDeclaration(a, 0 === b ? 0 : b - 1);
                return c && c.fill ? c.fill : this.cursorColor
            },
            _getCursorBoundaries: function(a, b) {
                var c = Math.round(this._getLeftOffset()),
                    d = this._getTopOffset(),
                    e = this._getCursorBoundariesOffsets(a, b);
                return {
                    left: c,
                    top: d,
                    leftOffset: e.left + e.lineLeft,
                    topOffset: e.top
                }
            },
            _getCursorBoundariesOffsets: function(a, b) {
                for (var c = 0, d = 0, e = 0, f = 0, g = 0, h = 0; h < this.selectionStart; h++) "\n" === a[h] ? (g = 0, f += this._getHeightOfLine(this.ctx, d), d++, e = 0) : (g += this._getWidthOfChar(this.ctx, a[h], d, e), e++), c = this._getLineLeftOffset(this._getLineWidth(this.ctx, d));
                return "cursor" === b && (f += (1 - this._fontSizeFraction) * this._getHeightOfLine(this.ctx, d) / this.lineHeight - this.getCurrentCharFontSize(d, e) * (1 - this._fontSizeFraction)), {
                    top: f,
                    left: g,
                    lineLeft: c
                }
            },
            renderCursor: function(a, b) {
                var c = this.get2DCursorLocation(),
                    d = c.lineIndex,
                    e = c.charIndex,
                    f = this.getCurrentCharFontSize(d, e),
                    g = 0 === d && 0 === e ? this._getLineLeftOffset(this._getLineWidth(b, d)) : a.leftOffset;
                b.fillStyle = this.getCurrentCharColor(d, e), b.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity, b.fillRect(a.left + g, a.top + a.topOffset, this.cursorWidth / this.scaleX, f)
            },
            renderSelection: function(a, b, c) {
                c.fillStyle = this.selectionColor;
                for (var d = this.get2DCursorLocation(this.selectionStart), e = this.get2DCursorLocation(this.selectionEnd), f = d.lineIndex, g = e.lineIndex, h = f; g >= h; h++) {
                    var i = this._getLineLeftOffset(this._getLineWidth(c, h)) || 0,
                        j = this._getHeightOfLine(this.ctx, h),
                        k = 0,
                        l = this._textLines[h];
                    if (h === f)
                        for (var m = 0, n = l.length; n > m; m++) m >= d.charIndex && (h !== g || m < e.charIndex) && (k += this._getWidthOfChar(c, l[m], h, m)), m < d.charIndex && (i += this._getWidthOfChar(c, l[m], h, m));
                    else if (h > f && g > h) k += this._getLineWidth(c, h) || 5;
                    else if (h === g)
                        for (var o = 0, p = e.charIndex; p > o; o++) k += this._getWidthOfChar(c, l[o], h, o);
                    c.fillRect(b.left + i, b.top + b.topOffset, k, j), b.topOffset += j
                }
            },
            _renderChars: function(a, b, c, d, e, f, g) {
                if (this.isEmptyStyles()) return this._renderCharsFast(a, b, c, d, e);
                g = g || 0, this.skipTextAlign = !0, d -= "center" === this.textAlign ? this.width / 2 : "right" === this.textAlign ? this.width : 0;
                var h, i, j = this._getHeightOfLine(b, f),
                    k = this._getLineLeftOffset(this._getLineWidth(b, f)),
                    l = "";
                d += k || 0, b.save(), e -= j / this.lineHeight * this._fontSizeFraction;
                for (var m = g, n = c.length + g; n >= m; m++) h = h || this.getCurrentCharStyle(f, m), i = this.getCurrentCharStyle(f, m + 1), (this._hasStyleChanged(h, i) || m === n) && (this._renderChar(a, b, f, m - 1, l, d, e, j), l = "", h = i), l += c[m - g];
                b.restore()
            },
            _renderCharsFast: function(a, b, c, d, e) {
                this.skipTextAlign = !1, "fillText" === a && this.fill && this.callSuper("_renderChars", a, b, c, d, e), "strokeText" === a && (this.stroke && this.strokeWidth > 0 || this.skipFillStrokeCheck) && this.callSuper("_renderChars", a, b, c, d, e)
            },
            _renderChar: function(a, b, c, d, e, f, g, h) {
                var i, j, k = this._getStyleDeclaration(c, d),
                    l = this._fontSizeFraction * h / this.lineHeight;
                if (k) {
                    var m = k.stroke || this.stroke,
                        n = k.fill || this.fill;
                    b.save(), i = this._applyCharStylesGetWidth(b, e, c, d, k), j = this._getHeightOfChar(b, e, c, d), n && b.fillText(e, f, g), m && b.strokeText(e, f, g), this._renderCharDecoration(b, k, f, g, l, i, j), b.restore(), b.translate(i, 0)
                } else "strokeText" === a && this.stroke && b[a](e, f, g), "fillText" === a && this.fill && b[a](e, f, g), i = this._applyCharStylesGetWidth(b, e, c, d), this._renderCharDecoration(b, null, f, g, l, i, this.fontSize), b.translate(b.measureText(e).width, 0)
            },
            _hasStyleChanged: function(a, b) {
                return a.fill !== b.fill || a.fontSize !== b.fontSize || a.textBackgroundColor !== b.textBackgroundColor || a.textDecoration !== b.textDecoration || a.fontFamily !== b.fontFamily || a.fontWeight !== b.fontWeight || a.fontStyle !== b.fontStyle || a.stroke !== b.stroke || a.strokeWidth !== b.strokeWidth
            },
            _renderCharDecoration: function(a, b, c, d, e, f, g) {
                var h = b ? b.textDecoration || this.textDecoration : this.textDecoration;
                h && (h.indexOf("underline") > -1 && a.fillRect(c, d + g / 10, f, g / 15), h.indexOf("line-through") > -1 && a.fillRect(c, d - g * (this._fontSizeFraction + this._fontSizeMult - 1) + g / 15, f, g / 15), h.indexOf("overline") > -1 && a.fillRect(c, d - (this._fontSizeMult - this._fontSizeFraction) * g, f, g / 15))
            },
            _renderTextLine: function(a, b, c, d, e, f) {
                this.isEmptyStyles() || (e += this.fontSize * (this._fontSizeFraction + .03)), this.callSuper("_renderTextLine", a, b, c, d, e, f)
            },
            _renderTextDecoration: function(a) {
                return this.isEmptyStyles() ? this.callSuper("_renderTextDecoration", a) : void 0
            },
            _renderTextLinesBackground: function(a) {
                if (this.textBackgroundColor || this.styles) {
                    a.save(), this.textBackgroundColor && (a.fillStyle = this.textBackgroundColor);
                    for (var b = 0, c = 0, d = this._textLines.length; d > c; c++) {
                        var e = this._getHeightOfLine(a, c);
                        if ("" !== this._textLines[c]) {
                            var f = this._getLineWidth(a, c),
                                g = this._getLineLeftOffset(f);
                            if (this.textBackgroundColor && (a.fillStyle = this.textBackgroundColor, a.fillRect(this._getLeftOffset() + g, this._getTopOffset() + b, f, e / this.lineHeight)), this._getLineStyle(c))
                                for (var h = 0, i = this._textLines[c].length; i > h; h++) {
                                    var j = this._getStyleDeclaration(c, h);
                                    if (j && j.textBackgroundColor) {
                                        var k = this._textLines[c][h];
                                        a.fillStyle = j.textBackgroundColor, a.fillRect(this._getLeftOffset() + g + this._getWidthOfCharsAt(a, c, h), this._getTopOffset() + b, this._getWidthOfChar(a, k, c, h) + 1, e / this.lineHeight)
                                    }
                                }
                            b += e
                        } else b += e
                    }
                    a.restore()
                }
            },
            _getCacheProp: function(a, b) {
                return a + b.fontFamily + b.fontSize + b.fontWeight + b.fontStyle + b.shadow
            },
            _applyCharStylesGetWidth: function(a, b, c, d, e) {
                var f = e || this._getStyleDeclaration(c, d, !0);
                this._applyFontStyles(f);
                var g = this._getCacheProp(b, f);
                if (this.isEmptyStyles() && this._charWidthsCache[g] && this.caching) return this._charWidthsCache[g];
                "string" == typeof f.shadow && (f.shadow = new fabric.Shadow(f.shadow));
                var h = f.fill || this.fill;
                return a.fillStyle = h.toLive ? h.toLive(a, this) : h, f.stroke && (a.strokeStyle = f.stroke && f.stroke.toLive ? f.stroke.toLive(a, this) : f.stroke), a.lineWidth = f.strokeWidth || this.strokeWidth, a.font = this._getFontDeclaration.call(f), this._setShadow.call(f, a), this.caching ? (this._charWidthsCache[g] || (this._charWidthsCache[g] = a.measureText(b).width), this._charWidthsCache[g]) : a.measureText(b).width
            },
            _applyFontStyles: function(a) {
                a.fontFamily || (a.fontFamily = this.fontFamily), a.fontSize || (a.fontSize = this.fontSize), a.fontWeight || (a.fontWeight = this.fontWeight), a.fontStyle || (a.fontStyle = this.fontStyle)
            },
            _getStyleDeclaration: function(b, c, d) {
                return d ? this.styles[b] && this.styles[b][c] ? a(this.styles[b][c]) : {} : this.styles[b] && this.styles[b][c] ? this.styles[b][c] : null
            },
            _setStyleDeclaration: function(a, b, c) {
                this.styles[a][b] = c
            },
            _deleteStyleDeclaration: function(a, b) {
                delete this.styles[a][b]
            },
            _getLineStyle: function(a) {
                return this.styles[a];
            },
            _setLineStyle: function(a, b) {
                this.styles[a] = b
            },
            _deleteLineStyle: function(a) {
                delete this.styles[a]
            },
            _getWidthOfChar: function(a, b, c, d) {
                if ("justify" === this.textAlign && this._reSpacesAndTabs.test(b)) return this._getWidthOfSpace(a, c);
                var e = this._getStyleDeclaration(c, d, !0);
                this._applyFontStyles(e);
                var f = this._getCacheProp(b, e);
                if (this._charWidthsCache[f] && this.caching) return this._charWidthsCache[f];
                if (a) {
                    a.save();
                    var g = this._applyCharStylesGetWidth(a, b, c, d);
                    return a.restore(), g
                }
            },
            _getHeightOfChar: function(a, b, c, d) {
                var e = this._getStyleDeclaration(c, d);
                return e && e.fontSize ? e.fontSize : this.fontSize
            },
            _getHeightOfCharAt: function(a, b, c) {
                var d = this._textLines[b][c];
                return this._getHeightOfChar(a, d, b, c)
            },
            _getWidthOfCharsAt: function(a, b, c) {
                var d, e, f = 0;
                for (d = 0; c > d; d++) e = this._textLines[b][d], f += this._getWidthOfChar(a, e, b, d);
                return f
            },
            _getLineWidth: function(a, b) {
                return this.__lineWidths[b] ? this.__lineWidths[b] : (this.__lineWidths[b] = this._getWidthOfCharsAt(a, b, this._textLines[b].length), this.__lineWidths[b])
            },
            _getWidthOfSpace: function(a, b) {
                if (this.__widthOfSpace[b]) return this.__widthOfSpace[b];
                var c = this._textLines[b],
                    d = this._getWidthOfWords(a, c, b),
                    e = this.width - d,
                    f = c.length - c.replace(this._reSpacesAndTabs, "").length,
                    g = e / f;
                return this.__widthOfSpace[b] = g, g
            },
            _getWidthOfWords: function(a, b, c) {
                for (var d = 0, e = 0; e < b.length; e++) {
                    var f = b[e];
                    f.match(/\s/) || (d += this._getWidthOfChar(a, f, c, e))
                }
                return d
            },
            _getHeightOfLine: function(a, b) {
                if (this.__lineHeights[b]) return this.__lineHeights[b];
                for (var c = this._textLines[b], d = this._getHeightOfChar(a, c[0], b, 0), e = 1, f = c.length; f > e; e++) {
                    var g = this._getHeightOfChar(a, c[e], b, e);
                    g > d && (d = g)
                }
                return this.__maxFontHeights[b] = d, this.__lineHeights[b] = d * this.lineHeight * this._fontSizeMult, this.__lineHeights[b]
            },
            _getTextHeight: function(a) {
                for (var b = 0, c = 0, d = this._textLines.length; d > c; c++) b += this._getHeightOfLine(a, c);
                return b
            },
            _renderTextBoxBackground: function(a) {
                this.backgroundColor && (a.save(), a.fillStyle = this.backgroundColor, a.fillRect(this._getLeftOffset(), this._getTopOffset(), this.width, this.height), a.restore())
            },
            toObject: function(b) {
                return fabric.util.object.extend(this.callSuper("toObject", b), {
                    styles: a(this.styles)
                })
            }
        }), fabric.IText.fromObject = function(b) {
            return new fabric.IText(b.text, a(b))
        }
    }(),
    function() {
        var a = fabric.util.object.clone;
        fabric.util.object.extend(fabric.IText.prototype, {
            initBehavior: function() {
                this.initAddedHandler(), this.initRemovedHandler(), this.initCursorSelectionHandlers(), this.initDoubleClickSimulation()
            },
            initSelectedHandler: function() {
                this.on("selected", function() {
                    var a = this;
                    setTimeout(function() {
                        a.selected = !0
                    }, 100)
                })
            },
            initAddedHandler: function() {
                var a = this;
                this.on("added", function() {
                    this.canvas && !this.canvas._hasITextHandlers && (this.canvas._hasITextHandlers = !0, this._initCanvasHandlers()), a.canvas && (a.canvas._iTextInstances = a.canvas._iTextInstances || [], a.canvas._iTextInstances.push(a))
                })
            },
            initRemovedHandler: function() {
                var a = this;
                this.on("removed", function() {
                    a.canvas && (a.canvas._iTextInstances = a.canvas._iTextInstances || [], fabric.util.removeFromArray(a.canvas._iTextInstances, a))
                })
            },
            _initCanvasHandlers: function() {
                var a = this;
                this.canvas.on("selection:cleared", function() {
                    fabric.IText.prototype.exitEditingOnOthers(a.canvas)
                }), this.canvas.on("mouse:up", function() {
                    a.canvas._iTextInstances && a.canvas._iTextInstances.forEach(function(a) {
                        a.__isMousedown = !1
                    })
                }), this.canvas.on("object:selected", function() {
                    fabric.IText.prototype.exitEditingOnOthers(a.canvas)
                })
            },
            _tick: function() {
                this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, "_onTickComplete")
            },
            _animateCursor: function(a, b, c, d) {
                var e;
                return e = {
                    isAborted: !1,
                    abort: function() {
                        this.isAborted = !0
                    }
                }, a.animate("_currentCursorOpacity", b, {
                    duration: c,
                    onComplete: function() {
                        e.isAborted || a[d]()
                    },
                    onChange: function() {
                        a.canvas && (a.canvas.clearContext(a.canvas.contextTop || a.ctx), a.renderCursorOrSelection())
                    },
                    abort: function() {
                        return e.isAborted
                    }
                }), e
            },
            _onTickComplete: function() {
                var a = this;
                this._cursorTimeout1 && clearTimeout(this._cursorTimeout1), this._cursorTimeout1 = setTimeout(function() {
                    a._currentTickCompleteState = a._animateCursor(a, 0, this.cursorDuration / 2, "_tick")
                }, 100)
            },
            initDelayedCursor: function(a) {
                var b = this,
                    c = a ? 0 : this.cursorDelay;
                this._currentTickState && this._currentTickState.abort(), this._currentTickCompleteState && this._currentTickCompleteState.abort(), clearTimeout(this._cursorTimeout1), this._currentCursorOpacity = 1, this.canvas && (this.canvas.clearContext(this.canvas.contextTop || this.ctx), this.renderCursorOrSelection()), this._cursorTimeout2 && clearTimeout(this._cursorTimeout2), this._cursorTimeout2 = setTimeout(function() {
                    b._tick()
                }, c)
            },
            abortCursorAnimation: function() {
                this._currentTickState && this._currentTickState.abort(), this._currentTickCompleteState && this._currentTickCompleteState.abort(), clearTimeout(this._cursorTimeout1), clearTimeout(this._cursorTimeout2), this._currentCursorOpacity = 0, this.canvas && this.canvas.clearContext(this.canvas.contextTop || this.ctx)
            },
            selectAll: function() {
                this.setSelectionStart(0), this.setSelectionEnd(this.text.length)
            },
            getSelectedText: function() {
                return this.text.slice(this.selectionStart, this.selectionEnd)
            },
            findWordBoundaryLeft: function(a) {
                var b = 0,
                    c = a - 1;
                if (this._reSpace.test(this.text.charAt(c)))
                    for (; this._reSpace.test(this.text.charAt(c));) b++, c--;
                for (;
                    /\S/.test(this.text.charAt(c)) && c > -1;) b++, c--;
                return a - b
            },
            findWordBoundaryRight: function(a) {
                var b = 0,
                    c = a;
                if (this._reSpace.test(this.text.charAt(c)))
                    for (; this._reSpace.test(this.text.charAt(c));) b++, c++;
                for (;
                    /\S/.test(this.text.charAt(c)) && c < this.text.length;) b++, c++;
                return a + b
            },
            findLineBoundaryLeft: function(a) {
                for (var b = 0, c = a - 1; !/\n/.test(this.text.charAt(c)) && c > -1;) b++, c--;
                return a - b
            },
            findLineBoundaryRight: function(a) {
                for (var b = 0, c = a; !/\n/.test(this.text.charAt(c)) && c < this.text.length;) b++, c++;
                return a + b
            },
            getNumNewLinesInSelectedText: function() {
                for (var a = this.getSelectedText(), b = 0, c = 0, d = a.length; d > c; c++) "\n" === a[c] && b++;
                return b
            },
            searchWordBoundary: function(a, b) {
                for (var c = this._reSpace.test(this.text.charAt(a)) ? a - 1 : a, d = this.text.charAt(c), e = /[ \n\.,;!\?\-]/; !e.test(d) && c > 0 && c < this.text.length;) c += b, d = this.text.charAt(c);
                return e.test(d) && "\n" !== d && (c += 1 === b ? 0 : 1), c
            },
            selectWord: function(a) {
                var b = this.searchWordBoundary(a, -1),
                    c = this.searchWordBoundary(a, 1);
                this.setSelectionStart(b), this.setSelectionEnd(c)
            },
            selectLine: function(a) {
                var b = this.findLineBoundaryLeft(a),
                    c = this.findLineBoundaryRight(a);
                this.setSelectionStart(b), this.setSelectionEnd(c)
            },
            enterEditing: function() {
                return !this.isEditing && this.editable ? (this.canvas && this.exitEditingOnOthers(this.canvas), this.isEditing = !0, this.initHiddenTextarea(), this.hiddenTextarea.focus(), this._updateTextarea(), this._saveEditingProps(), this._setEditingProps(), this._tick(), this.fire("editing:entered"), this.canvas ? (this.canvas.renderAll(), this.canvas.fire("text:editing:entered", {
                    target: this
                }), this.initMouseMoveHandler(), this) : this) : void 0
            },
            exitEditingOnOthers: function(a) {
                a._iTextInstances && a._iTextInstances.forEach(function(a) {
                    a.selected = !1, a.isEditing && a.exitEditing()
                })
            },
            initMouseMoveHandler: function() {
                var a = this;
                this.canvas.on("mouse:move", function(b) {
                    if (a.__isMousedown && a.isEditing) {
                        var c = a.getSelectionStartFromPointer(b.e);
                        c >= a.__selectionStartOnMouseDown ? (a.setSelectionStart(a.__selectionStartOnMouseDown), a.setSelectionEnd(c)) : (a.setSelectionStart(c), a.setSelectionEnd(a.__selectionStartOnMouseDown))
                    }
                })
            },
            _setEditingProps: function() {
                this.hoverCursor = "text", this.canvas && (this.canvas.defaultCursor = this.canvas.moveCursor = "text"), this.borderColor = this.editingBorderColor, this.hasControls = this.selectable = !1, this.lockMovementX = this.lockMovementY = !0
            },
            _updateTextarea: function() {
                this.hiddenTextarea && (this.hiddenTextarea.value = this.text, this.hiddenTextarea.selectionStart = this.selectionStart, this.hiddenTextarea.selectionEnd = this.selectionEnd)
            },
            _saveEditingProps: function() {
                this._savedProps = {
                    hasControls: this.hasControls,
                    borderColor: this.borderColor,
                    lockMovementX: this.lockMovementX,
                    lockMovementY: this.lockMovementY,
                    hoverCursor: this.hoverCursor,
                    defaultCursor: this.canvas && this.canvas.defaultCursor,
                    moveCursor: this.canvas && this.canvas.moveCursor
                }
            },
            _restoreEditingProps: function() {
                this._savedProps && (this.hoverCursor = this._savedProps.overCursor, this.hasControls = this._savedProps.hasControls, this.borderColor = this._savedProps.borderColor, this.lockMovementX = this._savedProps.lockMovementX, this.lockMovementY = this._savedProps.lockMovementY, this.canvas && (this.canvas.defaultCursor = this._savedProps.defaultCursor, this.canvas.moveCursor = this._savedProps.moveCursor))
            },
            exitEditing: function() {
                return this.selected = !1, this.isEditing = !1, this.selectable = !0, this.selectionEnd = this.selectionStart, this.hiddenTextarea && this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea), this.hiddenTextarea = null, this.abortCursorAnimation(), this._restoreEditingProps(), this._currentCursorOpacity = 0, this.fire("editing:exited"), this.canvas && this.canvas.fire("text:editing:exited", {
                    target: this
                }), this
            },
            _removeExtraneousStyles: function() {
                for (var a in this.styles) this._textLines[a] || delete this.styles[a]
            },
            _removeCharsFromTo: function(a, b) {
                for (; b !== a;) this._removeSingleCharAndStyle(a + 1), b--;
                this.setSelectionStart(a)
            },
            _removeSingleCharAndStyle: function(a) {
                var b = "\n" === this.text[a - 1],
                    c = b ? a : a - 1;
                this.removeStyleObject(b, c), this.text = this.text.slice(0, a - 1) + this.text.slice(a), this._textLines = this._splitTextIntoLines()
            },
            insertChars: function(a, b) {
                var c;
                this.selectionEnd - this.selectionStart > 1 && (this._removeCharsFromTo(this.selectionStart, this.selectionEnd), this.setSelectionEnd(this.selectionStart));
                for (var d = 0, e = a.length; e > d; d++) b && (c = fabric.copiedTextStyle[d]), this.insertChar(a[d], e - 1 > d, c)
            },
            insertChar: function(a, b, c) {
                var d = "\n" === this.text[this.selectionStart];
                this.text = this.text.slice(0, this.selectionStart) + a + this.text.slice(this.selectionEnd), this._textLines = this._splitTextIntoLines(), this.insertStyleObjects(a, d, c), this.setSelectionStart(this.selectionStart + 1), this.setSelectionEnd(this.selectionStart), b || (this.canvas && this.canvas.renderAll(), this.setCoords(), this.fire("changed"), this.canvas && this.canvas.fire("text:changed", {
                    target: this
                }))
            },
            insertNewlineStyleObject: function(b, c, d) {
                this.shiftLineStyles(b, 1), this.styles[b + 1] || (this.styles[b + 1] = {});
                var e = {},
                    f = {};
                if (this.styles[b] && this.styles[b][c - 1] && (e = this.styles[b][c - 1]), d) f[0] = a(e), this.styles[b + 1] = f;
                else {
                    for (var g in this.styles[b]) parseInt(g, 10) >= c && (f[parseInt(g, 10) - c] = this.styles[b][g], delete this.styles[b][g]);
                    this.styles[b + 1] = f
                }
                this._forceClearCache = !0
            },
            insertCharStyleObject: function(b, c, d) {
                var e = this.styles[b],
                    f = a(e);
                0 !== c || d || (c = 1);
                for (var g in f) {
                    var h = parseInt(g, 10);
                    h >= c && (e[h + 1] = f[h], f[h - 1] || delete e[h])
                }
                this.styles[b][c] = d || a(e[c - 1]), this._forceClearCache = !0
            },
            insertStyleObjects: function(a, b, c) {
                var d = this.get2DCursorLocation(),
                    e = d.lineIndex,
                    f = d.charIndex;
                this._getLineStyle(e) || this._setLineStyle(e, {}), "\n" === a ? this.insertNewlineStyleObject(e, f, b) : this.insertCharStyleObject(e, f, c)
            },
            shiftLineStyles: function(b, c) {
                var d = a(this.styles);
                for (var e in this.styles) {
                    var f = parseInt(e, 10);
                    f > b && (this.styles[f + c] = d[f], d[f - c] || delete this.styles[f])
                }
            },
            removeStyleObject: function(a, b) {
                var c = this.get2DCursorLocation(b),
                    d = c.lineIndex,
                    e = c.charIndex;
                this._removeStyleObject(a, c, d, e)
            },
            _getTextOnPreviousLine: function(a) {
                return this._textLines[a - 1]
            },
            _removeStyleObject: function(b, c, d, e) {
                if (b) {
                    var f = this._getTextOnPreviousLine(c.lineIndex),
                        g = f ? f.length : 0;
                    this.styles[d - 1] || (this.styles[d - 1] = {});
                    for (e in this.styles[d]) this.styles[d - 1][parseInt(e, 10) + g] = this.styles[d][e];
                    this.shiftLineStyles(c.lineIndex, -1)
                } else {
                    var h = this.styles[d];
                    h && delete h[e];
                    var i = a(h);
                    for (var j in i) {
                        var k = parseInt(j, 10);
                        k >= e && 0 !== k && (h[k - 1] = i[k], delete h[k])
                    }
                }
            },
            insertNewline: function() {
                this.insertChars("\n")
            }
        })
    }(), fabric.util.object.extend(fabric.IText.prototype, {
        initDoubleClickSimulation: function() {
            this.__lastClickTime = +new Date, this.__lastLastClickTime = +new Date, this.__lastPointer = {}, this.on("mousedown", this.onMouseDown.bind(this))
        },
        onMouseDown: function(a) {
            this.__newClickTime = +new Date;
            var b = this.canvas.getPointer(a.e);
            this.isTripleClick(b) ? (this.fire("tripleclick", a), this._stopEvent(a.e)) : this.isDoubleClick(b) && (this.fire("dblclick", a), this._stopEvent(a.e)), this.__lastLastClickTime = this.__lastClickTime, this.__lastClickTime = this.__newClickTime, this.__lastPointer = b, this.__lastIsEditing = this.isEditing, this.__lastSelected = this.selected
        },
        isDoubleClick: function(a) {
            return this.__newClickTime - this.__lastClickTime < 500 && this.__lastPointer.x === a.x && this.__lastPointer.y === a.y && this.__lastIsEditing
        },
        isTripleClick: function(a) {
            return this.__newClickTime - this.__lastClickTime < 500 && this.__lastClickTime - this.__lastLastClickTime < 500 && this.__lastPointer.x === a.x && this.__lastPointer.y === a.y
        },
        _stopEvent: function(a) {
            a.preventDefault && a.preventDefault(), a.stopPropagation && a.stopPropagation()
        },
        initCursorSelectionHandlers: function() {
            this.initSelectedHandler(), this.initMousedownHandler(), this.initMouseupHandler(), this.initClicks()
        },
        initClicks: function() {
            this.on("dblclick", function(a) {
                this.selectWord(this.getSelectionStartFromPointer(a.e))
            }), this.on("tripleclick", function(a) {
                this.selectLine(this.getSelectionStartFromPointer(a.e))
            })
        },
        initMousedownHandler: function() {
            this.on("mousedown", function(a) {
                var b = this.canvas.getPointer(a.e);
                this.__mousedownX = b.x, this.__mousedownY = b.y, this.__isMousedown = !0, this.hiddenTextarea && this.canvas && this.canvas.wrapperEl.appendChild(this.hiddenTextarea), this.selected && this.setCursorByClick(a.e), this.isEditing && (this.__selectionStartOnMouseDown = this.selectionStart, this.initDelayedCursor(!0))
            })
        },
        _isObjectMoved: function(a) {
            var b = this.canvas.getPointer(a);
            return this.__mousedownX !== b.x || this.__mousedownY !== b.y
        },
        initMouseupHandler: function() {
            this.on("mouseup", function(a) {
                this.__isMousedown = !1, this._isObjectMoved(a.e) || (this.__lastSelected && (this.enterEditing(), this.initDelayedCursor(!0)), this.selected = !0)
            })
        },
        setCursorByClick: function(a) {
            var b = this.getSelectionStartFromPointer(a);
            a.shiftKey ? b < this.selectionStart ? (this.setSelectionEnd(this.selectionStart), this.setSelectionStart(b)) : this.setSelectionEnd(b) : (this.setSelectionStart(b), this.setSelectionEnd(b))
        },
        getSelectionStartFromPointer: function(a) {
            for (var b, c, d = this.getLocalPointer(a), e = 0, f = 0, g = 0, h = 0, i = 0, j = this._textLines.length; j > i; i++) {
                c = this._textLines[i], g += this._getHeightOfLine(this.ctx, i) * this.scaleY;
                var k = this._getLineWidth(this.ctx, i),
                    l = this._getLineLeftOffset(k);
                f = l * this.scaleX, this.flipX && (this._textLines[i] = c.reverse().join(""));
                for (var m = 0, n = c.length; n > m; m++) {
                    if (e = f, f += this._getWidthOfChar(this.ctx, c[m], i, this.flipX ? n - m : m) * this.scaleX, !(g <= d.y || f <= d.x)) return this._getNewSelectionStartFromOffset(d, e, f, h + i, n);
                    h++
                }
                if (d.y < g) return this._getNewSelectionStartFromOffset(d, e, f, h + i - 1, n)
            }
            return "undefined" == typeof b ? this.text.length : void 0
        },
        _getNewSelectionStartFromOffset: function(a, b, c, d, e) {
            var f = a.x - b,
                g = c - a.x,
                h = g > f ? 0 : 1,
                i = d + h;
            return this.flipX && (i = e - i), i > this.text.length && (i = this.text.length), i
        }
    }), fabric.util.object.extend(fabric.IText.prototype, {
        initHiddenTextarea: function() {
            this.hiddenTextarea = fabric.document.createElement("textarea"), this.hiddenTextarea.setAttribute("autocapitalize", "off"), this.hiddenTextarea.style.cssText = "position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;", fabric.document.body.appendChild(this.hiddenTextarea), fabric.util.addListener(this.hiddenTextarea, "keydown", this.onKeyDown.bind(this)), fabric.util.addListener(this.hiddenTextarea, "input", this.onInput.bind(this)), fabric.util.addListener(this.hiddenTextarea, "copy", this.copy.bind(this)), fabric.util.addListener(this.hiddenTextarea, "paste", this.paste.bind(this)), !this._clickHandlerInitialized && this.canvas && (fabric.util.addListener(this.canvas.upperCanvasEl, "click", this.onClick.bind(this)), this._clickHandlerInitialized = !0)
        },
        _keysMap: {
            8: "removeChars",
            9: "exitEditing",
            27: "exitEditing",
            13: "insertNewline",
            33: "moveCursorUp",
            34: "moveCursorDown",
            35: "moveCursorRight",
            36: "moveCursorLeft",
            37: "moveCursorLeft",
            38: "moveCursorUp",
            39: "moveCursorRight",
            40: "moveCursorDown",
            46: "forwardDelete"
        },
        _ctrlKeysMap: {
            65: "selectAll",
            88: "cut"
        },
        onClick: function() {
            this.hiddenTextarea && this.hiddenTextarea.focus()
        },
        onKeyDown: function(a) {
            if (this.isEditing) {
                if (a.keyCode in this._keysMap) this[this._keysMap[a.keyCode]](a);
                else {
                    if (!(a.keyCode in this._ctrlKeysMap && (a.ctrlKey || a.metaKey))) return;
                    this[this._ctrlKeysMap[a.keyCode]](a)
                }
                a.stopImmediatePropagation(), a.preventDefault(), this.canvas && this.canvas.renderAll()
            }
        },
        onInput: function(a) {
            if (this.isEditing) {
                var b = this.selectionStart || 0,
                    c = this.selectionEnd || 0,
                    d = this.text.length,
                    e = this.hiddenTextarea.value.length,
                    f = e - d + c - b,
                    g = this.hiddenTextarea.value.slice(b, b + f);
                this.insertChars(g), a.stopPropagation()
            }
        },
        forwardDelete: function(a) {
            if (this.selectionStart === this.selectionEnd) {
                if (this.selectionStart === this.text.length) return;
                this.moveCursorRight(a)
            }
            this.removeChars(a)
        },
        copy: function(a) {
            var b = this.getSelectedText(),
                c = this._getClipboardData(a);
            c && c.setData("text", b), fabric.copiedText = b, fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd)
        },
        paste: function(a) {
            var b = null,
                c = this._getClipboardData(a),
                d = !0;
            c ? (b = c.getData("text").replace(/\r/g, ""), fabric.copiedTextStyle && fabric.copiedText === b || (d = !1)) : b = fabric.copiedText, b && this.insertChars(b, d), a.stopImmediatePropagation(), a.preventDefault()
        },
        cut: function(a) {
            this.selectionStart !== this.selectionEnd && (this.copy(), this.removeChars(a))
        },
        _getClipboardData: function(a) {
            return a && (a.clipboardData || fabric.window.clipboardData)
        },
        getDownCursorOffset: function(a, b) {
            var c, d, e = b ? this.selectionEnd : this.selectionStart,
                f = this.get2DCursorLocation(e),
                g = f.lineIndex,
                h = this._textLines[g].slice(0, f.charIndex),
                i = this._textLines[g].slice(f.charIndex),
                j = this._textLines[g + 1] || "";
            if (g === this._textLines.length - 1 || a.metaKey || 34 === a.keyCode) return this.text.length - e;
            var k = this._getLineWidth(this.ctx, g);
            d = this._getLineLeftOffset(k);
            for (var l = d, m = 0, n = h.length; n > m; m++) c = h[m], l += this._getWidthOfChar(this.ctx, c, g, m);
            var o = this._getIndexOnNextLine(f, j, l);
            return i.length + 1 + o
        },
        _getIndexOnNextLine: function(a, b, c) {
            for (var d, e = a.lineIndex + 1, f = this._getLineWidth(this.ctx, e), g = this._getLineLeftOffset(f), h = g, i = 0, j = 0, k = b.length; k > j; j++) {
                var l = b[j],
                    m = this._getWidthOfChar(this.ctx, l, e, j);
                if (h += m, h > c) {
                    d = !0;
                    var n = h - m,
                        o = h,
                        p = Math.abs(n - c),
                        q = Math.abs(o - c);
                    i = p > q ? j + 1 : j;
                    break
                }
            }
            return d || (i = b.length), i
        },
        moveCursorDown: function(a) {
            this.abortCursorAnimation(), this._currentCursorOpacity = 1;
            var b = this.getDownCursorOffset(a, "right" === this._selectionDirection);
            a.shiftKey ? this.moveCursorDownWithShift(b) : this.moveCursorDownWithoutShift(b), this.initDelayedCursor()
        },
        moveCursorDownWithoutShift: function(a) {
            this._selectionDirection = "right", this.setSelectionStart(this.selectionStart + a), this.setSelectionEnd(this.selectionStart)
        },
        swapSelectionPoints: function() {
            var a = this.selectionEnd;
            this.setSelectionEnd(this.selectionStart), this.setSelectionStart(a)
        },
        moveCursorDownWithShift: function(a) {
            this.selectionEnd === this.selectionStart && (this._selectionDirection = "right"), "right" === this._selectionDirection ? this.setSelectionEnd(this.selectionEnd + a) : this.setSelectionStart(this.selectionStart + a), this.selectionEnd < this.selectionStart && "left" === this._selectionDirection && (this.swapSelectionPoints(), this._selectionDirection = "right"), this.selectionEnd > this.text.length && this.setSelectionEnd(this.text.length)
        },
        getUpCursorOffset: function(a, b) {
            var c = b ? this.selectionEnd : this.selectionStart,
                d = this.get2DCursorLocation(c),
                e = d.lineIndex;
            if (0 === e || a.metaKey || 33 === a.keyCode) return c;
            for (var f, g = this._textLines[e].slice(0, d.charIndex), h = this._textLines[e - 1] || "", i = this._getLineWidth(this.ctx, d.lineIndex), j = this._getLineLeftOffset(i), k = j, l = 0, m = g.length; m > l; l++) f = g[l], k += this._getWidthOfChar(this.ctx, f, e, l);
            var n = this._getIndexOnPrevLine(d, h, k);
            return h.length - n + g.length
        },
        _getIndexOnPrevLine: function(a, b, c) {
            for (var d, e = a.lineIndex - 1, f = this._getLineWidth(this.ctx, e), g = this._getLineLeftOffset(f), h = g, i = 0, j = 0, k = b.length; k > j; j++) {
                var l = b[j],
                    m = this._getWidthOfChar(this.ctx, l, e, j);
                if (h += m, h > c) {
                    d = !0;
                    var n = h - m,
                        o = h,
                        p = Math.abs(n - c),
                        q = Math.abs(o - c);
                    i = p > q ? j : j - 1;
                    break
                }
            }
            return d || (i = b.length - 1), i
        },
        moveCursorUp: function(a) {
            this.abortCursorAnimation(), this._currentCursorOpacity = 1;
            var b = this.getUpCursorOffset(a, "right" === this._selectionDirection);
            a.shiftKey ? this.moveCursorUpWithShift(b) : this.moveCursorUpWithoutShift(b), this.initDelayedCursor()
        },
        moveCursorUpWithShift: function(a) {
            this.selectionEnd === this.selectionStart && (this._selectionDirection = "left"), "right" === this._selectionDirection ? this.setSelectionEnd(this.selectionEnd - a) : this.setSelectionStart(this.selectionStart - a), this.selectionEnd < this.selectionStart && "right" === this._selectionDirection && (this.swapSelectionPoints(), this._selectionDirection = "left")
        },
        moveCursorUpWithoutShift: function(a) {
            this.selectionStart === this.selectionEnd && this.setSelectionStart(this.selectionStart - a), this.setSelectionEnd(this.selectionStart), this._selectionDirection = "left"
        },
        moveCursorLeft: function(a) {
            0 === this.selectionStart && 0 === this.selectionEnd || (this.abortCursorAnimation(), this._currentCursorOpacity = 1, a.shiftKey ? this.moveCursorLeftWithShift(a) : this.moveCursorLeftWithoutShift(a), this.initDelayedCursor())
        },
        _move: function(a, b, c) {
            var d = "selectionStart" === b ? "setSelectionStart" : "setSelectionEnd";
            a.altKey ? this[d](this["findWordBoundary" + c](this[b])) : a.metaKey || 35 === a.keyCode || 36 === a.keyCode ? this[d](this["findLineBoundary" + c](this[b])) : this[d](this[b] + ("Left" === c ? -1 : 1))
        },
        _moveLeft: function(a, b) {
            this._move(a, b, "Left")
        },
        _moveRight: function(a, b) {
            this._move(a, b, "Right")
        },
        moveCursorLeftWithoutShift: function(a) {
            this._selectionDirection = "left", this.selectionEnd === this.selectionStart && this._moveLeft(a, "selectionStart"), this.setSelectionEnd(this.selectionStart)
        },
        moveCursorLeftWithShift: function(a) {
            "right" === this._selectionDirection && this.selectionStart !== this.selectionEnd ? this._moveLeft(a, "selectionEnd") : (this._selectionDirection = "left", this._moveLeft(a, "selectionStart"))
        },
        moveCursorRight: function(a) {
            this.selectionStart >= this.text.length && this.selectionEnd >= this.text.length || (this.abortCursorAnimation(), this._currentCursorOpacity = 1, a.shiftKey ? this.moveCursorRightWithShift(a) : this.moveCursorRightWithoutShift(a), this.initDelayedCursor())
        },
        moveCursorRightWithShift: function(a) {
            "left" === this._selectionDirection && this.selectionStart !== this.selectionEnd ? this._moveRight(a, "selectionStart") : (this._selectionDirection = "right", this._moveRight(a, "selectionEnd"))
        },
        moveCursorRightWithoutShift: function(a) {
            this._selectionDirection = "right", this.selectionStart === this.selectionEnd ? (this._moveRight(a, "selectionStart"), this.setSelectionEnd(this.selectionStart)) : (this.setSelectionEnd(this.selectionEnd + this.getNumNewLinesInSelectedText()), this.setSelectionStart(this.selectionEnd))
        },
        removeChars: function(a) {
            this.selectionStart === this.selectionEnd ? this._removeCharsNearCursor(a) : this._removeCharsFromTo(this.selectionStart, this.selectionEnd), this.setSelectionEnd(this.selectionStart), this._removeExtraneousStyles(), this.canvas && this.canvas.renderAll(), this.setCoords(), this.fire("changed"), this.canvas && this.canvas.fire("text:changed", {
                target: this
            })
        },
        _removeCharsNearCursor: function(a) {
            if (0 !== this.selectionStart)
                if (a.metaKey) {
                    var b = this.findLineBoundaryLeft(this.selectionStart);
                    this._removeCharsFromTo(b, this.selectionStart), this.setSelectionStart(b)
                } else if (a.altKey) {
                var c = this.findWordBoundaryLeft(this.selectionStart);
                this._removeCharsFromTo(c, this.selectionStart), this.setSelectionStart(c)
            } else this._removeSingleCharAndStyle(this.selectionStart), this.setSelectionStart(this.selectionStart - 1)
        }
    }),
    function() {
        var a = fabric.util.toFixed,
            b = fabric.Object.NUM_FRACTION_DIGITS;
        fabric.util.object.extend(fabric.IText.prototype, {
            _setSVGTextLineText: function(a, b, c, d, e, f) {
                this.styles[a] ? this._setSVGTextLineChars(a, b, c, d, f) : fabric.Text.prototype._setSVGTextLineText.call(this, a, b, c, d, e)
            },
            _setSVGTextLineChars: function(a, b, c, d, e) {
                for (var f = this._textLines[a], g = 0, h = this._getLineLeftOffset(this._getLineWidth(this.ctx, a)) - this.width / 2, i = this._getSVGLineTopOffset(a), j = this._getHeightOfLine(this.ctx, a), k = 0, l = f.length; l > k; k++) {
                    var m = this.styles[a][k] || {};
                    b.push(this._createTextCharSpan(f[k], m, h, i.lineTop + i.offset, g));
                    var n = this._getWidthOfChar(this.ctx, f[k], a, k);
                    m.textBackgroundColor && e.push(this._createTextCharBg(m, h, i.lineTop, j, n, g)), g += n
                }
            },
            _getSVGLineTopOffset: function(a) {
                for (var b = 0, c = 0, d = 0; a > d; d++) b += this._getHeightOfLine(this.ctx, d);
                return c = this._getHeightOfLine(this.ctx, d), {
                    lineTop: b,
                    offset: (this._fontSizeMult - this._fontSizeFraction) * c / (this.lineHeight * this._fontSizeMult)
                }
            },
            _createTextCharBg: function(c, d, e, f, g, h) {
                return ['<rect fill="', c.textBackgroundColor, '" x="', a(d + h, b), '" y="', a(e - this.height / 2, b), '" width="', a(g, b), '" height="', a(f / this.lineHeight, b), '"></rect>'].join("")
            },
            _createTextCharSpan: function(c, d, e, f, g) {
                var h = this.getSvgStyles.call(fabric.util.object.extend({
                    visible: !0,
                    fill: this.fill,
                    stroke: this.stroke,
                    type: "text"
                }, d));
                return ['<tspan x="', a(e + g, b), '" y="', a(f - this.height / 2, b), '" ', d.fontFamily ? 'font-family="' + d.fontFamily.replace(/"/g, "'") + '" ' : "", d.fontSize ? 'font-size="' + d.fontSize + '" ' : "", d.fontStyle ? 'font-style="' + d.fontStyle + '" ' : "", d.fontWeight ? 'font-weight="' + d.fontWeight + '" ' : "", d.textDecoration ? 'text-decoration="' + d.textDecoration + '" ' : "", 'style="', h, '">', fabric.util.string.escapeXml(c), "</tspan>"].join("")
            }
        })
    }(),
    function(a) {
        "use strict";
        var b = a.fabric || (a.fabric = {}),
            c = b.util.object.clone;
        b.Textbox = b.util.createClass(b.IText, b.Observable, {
            type: "textbox",
            minWidth: 20,
            dynamicMinWidth: 0,
            __cachedLines: null,
            initialize: function(a, c) {
                this.ctx = b.util.createCanvasElement().getContext("2d"), this.callSuper("initialize", a, c), this.set({
                    lockUniScaling: !1,
                    lockScalingY: !0,
                    lockScalingFlip: !0,
                    hasBorders: !0
                }), this.setControlsVisibility(b.Textbox.getTextboxControlVisibility()), this._dimensionAffectingProps.width = !0
            },
            _initDimensions: function(a) {
                this.__skipDimension || (a || (a = b.util.createCanvasElement().getContext("2d"), this._setTextStyles(a)), this.dynamicMinWidth = 0, this._textLines = this._splitTextIntoLines(), this.dynamicMinWidth > this.width && this._set("width", this.dynamicMinWidth), this._clearCache(), this.height = this._getTextHeight(a))
            },
            _generateStyleMap: function() {
                for (var a = 0, b = 0, c = 0, d = {}, e = 0; e < this._textLines.length; e++) "\n" === this.text[c] ? (b = 0, c++, a++) : " " === this.text[c] && (b++, c++), d[e] = {
                    line: a,
                    offset: b
                }, c += this._textLines[e].length, b += this._textLines[e].length;
                return d
            },
            _getStyleDeclaration: function(a, b, c) {
                if (this._styleMap) {
                    var d = this._styleMap[a];
                    a = d.line, b = d.offset + b
                }
                return this.callSuper("_getStyleDeclaration", a, b, c)
            },
            _setStyleDeclaration: function(a, b, c) {
                var d = this._styleMap[a];
                a = d.line, b = d.offset + b, this.styles[a][b] = c
            },
            _deleteStyleDeclaration: function(a, b) {
                var c = this._styleMap[a];
                a = c.line, b = c.offset + b, delete this.styles[a][b]
            },
            _getLineStyle: function(a) {
                var b = this._styleMap[a];
                return this.styles[b.line]
            },
            _setLineStyle: function(a, b) {
                var c = this._styleMap[a];
                this.styles[c.line] = b
            },
            _deleteLineStyle: function(a) {
                var b = this._styleMap[a];
                delete this.styles[b.line]
            },
            _wrapText: function(a, b) {
                var c, d = b.split(this._reNewline),
                    e = [];
                for (c = 0; c < d.length; c++) e = e.concat(this._wrapLine(a, d[c], c));
                return e
            },
            _measureText: function(a, b, c, d) {
                var e, f = 0;
                d = d || 0;
                for (var g = 0; g < b.length; g++) this.styles && this.styles[c] && (e = this.styles[c][g + d]) ? (a.save(), f += this._applyCharStylesGetWidth(a, b[g], c, g, e), a.restore()) : f += this._applyCharStylesGetWidth(a, b[g], c, g, {});
                return f
            },
            _wrapLine: function(a, b, c) {
                var d = this.width,
                    e = this._measureText(a, b, c, 0);
                if (d > e) return -1 === b.indexOf(" ") && e > this.dynamicMinWidth && (this.dynamicMinWidth = e), [b];
                for (var f = [], g = "", h = b.split(" "), i = 0, j = "", k = 0, l = 0; h.length > 0;) j = "" === g ? "" : " ", k = this._measureText(a, h[0], c, g.length + j.length + i), e = "" === g ? k : this._measureText(a, g + j + h[0], c, i), d > e || "" === g && k >= d ? g += j + h.shift() : (i += g.length + 1, f.push(g), g = ""), 0 === h.length && f.push(g), k > l && (l = k);
                return l > this.dynamicMinWidth && (this.dynamicMinWidth = l), f
            },
            _splitTextIntoLines: function() {
                this.ctx.save(), this._setTextStyles(this.ctx);
                var a = this._wrapText(this.ctx, this.text);
                return this.ctx.restore(), this._textLines = a, this._styleMap = this._generateStyleMap(), a
            },
            setOnGroup: function(a, b) {
                "scaleX" === a && (this.set("scaleX", Math.abs(1 / b)), this.set("width", this.get("width") * b / ("undefined" == typeof this.__oldScaleX ? 1 : this.__oldScaleX)), this.__oldScaleX = b)
            },
            get2DCursorLocation: function(a) {
                "undefined" == typeof a && (a = this.selectionStart);
                for (var b = this._textLines.length, c = 0, d = 0; b > d; d++) {
                    var e = this._textLines[d],
                        f = e.length;
                    if (c + f >= a) return {
                        lineIndex: d,
                        charIndex: a - c
                    };
                    c += f, "\n" !== this.text[c] && " " !== this.text[c] || c++
                }
                return {
                    lineIndex: b - 1,
                    charIndex: this._textLines[b - 1].length
                }
            },
            _getCursorBoundariesOffsets: function(a, b) {
                for (var c = 0, d = 0, e = this.get2DCursorLocation(), f = this._textLines[e.lineIndex].split(""), g = this._getLineLeftOffset(this._getLineWidth(this.ctx, e.lineIndex)), h = 0; h < e.charIndex; h++) d += this._getWidthOfChar(this.ctx, f[h], e.lineIndex, h);
                for (h = 0; h < e.lineIndex; h++) c += this._getHeightOfLine(this.ctx, h);
                return "cursor" === b && (c += (1 - this._fontSizeFraction) * this._getHeightOfLine(this.ctx, e.lineIndex) / this.lineHeight - this.getCurrentCharFontSize(e.lineIndex, e.charIndex) * (1 - this._fontSizeFraction)), {
                    top: c,
                    left: d,
                    lineLeft: g
                }
            },
            getMinWidth: function() {
                return Math.max(this.minWidth, this.dynamicMinWidth)
            },
            toObject: function(a) {
                return b.util.object.extend(this.callSuper("toObject", a), {
                    minWidth: this.minWidth
                })
            }
        }), b.Textbox.fromObject = function(a) {
            return new b.Textbox(a.text, c(a))
        }, b.Textbox.getTextboxControlVisibility = function() {
            return {
                tl: !1,
                tr: !1,
                br: !1,
                bl: !1,
                ml: !0,
                mt: !1,
                mr: !0,
                mb: !1,
                mtr: !0
            }
        }, b.Textbox.instances = []
    }("undefined" != typeof exports ? exports : this),
    function() {
        var a = fabric.Canvas.prototype._setObjectScale;
        fabric.Canvas.prototype._setObjectScale = function(b, c, d, e, f, g) {
            var h = c.target;
            if (h instanceof fabric.Textbox) {
                var i = h.width * (b.x / c.scaleX / (h.width + h.strokeWidth));
                i >= h.getMinWidth() && h.set("width", i)
            } else a.call(fabric.Canvas.prototype, b, c, d, e, f, g)
        }, fabric.Group.prototype._refreshControlsVisibility = function() {
            if ("undefined" != typeof fabric.Textbox)
                for (var a = this._objects.length; a--;)
                    if (this._objects[a] instanceof fabric.Textbox) return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())
        };
        var b = fabric.util.object.clone;
        fabric.util.object.extend(fabric.Textbox.prototype, {
            _removeExtraneousStyles: function() {
                for (var a in this._styleMap) this._textLines[a] || delete this.styles[this._styleMap[a].line]
            },
            insertCharStyleObject: function(a, b, c) {
                var d = this._styleMap[a];
                a = d.line, b = d.offset + b, fabric.IText.prototype.insertCharStyleObject.apply(this, [a, b, c])
            },
            insertNewlineStyleObject: function(a, b, c) {
                var d = this._styleMap[a];
                a = d.line, b = d.offset + b, fabric.IText.prototype.insertNewlineStyleObject.apply(this, [a, b, c])
            },
            shiftLineStyles: function(a, c) {
                var d = b(this.styles),
                    e = this._styleMap[a];
                a = e.line;
                for (var f in this.styles) {
                    var g = parseInt(f, 10);
                    g > a && (this.styles[g + c] = d[g], d[g - c] || delete this.styles[g])
                }
            },
            _getTextOnPreviousLine: function(a) {
                for (var b = this._textLines[a - 1]; this._styleMap[a - 2] && this._styleMap[a - 2].line === this._styleMap[a - 1].line;) b = this._textLines[a - 2] + b, a--;
                return b
            },
            removeStyleObject: function(a, b) {
                var c = this.get2DCursorLocation(b),
                    d = this._styleMap[c.lineIndex],
                    e = d.line,
                    f = d.offset + c.charIndex;
                this._removeStyleObject(a, c, e, f)
            }
        })
    }(),
    function() {
        var a = fabric.IText.prototype._getNewSelectionStartFromOffset;
        fabric.IText.prototype._getNewSelectionStartFromOffset = function(b, c, d, e, f) {
            e = a.call(this, b, c, d, e, f);
            for (var g = 0, h = 0, i = 0; i < this._textLines.length && (g += this._textLines[i].length, !(g + h >= e)); i++) "\n" !== this.text[g + h] && " " !== this.text[g + h] || h++;
            return e - i + h
        }
    }(),
    function() {
        function request(a, b, c) {
            var d = URL.parse(a);
            d.port || (d.port = 0 === d.protocol.indexOf("https:") ? 443 : 80);
            var e = 0 === d.protocol.indexOf("https:") ? HTTPS : HTTP,
                f = e.request({
                    hostname: d.hostname,
                    port: d.port,
                    path: d.path,
                    method: "GET"
                }, function(a) {
                    var d = "";
                    b && a.setEncoding(b), a.on("end", function() {
                        c(d)
                    }), a.on("data", function(b) {
                        200 === a.statusCode && (d += b)
                    })
                });
            f.on("error", function(a) {
                a.errno === process.ECONNREFUSED ? fabric.log("ECONNREFUSED: connection refused to " + d.hostname + ":" + d.port) : fabric.log(a.message), c(null)
            }), f.end()
        }

        function requestFs(a, b) {
            var c = require("fs");
            c.readFile(a, function(a, c) {
                if (a) throw fabric.log(a), a;
                b(c)
            })
        }
        if ("undefined" == typeof document || "undefined" == typeof window) {
            var DOMParser = require("xmldom").DOMParser,
                URL = require("url"),
                HTTP = require("http"),
                HTTPS = require("https"),
                Canvas = require("canvas"),
                Image = require("canvas").Image;
            fabric.util.loadImage = function(a, b, c) {
                function d(d) {
                    d ? (e.src = new Buffer(d, "binary"), e._src = a, b && b.call(c, e)) : (e = null, b && b.call(c, null, !0))
                }
                var e = new Image;
                a && (a instanceof Buffer || 0 === a.indexOf("data")) ? (e.src = e._src = a, b && b.call(c, e)) : a && 0 !== a.indexOf("http") ? requestFs(a, d) : a ? request(a, "binary", d) : b && b.call(c, a)
            }, fabric.loadSVGFromURL = function(a, b, c) {
                a = a.replace(/^\n\s*/, "").replace(/\?.*$/, "").trim(), 0 !== a.indexOf("http") ? requestFs(a, function(a) {
                    fabric.loadSVGFromString(a.toString(), b, c)
                }) : request(a, "", function(a) {
                    fabric.loadSVGFromString(a, b, c)
                })
            }, fabric.loadSVGFromString = function(a, b, c) {
                var d = (new DOMParser).parseFromString(a);
                fabric.parseSVGDocument(d.documentElement, function(a, c) {
                    b && b(a, c)
                }, c)
            }, fabric.util.getScript = function(url, callback) {
                request(url, "", function(body) {
                    eval(body), callback && callback()
                })
            }, fabric.Image.fromObject = function(a, b) {
                fabric.util.loadImage(a.src, function(c) {
                    var d = new fabric.Image(c);
                    d._initConfig(a), d._initFilters(a.filters, function(c) {
                        d.filters = c || [], d._initFilters(a.resizeFilters, function(a) {
                            d.resizeFilters = a || [], b && b(d)
                        })
                    })
                })
            }, fabric.createCanvasForNode = function(a, b, c, d) {
                d = d || c;
                var e = fabric.document.createElement("canvas"),
                    f = new Canvas(a || 600, b || 600, d);
                e.style = {}, e.width = f.width, e.height = f.height;
                var g = fabric.Canvas || fabric.StaticCanvas,
                    h = new g(e, c);
                return h.contextContainer = f.getContext("2d"), h.nodeCanvas = f, h.Font = Canvas.Font, h
            }, fabric.StaticCanvas.prototype.createPNGStream = function() {
                return this.nodeCanvas.createPNGStream()
            }, fabric.StaticCanvas.prototype.createJPEGStream = function(a) {
                return this.nodeCanvas.createJPEGStream(a)
            };
            var origSetWidth = fabric.StaticCanvas.prototype.setWidth;
            fabric.StaticCanvas.prototype.setWidth = function(a, b) {
                return origSetWidth.call(this, a, b), this.nodeCanvas.width = a, this
            }, fabric.Canvas && (fabric.Canvas.prototype.setWidth = fabric.StaticCanvas.prototype.setWidth);
            var origSetHeight = fabric.StaticCanvas.prototype.setHeight;
            fabric.StaticCanvas.prototype.setHeight = function(a, b) {
                return origSetHeight.call(this, a, b), this.nodeCanvas.height = a, this
            }, fabric.Canvas && (fabric.Canvas.prototype.setHeight = fabric.StaticCanvas.prototype.setHeight)
        }
    }(), jQuery.browser = {},
    function() {
        jQuery.browser.msie = !1, jQuery.browser.version = 0, navigator.userAgent.match(/MSIE ([0-9]+)\./) && (jQuery.browser.msie = !0, jQuery.browser.version = RegExp.$1)
    }(),
    function(a) {
        var b = !1;
        a.fn.farbtastic = function(b) {
            return a.farbtastic(this, b), this
        }, a.farbtastic = function(b, c) {
            var b = a(b)[0];
            return b.farbtastic || (b.farbtastic = new a._farbtastic(b, c))
        }, a._farbtastic = function(c, d) {
            var e = this;
            e.linkTo = function(b) {
                return "object" == typeof e.callback && a(e.callback).unbind("keyup", e.updateValue), e.color = null, "function" == typeof b ? e.callback = b : "object" != typeof b && "string" != typeof b || (e.callback = a(b), e.callback.bind("keyup", e.updateValue), e.callback[0].value && e.setColor(e.callback[0].value)), this
            }, e.updateValue = function(a) {
                this.value && this.value != e.color && e.setColor(this.value)
            }, e.setColor = function(a) {
                var b = e.unpack(a);
                return e.color != a && b && (e.color = a, e.rgb = b, e.hsl = e.RGBToHSL(e.rgb), e.updateDisplay()), this
            }, e.setHSL = function(a) {
                return e.hsl = a, e.rgb = e.HSLToRGB(a), e.color = e.pack(e.rgb), e.updateDisplay(), this
            }, e.initWidget = function() {
                var b = {
                    width: d.width,
                    height: d.width
                };
                a(c).html('<div class="farbtastic" style="position: relative"><div class="farbtastic-solid"></div><canvas class="farbtastic-mask"></canvas><canvas class="farbtastic-overlay"></canvas></div>').find("*").attr(b).css(b).end().find("div>*").css({
                    position: "absolute",
                    left: 0,
                    top: 0
                }), a.browser.msie || !1, e.radius = (d.width - d.wheelWidth) / 2 - 1, e.square = Math.floor(.7 * (e.radius - d.wheelWidth / 2)) - 1, e.mid = Math.floor(d.width / 2), e.markerSize = .3 * d.wheelWidth, e.solidFill = a(".farbtastic-solid", c).css({
                    width: 2 * e.square - 1,
                    height: 2 * e.square - 1,
                    left: e.mid - e.square,
                    top: e.mid - e.square
                }), e.cnvMask = a(".farbtastic-mask", c), e.ctxMask = e.cnvMask[0].getContext("2d"), e.cnvOverlay = a(".farbtastic-overlay", c), e.ctxOverlay = e.cnvOverlay[0].getContext("2d"), e.ctxMask.translate(e.mid, e.mid), e.ctxOverlay.translate(e.mid, e.mid), e.drawCircle(), e.drawMask()
            }, e.drawCircle = function() {
                var c, f, g = +new Date,
                    h = 24,
                    i = e.radius,
                    j = d.wheelWidth,
                    k = 8 / i / h * Math.PI,
                    l = e.ctxMask,
                    m = 0;
                l.save(), l.lineWidth = j / i, l.scale(i, i);
                for (var n = 0; h >= n; ++n) {
                    var o = n / h,
                        p = o * Math.PI * 2,
                        q = Math.sin(m),
                        r = -Math.cos(m);
                    if (x2 = Math.sin(p), y2 = -Math.cos(p), am = (m + p) / 2, tan = 1 / Math.cos((p - m) / 2), xm = Math.sin(am) * tan, ym = -Math.cos(am) * tan, color2 = e.pack(e.HSLToRGB([o, 1, .5])), n > 0)
                        if (a.browser.msie) {
                            var s = (1 + Math.min(Math.abs(Math.tan(m)), Math.abs(Math.tan(Math.PI / 2 - m)))) / h;
                            c = e.pack(e.HSLToRGB([f - .15 * s, 1, .5])), color2 = e.pack(e.HSLToRGB([o + .15 * s, 1, .5]));
                            var t = l.createLinearGradient(q, r, x2, y2);
                            t.addColorStop(0, c), t.addColorStop(1, color2), l.fillStyle = t;
                            var u = (i + j / 2) / i,
                                v = (i - j / 2) / i;
                            l.beginPath(), l.moveTo(q * u, r * u), l.quadraticCurveTo(xm * u, ym * u, x2 * u, y2 * u), l.lineTo(x2 * v, y2 * v), l.quadraticCurveTo(xm * v, ym * v, q * v, r * v), l.fill()
                        } else {
                            var t = l.createLinearGradient(q, r, x2, y2);
                            t.addColorStop(0, c), t.addColorStop(1, color2), l.strokeStyle = t, l.beginPath(), l.moveTo(q, r), l.quadraticCurveTo(xm, ym, x2, y2), l.stroke()
                        }
                    m = p - k, c = color2, f = o
                }
                l.restore(), b && a("body").append("<div>drawCircle " + (+new Date - g) + "ms")
            }, e.drawMask = function() {
                function c(a, b, c) {
                    for (var d = 1 / a, e = 1 / b, f = 0; b >= f; ++f)
                        for (var g = 1 - f * e, h = 0; a >= h; ++h) {
                            var i = 1 - h * d,
                                j = 1 - 2 * Math.min(g * i, (1 - g) * i),
                                k = j > 0 ? .5 * (2 * g - 1 + j) / j : 0;
                            c(h, f, k, j)
                        }
                }
                var d = +new Date,
                    f = 2 * e.square,
                    g = e.square;
                if (e.ctxMask.getImageData) {
                    var h = Math.floor(f / 2),
                        i = document.createElement("canvas");
                    i.width = i.height = h + 1;
                    var j = i.getContext("2d"),
                        k = j.getImageData(0, 0, h + 1, h + 1),
                        l = 0;
                    c(h, h, function(a, b, c, d) {
                        k.data[l++] = k.data[l++] = k.data[l++] = 255 * c, k.data[l++] = 255 * d
                    }), j.putImageData(k, 0, 0), e.ctxMask.drawImage(i, 0, 0, h + 1, h + 1, -g, -g, 2 * g, 2 * g)
                } else if (a.browser.msie) {
                    var m, n, o = 6,
                        p = Math.floor(f / o);
                    c(p, 6, function(b, c, d, f) {
                        if (0 == b && (m = n, n = []), d = Math.round(255 * d), f = Math.round(255 * f), c > 0) {
                            var h = m[b][0],
                                i = m[b][1],
                                j = e.packDX(h, i),
                                k = e.packDX(d, f),
                                l = Math.round(e.mid + (.333 * (c - 1) - 1) * g),
                                q = Math.round(e.mid + (.333 * c - 1) * g);
                            a("<div>").css({
                                position: "absolute",
                                filter: "progid:DXImageTransform.Microsoft.Gradient(StartColorStr=" + j + ", EndColorStr=" + k + ", GradientType=0)",
                                top: l,
                                height: q - l,
                                left: e.mid + (b * o - g - 1),
                                width: o - (b == p ? Math.round(o / 2) : 0)
                            }).appendTo(e.cnvMask)
                        }
                        n.push([d, f])
                    })
                } else {
                    var h = Math.floor(f / 2);
                    c(h, h, function(a, b, c, d) {
                        c = Math.round(255 * c), e.ctxMask.fillStyle = "rgba(" + c + ", " + c + ", " + c + ", " + d + ")", e.ctxMask.fillRect(2 * a - g - 1, 2 * b - g - 1, 2, 2)
                    })
                }
                b && a("body").append("<div>drawMask " + (+new Date - d) + "ms")
            }, e.drawMarkers = function() {
                var a = d.width,
                    b = Math.ceil(e.markerSize / 4),
                    c = e.markerSize - b + 1,
                    f = 6.28 * e.hsl[0],
                    g = Math.sin(f) * e.radius,
                    h = -Math.cos(f) * e.radius,
                    i = 2 * e.square * (.5 - e.hsl[1]),
                    j = 2 * e.square * (.5 - e.hsl[2]),
                    k = e.invert ? "#fff" : "#000",
                    l = e.invert ? "#000" : "#fff",
                    m = [{
                        x: g,
                        y: h,
                        r: c,
                        c: "#000",
                        lw: b + 1
                    }, {
                        x: g,
                        y: h,
                        r: e.markerSize,
                        c: "#fff",
                        lw: b
                    }, {
                        x: i,
                        y: j,
                        r: c,
                        c: l,
                        lw: b + 1
                    }, {
                        x: i,
                        y: j,
                        r: e.markerSize,
                        c: k,
                        lw: b
                    }];
                e.ctxOverlay.clearRect(-e.mid, -e.mid, a, a);
                for (var n = 0; n < m.length; n++) {
                    var o = m[n];
                    e.ctxOverlay.lineWidth = o.lw, e.ctxOverlay.strokeStyle = o.c, e.ctxOverlay.beginPath(), e.ctxOverlay.arc(o.x, o.y, o.r, 0, 2 * Math.PI, !0), e.ctxOverlay.stroke()
                }
            }, e.updateDisplay = function() {
                e.invert = .3 * e.rgb[0] + .59 * e.rgb[1] + .11 * e.rgb[2] <= .6, e.solidFill.css("backgroundColor", e.pack(e.HSLToRGB([e.hsl[0], 1, .5]))), e.drawMarkers(), "object" == typeof e.callback ? (a(e.callback).css({
                    backgroundColor: e.color,
                    color: e.invert ? "#fff" : "#000"
                }), a(e.callback).each(function() {
                    "string" == typeof this.value && this.value != e.color && (this.value = e.color)
                }).change()) : "function" == typeof e.callback && e.callback.call(e, e.color)
            }, e.widgetCoords = function(a) {
                return {
                    x: a.pageX - e.offset.left - e.mid,
                    y: a.pageY - e.offset.top - e.mid
                }
            }, e.mousedown = function(b) {
                a._farbtastic.dragging || (a(document).bind("mousemove", e.mousemove).bind("mouseup", e.mouseup), a._farbtastic.dragging = !0), e.offset = a(c).offset();
                var d = e.widgetCoords(b);
                return e.circleDrag = Math.max(Math.abs(d.x), Math.abs(d.y)) > e.square + 2, e.mousemove(b), !1
            }, e.mousemove = function(a) {
                var b = e.widgetCoords(a);
                if (e.circleDrag) {
                    var c = Math.atan2(b.x, -b.y) / 6.28;
                    e.setHSL([(c + 1) % 1, e.hsl[1], e.hsl[2]])
                } else {
                    var d = Math.max(0, Math.min(1, -(b.x / e.square / 2) + .5)),
                        f = Math.max(0, Math.min(1, -(b.y / e.square / 2) + .5));
                    e.setHSL([e.hsl[0], d, f])
                }
                return !1
            }, e.mouseup = function() {
                a(document).unbind("mousemove", e.mousemove), a(document).unbind("mouseup", e.mouseup), a._farbtastic.dragging = !1
            }, e.dec2hex = function(a) {
                return (16 > a ? "0" : "") + a.toString(16)
            }, e.packDX = function(a, b) {
                return "#" + e.dec2hex(b) + e.dec2hex(a) + e.dec2hex(a) + e.dec2hex(a)
            }, e.pack = function(a) {
                var b = Math.round(255 * a[0]),
                    c = Math.round(255 * a[1]),
                    d = Math.round(255 * a[2]);
                return "#" + e.dec2hex(b) + e.dec2hex(c) + e.dec2hex(d)
            }, e.unpack = function(a) {
                function b(b) {
                    return parseInt(a.substring(b, b + 2), 16) / 255
                }

                function b(b) {
                    return parseInt(a.substring(b, b + 1), 16) / 15
                }
                return 7 == a.length ? [b(1), b(3), b(5)] : 4 == a.length ? [b(1), b(2), b(3)] : void 0
            }, e.HSLToRGB = function(a) {
                var b, c, d = a[0],
                    e = a[1],
                    f = a[2];
                return c = .5 >= f ? f * (e + 1) : f + e - f * e, b = 2 * f - c, [this.hueToRGB(b, c, d + .33333), this.hueToRGB(b, c, d), this.hueToRGB(b, c, d - .33333)]
            }, e.hueToRGB = function(a, b, c) {
                return c = (c + 1) % 1, 1 > 6 * c ? a + (b - a) * c * 6 : 1 > 2 * c ? b : 2 > 3 * c ? a + (b - a) * (.66666 - c) * 6 : a
            }, e.RGBToHSL = function(a) {
                var b = a[0],
                    c = a[1],
                    d = a[2],
                    e = Math.min(b, c, d),
                    f = Math.max(b, c, d),
                    g = f - e,
                    h = 0,
                    i = 0,
                    j = (e + f) / 2;
                return j > 0 && 1 > j && (i = g / (.5 > j ? 2 * j : 2 - 2 * j)), g > 0 && (f == b && f != c && (h += (c - d) / g), f == c && f != d && (h += 2 + (d - b) / g), f == d && f != b && (h += 4 + (b - c) / g), h /= 6), [h, i, j]
            }, d.callback || (d = {
                callback: d
            }), d = a.extend({
                width: 300,
                wheelWidth: (d.width || 300) / 10,
                callback: null
            }, d), e.initWidget(), a("canvas.farbtastic-overlay", c).mousedown(e.mousedown), d.callback && e.linkTo(d.callback), e.color || e.setColor("#808080")
        }
    }(jQuery),
    function(a, b) {
        "object" == typeof exports ? b(exports) : "function" == typeof define && define.amd ? define(["exports"], b) : b(a)
    }(this, function(a) {
        function b(a) {
            this._targetElement = a, this._options = {
                nextLabel: "Next &rarr;",
                prevLabel: "&larr; Back",
                skipLabel: "Skip",
                doneLabel: "Done",
                tooltipPosition: "bottom",
                tooltipClass: "",
                highlightClass: "",
                exitOnEsc: !0,
                exitOnOverlayClick: !0,
                showStepNumbers: !0,
                keyboardNavigation: !0,
                showButtons: !0,
                showBullets: !0,
                showProgress: !1,
                scrollToElement: !0,
                overlayOpacity: .8,
                positionPrecedence: ["bottom", "top", "right", "left"],
                disableInteraction: !1
            }
        }

        function c(a) {
            var b = [],
                c = this;
            if (this._options.steps)
                for (var h = 0, i = this._options.steps.length; i > h; h++) {
                    var j = d(this._options.steps[h]);
                    if (j.step = b.length + 1, "string" == typeof j.element && (j.element = document.querySelector(j.element)), "undefined" == typeof j.element || null == j.element) {
                        var k = document.querySelector(".introjsFloatingElement");
                        null == k && (k = document.createElement("div"), k.className = "introjsFloatingElement", document.body.appendChild(k)), j.element = k, j.position = "floating"
                    }
                    null != j.element && b.push(j)
                } else {
                    if (i = a.querySelectorAll("*[data-intro]"), 1 > i.length) return !1;
                    for (h = 0, j = i.length; j > h; h++) {
                        var k = i[h],
                            m = parseInt(k.getAttribute("data-step"), 10);
                        m > 0 && (b[m - 1] = {
                            element: k,
                            intro: k.getAttribute("data-intro"),
                            step: parseInt(k.getAttribute("data-step"), 10),
                            tooltipClass: k.getAttribute("data-tooltipClass"),
                            highlightClass: k.getAttribute("data-highlightClass"),
                            position: k.getAttribute("data-position") || this._options.tooltipPosition
                        })
                    }
                    for (h = m = 0, j = i.length; j > h; h++)
                        if (k = i[h], null == k.getAttribute("data-step")) {
                            for (;
                                "undefined" != typeof b[m];) m++;
                            b[m] = {
                                element: k,
                                intro: k.getAttribute("data-intro"),
                                step: m + 1,
                                tooltipClass: k.getAttribute("data-tooltipClass"),
                                highlightClass: k.getAttribute("data-highlightClass"),
                                position: k.getAttribute("data-position") || this._options.tooltipPosition
                            }
                        }
                }
            for (h = [], i = 0; i < b.length; i++) b[i] && h.push(b[i]);
            return b = h, b.sort(function(a, b) {
                return a.step - b.step
            }), c._introItems = b, r.call(c, a) && (e.call(c), a.querySelector(".introjs-skipbutton"), a.querySelector(".introjs-nextbutton"), c._onKeyDown = function(b) {
                if (27 === b.keyCode && 1 == c._options.exitOnEsc) void 0 != c._introExitCallback && c._introExitCallback.call(c), g.call(c, a);
                else if (37 === b.keyCode) f.call(c);
                else if (39 === b.keyCode) e.call(c);
                else if (13 === b.keyCode) {
                    var d = b.target || b.srcElement;
                    d && 0 < d.className.indexOf("introjs-prevbutton") ? f.call(c) : d && 0 < d.className.indexOf("introjs-skipbutton") ? (c._introItems.length - 1 == c._currentStep && "function" == typeof c._introCompleteCallback && c._introCompleteCallback.call(c), void 0 != c._introExitCallback && c._introExitCallback.call(c), g.call(c, a)) : e.call(c), b.preventDefault ? b.preventDefault() : b.returnValue = !1
                }
            }, c._onResize = function(a) {
                l.call(c, document.querySelector(".introjs-helperLayer")), l.call(c, document.querySelector(".introjs-tooltipReferenceLayer"))
            }, window.addEventListener ? (this._options.keyboardNavigation && window.addEventListener("keydown", c._onKeyDown, !0), window.addEventListener("resize", c._onResize, !0)) : document.attachEvent && (this._options.keyboardNavigation && document.attachEvent("onkeydown", c._onKeyDown), document.attachEvent("onresize", c._onResize))), !1
        }

        function d(a) {
            if (null == a || "object" != typeof a || "undefined" != typeof a.nodeType) return a;
            var b, c = {};
            for (b in a) c[b] = "undefined" != typeof jQuery && a[b] instanceof jQuery ? a[b] : d(a[b]);
            return c
        }

        function e() {
            if (this._direction = "forward", "undefined" == typeof this._currentStep ? this._currentStep = 0 : ++this._currentStep, this._introItems.length <= this._currentStep) "function" == typeof this._introCompleteCallback && this._introCompleteCallback.call(this), g.call(this, this._targetElement);
            else {
                var a = this._introItems[this._currentStep];
                "undefined" != typeof this._introBeforeChangeCallback && this._introBeforeChangeCallback.call(this, a.element), n.call(this, a)
            }
        }

        function f() {
            if (this._direction = "backward", 0 === this._currentStep) return !1;
            var a = this._introItems[--this._currentStep];
            "undefined" != typeof this._introBeforeChangeCallback && this._introBeforeChangeCallback.call(this, a.element), n.call(this, a)
        }

        function g(a) {
            var b = a.querySelector(".introjs-overlay");
            if (null != b) {
                b.style.opacity = 0, setTimeout(function() {
                    b.parentNode && b.parentNode.removeChild(b)
                }, 500);
                var c = a.querySelector(".introjs-helperLayer");
                if (c && c.parentNode.removeChild(c), (c = a.querySelector(".introjs-tooltipReferenceLayer")) && c.parentNode.removeChild(c), (a = a.querySelector(".introjs-disableInteraction")) && a.parentNode.removeChild(a), (a = document.querySelector(".introjsFloatingElement")) && a.parentNode.removeChild(a), (a = document.querySelector(".introjs-showElement")) && (a.className = a.className.replace(/introjs-[a-zA-Z]+/g, "").replace(/^\s+|\s+$/g, "")), (a = document.querySelectorAll(".introjs-fixParent")) && 0 < a.length)
                    for (c = a.length - 1; c >= 0; c--) a[c].className = a[c].className.replace(/introjs-fixParent/g, "").replace(/^\s+|\s+$/g, "");
                window.removeEventListener ? window.removeEventListener("keydown", this._onKeyDown, !0) : document.detachEvent && document.detachEvent("onkeydown", this._onKeyDown), this._currentStep = void 0
            }
        }

        function h(a, b, c, d) {
            var e, f, g = "";
            if (b.style.top = null, b.style.right = null, b.style.bottom = null, b.style.left = null, b.style.marginLeft = null, b.style.marginTop = null, c.style.display = "inherit", "undefined" != typeof d && null != d && (d.style.top = null, d.style.left = null), this._introItems[this._currentStep]) {
                if (g = this._introItems[this._currentStep], g = "string" == typeof g.tooltipClass ? g.tooltipClass : this._options.tooltipClass, b.className = ("introjs-tooltip " + g).replace(/^\s+|\s+$/g, ""), f = this._introItems[this._currentStep].position, ("auto" == f || "auto" == this._options.tooltipPosition) && "floating" != f) {
                    g = f, e = this._options.positionPrecedence.slice(), f = p();
                    var h = s(b).height + 10,
                        l = s(b).width + 20,
                        m = s(a),
                        n = "floating";
                    m.left + l > f.width || 0 > m.left + m.width / 2 - l ? (k(e, "bottom"), k(e, "top")) : (m.height + m.top + h > f.height && k(e, "bottom"), 0 > m.top - h && k(e, "top")), m.width + m.left + l > f.width && k(e, "right"), 0 > m.left - l && k(e, "left"), 0 < e.length && (n = e[0]), g && "auto" != g && -1 < e.indexOf(g) && (n = g), f = n
                }
                switch (g = s(a), a = s(b), e = p(), f) {
                    case "top":
                        c.className = "introjs-arrow bottom", i(g, 15, a, e, b), b.style.bottom = g.height + 20 + "px";
                        break;
                    case "right":
                        b.style.left = g.width + 20 + "px", g.top + a.height > e.height ? (c.className = "introjs-arrow left-bottom", b.style.top = "-" + (a.height - g.height - 20) + "px") : c.className = "introjs-arrow left";
                        break;
                    case "left":
                        1 == this._options.showStepNumbers && (b.style.top = "15px"), g.top + a.height > e.height ? (b.style.top = "-" + (a.height - g.height - 20) + "px", c.className = "introjs-arrow right-bottom") : c.className = "introjs-arrow right", b.style.right = g.width + 20 + "px";
                        break;
                    case "floating":
                        c.style.display = "none", b.style.left = "50%", b.style.top = "50%", b.style.marginLeft = "-" + a.width / 2 + "px", b.style.marginTop = "-" + a.height / 2 + "px", "undefined" != typeof d && null != d && (d.style.left = "-" + (a.width / 2 + 18) + "px", d.style.top = "-" + (a.height / 2 + 18) + "px");
                        break;
                    case "bottom-right-aligned":
                        c.className = "introjs-arrow top-right", j(g, 0, a, b), b.style.top = g.height + 20 + "px";
                        break;
                    case "bottom-middle-aligned":
                        c.className = "introjs-arrow top-middle", c = g.width / 2 - a.width / 2, j(g, c, a, b) && (b.style.right = null, i(g, c, a, e, b)), b.style.top = g.height + 20 + "px";
                        break;
                    default:
                        c.className = "introjs-arrow top", i(g, 0, a, e, b), b.style.top = g.height + 20 + "px"
                }
            }
        }

        function i(a, b, c, d, e) {
            return a.left + b + c.width > d.width ? (e.style.left = d.width - c.width - a.left + "px", !1) : (e.style.left = b + "px", !0)
        }

        function j(a, b, c, d) {
            return 0 > a.left + a.width - b - c.width ? (d.style.left = -a.left + "px", !1) : (d.style.right = b + "px", !0)
        }

        function k(a, b) {
            -1 < a.indexOf(b) && a.splice(a.indexOf(b), 1)
        }

        function l(a) {
            if (a && this._introItems[this._currentStep]) {
                var b = this._introItems[this._currentStep],
                    c = s(b.element),
                    d = 10;
                "floating" == b.position && (d = 0), a.setAttribute("style", "width: " + (c.width + d) + "px; height:" + (c.height + d) + "px; top:" + (c.top - 5) + "px;left: " + (c.left - 5) + "px;")
            }
        }

        function m() {
            var a = document.querySelector(".introjs-disableInteraction");
            null === a && (a = document.createElement("div"), a.className = "introjs-disableInteraction", this._targetElement.appendChild(a)), l.call(this, a)
        }

        function n(a) {
            "undefined" != typeof this._introChangeCallback && this._introChangeCallback.call(this, a.element);
            var b = this,
                c = document.querySelector(".introjs-helperLayer"),
                d = document.querySelector(".introjs-tooltipReferenceLayer"),
                i = "introjs-helperLayer";
            if (s(a.element), "string" == typeof a.highlightClass && (i += " " + a.highlightClass), "string" == typeof this._options.highlightClass && (i += " " + this._options.highlightClass), null != c) {
                var j = d.querySelector(".introjs-helperNumberLayer"),
                    k = d.querySelector(".introjs-tooltiptext"),
                    n = d.querySelector(".introjs-arrow"),
                    r = d.querySelector(".introjs-tooltip"),
                    u = d.querySelector(".introjs-skipbutton"),
                    v = d.querySelector(".introjs-prevbutton"),
                    w = d.querySelector(".introjs-nextbutton");
                if (c.className = i, r.style.opacity = 0, r.style.display = "none", null != j) {
                    var x = this._introItems[0 <= a.step - 2 ? a.step - 2 : 0];
                    (null != x && "forward" == this._direction && "floating" == x.position || "backward" == this._direction && "floating" == a.position) && (j.style.opacity = 0)
                }
                if (l.call(b, c), l.call(b, d), (x = document.querySelectorAll(".introjs-fixParent")) && 0 < x.length)
                    for (i = x.length - 1; i >= 0; i--) x[i].className = x[i].className.replace(/introjs-fixParent/g, "").replace(/^\s+|\s+$/g, "");
                x = document.querySelector(".introjs-showElement"), x.className = x.className.replace(/introjs-[a-zA-Z]+/g, "").replace(/^\s+|\s+$/g, ""), b._lastShowElementTimer && clearTimeout(b._lastShowElementTimer), b._lastShowElementTimer = setTimeout(function() {
                    null != j && (j.innerHTML = a.step), k.innerHTML = a.intro, r.style.display = "block", h.call(b, a.element, r, n, j), d.querySelector(".introjs-bullets li > a.active").className = "", d.querySelector('.introjs-bullets li > a[data-stepnumber="' + a.step + '"]').className = "active", d.querySelector(".introjs-progress .introjs-progressbar").setAttribute("style", "width:" + t.call(b) + "%;"), r.style.opacity = 1, j && (j.style.opacity = 1), -1 === w.tabIndex ? u.focus() : w.focus()
                }, 350)
            } else {
                var y = document.createElement("div"),
                    v = document.createElement("div"),
                    c = document.createElement("div"),
                    z = document.createElement("div"),
                    A = document.createElement("div"),
                    B = document.createElement("div"),
                    C = document.createElement("div"),
                    D = document.createElement("div");
                y.className = i, v.className = "introjs-tooltipReferenceLayer", l.call(b, y), l.call(b, v), this._targetElement.appendChild(y), this._targetElement.appendChild(v), c.className = "introjs-arrow", A.className = "introjs-tooltiptext", A.innerHTML = a.intro, B.className = "introjs-bullets", !1 === this._options.showBullets && (B.style.display = "none");
                for (var y = document.createElement("ul"), i = 0, E = this._introItems.length; E > i; i++) {
                    var F = document.createElement("li"),
                        G = document.createElement("a");
                    G.onclick = function() {
                        b.goToStep(this.getAttribute("data-stepnumber"))
                    }, i === a.step - 1 && (G.className = "active"), G.href = "javascript:void(0);", G.innerHTML = "&nbsp;", G.setAttribute("data-stepnumber", this._introItems[i].step), F.appendChild(G), y.appendChild(F)
                }
                B.appendChild(y), C.className = "introjs-progress", !1 === this._options.showProgress && (C.style.display = "none"), i = document.createElement("div"), i.className = "introjs-progressbar", i.setAttribute("style", "width:" + t.call(this) + "%;"), C.appendChild(i), D.className = "introjs-tooltipbuttons", !1 === this._options.showButtons && (D.style.display = "none"), z.className = "introjs-tooltip", z.appendChild(A), z.appendChild(B), z.appendChild(C), 1 == this._options.showStepNumbers && (x = document.createElement("span"), x.className = "introjs-helperNumberLayer", x.innerHTML = a.step, v.appendChild(x)), z.appendChild(c), v.appendChild(z), w = document.createElement("a"), w.onclick = function() {
                    b._introItems.length - 1 != b._currentStep && e.call(b)
                }, w.href = "javascript:void(0);", w.innerHTML = this._options.nextLabel, v = document.createElement("a"), v.onclick = function() {
                    0 != b._currentStep && f.call(b)
                }, v.href = "javascript:void(0);", v.innerHTML = this._options.prevLabel, u = document.createElement("a"), u.className = "introjs-button introjs-skipbutton", u.href = "javascript:void(0);", u.innerHTML = this._options.skipLabel, u.onclick = function() {
                    b._introItems.length - 1 == b._currentStep && "function" == typeof b._introCompleteCallback && b._introCompleteCallback.call(b), b._introItems.length - 1 != b._currentStep && "function" == typeof b._introExitCallback && b._introExitCallback.call(b), g.call(b, b._targetElement)
                }, D.appendChild(u), 1 < this._introItems.length && (D.appendChild(v), D.appendChild(w)), z.appendChild(D), h.call(b, a.element, z, c, x)
            }
            for (!0 === this._options.disableInteraction && m.call(b), v.removeAttribute("tabIndex"), w.removeAttribute("tabIndex"), 0 == this._currentStep && 1 < this._introItems.length ? (v.className = "introjs-button introjs-prevbutton introjs-disabled", v.tabIndex = "-1", w.className = "introjs-button introjs-nextbutton", u.innerHTML = this._options.skipLabel) : this._introItems.length - 1 == this._currentStep || 1 == this._introItems.length ? (u.innerHTML = this._options.doneLabel, v.className = "introjs-button introjs-prevbutton", w.className = "introjs-button introjs-nextbutton introjs-disabled", w.tabIndex = "-1") : (v.className = "introjs-button introjs-prevbutton", w.className = "introjs-button introjs-nextbutton", u.innerHTML = this._options.skipLabel), w.focus(), a.element.className += " introjs-showElement", x = o(a.element, "position"), "absolute" !== x && "relative" !== x && (a.element.className += " introjs-relativePosition"), x = a.element.parentNode; null != x && "body" !== x.tagName.toLowerCase();) c = o(x, "z-index"), z = parseFloat(o(x, "opacity")), D = o(x, "transform") || o(x, "-webkit-transform") || o(x, "-moz-transform") || o(x, "-ms-transform") || o(x, "-o-transform"), (/[0-9]+/.test(c) || 1 > z || "none" !== D && void 0 !== D) && (x.className += " introjs-fixParent"), x = x.parentNode;
            q(a.element) || !0 !== this._options.scrollToElement || (z = a.element.getBoundingClientRect(), x = p().height, c = z.bottom - (z.bottom - z.top), z = z.bottom - x, 0 > c || a.element.clientHeight > x ? window.scrollBy(0, c - 30) : window.scrollBy(0, z + 100)), "undefined" != typeof this._introAfterChangeCallback && this._introAfterChangeCallback.call(this, a.element)
        }

        function o(a, b) {
            var c = "";
            return a.currentStyle ? c = a.currentStyle[b] : document.defaultView && document.defaultView.getComputedStyle && (c = document.defaultView.getComputedStyle(a, null).getPropertyValue(b)), c && c.toLowerCase ? c.toLowerCase() : c
        }

        function p() {
            if (void 0 != window.innerWidth) return {
                width: window.innerWidth,
                height: window.innerHeight
            };
            var a = document.documentElement;
            return {
                width: a.clientWidth,
                height: a.clientHeight
            }
        }

        function q(a) {
            return a = a.getBoundingClientRect(), 0 <= a.top && 0 <= a.left && a.bottom + 80 <= window.innerHeight && a.right <= window.innerWidth
        }

        function r(a) {
            var b = document.createElement("div"),
                c = "",
                d = this;
            if (b.className = "introjs-overlay", "body" === a.tagName.toLowerCase()) c += "top: 0;bottom: 0; left: 0;right: 0;position: fixed;", b.setAttribute("style", c);
            else {
                var e = s(a);
                e && (c += "width: " + e.width + "px; height:" + e.height + "px; top:" + e.top + "px;left: " + e.left + "px;", b.setAttribute("style", c))
            }
            return a.appendChild(b), b.onclick = function() {
                1 == d._options.exitOnOverlayClick && (void 0 != d._introExitCallback && d._introExitCallback.call(d), g.call(d, a))
            }, setTimeout(function() {
                c += "opacity: " + d._options.overlayOpacity.toString() + ";", b.setAttribute("style", c)
            }, 10), !0
        }

        function s(a) {
            var b = {};
            b.width = a.offsetWidth, b.height = a.offsetHeight;
            for (var c = 0, d = 0; a && !isNaN(a.offsetLeft) && !isNaN(a.offsetTop);) c += a.offsetLeft, d += a.offsetTop, a = a.offsetParent;
            return b.top = d, b.left = c, b
        }

        function t() {
            return 100 * (parseInt(this._currentStep + 1, 10) / this._introItems.length)
        }
        var u = function(a) {
            if ("object" == typeof a) return new b(a);
            if ("string" == typeof a) {
                if (a = document.querySelector(a)) return new b(a);
                throw Error("There is no element with given selector.")
            }
            return new b(document.body)
        };
        return u.version = "1.1.1", u.fn = b.prototype = {
            clone: function() {
                return new b(this)
            },
            setOption: function(a, b) {
                return this._options[a] = b, this
            },
            setOptions: function(a) {
                var b, c = this._options,
                    d = {};
                for (b in c) d[b] = c[b];
                for (b in a) d[b] = a[b];
                return this._options = d, this
            },
            start: function() {
                return c.call(this, this._targetElement), this
            },
            goToStep: function(a) {
                return this._currentStep = a - 2, "undefined" != typeof this._introItems && e.call(this), this
            },
            nextStep: function() {
                return e.call(this), this
            },
            previousStep: function() {
                return f.call(this), this
            },
            exit: function() {
                return g.call(this, this._targetElement), this
            },
            refresh: function() {
                return l.call(this, document.querySelector(".introjs-helperLayer")), l.call(this, document.querySelector(".introjs-tooltipReferenceLayer")), this
            },
            onbeforechange: function(a) {
                if ("function" != typeof a) throw Error("Provided callback for onbeforechange was not a function");
                return this._introBeforeChangeCallback = a, this
            },
            onchange: function(a) {
                if ("function" != typeof a) throw Error("Provided callback for onchange was not a function.");
                return this._introChangeCallback = a, this
            },
            onafterchange: function(a) {
                if ("function" != typeof a) throw Error("Provided callback for onafterchange was not a function");
                return this._introAfterChangeCallback = a, this
            },
            oncomplete: function(a) {
                if ("function" != typeof a) throw Error("Provided callback for oncomplete was not a function.");
                return this._introCompleteCallback = a, this
            },
            onexit: function(a) {
                if ("function" != typeof a) throw Error("Provided callback for onexit was not a function.");
                return this._introExitCallback = a, this
            }
        }, a.introJs = u
    }), ! function(a) {
        "function" == typeof define && define.amd ? define([], a) : "object" == typeof exports ? module.exports = a(require("jquery")) : window.noUiSlider = a()
    }(function() {
        "use strict";

        function a(a) {
            return a.filter(function(a) {
                return this[a] ? !1 : this[a] = !0
            }, {})
        }

        function b(a, b) {
            return Math.round(a / b) * b
        }

        function c(a) {
            var b = a.getBoundingClientRect(),
                c = a.ownerDocument,
                d = c.defaultView || c.parentWindow,
                e = c.documentElement,
                f = d.pageXOffset;
            return /webkit.*Chrome.*Mobile/i.test(navigator.userAgent) && (f = 0), {
                top: b.top + d.pageYOffset - e.clientTop,
                left: b.left + f - e.clientLeft
            }
        }

        function d(a) {
            return "number" == typeof a && !isNaN(a) && isFinite(a)
        }

        function e(a) {
            var b = Math.pow(10, 7);
            return Number((Math.round(a * b) / b).toFixed(7))
        }

        function f(a, b, c) {
            k(a, b), setTimeout(function() {
                l(a, b)
            }, c)
        }

        function g(a) {
            return Math.max(Math.min(a, 100), 0)
        }

        function h(a) {
            return Array.isArray(a) ? a : [a]
        }

        function j(a) {
            var b = a.split(".");
            return b.length > 1 ? b[1].length : 0
        }

        function k(a, b) {
            a.classList ? a.classList.add(b) : a.className += " " + b
        }

        function l(a, b) {
            a.classList ? a.classList.remove(b) : a.className = a.className.replace(new RegExp("(^|\\b)" + b.split(" ").join("|") + "(\\b|$)", "gi"), " ")
        }

        function m(a, b) {
            a.classList ? a.classList.contains(b) : new RegExp("(^| )" + b + "( |$)", "gi").test(a.className)
        }

        function n(a, b) {
            return 100 / (b - a)
        }

        function o(a, b) {
            return 100 * b / (a[1] - a[0])
        }

        function p(a, b) {
            return o(a, a[0] < 0 ? b + Math.abs(a[0]) : b - a[0])
        }

        function q(a, b) {
            return b * (a[1] - a[0]) / 100 + a[0]
        }

        function r(a, b) {
            for (var c = 1; a >= b[c];) c += 1;
            return c
        }

        function s(a, b, c) {
            if (c >= a.slice(-1)[0]) return 100;
            var d, e, f, g, h = r(c, a);
            return d = a[h - 1], e = a[h], f = b[h - 1], g = b[h], f + p([d, e], c) / n(f, g)
        }

        function t(a, b, c) {
            if (c >= 100) return a.slice(-1)[0];
            var d, e, f, g, h = r(c, b);
            return d = a[h - 1], e = a[h], f = b[h - 1], g = b[h], q([d, e], (c - f) * n(f, g))
        }

        function u(a, c, d, e) {
            if (100 === e) return e;
            var f, g, h = r(e, a);
            return d ? (f = a[h - 1], g = a[h], e - f > (g - f) / 2 ? g : f) : c[h - 1] ? a[h - 1] + b(e - a[h - 1], c[h - 1]) : e
        }

        function v(a, b, c) {
            var e;
            if ("number" == typeof b && (b = [b]), "[object Array]" !== Object.prototype.toString.call(b)) throw new Error("noUiSlider: 'range' contains invalid value.");
            if (e = "min" === a ? 0 : "max" === a ? 100 : parseFloat(a), !d(e) || !d(b[0])) throw new Error("noUiSlider: 'range' value isn't numeric.");
            c.xPct.push(e), c.xVal.push(b[0]), e ? c.xSteps.push(isNaN(b[1]) ? !1 : b[1]) : isNaN(b[1]) || (c.xSteps[0] = b[1])
        }

        function w(a, b, c) {
            return b ? void(c.xSteps[a] = o([c.xVal[a], c.xVal[a + 1]], b) / n(c.xPct[a], c.xPct[a + 1])) : !0
        }

        function x(a, b, c, d) {
            this.xPct = [], this.xVal = [], this.xSteps = [d || !1], this.xNumSteps = [!1], this.snap = b, this.direction = c;
            var e, f = [];
            for (e in a) a.hasOwnProperty(e) && f.push([a[e], e]);
            for (f.sort(function(a, b) {
                    return a[0] - b[0]
                }), e = 0; e < f.length; e++) v(f[e][1], f[e][0], this);
            for (this.xNumSteps = this.xSteps.slice(0), e = 0; e < this.xNumSteps.length; e++) w(e, this.xNumSteps[e], this)
        }

        function y(a, b) {
            if (!d(b)) throw new Error("noUiSlider: 'step' is not numeric.");
            a.singleStep = b
        }

        function z(a, b) {
            if ("object" != typeof b || Array.isArray(b)) throw new Error("noUiSlider: 'range' is not an object.");
            if (void 0 === b.min || void 0 === b.max) throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");
            a.spectrum = new x(b, a.snap, a.dir, a.singleStep)
        }

        function A(a, b) {
            if (b = h(b), !Array.isArray(b) || !b.length || b.length > 2) throw new Error("noUiSlider: 'start' option is incorrect.");
            a.handles = b.length, a.start = b
        }

        function B(a, b) {
            if (a.snap = b, "boolean" != typeof b) throw new Error("noUiSlider: 'snap' option must be a boolean.")
        }

        function C(a, b) {
            if (a.animate = b, "boolean" != typeof b) throw new Error("noUiSlider: 'animate' option must be a boolean.")
        }

        function D(a, b) {
            if ("lower" === b && 1 === a.handles) a.connect = 1;
            else if ("upper" === b && 1 === a.handles) a.connect = 2;
            else if (b === !0 && 2 === a.handles) a.connect = 3;
            else {
                if (b !== !1) throw new Error("noUiSlider: 'connect' option doesn't match handle count.");
                a.connect = 0
            }
        }

        function E(a, b) {
            switch (b) {
                case "horizontal":
                    a.ort = 0;
                    break;
                case "vertical":
                    a.ort = 1;
                    break;
                default:
                    throw new Error("noUiSlider: 'orientation' option is invalid.")
            }
        }

        function F(a, b) {
            if (!d(b)) throw new Error("noUiSlider: 'margin' option must be numeric.");
            if (a.margin = a.spectrum.getMargin(b), !a.margin) throw new Error("noUiSlider: 'margin' option is only supported on linear sliders.")
        }

        function G(a, b) {
            if (!d(b)) throw new Error("noUiSlider: 'limit' option must be numeric.");
            if (a.limit = a.spectrum.getMargin(b), !a.limit) throw new Error("noUiSlider: 'limit' option is only supported on linear sliders.")
        }

        function H(a, b) {
            switch (b) {
                case "ltr":
                    a.dir = 0;
                    break;
                case "rtl":
                    a.dir = 1, a.connect = [0, 2, 1, 3][a.connect];
                    break;
                default:
                    throw new Error("noUiSlider: 'direction' option was not recognized.")
            }
        }

        function I(a, b) {
            if ("string" != typeof b) throw new Error("noUiSlider: 'behaviour' must be a string containing options.");
            var c = b.indexOf("tap") >= 0,
                d = b.indexOf("drag") >= 0,
                e = b.indexOf("fixed") >= 0,
                f = b.indexOf("snap") >= 0;
            a.events = {
                tap: c || f,
                drag: d,
                fixed: e,
                snap: f
            }
        }

        function J(a, b) {
            if (a.format = b, "function" == typeof b.to && "function" == typeof b.from) return !0;
            throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.")
        }

        function K(a) {
            var b, c = {
                margin: 0,
                limit: 0,
                animate: !0,
                format: V
            };
            b = {
                step: {
                    r: !1,
                    t: y
                },
                start: {
                    r: !0,
                    t: A
                },
                connect: {
                    r: !0,
                    t: D
                },
                direction: {
                    r: !0,
                    t: H
                },
                snap: {
                    r: !1,
                    t: B
                },
                animate: {
                    r: !1,
                    t: C
                },
                range: {
                    r: !0,
                    t: z
                },
                orientation: {
                    r: !1,
                    t: E
                },
                margin: {
                    r: !1,
                    t: F
                },
                limit: {
                    r: !1,
                    t: G
                },
                behaviour: {
                    r: !0,
                    t: I
                },
                format: {
                    r: !1,
                    t: J
                }
            };
            var d = {
                connect: !1,
                direction: "ltr",
                behaviour: "tap",
                orientation: "horizontal"
            };
            return Object.keys(d).forEach(function(b) {
                void 0 === a[b] && (a[b] = d[b])
            }), Object.keys(b).forEach(function(d) {
                var e = b[d];
                if (void 0 === a[d]) {
                    if (e.r) throw new Error("noUiSlider: '" + d + "' is required.");
                    return !0
                }
                e.t(c, a[d])
            }), c.pips = a.pips, c.style = c.ort ? "top" : "left", c
        }

        function L(a, b, c) {
            var d = a + b[0],
                e = a + b[1];
            return c ? (0 > d && (e += Math.abs(d)), e > 100 && (d -= e - 100), [g(d), g(e)]) : [d, e]
        }

        function M(a) {
            a.preventDefault();
            var b, c, d = 0 === a.type.indexOf("touch"),
                e = 0 === a.type.indexOf("mouse"),
                f = 0 === a.type.indexOf("pointer"),
                g = a;
            return 0 === a.type.indexOf("MSPointer") && (f = !0), d && (b = a.changedTouches[0].pageX, c = a.changedTouches[0].pageY), (e || f) && (b = a.clientX + window.pageXOffset, c = a.clientY + window.pageYOffset), g.points = [b, c], g.cursor = e || f, g
        }

        function N(a, b) {
            var c = document.createElement("div"),
                d = document.createElement("div"),
                e = ["-lower", "-upper"];
            return a && e.reverse(), k(d, U[3]), k(d, U[3] + e[b]), k(c, U[2]), c.appendChild(d), c
        }

        function O(a, b, c) {
            switch (a) {
                case 1:
                    k(b, U[7]), k(c[0], U[6]);
                    break;
                case 3:
                    k(c[1], U[6]);
                case 2:
                    k(c[0], U[7]);
                case 0:
                    k(b, U[6])
            }
        }

        function P(a, b, c) {
            var d, e = [];
            for (d = 0; a > d; d += 1) e.push(c.appendChild(N(b, d)));
            return e
        }

        function Q(a, b, c) {
            k(c, U[0]), k(c, U[8 + a]), k(c, U[4 + b]);
            var d = document.createElement("div");
            return k(d, U[1]), c.appendChild(d), d
        }

        function R(b, d) {
            function e(a, b, c) {
                if ("range" === a || "steps" === a) return N.xVal;
                if ("count" === a) {
                    var d, e = 100 / (b - 1),
                        f = 0;
                    for (b = [];
                        (d = f++ * e) <= 100;) b.push(d);
                    a = "positions"
                }
                return "positions" === a ? b.map(function(a) {
                    return N.fromStepping(c ? N.getStep(a) : a)
                }) : "values" === a ? c ? b.map(function(a) {
                    return N.fromStepping(N.getStep(N.toStepping(a)))
                }) : b : void 0
            }

            function n(b, c, d) {
                var e = N.direction,
                    f = {},
                    g = N.xVal[0],
                    h = N.xVal[N.xVal.length - 1],
                    i = !1,
                    j = !1,
                    k = 0;
                return N.direction = 0, d = a(d.slice().sort(function(a, b) {
                    return a - b
                })), d[0] !== g && (d.unshift(g), i = !0), d[d.length - 1] !== h && (d.push(h), j = !0), d.forEach(function(a, e) {
                    var g, h, l, m, n, o, p, q, r, s, t = a,
                        u = d[e + 1];
                    if ("steps" === c && (g = N.xNumSteps[e]), g || (g = u - t), t !== !1 && void 0 !== u)
                        for (h = t; u >= h; h += g) {
                            for (m = N.toStepping(h), n = m - k, q = n / b, r = Math.round(q), s = n / r, l = 1; r >= l; l += 1) o = k + l * s, f[o.toFixed(5)] = ["x", 0];
                            p = d.indexOf(h) > -1 ? 1 : "steps" === c ? 2 : 0, !e && i && (p = 0), h === u && j || (f[m.toFixed(5)] = [h, p]), k = m
                        }
                }), N.direction = e, f
            }

            function o(a, b, c) {
                function e(a) {
                    return ["-normal", "-large", "-sub"][a]
                }

                function f(a, b, c) {
                    return 'class="' + b + " " + b + "-" + h + " " + b + e(c[1], c[0]) + '" style="' + d.style + ": " + a + '%"'
                }

                function g(a, d) {
                    N.direction && (a = 100 - a), d[1] = d[1] && b ? b(d[0], d[1]) : d[1], i.innerHTML += "<div " + f(a, "noUi-marker", d) + "></div>", d[1] && (i.innerHTML += "<div " + f(a, "noUi-value", d) + ">" + c.to(d[0]) + "</div>")
                }
                var h = ["horizontal", "vertical"][d.ort],
                    i = document.createElement("div");
                return k(i, "noUi-pips"), k(i, "noUi-pips-" + h), Object.keys(a).forEach(function(b) {
                    g(b, a[b])
                }), i
            }

            function p(a) {
                var b = a.mode,
                    c = a.density || 1,
                    d = a.filter || !1,
                    f = a.values || !1,
                    g = a.stepped || !1,
                    h = e(b, f, g),
                    i = n(c, b, h),
                    j = a.format || {
                        to: Math.round
                    };
                return J.appendChild(o(i, d, j))
            }

            function q() {
                return H["offset" + ["Width", "Height"][d.ort]]
            }

            function r(a, b) {
                void 0 !== b && (b = Math.abs(b - d.dir)), Object.keys(S).forEach(function(c) {
                    var d = c.split(".")[0];
                    a === d && S[c].forEach(function(a) {
                        a(h(C()), b, s(Array.prototype.slice.call(R)))
                    })
                })
            }

            function s(a) {
                return 1 === a.length ? a[0] : d.dir ? a.reverse() : a
            }

            function t(a, b, c, e) {
                var f = function(b) {
                        return J.hasAttribute("disabled") ? !1 : m(J, U[14]) ? !1 : (b = M(b), a === T.start && void 0 !== b.buttons && b.buttons > 1 ? !1 : (b.calcPoint = b.points[d.ort], void c(b, e)))
                    },
                    g = [];
                return a.split(" ").forEach(function(a) {
                    b.addEventListener(a, f, !1), g.push([a, f])
                }), g
            }

            function u(a, b) {
                var c, d = b.handles || I,
                    e = !1,
                    f = 100 * (a.calcPoint - b.start) / q(),
                    g = d[0] === I[0] ? 0 : 1;
                if (c = L(f, b.positions, d.length > 1), e = z(d[0], c[g], 1 === d.length), d.length > 1) {
                    if (e = z(d[1], c[g ? 0 : 1], !1) || e)
                        for (i = 0; i < b.handles.length; i++) r("slide", i)
                } else e && r("slide", g)
            }

            function v(a, b) {
                var c = H.getElementsByClassName(U[15]),
                    d = b.handles[0] === I[0] ? 0 : 1;
                c.length && l(c[0], U[15]), a.cursor && (document.body.style.cursor = "", document.body.removeEventListener("selectstart", document.body.noUiListener));
                var e = document.documentElement;
                e.noUiListeners.forEach(function(a) {
                    e.removeEventListener(a[0], a[1])
                }), l(J, U[12]), r("set", d), r("change", d)
            }

            function w(a, b) {
                var c = document.documentElement;
                if (1 === b.handles.length && (k(b.handles[0].children[0], U[15]), b.handles[0].hasAttribute("disabled"))) return !1;
                a.stopPropagation();
                var d = t(T.move, c, u, {
                        start: a.calcPoint,
                        handles: b.handles,
                        positions: [K[0], K[I.length - 1]]
                    }),
                    e = t(T.end, c, v, {
                        handles: b.handles
                    });
                if (c.noUiListeners = d.concat(e), a.cursor) {
                    document.body.style.cursor = getComputedStyle(a.target).cursor, I.length > 1 && k(J, U[12]);
                    var f = function() {
                        return !1
                    };
                    document.body.noUiListener = f, document.body.addEventListener("selectstart", f, !1)
                }
            }

            function x(a) {
                var b, e, g = a.calcPoint,
                    h = 0;
                return a.stopPropagation(), I.forEach(function(a) {
                    h += c(a)[d.style]
                }), b = h / 2 > g || 1 === I.length ? 0 : 1, g -= c(H)[d.style], e = 100 * g / q(), d.events.snap || f(J, U[14], 300), I[b].hasAttribute("disabled") ? !1 : (z(I[b], e), r("slide", b), r("set", b), r("change", b), void(d.events.snap && w(a, {
                    handles: [I[h]]
                })))
            }

            function y(a) {
                var b, c;
                if (!a.fixed)
                    for (b = 0; b < I.length; b += 1) t(T.start, I[b].children[0], w, {
                        handles: [I[b]]
                    });
                a.tap && t(T.start, H, x, {
                    handles: I
                }), a.drag && (c = [H.getElementsByClassName(U[7])[0]], k(c[0], U[10]), a.fixed && c.push(I[c[0] === I[0] ? 1 : 0].children[0]), c.forEach(function(a) {
                    t(T.start, a, w, {
                        handles: I
                    })
                }))
            }

            function z(a, b, c) {
                var e = a !== I[0] ? 1 : 0,
                    f = K[0] + d.margin,
                    h = K[1] - d.margin,
                    i = K[0] + d.limit,
                    j = K[1] - d.limit;
                return I.length > 1 && (b = e ? Math.max(b, f) : Math.min(b, h)), c !== !1 && d.limit && I.length > 1 && (b = e ? Math.min(b, i) : Math.max(b, j)), b = N.getStep(b), b = g(parseFloat(b.toFixed(7))), b === K[e] ? !1 : (a.style[d.style] = b + "%", a.previousSibling || (l(a, U[17]), b > 50 && k(a, U[17])), K[e] = b, R[e] = N.fromStepping(b), r("update", e), !0)
            }

            function A(a, b) {
                var c, e, f;
                for (d.limit && (a += 1), c = 0; a > c; c += 1) e = c % 2, f = b[e], null !== f && f !== !1 && ("number" == typeof f && (f = String(f)), f = d.format.from(f), (f === !1 || isNaN(f) || z(I[e], N.toStepping(f), c === 3 - d.dir) === !1) && r("update", e))
            }

            function B(a) {
                var b, c, e = h(a);
                for (d.dir && d.handles > 1 && e.reverse(), d.animate && -1 !== K[0] && f(J, U[14], 300), b = I.length > 1 ? 3 : 1, 1 === e.length && (b = 1), A(b, e), c = 0; c < I.length; c++) r("set", c)
            }

            function C() {
                var a, b = [];
                for (a = 0; a < d.handles; a += 1) b[a] = d.format.to(R[a]);
                return s(b)
            }

            function D() {
                U.forEach(function(a) {
                    a && l(J, a)
                }), J.innerHTML = "", delete J.noUiSlider
            }

            function E() {
                var a = K.map(function(a, b) {
                    var c = N.getApplicableStep(a),
                        d = j(String(c[2])),
                        e = R[b],
                        f = 100 === a ? null : c[2],
                        g = Number((e - c[2]).toFixed(d)),
                        h = 0 === a ? null : g >= c[1] ? c[2] : c[0] || !1;
                    return [h, f]
                });
                return s(a)
            }

            function F(a, b) {
                S[a] = S[a] || [], S[a].push(b), "update" === a.split(".")[0] && I.forEach(function(a, b) {
                    r("update", b)
                })
            }

            function G(a) {
                var b = a.split(".")[0],
                    c = a.substring(b.length);
                Object.keys(S).forEach(function(a) {
                    var d = a.split(".")[0],
                        e = a.substring(d.length);
                    b && b !== d || c && c !== e || delete S[a]
                })
            }
            var H, I, J = b,
                K = [-1, -1],
                N = d.spectrum,
                R = [],
                S = {};
            if (J.noUiSlider) throw new Error("Slider was already initialized.");
            return H = Q(d.dir, d.ort, J), I = P(d.handles, d.dir, H), O(d.connect, J, I), y(d.events), d.pips && p(d.pips), {
                destroy: D,
                steps: E,
                on: F,
                off: G,
                get: C,
                set: B
            }
        }

        function S(a, b) {
            if (!a.nodeName) throw new Error("noUiSlider.create requires a single element.");
            var c = K(b, a),
                d = R(a, c);
            d.set(c.start), a.noUiSlider = d
        }
        var T = window.navigator.pointerEnabled ? {
                start: "pointerdown",
                move: "pointermove",
                end: "pointerup"
            } : window.navigator.msPointerEnabled ? {
                start: "MSPointerDown",
                move: "MSPointerMove",
                end: "MSPointerUp"
            } : {
                start: "mousedown touchstart",
                move: "mousemove touchmove",
                end: "mouseup touchend"
            },
            U = ["noUi-target", "noUi-base", "noUi-origin", "noUi-handle", "noUi-horizontal", "noUi-vertical", "noUi-background", "noUi-connect", "noUi-ltr", "noUi-rtl", "noUi-dragable", "", "noUi-state-drag", "", "noUi-state-tap", "noUi-active", "", "noUi-stacking"];
        x.prototype.getMargin = function(a) {
            return 2 === this.xPct.length ? o(this.xVal, a) : !1
        }, x.prototype.toStepping = function(a) {
            return a = s(this.xVal, this.xPct, a), this.direction && (a = 100 - a), a
        }, x.prototype.fromStepping = function(a) {
            return this.direction && (a = 100 - a), e(t(this.xVal, this.xPct, a))
        }, x.prototype.getStep = function(a) {
            return this.direction && (a = 100 - a), a = u(this.xPct, this.xSteps, this.snap, a), this.direction && (a = 100 - a), a
        }, x.prototype.getApplicableStep = function(a) {
            var b = r(a, this.xPct),
                c = 100 === a ? 2 : 1;
            return [this.xNumSteps[b - 2], this.xVal[b - c], this.xNumSteps[b - c]]
        }, x.prototype.convert = function(a) {
            return this.getStep(this.toStepping(a))
        };
        var V = {
            to: function(a) {
                return a.toFixed(2)
            },
            from: Number
        };
        return {
            create: S
        }
    }),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["jquery"], a) : a("object" == typeof exports ? require("jquery") : jQuery)
    }(function(a) {
        "use strict";

        function b(a) {
            return "string" == typeof a ? parseInt(a, 10) : ~~a
        }
        var c = {
                wheelSpeed: 1,
                wheelPropagation: !1,
                swipePropagation: !0,
                minScrollbarLength: null,
                maxScrollbarLength: null,
                useBothWheelAxes: !1,
                useKeyboard: !0,
                suppressScrollX: !1,
                suppressScrollY: !1,
                scrollXMarginOffset: 0,
                scrollYMarginOffset: 0,
                includePadding: !1
            },
            d = 0,
            e = function() {
                var a = d++;
                return function(b) {
                    var c = ".perfect-scrollbar-" + a;
                    return void 0 === b ? c : b + c
                }
            },
            f = "WebkitAppearance" in document.documentElement.style;
        a.fn.perfectScrollbar = function(d, g) {
            return this.each(function() {
                function h(a, c) {
                    var d = a + c,
                        e = C - K;
                    L = 0 > d ? 0 : d > e ? e : d;
                    var f = b(L * (E - C) / (C - K));
                    z.scrollTop(f)
                }

                function i(a, c) {
                    var d = a + c,
                        e = B - G;
                    H = 0 > d ? 0 : d > e ? e : d;
                    var f = b(H * (D - B) / (B - G));
                    z.scrollLeft(f)
                }

                function j(a) {
                    return y.minScrollbarLength && (a = Math.max(a, y.minScrollbarLength)), y.maxScrollbarLength && (a = Math.min(a, y.maxScrollbarLength)), a
                }

                function k() {
                    var a = {
                        width: I
                    };
                    a.left = N ? z.scrollLeft() + B - D : z.scrollLeft(), T ? a.bottom = S - z.scrollTop() : a.top = U + z.scrollTop(), Q.css(a);
                    var b = {
                        top: z.scrollTop(),
                        height: M
                    };
                    $ ? b.right = N ? D - z.scrollLeft() - Z - Y.outerWidth() : Z - z.scrollLeft() : b.left = N ? z.scrollLeft() + 2 * B - D - _ - Y.outerWidth() : _ + z.scrollLeft(), X.css(b), R.css({
                        left: H,
                        width: G - V
                    }), Y.css({
                        top: L,
                        height: K - aa
                    })
                }

                function l() {
                    z.removeClass("ps-active-x"), z.removeClass("ps-active-y"), B = y.includePadding ? z.innerWidth() : z.width(), C = y.includePadding ? z.innerHeight() : z.height(), D = z.prop("scrollWidth"), E = z.prop("scrollHeight"), !y.suppressScrollX && D > B + y.scrollXMarginOffset ? (F = !0, I = B - W, G = j(b(I * B / D)), H = b(z.scrollLeft() * (I - G) / (D - B))) : (F = !1, G = 0, H = 0, z.scrollLeft(0)), !y.suppressScrollY && E > C + y.scrollYMarginOffset ? (J = !0, M = C - ba, K = j(b(M * C / E)), L = b(z.scrollTop() * (M - K) / (E - C))) : (J = !1, K = 0, L = 0, z.scrollTop(0)), H >= I - G && (H = I - G), L >= M - K && (L = M - K), k(), F && z.addClass("ps-active-x"), J && z.addClass("ps-active-y")
                }

                function m() {
                    var b, c, d = function(a) {
                            i(b, a.pageX - c), l(), a.stopPropagation(), a.preventDefault()
                        },
                        e = function() {
                            Q.removeClass("in-scrolling"), a(P).unbind(O("mousemove"), d)
                        };
                    R.bind(O("mousedown"), function(f) {
                        c = f.pageX, b = R.position().left, Q.addClass("in-scrolling"), a(P).bind(O("mousemove"), d), a(P).one(O("mouseup"), e), f.stopPropagation(), f.preventDefault()
                    }), b = c = null
                }

                function n() {
                    var b, c, d = function(a) {
                            h(b, a.pageY - c), l(), a.stopPropagation(), a.preventDefault()
                        },
                        e = function() {
                            X.removeClass("in-scrolling"), a(P).unbind(O("mousemove"), d)
                        };
                    Y.bind(O("mousedown"), function(f) {
                        c = f.pageY, b = Y.position().top, X.addClass("in-scrolling"), a(P).bind(O("mousemove"), d), a(P).one(O("mouseup"), e), f.stopPropagation(), f.preventDefault()
                    }), b = c = null
                }

                function o(a, b) {
                    var c = z.scrollTop();
                    if (0 === a) {
                        if (!J) return !1;
                        if (0 === c && b > 0 || c >= E - C && 0 > b) return !y.wheelPropagation
                    }
                    var d = z.scrollLeft();
                    if (0 === b) {
                        if (!F) return !1;
                        if (0 === d && 0 > a || d >= D - B && a > 0) return !y.wheelPropagation
                    }
                    return !0
                }

                function p(a, b) {
                    var c = z.scrollTop(),
                        d = z.scrollLeft(),
                        e = Math.abs(a),
                        f = Math.abs(b);
                    if (f > e) {
                        if (0 > b && c === E - C || b > 0 && 0 === c) return !y.swipePropagation
                    } else if (e > f && (0 > a && d === D - B || a > 0 && 0 === d)) return !y.swipePropagation;
                    return !0
                }

                function q() {
                    function a(a) {
                        var b = a.originalEvent.deltaX,
                            c = -1 * a.originalEvent.deltaY;
                        return (void 0 === b || void 0 === c) && (b = -1 * a.originalEvent.wheelDeltaX / 6, c = a.originalEvent.wheelDeltaY / 6), a.originalEvent.deltaMode && 1 === a.originalEvent.deltaMode && (b *= 10, c *= 10), b !== b && c !== c && (b = 0, c = a.originalEvent.wheelDelta), [b, c]
                    }

                    function b(b) {
                        if (f || !(z.find("select:focus").length > 0)) {
                            var d = a(b),
                                e = d[0],
                                g = d[1];
                            c = !1, y.useBothWheelAxes ? J && !F ? (g ? z.scrollTop(z.scrollTop() - g * y.wheelSpeed) : z.scrollTop(z.scrollTop() + e * y.wheelSpeed), c = !0) : F && !J && (e ? z.scrollLeft(z.scrollLeft() + e * y.wheelSpeed) : z.scrollLeft(z.scrollLeft() - g * y.wheelSpeed), c = !0) : (z.scrollTop(z.scrollTop() - g * y.wheelSpeed), z.scrollLeft(z.scrollLeft() + e * y.wheelSpeed)), l(), c = c || o(e, g), c && (b.stopPropagation(), b.preventDefault())
                        }
                    }
                    var c = !1;
                    void 0 !== window.onwheel ? z.bind(O("wheel"), b) : void 0 !== window.onmousewheel && z.bind(O("mousewheel"), b)
                }

                function r() {
                    var b = !1;
                    z.bind(O("mouseenter"), function() {
                        b = !0
                    }), z.bind(O("mouseleave"), function() {
                        b = !1
                    });
                    var c = !1;
                    a(P).bind(O("keydown"), function(d) {
                        if ((!d.isDefaultPrevented || !d.isDefaultPrevented()) && b) {
                            for (var e = document.activeElement ? document.activeElement : P.activeElement; e.shadowRoot;) e = e.shadowRoot.activeElement;
                            if (!a(e).is(":input,[contenteditable]")) {
                                var f = 0,
                                    g = 0;
                                switch (d.which) {
                                    case 37:
                                        f = -30;
                                        break;
                                    case 38:
                                        g = 30;
                                        break;
                                    case 39:
                                        f = 30;
                                        break;
                                    case 40:
                                        g = -30;
                                        break;
                                    case 33:
                                        g = 90;
                                        break;
                                    case 32:
                                    case 34:
                                        g = -90;
                                        break;
                                    case 35:
                                        g = d.ctrlKey ? -E : -C;
                                        break;
                                    case 36:
                                        g = d.ctrlKey ? z.scrollTop() : C;
                                        break;
                                    default:
                                        return
                                }
                                z.scrollTop(z.scrollTop() - g), z.scrollLeft(z.scrollLeft() + f), c = o(f, g), c && d.preventDefault()
                            }
                        }
                    })
                }

                function s() {
                    function a(a) {
                        a.stopPropagation()
                    }
                    Y.bind(O("click"), a), X.bind(O("click"), function(a) {
                        var c = b(K / 2),
                            d = a.pageY - X.offset().top - c,
                            e = C - K,
                            f = d / e;
                        0 > f ? f = 0 : f > 1 && (f = 1), z.scrollTop((E - C) * f)
                    }), R.bind(O("click"), a), Q.bind(O("click"), function(a) {
                        var c = b(G / 2),
                            d = a.pageX - Q.offset().left - c,
                            e = B - G,
                            f = d / e;
                        0 > f ? f = 0 : f > 1 && (f = 1), z.scrollLeft((D - B) * f)
                    })
                }

                function t() {
                    function b() {
                        var a = window.getSelection ? window.getSelection() : document.getSlection ? document.getSlection() : {
                            rangeCount: 0
                        };
                        return 0 === a.rangeCount ? null : a.getRangeAt(0).commonAncestorContainer
                    }

                    function c() {
                        e || (e = setInterval(function() {
                            return A() ? (z.scrollTop(z.scrollTop() + f.top), z.scrollLeft(z.scrollLeft() + f.left), void l()) : void clearInterval(e)
                        }, 50))
                    }

                    function d() {
                        e && (clearInterval(e), e = null), Q.removeClass("in-scrolling"), X.removeClass("in-scrolling")
                    }
                    var e = null,
                        f = {
                            top: 0,
                            left: 0
                        },
                        g = !1;
                    a(P).bind(O("selectionchange"), function() {
                        a.contains(z[0], b()) ? g = !0 : (g = !1, d())
                    }), a(window).bind(O("mouseup"), function() {
                        g && (g = !1, d())
                    }), a(window).bind(O("mousemove"), function(a) {
                        if (g) {
                            var b = {
                                    x: a.pageX,
                                    y: a.pageY
                                },
                                e = z.offset(),
                                h = {
                                    left: e.left,
                                    right: e.left + z.outerWidth(),
                                    top: e.top,
                                    bottom: e.top + z.outerHeight()
                                };
                            b.x < h.left + 3 ? (f.left = -5, Q.addClass("in-scrolling")) : b.x > h.right - 3 ? (f.left = 5, Q.addClass("in-scrolling")) : f.left = 0, b.y < h.top + 3 ? (f.top = 5 > h.top + 3 - b.y ? -5 : -20, X.addClass("in-scrolling")) : b.y > h.bottom - 3 ? (f.top = 5 > b.y - h.bottom + 3 ? 5 : 20, X.addClass("in-scrolling")) : f.top = 0, 0 === f.top && 0 === f.left ? d() : c()
                        }
                    })
                }

                function u(b, c) {
                    function d(a, b) {
                        z.scrollTop(z.scrollTop() - b), z.scrollLeft(z.scrollLeft() - a), l()
                    }

                    function e() {
                        r = !0
                    }

                    function f() {
                        r = !1
                    }

                    function g(a) {
                        return a.originalEvent.targetTouches ? a.originalEvent.targetTouches[0] : a.originalEvent
                    }

                    function h(a) {
                        var b = a.originalEvent;
                        return b.targetTouches && 1 === b.targetTouches.length ? !0 : !(!b.pointerType || "mouse" === b.pointerType || b.pointerType === b.MSPOINTER_TYPE_MOUSE)
                    }

                    function i(a) {
                        if (h(a)) {
                            s = !0;
                            var b = g(a);
                            m.pageX = b.pageX, m.pageY = b.pageY, n = (new Date).getTime(), null !== q && clearInterval(q), a.stopPropagation()
                        }
                    }

                    function j(a) {
                        if (!r && s && h(a)) {
                            var b = g(a),
                                c = {
                                    pageX: b.pageX,
                                    pageY: b.pageY
                                },
                                e = c.pageX - m.pageX,
                                f = c.pageY - m.pageY;
                            d(e, f), m = c;
                            var i = (new Date).getTime(),
                                j = i - n;
                            j > 0 && (o.x = e / j, o.y = f / j, n = i), p(e, f) && (a.stopPropagation(), a.preventDefault())
                        }
                    }

                    function k() {
                        !r && s && (s = !1, clearInterval(q), q = setInterval(function() {
                            return A() ? .01 > Math.abs(o.x) && .01 > Math.abs(o.y) ? void clearInterval(q) : (d(30 * o.x, 30 * o.y), o.x *= .8, void(o.y *= .8)) : void clearInterval(q)
                        }, 10))
                    }
                    var m = {},
                        n = 0,
                        o = {},
                        q = null,
                        r = !1,
                        s = !1;
                    b && (a(window).bind(O("touchstart"), e), a(window).bind(O("touchend"), f), z.bind(O("touchstart"), i), z.bind(O("touchmove"), j), z.bind(O("touchend"), k)), c && (window.PointerEvent ? (a(window).bind(O("pointerdown"), e), a(window).bind(O("pointerup"), f), z.bind(O("pointerdown"), i), z.bind(O("pointermove"), j), z.bind(O("pointerup"), k)) : window.MSPointerEvent && (a(window).bind(O("MSPointerDown"), e), a(window).bind(O("MSPointerUp"), f), z.bind(O("MSPointerDown"), i), z.bind(O("MSPointerMove"), j), z.bind(O("MSPointerUp"), k)))
                }

                function v() {
                    z.bind(O("scroll"), function() {
                        l()
                    })
                }

                function w() {
                    z.unbind(O()), a(window).unbind(O()), a(P).unbind(O()), z.data("perfect-scrollbar", null), z.data("perfect-scrollbar-update", null), z.data("perfect-scrollbar-destroy", null), R.remove(), Y.remove(), Q.remove(), X.remove(), z = Q = X = R = Y = F = J = B = C = D = E = G = H = S = T = U = K = L = Z = $ = _ = N = O = null
                }

                function x() {
                    l(), v(), m(), n(), s(), t(), q(), (ca || da) && u(ca, da), y.useKeyboard && r(), z.data("perfect-scrollbar", z), z.data("perfect-scrollbar-update", l), z.data("perfect-scrollbar-destroy", w)
                }
                var y = a.extend(!0, {}, c),
                    z = a(this),
                    A = function() {
                        return !!z
                    };
                if ("object" == typeof d ? a.extend(!0, y, d) : g = d, "update" === g) return z.data("perfect-scrollbar-update") && z.data("perfect-scrollbar-update")(), z;
                if ("destroy" === g) return z.data("perfect-scrollbar-destroy") && z.data("perfect-scrollbar-destroy")(), z;
                if (z.data("perfect-scrollbar")) return z.data("perfect-scrollbar");
                z.addClass("ps-container");
                var B, C, D, E, F, G, H, I, J, K, L, M, N = "rtl" === z.css("direction"),
                    O = e(),
                    P = this.ownerDocument || document,
                    Q = a("<div class='ps-scrollbar-x-rail'>").appendTo(z),
                    R = a("<div class='ps-scrollbar-x'>").appendTo(Q),
                    S = b(Q.css("bottom")),
                    T = S === S,
                    U = T ? null : b(Q.css("top")),
                    V = b(Q.css("borderLeftWidth")) + b(Q.css("borderRightWidth")),
                    W = b(Q.css("marginLeft")) + b(Q.css("marginRight")),
                    X = a("<div class='ps-scrollbar-y-rail'>").appendTo(z),
                    Y = a("<div class='ps-scrollbar-y'>").appendTo(X),
                    Z = b(X.css("right")),
                    $ = Z === Z,
                    _ = $ ? null : b(X.css("left")),
                    aa = b(X.css("borderTopWidth")) + b(X.css("borderBottomWidth")),
                    ba = b(X.css("marginTop")) + b(X.css("marginBottom")),
                    ca = "ontouchstart" in window || window.DocumentTouch && document instanceof window.DocumentTouch,
                    da = null !== window.navigator.msMaxTouchPoints;
                return x(), z
            })
        }
    }), ! function(a) {
        var b = {};
        if (b.EventTarget = function() {
                "use strict";

                function a() {
                    this._handlers = {}
                }
                return a.prototype = {
                    constructor: a,
                    on: function(a, b) {
                        var c, d, e = this._handlers[a];
                        for ("undefined" == typeof e && (e = this._handlers[a] = []), c = 0, d = e.length; d > c; c++)
                            if (e[c] === b) return;
                        e.push(b)
                    },
                    fire: function(a, b) {
                        var c, d, e, f = {
                            type: a,
                            data: b
                        };
                        if (c = this._handlers[f.type], c instanceof Array)
                            for (c = c.concat(), d = 0, e = c.length; e > d; d++) c[d].call(this, f)
                    },
                    off: function(a, b) {
                        var c, d, e = this._handlers[a];
                        if (e instanceof Array)
                            for (c = 0, d = e.length; d > c; c++)
                                if (e[c] === b) {
                                    e.splice(c, 1);
                                    break
                                }
                    }
                }, a
            }(), b.NativeDOM = function() {
                "use strict";
                return {
                    type: "native",
                    query: function(a, b) {
                        return a.querySelector(b)
                    },
                    queryAll: function(a, b) {
                        return a.querySelectorAll(b)
                    },
                    on: function(a, b, c) {
                        a.addEventListener(b, c, !1)
                    },
                    off: function(a, b, c) {
                        a.removeEventListener(b, c, !1)
                    }
                }
            }(), b.DOM = b.NativeDOM, b.DOMEventDelegate = function() {
                "use strict";

                function a(a) {
                    return a && a.hasAttribute("data-module")
                }

                function c(a) {
                    return a && a.hasAttribute("data-type")
                }

                function d(b) {
                    for (var d = !1, e = !1; !d && b && b.parentNode && !e;) d = c(b), e = a(b), d || (b = b.parentNode);
                    return d ? b : null
                }

                function e(a, b, c, d) {
                    var e, f;
                    for (e = 0; e < a.length; e++) f = a[e], b["on" + f] && c.call(d, f)
                }

                function f(a, b, c) {
                    this.element = a, this._handler = b, this._eventTypes = c || g, this._boundHandler = {}, this._attached = !1
                }
                var g = ["click", "mouseover", "mouseout", "mousedown", "mouseup", "mouseenter", "mouseleave", "mousemove", "keydown", "keyup", "submit", "change", "contextmenu", "dblclick", "input", "focusin", "focusout"];
                return f.prototype = {
                    constructor: f,
                    _handleEvent: function(a) {
                        var b = d(a.target),
                            c = b ? b.getAttribute("data-type") : "";
                        this._handler["on" + a.type](a, b, c)
                    },
                    attachEvents: function() {
                        this._attached || (e(this._eventTypes, this._handler, function(a) {
                            function c() {
                                d._handleEvent.apply(d, arguments)
                            }
                            var d = this;
                            b.DOM.on(this.element, a, c), this._boundHandler[a] = c
                        }, this), this._attached = !0)
                    },
                    detachEvents: function() {
                        e(this._eventTypes, this._handler, function(a) {
                            b.DOM.off(this.element, a, this._boundHandler[a])
                        }, this)
                    }
                }, f
            }(), b.Context = function() {
                "use strict";

                function a(a, b) {
                    this.application = a, this.element = b
                }
                return a.prototype = {
                    constructor: a,
                    broadcast: function(a, b) {
                        this.application.broadcast(a, b)
                    },
                    getService: function(a) {
                        return this.application.getService(a)
                    },
                    hasService: function(a) {
                        return this.application.hasService(a)
                    },
                    getConfig: function(a) {
                        return this.application.getModuleConfig(this.element, a)
                    },
                    getGlobal: function(a) {
                        return this.application.getGlobal(a)
                    },
                    getGlobalConfig: function(a) {
                        return this.application.getGlobalConfig(a)
                    },
                    reportError: function(a) {
                        this.application.reportError(a)
                    },
                    getElement: function() {
                        return this.element
                    }
                }, a
            }(), b.Application = function() {
                "use strict";

                function c(a, b) {
                    for (var c in b) b.hasOwnProperty(c) && (a[c] = b[c]);
                    return a
                }

                function d(a, b) {
                    for (var c = 0, d = a.length; d > c; c++)
                        if (a[c] === b) return c;
                    return -1
                }

                function e() {
                    s = {}, t = {}, v = {}, u = [], w = {}, x = {}, y = !1
                }

                function f(a) {
                    for (var b = 0, c = u.length; c > b; b++)
                        if (u[b] === a) return !0;
                    return !1
                }

                function g(a) {
                    if (s.debug) throw a;
                    z.fire("error", {
                        exception: a
                    })
                }

                function h(a, b) {
                    var c, d;
                    for (c in a) d = a[c], "function" == typeof d && (a[c] = function(a, c) {
                        return function() {
                            var d = b + "." + a + "() - ";
                            try {
                                return c.apply(this, arguments)
                            } catch (e) {
                                e.methodName = a, e.objectName = b, e.name = d + e.name, e.message = d + e.message, g(e)
                            }
                        }
                    }(c, d))
                }

                function i(a) {
                    var b = a.getAttribute("data-module");
                    return b ? b.split(" ")[0] : ""
                }

                function j(a, b) {
                    "function" == typeof a[b] && a[b].apply(a, Array.prototype.slice.call(arguments, 2))
                }

                function k(a) {
                    var b = v[a];
                    if (b) {
                        if (!b.instance) {
                            if (f(a)) return g(new ReferenceError("Circular service dependency: " + u.join(" -> ") + " -> " + a)), null;
                            u.push(a), b.instance = b.creator(z), u.pop()
                        }
                        return b.instance
                    }
                    return g(new Error('Service "' + a + '" not found')), null
                }

                function l(a) {
                    var b, c, d, e, f, h = [],
                        i = {};
                    for (c = a.instance.behaviors || [], b = 0; b < c.length; b++) f = c[b], "behaviorInstances" in a || (a.behaviorInstances = {}), e = a.behaviorInstances, d = w[f], f in i ? g(new Error('Behavior "' + f + '" cannot be specified twice in a module.')) : d ? (e[f] || (e[f] = d.creator(a.context)), h.push(e[f])) : g(new Error('Behavior "' + f + '" not found')), i[f] = !0;
                    return h
                }

                function m(a, c, d) {
                    var e = new b.DOMEventDelegate(c, d, s.eventTypes);
                    a.push(e), e.attachEvents()
                }

                function n(a) {
                    var b = a.eventDelegates,
                        c = l(a);
                    m(b, a.element, a.instance);
                    for (var d = 0; d < c.length; d++) m(b, a.element, c[d])
                }

                function o(a) {
                    for (var b = a.eventDelegates, c = 0; c < b.length; c++) b[c].detachEvents();
                    a.eventDelegates = []
                }

                function p(a) {
                    return x[a.id]
                }

                function q(a, b, c) {
                    null !== a.onmessage && "object" == typeof a.onmessage && a.onmessage.hasOwnProperty(b) ? a.onmessage[b].call(a, c) : -1 !== d(a.messages || [], b) && a.onmessage.call(a, b, c)
                }
                var r = "[data-module]",
                    s = {},
                    t = {},
                    u = [],
                    v = {},
                    w = {},
                    x = {},
                    y = !1,
                    z = new b.EventTarget;
                return c(z, {
                    init: function(a) {
                        return c(s, a || {}), this.startAll(document.documentElement), this.fire("init"), y = !0, this
                    },
                    destroy: function() {
                        return this.stopAll(document.documentElement), e(), this
                    },
                    isStarted: function(a) {
                        var b = p(a);
                        return "object" == typeof b
                    },
                    start: function(a) {
                        var c, d, e, f = i(a),
                            k = t[f];
                        if (!k) return g(new Error('Module type "' + f + '" is not defined.')), this;
                        if (!this.isStarted(a)) {
                            a.id || (a.id = "mod-" + f + "-" + k.counter), k.counter++, d = new b.Context(this, a), e = k.creator(d), s.debug || h(e, f), c = {
                                moduleName: f,
                                instance: e,
                                context: d,
                                element: a,
                                eventDelegates: []
                            }, x[a.id] = c;
                            for (var m, o = l(c), p = 0, q = o.length; q > p; p++) m = o[p], j(m, "init");
                            j(c.instance, "init"), n(c)
                        }
                        return this
                    },
                    stop: function(a) {
                        var b = p(a);
                        if (b) {
                            o(b);
                            for (var c, d = l(b), e = d.length - 1; e >= 0; e--) c = d[e], j(c, "destroy");
                            j(b.instance, "destroy"), delete x[a.id]
                        } else if (s.debug) return g(new Error("Unable to stop module associated with element: " + a.id)), this;
                        return this
                    },
                    startAll: function(a) {
                        for (var c = b.DOM.queryAll(a, r), d = 0, e = c.length; e > d; d++) this.start(c[d]);
                        return this
                    },
                    stopAll: function(a) {
                        for (var c = b.DOM.queryAll(a, r), d = 0, e = c.length; e > d; d++) this.stop(c[d]);
                        return this
                    },
                    addModule: function(a, b) {
                        return "undefined" != typeof t[a] ? (g(new Error("Module " + a + " has already been added.")), this) : (t[a] = {
                            creator: b,
                            counter: 1
                        }, this)
                    },
                    getModuleConfig: function(a, c) {
                        var d = p(a),
                            e = null;
                        if (d && d.config) e = d.config;
                        else {
                            var f = b.DOM.query(a, 'script[type="text/x-config"]');
                            if (f) try {
                                e = JSON.parse(f.text)
                            } catch (h) {
                                g(new Error("Module with id " + a.id + " has a malformed config."))
                            }
                            d && (d.config = e)
                        }
                        return e ? "undefined" == typeof c ? e : c in e ? e[c] : null : null
                    },
                    addService: function(a, b) {
                        return "undefined" != typeof v[a] ? (g(new Error("Service " + a + " has already been added.")), this) : (v[a] = {
                            creator: b,
                            instance: null
                        }, this)
                    },
                    getService: k,
                    hasService: function(a) {
                        return v.hasOwnProperty(a)
                    },
                    addBehavior: function(a, b) {
                        return "undefined" != typeof w[a] ? (g(new Error("Behavior " + a + " has already been added.")), this) : (w[a] = {
                            creator: b,
                            instance: null
                        }, this)
                    },
                    broadcast: function(a, b) {
                        var c, d, e, f, g;
                        for (d in x)
                            if (x.hasOwnProperty(d))
                                for (e = x[d], q(e.instance, a, b), g = l(e), c = 0; c < g.length; c++) f = g[c], q(f, a, b);
                        return this.fire("message", {
                            message: a,
                            messageData: b
                        }), this
                    },
                    getGlobal: function(b) {
                        return b in a ? a[b] : null
                    },
                    getGlobalConfig: function(a) {
                        return "undefined" == typeof a ? s : a in s ? s[a] : null
                    },
                    setGlobalConfig: function(a) {
                        return y ? (g(new Error("Cannot set global configuration after application initialization")), this) : (c(s, a), this)
                    },
                    reportError: g,
                    reportWarning: function(a) {
                        if (s.debug) {
                            var b = this.getGlobal("console");
                            b && b.warn && b.warn(a)
                        } else z.fire("warning", a)
                    }
                })
            }(), "function" == typeof define && define.amd) define("t3", [], function() {
            return b
        });
        else if ("object" == typeof module && "object" == typeof module.exports) module.exports = b;
        else {
            a.Box = a.Box || {};
            for (var c in b) b.hasOwnProperty(c) && (a.Box[c] = b[c])
        }
    }("undefined" != typeof window ? window : this),
    function(a) {
        "use strict";
        var b = function(a, c, d) {
                var e, f, g = document.createElement("img");
                if (g.onerror = c, g.onload = function() {
                        !f || d && d.noRevoke || b.revokeObjectURL(f), c && c(b.scale(g, d))
                    }, b.isInstanceOf("Blob", a) || b.isInstanceOf("File", a)) e = f = b.createObjectURL(a), g._type = a.type;
                else {
                    if ("string" != typeof a) return !1;
                    e = a, d && d.crossOrigin && (g.crossOrigin = d.crossOrigin)
                }
                return e ? (g.src = e, g) : b.readFile(a, function(a) {
                    var b = a.target;
                    b && b.result ? g.src = b.result : c && c(a)
                })
            },
            c = window.createObjectURL && window || window.URL && URL.revokeObjectURL && URL || window.webkitURL && webkitURL;
        b.isInstanceOf = function(a, b) {
            return Object.prototype.toString.call(b) === "[object " + a + "]"
        }, b.transformCoordinates = function() {}, b.getTransformedOptions = function(a) {
            return a
        }, b.renderImageToCanvas = function(a, b, c, d, e, f, g, h, i, j) {
            return a.getContext("2d").drawImage(b, c, d, e, f, g, h, i, j), a
        }, b.hasCanvasOption = function(a) {
            return a.canvas || a.crop
        }, b.scale = function(a, c) {
            c = c || {};
            var d, e, f, g, h, i, j, k, l, m = document.createElement("canvas"),
                n = a.getContext || b.hasCanvasOption(c) && m.getContext,
                o = a.naturalWidth || a.width,
                p = a.naturalHeight || a.height,
                q = o,
                r = p,
                s = function() {
                    var a = Math.max((f || q) / q, (g || r) / r);
                    a > 1 && (q = Math.ceil(q * a), r = Math.ceil(r * a))
                },
                t = function() {
                    var a = Math.min((d || q) / q, (e || r) / r);
                    1 > a && (q = Math.ceil(q * a), r = Math.ceil(r * a))
                };
            return n && (c = b.getTransformedOptions(c), j = c.left || 0, k = c.top || 0, c.sourceWidth ? (h = c.sourceWidth, void 0 !== c.right && void 0 === c.left && (j = o - h - c.right)) : h = o - j - (c.right || 0), c.sourceHeight ? (i = c.sourceHeight, void 0 !== c.bottom && void 0 === c.top && (k = p - i - c.bottom)) : i = p - k - (c.bottom || 0), q = h, r = i), d = c.maxWidth, e = c.maxHeight, f = c.minWidth, g = c.minHeight, n && d && e && c.crop ? (q = d, r = e, l = h / i - d / e, 0 > l ? (i = e * h / d, void 0 === c.top && void 0 === c.bottom && (k = (p - i) / 2)) : l > 0 && (h = d * i / e, void 0 === c.left && void 0 === c.right && (j = (o - h) / 2))) : ((c.contain || c.cover) && (f = d = d || f, g = e = e || g), c.cover ? (t(), s()) : (s(), t())), n ? (m.width = q, m.height = r, b.transformCoordinates(m, c), b.renderImageToCanvas(m, a, j, k, h, i, 0, 0, q, r)) : (a.width = q, a.height = r, a)
        }, b.createObjectURL = function(a) {
            return c ? c.createObjectURL(a) : !1
        }, b.revokeObjectURL = function(a) {
            return c ? c.revokeObjectURL(a) : !1
        }, b.readFile = function(a, b, c) {
            if (window.FileReader) {
                var d = new FileReader;
                if (d.onload = d.onerror = b, c = c || "readAsDataURL", d[c]) return d[c](a), d
            }
            return !1
        }, "function" == typeof define && define.amd ? define(function() {
            return b
        }) : a.loadImage = b
    }(this),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["load-image"], a) : a(window.loadImage)
    }(function(a) {
        "use strict";
        if (window.navigator && window.navigator.platform && /iP(hone|od|ad)/.test(window.navigator.platform)) {
            var b = a.renderImageToCanvas;
            a.detectSubsampling = function(a) {
                var b, c;
                return a.width * a.height > 1048576 ? (b = document.createElement("canvas"), b.width = b.height = 1, c = b.getContext("2d"), c.drawImage(a, -a.width + 1, 0), 0 === c.getImageData(0, 0, 1, 1).data[3]) : !1
            }, a.detectVerticalSquash = function(a, b) {
                var c, d, e, f, g, h = a.naturalHeight || a.height,
                    i = document.createElement("canvas"),
                    j = i.getContext("2d");
                for (b && (h /= 2), i.width = 1, i.height = h, j.drawImage(a, 0, 0), c = j.getImageData(0, 0, 1, h).data, d = 0, e = h, f = h; f > d;) g = c[4 * (f - 1) + 3], 0 === g ? e = f : d = f, f = e + d >> 1;
                return f / h || 1
            }, a.renderImageToCanvas = function(c, d, e, f, g, h, i, j, k, l) {
                if ("image/jpeg" === d._type) {
                    var m, n, o, p, q = c.getContext("2d"),
                        r = document.createElement("canvas"),
                        s = 1024,
                        t = r.getContext("2d");
                    if (r.width = s, r.height = s, q.save(), m = a.detectSubsampling(d), m && (e /= 2, f /= 2, g /= 2, h /= 2), n = a.detectVerticalSquash(d, m), m || 1 !== n) {
                        for (f *= n, k = Math.ceil(s * k / g), l = Math.ceil(s * l / h / n), j = 0, p = 0; h > p;) {
                            for (i = 0, o = 0; g > o;) t.clearRect(0, 0, s, s), t.drawImage(d, e, f, g, h, -o, -p, g, h), q.drawImage(r, 0, 0, s, s, i, j, k, l), o += s, i += k;
                            p += s, j += l
                        }
                        return q.restore(), c
                    }
                }
                return b(c, d, e, f, g, h, i, j, k, l)
            }
        }
    }),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["load-image"], a) : a(window.loadImage)
    }(function(a) {
        "use strict";
        var b = a.hasCanvasOption;
        a.hasCanvasOption = function(a) {
            return b(a) || a.orientation
        }, a.transformCoordinates = function(a, b) {
            var c = a.getContext("2d"),
                d = a.width,
                e = a.height,
                f = b.orientation;
            if (f) switch (f > 4 && (a.width = e, a.height = d), f) {
                case 2:
                    c.translate(d, 0), c.scale(-1, 1);
                    break;
                case 3:
                    c.translate(d, e), c.rotate(Math.PI);
                    break;
                case 4:
                    c.translate(0, e), c.scale(1, -1);
                    break;
                case 5:
                    c.rotate(.5 * Math.PI), c.scale(1, -1);
                    break;
                case 6:
                    c.rotate(.5 * Math.PI), c.translate(0, -e);
                    break;
                case 7:
                    c.rotate(.5 * Math.PI), c.translate(d, -e), c.scale(-1, 1);
                    break;
                case 8:
                    c.rotate(-.5 * Math.PI), c.translate(-d, 0)
            }
        }, a.getTransformedOptions = function(a) {
            if (!a.orientation || 1 === a.orientation) return a;
            var b, c = {};
            for (b in a) a.hasOwnProperty(b) && (c[b] = a[b]);
            switch (a.orientation) {
                case 2:
                    c.left = a.right, c.right = a.left;
                    break;
                case 3:
                    c.left = a.right, c.top = a.bottom, c.right = a.left, c.bottom = a.top;
                    break;
                case 4:
                    c.top = a.bottom, c.bottom = a.top;
                    break;
                case 5:
                    c.left = a.top, c.top = a.left, c.right = a.bottom, c.bottom = a.right;
                    break;
                case 6:
                    c.left = a.top, c.top = a.right, c.right = a.bottom, c.bottom = a.left;
                    break;
                case 7:
                    c.left = a.bottom, c.top = a.right, c.right = a.top, c.bottom = a.left;
                    break;
                case 8:
                    c.left = a.bottom, c.top = a.left, c.right = a.top, c.bottom = a.right
            }
            return a.orientation > 4 && (c.maxWidth = a.maxHeight, c.maxHeight = a.maxWidth, c.minWidth = a.minHeight, c.minHeight = a.minWidth, c.sourceWidth = a.sourceHeight, c.sourceHeight = a.sourceWidth), c
        }
    }),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["load-image"], a) : a(window.loadImage)
    }(function(a) {
        "use strict";
        var b = window.Blob && (Blob.prototype.slice || Blob.prototype.webkitSlice || Blob.prototype.mozSlice);
        a.blobSlice = b && function() {
            var a = this.slice || this.webkitSlice || this.mozSlice;
            return a.apply(this, arguments)
        }, a.metaDataParsers = {
            jpeg: {
                65505: []
            }
        }, a.parseMetaData = function(b, c, d) {
            d = d || {};
            var e = this,
                f = d.maxMetaDataSize || 262144,
                g = {},
                h = !(window.DataView && b && b.size >= 12 && "image/jpeg" === b.type && a.blobSlice);
            (h || !a.readFile(a.blobSlice.call(b, 0, f), function(b) {
                var f, h, i, j, k = b.target.result,
                    l = new DataView(k),
                    m = 2,
                    n = l.byteLength - 4,
                    o = m;
                if (65496 === l.getUint16(0)) {
                    for (; n > m && (f = l.getUint16(m), f >= 65504 && 65519 >= f || 65534 === f);) {
                        if (h = l.getUint16(m + 2) + 2, m + h > l.byteLength) {
                            console.log("Invalid meta data: Invalid segment size.");
                            break
                        }
                        if (i = a.metaDataParsers.jpeg[f])
                            for (j = 0; i.length > j; j += 1) i[j].call(e, l, m, h, g, d);
                        m += h, o = m
                    }!d.disableImageHead && o > 6 && (g.imageHead = k.slice ? k.slice(0, o) : new Uint8Array(k).subarray(0, o))
                } else console.log("Invalid JPEG file: Missing JPEG marker.");
                c(g)
            }, "readAsArrayBuffer")) && c(g)
        }
    }),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["load-image", "load-image-meta"], a) : a(window.loadImage)
    }(function(a) {
        "use strict";
        a.ExifMap = function() {
            return this
        }, a.ExifMap.prototype.map = {
            Orientation: 274
        }, a.ExifMap.prototype.get = function(a) {
            return this[a] || this[this.map[a]]
        }, a.getExifThumbnail = function(a, b, c) {
            var d, e, f;
            if (!c || b + c > a.byteLength) return void console.log("Invalid Exif data: Invalid thumbnail data.");
            for (d = [], e = 0; c > e; e += 1) f = a.getUint8(b + e), d.push((16 > f ? "0" : "") + f.toString(16));
            return "data:image/jpeg,%" + d.join("%")
        }, a.exifTagTypes = {
            1: {
                getValue: function(a, b) {
                    return a.getUint8(b)
                },
                size: 1
            },
            2: {
                getValue: function(a, b) {
                    return String.fromCharCode(a.getUint8(b))
                },
                size: 1,
                ascii: !0
            },
            3: {
                getValue: function(a, b, c) {
                    return a.getUint16(b, c)
                },
                size: 2
            },
            4: {
                getValue: function(a, b, c) {
                    return a.getUint32(b, c)
                },
                size: 4
            },
            5: {
                getValue: function(a, b, c) {
                    return a.getUint32(b, c) / a.getUint32(b + 4, c);
                },
                size: 8
            },
            9: {
                getValue: function(a, b, c) {
                    return a.getInt32(b, c)
                },
                size: 4
            },
            10: {
                getValue: function(a, b, c) {
                    return a.getInt32(b, c) / a.getInt32(b + 4, c)
                },
                size: 8
            }
        }, a.exifTagTypes[7] = a.exifTagTypes[1], a.getExifValue = function(b, c, d, e, f, g) {
            var h, i, j, k, l, m, n = a.exifTagTypes[e];
            if (!n) return void console.log("Invalid Exif data: Invalid tag type.");
            if (h = n.size * f, i = h > 4 ? c + b.getUint32(d + 8, g) : d + 8, i + h > b.byteLength) return void console.log("Invalid Exif data: Invalid data offset.");
            if (1 === f) return n.getValue(b, i, g);
            for (j = [], k = 0; f > k; k += 1) j[k] = n.getValue(b, i + k * n.size, g);
            if (n.ascii) {
                for (l = "", k = 0; j.length > k && (m = j[k], "\x00" !== m); k += 1) l += m;
                return l
            }
            return j
        }, a.parseExifTag = function(b, c, d, e, f) {
            var g = b.getUint16(d, e);
            f.exif[g] = a.getExifValue(b, c, d, b.getUint16(d + 2, e), b.getUint32(d + 4, e), e)
        }, a.parseExifTags = function(a, b, c, d, e) {
            var f, g, h;
            if (c + 6 > a.byteLength) return void console.log("Invalid Exif data: Invalid directory offset.");
            if (f = a.getUint16(c, d), g = c + 2 + 12 * f, g + 4 > a.byteLength) return void console.log("Invalid Exif data: Invalid directory size.");
            for (h = 0; f > h; h += 1) this.parseExifTag(a, b, c + 2 + 12 * h, d, e);
            return a.getUint32(g, d)
        }, a.parseExifData = function(b, c, d, e, f) {
            if (!f.disableExif) {
                var g, h, i, j = c + 10;
                if (1165519206 === b.getUint32(c + 4)) {
                    if (j + 8 > b.byteLength) return void console.log("Invalid Exif data: Invalid segment size.");
                    if (0 !== b.getUint16(c + 8)) return void console.log("Invalid Exif data: Missing byte alignment offset.");
                    switch (b.getUint16(j)) {
                        case 18761:
                            g = !0;
                            break;
                        case 19789:
                            g = !1;
                            break;
                        default:
                            return void console.log("Invalid Exif data: Invalid byte alignment marker.")
                    }
                    if (42 !== b.getUint16(j + 2, g)) return void console.log("Invalid Exif data: Missing TIFF marker.");
                    h = b.getUint32(j + 4, g), e.exif = new a.ExifMap, h = a.parseExifTags(b, j, j + h, g, e), h && !f.disableExifThumbnail && (i = {
                        exif: {}
                    }, h = a.parseExifTags(b, j, j + h, g, i), i.exif[513] && (e.exif.Thumbnail = a.getExifThumbnail(b, j + i.exif[513], i.exif[514]))), e.exif[34665] && !f.disableExifSub && a.parseExifTags(b, j, j + e.exif[34665], g, e), e.exif[34853] && !f.disableExifGps && a.parseExifTags(b, j, j + e.exif[34853], g, e)
                }
            }
        }, a.metaDataParsers.jpeg[65505].push(a.parseExifData)
    }),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["load-image", "load-image-exif"], a) : a(window.loadImage)
    }(function(a) {
        "use strict";
        var b, c, d;
        a.ExifMap.prototype.tags = {
            256: "ImageWidth",
            257: "ImageHeight",
            34665: "ExifIFDPointer",
            34853: "GPSInfoIFDPointer",
            40965: "InteroperabilityIFDPointer",
            258: "BitsPerSample",
            259: "Compression",
            262: "PhotometricInterpretation",
            274: "Orientation",
            277: "SamplesPerPixel",
            284: "PlanarConfiguration",
            530: "YCbCrSubSampling",
            531: "YCbCrPositioning",
            282: "XResolution",
            283: "YResolution",
            296: "ResolutionUnit",
            273: "StripOffsets",
            278: "RowsPerStrip",
            279: "StripByteCounts",
            513: "JPEGInterchangeFormat",
            514: "JPEGInterchangeFormatLength",
            301: "TransferFunction",
            318: "WhitePoint",
            319: "PrimaryChromaticities",
            529: "YCbCrCoefficients",
            532: "ReferenceBlackWhite",
            306: "DateTime",
            270: "ImageDescription",
            271: "Make",
            272: "Model",
            305: "Software",
            315: "Artist",
            33432: "Copyright",
            36864: "ExifVersion",
            40960: "FlashpixVersion",
            40961: "ColorSpace",
            40962: "PixelXDimension",
            40963: "PixelYDimension",
            42240: "Gamma",
            37121: "ComponentsConfiguration",
            37122: "CompressedBitsPerPixel",
            37500: "MakerNote",
            37510: "UserComment",
            40964: "RelatedSoundFile",
            36867: "DateTimeOriginal",
            36868: "DateTimeDigitized",
            37520: "SubSecTime",
            37521: "SubSecTimeOriginal",
            37522: "SubSecTimeDigitized",
            33434: "ExposureTime",
            33437: "FNumber",
            34850: "ExposureProgram",
            34852: "SpectralSensitivity",
            34855: "PhotographicSensitivity",
            34856: "OECF",
            34864: "SensitivityType",
            34865: "StandardOutputSensitivity",
            34866: "RecommendedExposureIndex",
            34867: "ISOSpeed",
            34868: "ISOSpeedLatitudeyyy",
            34869: "ISOSpeedLatitudezzz",
            37377: "ShutterSpeedValue",
            37378: "ApertureValue",
            37379: "BrightnessValue",
            37380: "ExposureBias",
            37381: "MaxApertureValue",
            37382: "SubjectDistance",
            37383: "MeteringMode",
            37384: "LightSource",
            37385: "Flash",
            37396: "SubjectArea",
            37386: "FocalLength",
            41483: "FlashEnergy",
            41484: "SpatialFrequencyResponse",
            41486: "FocalPlaneXResolution",
            41487: "FocalPlaneYResolution",
            41488: "FocalPlaneResolutionUnit",
            41492: "SubjectLocation",
            41493: "ExposureIndex",
            41495: "SensingMethod",
            41728: "FileSource",
            41729: "SceneType",
            41730: "CFAPattern",
            41985: "CustomRendered",
            41986: "ExposureMode",
            41987: "WhiteBalance",
            41988: "DigitalZoomRatio",
            41989: "FocalLengthIn35mmFilm",
            41990: "SceneCaptureType",
            41991: "GainControl",
            41992: "Contrast",
            41993: "Saturation",
            41994: "Sharpness",
            41995: "DeviceSettingDescription",
            41996: "SubjectDistanceRange",
            42016: "ImageUniqueID",
            42032: "CameraOwnerName",
            42033: "BodySerialNumber",
            42034: "LensSpecification",
            42035: "LensMake",
            42036: "LensModel",
            42037: "LensSerialNumber",
            0: "GPSVersionID",
            1: "GPSLatitudeRef",
            2: "GPSLatitude",
            3: "GPSLongitudeRef",
            4: "GPSLongitude",
            5: "GPSAltitudeRef",
            6: "GPSAltitude",
            7: "GPSTimeStamp",
            8: "GPSSatellites",
            9: "GPSStatus",
            10: "GPSMeasureMode",
            11: "GPSDOP",
            12: "GPSSpeedRef",
            13: "GPSSpeed",
            14: "GPSTrackRef",
            15: "GPSTrack",
            16: "GPSImgDirectionRef",
            17: "GPSImgDirection",
            18: "GPSMapDatum",
            19: "GPSDestLatitudeRef",
            20: "GPSDestLatitude",
            21: "GPSDestLongitudeRef",
            22: "GPSDestLongitude",
            23: "GPSDestBearingRef",
            24: "GPSDestBearing",
            25: "GPSDestDistanceRef",
            26: "GPSDestDistance",
            27: "GPSProcessingMethod",
            28: "GPSAreaInformation",
            29: "GPSDateStamp",
            30: "GPSDifferential",
            31: "GPSHPositioningError"
        }, a.ExifMap.prototype.stringValues = {
            ExposureProgram: {
                0: "Undefined",
                1: "Manual",
                2: "Normal program",
                3: "Aperture priority",
                4: "Shutter priority",
                5: "Creative program",
                6: "Action program",
                7: "Portrait mode",
                8: "Landscape mode"
            },
            MeteringMode: {
                0: "Unknown",
                1: "Average",
                2: "CenterWeightedAverage",
                3: "Spot",
                4: "MultiSpot",
                5: "Pattern",
                6: "Partial",
                255: "Other"
            },
            LightSource: {
                0: "Unknown",
                1: "Daylight",
                2: "Fluorescent",
                3: "Tungsten (incandescent light)",
                4: "Flash",
                9: "Fine weather",
                10: "Cloudy weather",
                11: "Shade",
                12: "Daylight fluorescent (D 5700 - 7100K)",
                13: "Day white fluorescent (N 4600 - 5400K)",
                14: "Cool white fluorescent (W 3900 - 4500K)",
                15: "White fluorescent (WW 3200 - 3700K)",
                17: "Standard light A",
                18: "Standard light B",
                19: "Standard light C",
                20: "D55",
                21: "D65",
                22: "D75",
                23: "D50",
                24: "ISO studio tungsten",
                255: "Other"
            },
            Flash: {
                0: "Flash did not fire",
                1: "Flash fired",
                5: "Strobe return light not detected",
                7: "Strobe return light detected",
                9: "Flash fired, compulsory flash mode",
                13: "Flash fired, compulsory flash mode, return light not detected",
                15: "Flash fired, compulsory flash mode, return light detected",
                16: "Flash did not fire, compulsory flash mode",
                24: "Flash did not fire, auto mode",
                25: "Flash fired, auto mode",
                29: "Flash fired, auto mode, return light not detected",
                31: "Flash fired, auto mode, return light detected",
                32: "No flash function",
                65: "Flash fired, red-eye reduction mode",
                69: "Flash fired, red-eye reduction mode, return light not detected",
                71: "Flash fired, red-eye reduction mode, return light detected",
                73: "Flash fired, compulsory flash mode, red-eye reduction mode",
                77: "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
                79: "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",
                89: "Flash fired, auto mode, red-eye reduction mode",
                93: "Flash fired, auto mode, return light not detected, red-eye reduction mode",
                95: "Flash fired, auto mode, return light detected, red-eye reduction mode"
            },
            SensingMethod: {
                1: "Undefined",
                2: "One-chip color area sensor",
                3: "Two-chip color area sensor",
                4: "Three-chip color area sensor",
                5: "Color sequential area sensor",
                7: "Trilinear sensor",
                8: "Color sequential linear sensor"
            },
            SceneCaptureType: {
                0: "Standard",
                1: "Landscape",
                2: "Portrait",
                3: "Night scene"
            },
            SceneType: {
                1: "Directly photographed"
            },
            CustomRendered: {
                0: "Normal process",
                1: "Custom process"
            },
            WhiteBalance: {
                0: "Auto white balance",
                1: "Manual white balance"
            },
            GainControl: {
                0: "None",
                1: "Low gain up",
                2: "High gain up",
                3: "Low gain down",
                4: "High gain down"
            },
            Contrast: {
                0: "Normal",
                1: "Soft",
                2: "Hard"
            },
            Saturation: {
                0: "Normal",
                1: "Low saturation",
                2: "High saturation"
            },
            Sharpness: {
                0: "Normal",
                1: "Soft",
                2: "Hard"
            },
            SubjectDistanceRange: {
                0: "Unknown",
                1: "Macro",
                2: "Close view",
                3: "Distant view"
            },
            FileSource: {
                3: "DSC"
            },
            ComponentsConfiguration: {
                0: "",
                1: "Y",
                2: "Cb",
                3: "Cr",
                4: "R",
                5: "G",
                6: "B"
            },
            Orientation: {
                1: "top-left",
                2: "top-right",
                3: "bottom-right",
                4: "bottom-left",
                5: "left-top",
                6: "right-top",
                7: "right-bottom",
                8: "left-bottom"
            }
        }, a.ExifMap.prototype.getText = function(a) {
            var b = this.get(a);
            switch (a) {
                case "LightSource":
                case "Flash":
                case "MeteringMode":
                case "ExposureProgram":
                case "SensingMethod":
                case "SceneCaptureType":
                case "SceneType":
                case "CustomRendered":
                case "WhiteBalance":
                case "GainControl":
                case "Contrast":
                case "Saturation":
                case "Sharpness":
                case "SubjectDistanceRange":
                case "FileSource":
                case "Orientation":
                    return this.stringValues[a][b];
                case "ExifVersion":
                case "FlashpixVersion":
                    return String.fromCharCode(b[0], b[1], b[2], b[3]);
                case "ComponentsConfiguration":
                    return this.stringValues[a][b[0]] + this.stringValues[a][b[1]] + this.stringValues[a][b[2]] + this.stringValues[a][b[3]];
                case "GPSVersionID":
                    return b[0] + "." + b[1] + "." + b[2] + "." + b[3]
            }
            return b + ""
        }, b = a.ExifMap.prototype.tags, c = a.ExifMap.prototype.map;
        for (d in b) b.hasOwnProperty(d) && (c[b[d]] = d);
        a.ExifMap.prototype.getAll = function() {
            var a, c, d = {};
            for (a in this) this.hasOwnProperty(a) && (c = b[a], c && (d[c] = this.getText(c)));
            return d
        }
    }), ! function(a) {
        "use strict";
        var b = a.HTMLCanvasElement && a.HTMLCanvasElement.prototype,
            c = a.Blob && function() {
                try {
                    return Boolean(new Blob)
                } catch (a) {
                    return !1
                }
            }(),
            d = c && a.Uint8Array && function() {
                try {
                    return 100 === new Blob([new Uint8Array(100)]).size
                } catch (a) {
                    return !1
                }
            }(),
            e = a.BlobBuilder || a.WebKitBlobBuilder || a.MozBlobBuilder || a.MSBlobBuilder,
            f = (c || e) && a.atob && a.ArrayBuffer && a.Uint8Array && function(a) {
                var b, f, g, h, i, j;
                for (b = a.split(",")[0].indexOf("base64") >= 0 ? atob(a.split(",")[1]) : decodeURIComponent(a.split(",")[1]), f = new ArrayBuffer(b.length), g = new Uint8Array(f), h = 0; h < b.length; h += 1) g[h] = b.charCodeAt(h);
                return i = a.split(",")[0].split(":")[1].split(";")[0], c ? new Blob([d ? g : f], {
                    type: i
                }) : (j = new e, j.append(f), j.getBlob(i))
            };
        a.HTMLCanvasElement && !b.toBlob && (b.mozGetAsFile ? b.toBlob = function(a, c, d) {
            a(d && b.toDataURL && f ? f(this.toDataURL(c, d)) : this.mozGetAsFile("blob", c))
        } : b.toDataURL && f && (b.toBlob = function(a, b, c) {
            a(f(this.toDataURL(b, c)))
        })), "function" == typeof define && define.amd ? define(function() {
            return f
        }) : a.dataURLtoBlob = f
    }(this),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["jquery"], a) : a(window.jQuery)
    }(function(a) {
        "use strict";
        var b = 0;
        a.ajaxTransport("iframe", function(c) {
            if (c.async) {
                var d, e, f, g = c.initialIframeSrc || "javascript:false;";
                return {
                    send: function(h, i) {
                        d = a('<form style="display:none;"></form>'), d.attr("accept-charset", c.formAcceptCharset), f = /\?/.test(c.url) ? "&" : "?", "DELETE" === c.type ? (c.url = c.url + f + "_method=DELETE", c.type = "POST") : "PUT" === c.type ? (c.url = c.url + f + "_method=PUT", c.type = "POST") : "PATCH" === c.type && (c.url = c.url + f + "_method=PATCH", c.type = "POST"), b += 1, e = a('<iframe src="' + g + '" name="iframe-transport-' + b + '"></iframe>').bind("load", function() {
                            var b, f = a.isArray(c.paramName) ? c.paramName : [c.paramName];
                            e.unbind("load").bind("load", function() {
                                var b;
                                try {
                                    if (b = e.contents(), !b.length || !b[0].firstChild) throw new Error
                                } catch (c) {
                                    b = void 0
                                }
                                i(200, "success", {
                                    iframe: b
                                }), a('<iframe src="' + g + '"></iframe>').appendTo(d), window.setTimeout(function() {
                                    d.remove()
                                }, 0)
                            }), d.prop("target", e.prop("name")).prop("action", c.url).prop("method", c.type), c.formData && a.each(c.formData, function(b, c) {
                                a('<input type="hidden"/>').prop("name", c.name).val(c.value).appendTo(d)
                            }), c.fileInput && c.fileInput.length && "POST" === c.type && (b = c.fileInput.clone(), c.fileInput.after(function(a) {
                                return b[a]
                            }), c.paramName && c.fileInput.each(function(b) {
                                a(this).prop("name", f[b] || c.paramName)
                            }), d.append(c.fileInput).prop("enctype", "multipart/form-data").prop("encoding", "multipart/form-data")), d.submit(), b && b.length && c.fileInput.each(function(c, d) {
                                var e = a(b[c]);
                                a(d).prop("name", e.prop("name")), e.replaceWith(d)
                            })
                        }), d.append(e).appendTo(document.body)
                    },
                    abort: function() {
                        e && e.unbind("load").prop("src", g), d && d.remove()
                    }
                }
            }
        }), a.ajaxSetup({
            converters: {
                "iframe text": function(b) {
                    return b && a(b[0].body).text()
                },
                "iframe json": function(b) {
                    return b && a.parseJSON(a(b[0].body).text())
                },
                "iframe html": function(b) {
                    return b && a(b[0].body).html()
                },
                "iframe xml": function(b) {
                    var c = b && b[0];
                    return c && a.isXMLDoc(c) ? c : a.parseXML(c.XMLDocument && c.XMLDocument.xml || a(c.body).html())
                },
                "iframe script": function(b) {
                    return b && a.globalEval(a(b[0].body).text())
                }
            }
        })
    }),
    function(a) {
        "function" == typeof define && define.amd ? define(["jquery"], a) : a(jQuery)
    }(function(a, b) {
        var c = 0,
            d = Array.prototype.slice,
            e = a.cleanData;
        a.cleanData = function(b) {
            for (var c, d = 0; null != (c = b[d]); d++) try {
                a(c).triggerHandler("remove")
            } catch (f) {}
            e(b)
        }, a.widget = function(b, c, d) {
            var e, f, g, h, i = {},
                j = b.split(".")[0];
            b = b.split(".")[1], e = j + "-" + b, d || (d = c, c = a.Widget), a.expr[":"][e.toLowerCase()] = function(b) {
                return !!a.data(b, e)
            }, a[j] = a[j] || {}, f = a[j][b], g = a[j][b] = function(a, b) {
                return this._createWidget ? void(arguments.length && this._createWidget(a, b)) : new g(a, b)
            }, a.extend(g, f, {
                version: d.version,
                _proto: a.extend({}, d),
                _childConstructors: []
            }), h = new c, h.options = a.widget.extend({}, h.options), a.each(d, function(b, d) {
                return a.isFunction(d) ? void(i[b] = function() {
                    var a = function() {
                            return c.prototype[b].apply(this, arguments)
                        },
                        e = function(a) {
                            return c.prototype[b].apply(this, a)
                        };
                    return function() {
                        var b, c = this._super,
                            f = this._superApply;
                        return this._super = a, this._superApply = e, b = d.apply(this, arguments), this._super = c, this._superApply = f, b
                    }
                }()) : void(i[b] = d)
            }), g.prototype = a.widget.extend(h, {
                widgetEventPrefix: f ? h.widgetEventPrefix : b
            }, i, {
                constructor: g,
                namespace: j,
                widgetName: b,
                widgetFullName: e
            }), f ? (a.each(f._childConstructors, function(b, c) {
                var d = c.prototype;
                a.widget(d.namespace + "." + d.widgetName, g, c._proto)
            }), delete f._childConstructors) : c._childConstructors.push(g), a.widget.bridge(b, g)
        }, a.widget.extend = function(c) {
            for (var e, f, g = d.call(arguments, 1), h = 0, i = g.length; i > h; h++)
                for (e in g[h]) f = g[h][e], g[h].hasOwnProperty(e) && f !== b && (a.isPlainObject(f) ? c[e] = a.isPlainObject(c[e]) ? a.widget.extend({}, c[e], f) : a.widget.extend({}, f) : c[e] = f);
            return c
        }, a.widget.bridge = function(c, e) {
            var f = e.prototype.widgetFullName || c;
            a.fn[c] = function(g) {
                var h = "string" == typeof g,
                    i = d.call(arguments, 1),
                    j = this;
                return g = !h && i.length ? a.widget.extend.apply(null, [g].concat(i)) : g, h ? this.each(function() {
                    var d, e = a.data(this, f);
                    return e ? a.isFunction(e[g]) && "_" !== g.charAt(0) ? (d = e[g].apply(e, i), d !== e && d !== b ? (j = d && d.jquery ? j.pushStack(d.get()) : d, !1) : void 0) : a.error("no such method '" + g + "' for " + c + " widget instance") : a.error("cannot call methods on " + c + " prior to initialization; attempted to call method '" + g + "'")
                }) : this.each(function() {
                    var b = a.data(this, f);
                    b ? b.option(g || {})._init() : a.data(this, f, new e(g, this))
                }), j
            }
        }, a.Widget = function() {}, a.Widget._childConstructors = [], a.Widget.prototype = {
            widgetName: "widget",
            widgetEventPrefix: "",
            defaultElement: "<div>",
            options: {
                disabled: !1,
                create: null
            },
            _createWidget: function(b, d) {
                d = a(d || this.defaultElement || this)[0], this.element = a(d), this.uuid = c++, this.eventNamespace = "." + this.widgetName + this.uuid, this.options = a.widget.extend({}, this.options, this._getCreateOptions(), b), this.bindings = a(), this.hoverable = a(), this.focusable = a(), d !== this && (a.data(d, this.widgetFullName, this), this._on(!0, this.element, {
                    remove: function(a) {
                        a.target === d && this.destroy()
                    }
                }), this.document = a(d.style ? d.ownerDocument : d.document || d), this.window = a(this.document[0].defaultView || this.document[0].parentWindow)), this._create(), this._trigger("create", null, this._getCreateEventData()), this._init()
            },
            _getCreateOptions: a.noop,
            _getCreateEventData: a.noop,
            _create: a.noop,
            _init: a.noop,
            destroy: function() {
                this._destroy(), this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)), this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled ui-state-disabled"), this.bindings.unbind(this.eventNamespace), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")
            },
            _destroy: a.noop,
            widget: function() {
                return this.element
            },
            option: function(c, d) {
                var e, f, g, h = c;
                if (0 === arguments.length) return a.widget.extend({}, this.options);
                if ("string" == typeof c)
                    if (h = {}, e = c.split("."), c = e.shift(), e.length) {
                        for (f = h[c] = a.widget.extend({}, this.options[c]), g = 0; g < e.length - 1; g++) f[e[g]] = f[e[g]] || {}, f = f[e[g]];
                        if (c = e.pop(), d === b) return f[c] === b ? null : f[c];
                        f[c] = d
                    } else {
                        if (d === b) return this.options[c] === b ? null : this.options[c];
                        h[c] = d
                    }
                return this._setOptions(h), this
            },
            _setOptions: function(a) {
                var b;
                for (b in a) this._setOption(b, a[b]);
                return this
            },
            _setOption: function(a, b) {
                return this.options[a] = b, "disabled" === a && (this.widget().toggleClass(this.widgetFullName + "-disabled ui-state-disabled", !!b).attr("aria-disabled", b), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")), this
            },
            enable: function() {
                return this._setOption("disabled", !1)
            },
            disable: function() {
                return this._setOption("disabled", !0)
            },
            _on: function(b, c, d) {
                var e, f = this;
                "boolean" != typeof b && (d = c, c = b, b = !1), d ? (c = e = a(c), this.bindings = this.bindings.add(c)) : (d = c, c = this.element, e = this.widget()), a.each(d, function(d, g) {
                    function h() {
                        return b || f.options.disabled !== !0 && !a(this).hasClass("ui-state-disabled") ? ("string" == typeof g ? f[g] : g).apply(f, arguments) : void 0
                    }
                    "string" != typeof g && (h.guid = g.guid = g.guid || h.guid || a.guid++);
                    var i = d.match(/^(\w+)\s*(.*)$/),
                        j = i[1] + f.eventNamespace,
                        k = i[2];
                    k ? e.delegate(k, j, h) : c.bind(j, h)
                })
            },
            _off: function(a, b) {
                b = (b || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace, a.unbind(b).undelegate(b)
            },
            _delay: function(a, b) {
                function c() {
                    return ("string" == typeof a ? d[a] : a).apply(d, arguments)
                }
                var d = this;
                return setTimeout(c, b || 0)
            },
            _hoverable: function(b) {
                this.hoverable = this.hoverable.add(b), this._on(b, {
                    mouseenter: function(b) {
                        a(b.currentTarget).addClass("ui-state-hover")
                    },
                    mouseleave: function(b) {
                        a(b.currentTarget).removeClass("ui-state-hover")
                    }
                })
            },
            _focusable: function(b) {
                this.focusable = this.focusable.add(b), this._on(b, {
                    focusin: function(b) {
                        a(b.currentTarget).addClass("ui-state-focus")
                    },
                    focusout: function(b) {
                        a(b.currentTarget).removeClass("ui-state-focus")
                    }
                })
            },
            _trigger: function(b, c, d) {
                var e, f, g = this.options[b];
                if (d = d || {}, c = a.Event(c), c.type = (b === this.widgetEventPrefix ? b : this.widgetEventPrefix + b).toLowerCase(), c.target = this.element[0], f = c.originalEvent)
                    for (e in f) e in c || (c[e] = f[e]);
                return this.element.trigger(c, d), !(a.isFunction(g) && g.apply(this.element[0], [c].concat(d)) === !1 || c.isDefaultPrevented())
            }
        }, a.each({
            show: "fadeIn",
            hide: "fadeOut"
        }, function(b, c) {
            a.Widget.prototype["_" + b] = function(d, e, f) {
                "string" == typeof e && (e = {
                    effect: e
                });
                var g, h = e ? e === !0 || "number" == typeof e ? c : e.effect || c : b;
                e = e || {}, "number" == typeof e && (e = {
                    duration: e
                }), g = !a.isEmptyObject(e), e.complete = f, e.delay && d.delay(e.delay), g && a.effects && a.effects.effect[h] ? d[b](e) : h !== b && d[h] ? d[h](e.duration, e.easing, f) : d.queue(function(c) {
                    a(this)[b](), f && f.call(d[0]), c()
                })
            }
        })
    }),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["jquery", "jquery.ui.widget"], a) : a(window.jQuery)
    }(function(a) {
        "use strict";
        a.support.fileInput = !(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent) || a('<input type="file">').prop("disabled")), a.support.xhrFileUpload = !(!window.ProgressEvent || !window.FileReader), a.support.xhrFormDataFileUpload = !!window.FormData, a.support.blobSlice = window.Blob && (Blob.prototype.slice || Blob.prototype.webkitSlice || Blob.prototype.mozSlice), a.widget("blueimp.fileupload", {
            options: {
                dropZone: a(document),
                pasteZone: a(document),
                fileInput: void 0,
                replaceFileInput: !0,
                paramName: void 0,
                singleFileUploads: !0,
                limitMultiFileUploads: void 0,
                sequentialUploads: !1,
                limitConcurrentUploads: void 0,
                forceIframeTransport: !1,
                redirect: void 0,
                redirectParamName: void 0,
                postMessage: void 0,
                multipart: !0,
                maxChunkSize: void 0,
                uploadedBytes: void 0,
                recalculateProgress: !0,
                progressInterval: 100,
                bitrateInterval: 500,
                autoUpload: !0,
                messages: {
                    uploadedBytes: "Uploaded bytes exceed file size"
                },
                i18n: function(b, c) {
                    return b = this.messages[b] || b.toString(), c && a.each(c, function(a, c) {
                        b = b.replace("{" + a + "}", c)
                    }), b
                },
                formData: function(a) {
                    return a.serializeArray()
                },
                add: function(b, c) {
                    return b.isDefaultPrevented() ? !1 : void((c.autoUpload || c.autoUpload !== !1 && a(this).fileupload("option", "autoUpload")) && c.process().done(function() {
                        c.submit()
                    }))
                },
                processData: !1,
                contentType: !1,
                cache: !1
            },
            _specialOptions: ["fileInput", "dropZone", "pasteZone", "multipart", "forceIframeTransport"],
            _blobSlice: a.support.blobSlice && function() {
                var a = this.slice || this.webkitSlice || this.mozSlice;
                return a.apply(this, arguments)
            },
            _BitrateTimer: function() {
                this.timestamp = Date.now ? Date.now() : (new Date).getTime(), this.loaded = 0, this.bitrate = 0, this.getBitrate = function(a, b, c) {
                    var d = a - this.timestamp;
                    return (!this.bitrate || !c || d > c) && (this.bitrate = (b - this.loaded) * (1e3 / d) * 8, this.loaded = b, this.timestamp = a), this.bitrate
                }
            },
            _isXHRUpload: function(b) {
                return !b.forceIframeTransport && (!b.multipart && a.support.xhrFileUpload || a.support.xhrFormDataFileUpload)
            },
            _getFormData: function(b) {
                var c;
                return "function" == typeof b.formData ? b.formData(b.form) : a.isArray(b.formData) ? b.formData : "object" === a.type(b.formData) ? (c = [], a.each(b.formData, function(a, b) {
                    c.push({
                        name: a,
                        value: b
                    })
                }), c) : []
            },
            _getTotal: function(b) {
                var c = 0;
                return a.each(b, function(a, b) {
                    c += b.size || 1
                }), c
            },
            _initProgressObject: function(b) {
                var c = {
                    loaded: 0,
                    total: 0,
                    bitrate: 0
                };
                b._progress ? a.extend(b._progress, c) : b._progress = c
            },
            _initResponseObject: function(a) {
                var b;
                if (a._response)
                    for (b in a._response) a._response.hasOwnProperty(b) && delete a._response[b];
                else a._response = {}
            },
            _onProgress: function(b, c) {
                if (b.lengthComputable) {
                    var d, e = Date.now ? Date.now() : (new Date).getTime();
                    if (c._time && c.progressInterval && e - c._time < c.progressInterval && b.loaded !== b.total) return;
                    c._time = e, d = Math.floor(b.loaded / b.total * (c.chunkSize || c._progress.total)) + (c.uploadedBytes || 0), this._progress.loaded += d - c._progress.loaded, this._progress.bitrate = this._bitrateTimer.getBitrate(e, this._progress.loaded, c.bitrateInterval), c._progress.loaded = c.loaded = d, c._progress.bitrate = c.bitrate = c._bitrateTimer.getBitrate(e, d, c.bitrateInterval), this._trigger("progress", a.Event("progress", {
                        delegatedEvent: b
                    }), c), this._trigger("progressall", a.Event("progressall", {
                        delegatedEvent: b
                    }), this._progress)
                }
            },
            _initProgressListener: function(b) {
                var c = this,
                    d = b.xhr ? b.xhr() : a.ajaxSettings.xhr();
                d.upload && (a(d.upload).bind("progress", function(a) {
                    var d = a.originalEvent;
                    a.lengthComputable = d.lengthComputable, a.loaded = d.loaded, a.total = d.total, c._onProgress(a, b)
                }), b.xhr = function() {
                    return d
                })
            },
            _isInstanceOf: function(a, b) {
                return Object.prototype.toString.call(b) === "[object " + a + "]"
            },
            _initXHRData: function(b) {
                var c, d = this,
                    e = b.files[0],
                    f = b.multipart || !a.support.xhrFileUpload,
                    g = b.paramName[0];
                b.headers = a.extend({}, b.headers), b.contentRange && (b.headers["Content-Range"] = b.contentRange), f && !b.blob && this._isInstanceOf("File", e) || (b.headers["Content-Disposition"] = 'attachment; filename="' + encodeURI(e.name) + '"'), f ? a.support.xhrFormDataFileUpload && (b.postMessage ? (c = this._getFormData(b), b.blob ? c.push({
                    name: g,
                    value: b.blob
                }) : a.each(b.files, function(a, d) {
                    c.push({
                        name: b.paramName[a] || g,
                        value: d
                    })
                })) : (d._isInstanceOf("FormData", b.formData) ? c = b.formData : (c = new FormData, a.each(this._getFormData(b), function(a, b) {
                    c.append(b.name, b.value)
                })), b.blob ? c.append(g, b.blob, e.name) : a.each(b.files, function(a, e) {
                    (d._isInstanceOf("File", e) || d._isInstanceOf("Blob", e)) && c.append(b.paramName[a] || g, e, e.name)
                })), b.data = c) : (b.contentType = e.type, b.data = b.blob || e), b.blob = null
            },
            _initIframeSettings: function(b) {
                var c = a("<a></a>").prop("href", b.url).prop("host");
                b.dataType = "iframe " + (b.dataType || ""), b.formData = this._getFormData(b), b.redirect && c && c !== location.host && b.formData.push({
                    name: b.redirectParamName || "redirect",
                    value: b.redirect
                })
            },
            _initDataSettings: function(a) {
                this._isXHRUpload(a) ? (this._chunkedUpload(a, !0) || (a.data || this._initXHRData(a), this._initProgressListener(a)), a.postMessage && (a.dataType = "postmessage " + (a.dataType || ""))) : this._initIframeSettings(a)
            },
            _getParamName: function(b) {
                var c = a(b.fileInput),
                    d = b.paramName;
                return d ? a.isArray(d) || (d = [d]) : (d = [], c.each(function() {
                    for (var b = a(this), c = b.prop("name") || "files[]", e = (b.prop("files") || [1]).length; e;) d.push(c), e -= 1
                }), d.length || (d = [c.prop("name") || "files[]"])), d
            },
            _initFormSettings: function(b) {
                b.form && b.form.length || (b.form = a(b.fileInput.prop("form")), b.form.length || (b.form = a(this.options.fileInput.prop("form")))), b.paramName = this._getParamName(b), b.url || (b.url = b.form.prop("action") || location.href), b.type = (b.type || "string" === a.type(b.form.prop("method")) && b.form.prop("method") || "").toUpperCase(), "POST" !== b.type && "PUT" !== b.type && "PATCH" !== b.type && (b.type = "POST"), b.formAcceptCharset || (b.formAcceptCharset = b.form.attr("accept-charset"))
            },
            _getAJAXSettings: function(b) {
                var c = a.extend({}, this.options, b);
                return this._initFormSettings(c), this._initDataSettings(c), c
            },
            _getDeferredState: function(a) {
                return a.state ? a.state() : a.isResolved() ? "resolved" : a.isRejected() ? "rejected" : "pending"
            },
            _enhancePromise: function(a) {
                return a.success = a.done, a.error = a.fail, a.complete = a.always, a
            },
            _getXHRPromise: function(b, c, d) {
                var e = a.Deferred(),
                    f = e.promise();
                return c = c || this.options.context || f, b === !0 ? e.resolveWith(c, d) : b === !1 && e.rejectWith(c, d), f.abort = e.promise, this._enhancePromise(f)
            },
            _addConvenienceMethods: function(b, c) {
                var d = this,
                    e = function(b) {
                        return a.Deferred().resolveWith(d, b).promise()
                    };
                c.process = function(b, f) {
                    return (b || f) && (c._processQueue = this._processQueue = (this._processQueue || e([this])).pipe(function() {
                        return c.errorThrown ? a.Deferred().rejectWith(d, [c]).promise() : e(arguments)
                    }).pipe(b, f)), this._processQueue || e([this])
                }, c.submit = function() {
                    return "pending" !== this.state() && (c.jqXHR = this.jqXHR = d._trigger("submit", a.Event("submit", {
                        delegatedEvent: b
                    }), this) !== !1 && d._onSend(b, this)), this.jqXHR || d._getXHRPromise()
                }, c.abort = function() {
                    return this.jqXHR ? this.jqXHR.abort() : (this.errorThrown = "abort", d._getXHRPromise())
                }, c.state = function() {
                    return this.jqXHR ? d._getDeferredState(this.jqXHR) : this._processQueue ? d._getDeferredState(this._processQueue) : void 0
                }, c.progress = function() {
                    return this._progress
                }, c.response = function() {
                    return this._response
                }
            },
            _getUploadedBytes: function(a) {
                var b = a.getResponseHeader("Range"),
                    c = b && b.split("-"),
                    d = c && c.length > 1 && parseInt(c[1], 10);
                return d && d + 1
            },
            _chunkedUpload: function(b, c) {
                b.uploadedBytes = b.uploadedBytes || 0;
                var d, e, f = this,
                    g = b.files[0],
                    h = g.size,
                    i = b.uploadedBytes,
                    j = b.maxChunkSize || h,
                    k = this._blobSlice,
                    l = a.Deferred(),
                    m = l.promise();
                return this._isXHRUpload(b) && k && (i || h > j) && !b.data ? c ? !0 : i >= h ? (g.error = b.i18n("uploadedBytes"), this._getXHRPromise(!1, b.context, [null, "error", g.error])) : (e = function() {
                    var c = a.extend({}, b),
                        m = c._progress.loaded;
                    c.blob = k.call(g, i, i + j, g.type), c.chunkSize = c.blob.size, c.contentRange = "bytes " + i + "-" + (i + c.chunkSize - 1) + "/" + h, f._initXHRData(c), f._initProgressListener(c), d = (f._trigger("chunksend", null, c) !== !1 && a.ajax(c) || f._getXHRPromise(!1, c.context)).done(function(d, g, j) {
                        i = f._getUploadedBytes(j) || i + c.chunkSize, m + c.chunkSize - c._progress.loaded && f._onProgress(a.Event("progress", {
                            lengthComputable: !0,
                            loaded: i - c.uploadedBytes,
                            total: i - c.uploadedBytes
                        }), c), b.uploadedBytes = c.uploadedBytes = i, c.result = d, c.textStatus = g, c.jqXHR = j, f._trigger("chunkdone", null, c), f._trigger("chunkalways", null, c), h > i ? e() : l.resolveWith(c.context, [d, g, j])
                    }).fail(function(a, b, d) {
                        c.jqXHR = a, c.textStatus = b, c.errorThrown = d, f._trigger("chunkfail", null, c), f._trigger("chunkalways", null, c), l.rejectWith(c.context, [a, b, d])
                    })
                }, this._enhancePromise(m), m.abort = function() {
                    return d.abort()
                }, e(), m) : !1
            },
            _beforeSend: function(a, b) {
                0 === this._active && (this._trigger("start"), this._bitrateTimer = new this._BitrateTimer, this._progress.loaded = this._progress.total = 0, this._progress.bitrate = 0), this._initResponseObject(b), this._initProgressObject(b), b._progress.loaded = b.loaded = b.uploadedBytes || 0, b._progress.total = b.total = this._getTotal(b.files) || 1, b._progress.bitrate = b.bitrate = 0, this._active += 1, this._progress.loaded += b.loaded, this._progress.total += b.total
            },
            _onDone: function(b, c, d, e) {
                var f = e._progress.total,
                    g = e._response;
                e._progress.loaded < f && this._onProgress(a.Event("progress", {
                    lengthComputable: !0,
                    loaded: f,
                    total: f
                }), e), g.result = e.result = b, g.textStatus = e.textStatus = c, g.jqXHR = e.jqXHR = d, this._trigger("done", null, e)
            },
            _onFail: function(a, b, c, d) {
                var e = d._response;
                d.recalculateProgress && (this._progress.loaded -= d._progress.loaded, this._progress.total -= d._progress.total), e.jqXHR = d.jqXHR = a, e.textStatus = d.textStatus = b, e.errorThrown = d.errorThrown = c, this._trigger("fail", null, d)
            },
            _onAlways: function(a, b, c, d) {
                this._trigger("always", null, d)
            },
            _onSend: function(b, c) {
                c.submit || this._addConvenienceMethods(b, c);
                var d, e, f, g, h = this,
                    i = h._getAJAXSettings(c),
                    j = function() {
                        return h._sending += 1, i._bitrateTimer = new h._BitrateTimer, d = d || ((e || h._trigger("send", a.Event("send", {
                            delegatedEvent: b
                        }), i) === !1) && h._getXHRPromise(!1, i.context, e) || h._chunkedUpload(i) || a.ajax(i)).done(function(a, b, c) {
                            h._onDone(a, b, c, i)
                        }).fail(function(a, b, c) {
                            h._onFail(a, b, c, i)
                        }).always(function(a, b, c) {
                            if (h._onAlways(a, b, c, i), h._sending -= 1, h._active -= 1, i.limitConcurrentUploads && i.limitConcurrentUploads > h._sending)
                                for (var d = h._slots.shift(); d;) {
                                    if ("pending" === h._getDeferredState(d)) {
                                        d.resolve();
                                        break
                                    }
                                    d = h._slots.shift()
                                }
                            0 === h._active && h._trigger("stop")
                        })
                    };
                return this._beforeSend(b, i), this.options.sequentialUploads || this.options.limitConcurrentUploads && this.options.limitConcurrentUploads <= this._sending ? (this.options.limitConcurrentUploads > 1 ? (f = a.Deferred(), this._slots.push(f), g = f.pipe(j)) : (this._sequence = this._sequence.pipe(j, j), g = this._sequence), g.abort = function() {
                    return e = [void 0, "abort", "abort"], d ? d.abort() : (f && f.rejectWith(i.context, e), j())
                }, this._enhancePromise(g)) : j()
            },
            _onAdd: function(b, c) {
                var d, e, f, g, h = this,
                    i = !0,
                    j = a.extend({}, this.options, c),
                    k = j.limitMultiFileUploads,
                    l = this._getParamName(j);
                if ((j.singleFileUploads || k) && this._isXHRUpload(j))
                    if (!j.singleFileUploads && k)
                        for (f = [], d = [], g = 0; g < c.files.length; g += k) f.push(c.files.slice(g, g + k)), e = l.slice(g, g + k), e.length || (e = l), d.push(e);
                    else d = l;
                else f = [c.files], d = [l];
                return c.originalFiles = c.files, a.each(f || c.files, function(e, g) {
                    var j = a.extend({}, c);
                    return j.files = f ? g : [g], j.paramName = d[e], h._initResponseObject(j), h._initProgressObject(j), h._addConvenienceMethods(b, j), i = h._trigger("add", a.Event("add", {
                        delegatedEvent: b
                    }), j)
                }), i
            },
            _replaceFileInput: function(b) {
                var c = b.clone(!0);
                a("<form></form>").append(c)[0].reset(), b.after(c).detach(), a.cleanData(b.unbind("remove")), this.options.fileInput = this.options.fileInput.map(function(a, d) {
                    return d === b[0] ? c[0] : d
                }), b[0] === this.element[0] && (this.element = c)
            },
            _handleFileTreeEntry: function(b, c) {
                var d, e = this,
                    f = a.Deferred(),
                    g = function(a) {
                        a && !a.entry && (a.entry = b), f.resolve([a])
                    };
                return c = c || "", b.isFile ? b._file ? (b._file.relativePath = c, f.resolve(b._file)) : b.file(function(a) {
                    a.relativePath = c, f.resolve(a)
                }, g) : b.isDirectory ? (d = b.createReader(), d.readEntries(function(a) {
                    e._handleFileTreeEntries(a, c + b.name + "/").done(function(a) {
                        f.resolve(a)
                    }).fail(g)
                }, g)) : f.resolve([]), f.promise()
            },
            _handleFileTreeEntries: function(b, c) {
                var d = this;
                return a.when.apply(a, a.map(b, function(a) {
                    return d._handleFileTreeEntry(a, c)
                })).pipe(function() {
                    return Array.prototype.concat.apply([], arguments)
                })
            },
            _getDroppedFiles: function(b) {
                b = b || {};
                var c = b.items;
                return c && c.length && (c[0].webkitGetAsEntry || c[0].getAsEntry) ? this._handleFileTreeEntries(a.map(c, function(a) {
                    var b;
                    return a.webkitGetAsEntry ? (b = a.webkitGetAsEntry(), b && (b._file = a.getAsFile()), b) : a.getAsEntry()
                })) : a.Deferred().resolve(a.makeArray(b.files)).promise()
            },
            _getSingleFileInputFiles: function(b) {
                b = a(b);
                var c, d, e = b.prop("webkitEntries") || b.prop("entries");
                if (e && e.length) return this._handleFileTreeEntries(e);
                if (c = a.makeArray(b.prop("files")), c.length) void 0 === c[0].name && c[0].fileName && a.each(c, function(a, b) {
                    b.name = b.fileName, b.size = b.fileSize
                });
                else {
                    if (d = b.prop("value"), !d) return a.Deferred().resolve([]).promise();
                    c = [{
                        name: d.replace(/^.*\\/, "")
                    }]
                }
                return a.Deferred().resolve(c).promise()
            },
            _getFileInputFiles: function(b) {
                return b instanceof a && 1 !== b.length ? a.when.apply(a, a.map(b, this._getSingleFileInputFiles)).pipe(function() {
                    return Array.prototype.concat.apply([], arguments)
                }) : this._getSingleFileInputFiles(b)
            },
            _onChange: function(b) {
                var c = this,
                    d = {
                        fileInput: a(b.target),
                        form: a(b.target.form)
                    };
                this._getFileInputFiles(d.fileInput).always(function(e) {
                    d.files = e, c.options.replaceFileInput && c._replaceFileInput(d.fileInput), c._trigger("change", a.Event("change", {
                        delegatedEvent: b
                    }), d) !== !1 && c._onAdd(b, d)
                })
            },
            _onPaste: function(b) {
                var c = b.originalEvent && b.originalEvent.clipboardData && b.originalEvent.clipboardData.items,
                    d = {
                        files: []
                    };
                c && c.length && (a.each(c, function(a, b) {
                    var c = b.getAsFile && b.getAsFile();
                    c && d.files.push(c)
                }), this._trigger("paste", a.Event("paste", {
                    delegatedEvent: b
                }), d) !== !1 && this._onAdd(b, d))
            },
            _onDrop: function(b) {
                b.dataTransfer = b.originalEvent && b.originalEvent.dataTransfer;
                var c = this,
                    d = b.dataTransfer,
                    e = {};
                d && d.files && d.files.length && (b.preventDefault(), this._getDroppedFiles(d).always(function(d) {
                    e.files = d, c._trigger("drop", a.Event("drop", {
                        delegatedEvent: b
                    }), e) !== !1 && c._onAdd(b, e)
                }))
            },
            _onDragOver: function(b) {
                b.dataTransfer = b.originalEvent && b.originalEvent.dataTransfer;
                var c = b.dataTransfer;
                c && -1 !== a.inArray("Files", c.types) && this._trigger("dragover", a.Event("dragover", {
                    delegatedEvent: b
                })) !== !1 && (b.preventDefault(), c.dropEffect = "copy")
            },
            _initEventHandlers: function() {
                this._isXHRUpload(this.options) && (this._on(this.options.dropZone, {
                    dragover: this._onDragOver,
                    drop: this._onDrop
                }), this._on(this.options.pasteZone, {
                    paste: this._onPaste
                })), a.support.fileInput && this._on(this.options.fileInput, {
                    change: this._onChange
                })
            },
            _destroyEventHandlers: function() {
                this._off(this.options.dropZone, "dragover drop"), this._off(this.options.pasteZone, "paste"), this._off(this.options.fileInput, "change")
            },
            _setOption: function(b, c) {
                var d = -1 !== a.inArray(b, this._specialOptions);
                d && this._destroyEventHandlers(), this._super(b, c), d && (this._initSpecialOptions(), this._initEventHandlers())
            },
            _initSpecialOptions: function() {
                var b = this.options;
                void 0 === b.fileInput ? b.fileInput = this.element.is('input[type="file"]') ? this.element : this.element.find('input[type="file"]') : b.fileInput instanceof a || (b.fileInput = a(b.fileInput)), b.dropZone instanceof a || (b.dropZone = a(b.dropZone)), b.pasteZone instanceof a || (b.pasteZone = a(b.pasteZone))
            },
            _getRegExp: function(a) {
                var b = a.split("/"),
                    c = b.pop();
                return b.shift(), new RegExp(b.join("/"), c)
            },
            _isRegExpOption: function(b, c) {
                return "url" !== b && "string" === a.type(c) && /^\/.*\/[igm]{0,3}$/.test(c)
            },
            _initDataAttributes: function() {
                var b = this,
                    c = this.options;
                a.each(a(this.element[0].cloneNode(!1)).data(), function(a, d) {
                    b._isRegExpOption(a, d) && (d = b._getRegExp(d)), c[a] = d
                })
            },
            _create: function() {
                this._initDataAttributes(), this._initSpecialOptions(), this._slots = [], this._sequence = this._getXHRPromise(!0), this._sending = this._active = 0, this._initProgressObject(this), this._initEventHandlers()
            },
            active: function() {
                return this._active
            },
            progress: function() {
                return this._progress
            },
            add: function(b) {
                var c = this;
                b && !this.options.disabled && (b.fileInput && !b.files ? this._getFileInputFiles(b.fileInput).always(function(a) {
                    b.files = a, c._onAdd(null, b)
                }) : (b.files = a.makeArray(b.files), this._onAdd(null, b)))
            },
            send: function(b) {
                if (b && !this.options.disabled) {
                    if (b.fileInput && !b.files) {
                        var c, d, e = this,
                            f = a.Deferred(),
                            g = f.promise();
                        return g.abort = function() {
                            return d = !0, c ? c.abort() : (f.reject(null, "abort", "abort"), g)
                        }, this._getFileInputFiles(b.fileInput).always(function(a) {
                            if (!d) {
                                if (!a.length) return void f.reject();
                                b.files = a, c = e._onSend(null, b).then(function(a, b, c) {
                                    f.resolve(a, b, c)
                                }, function(a, b, c) {
                                    f.reject(a, b, c)
                                })
                            }
                        }), this._enhancePromise(g)
                    }
                    if (b.files = a.makeArray(b.files), b.files.length) return this._onSend(null, b)
                }
                return this._getXHRPromise(!1, b && b.context)
            }
        })
    }),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["jquery", "./jquery.fileupload"], a) : a(window.jQuery)
    }(function(a) {
        "use strict";
        var b = a.blueimp.fileupload.prototype.options.add;
        a.widget("blueimp.fileupload", a.blueimp.fileupload, {
            options: {
                processQueue: [],
                add: function(c, d) {
                    var e = a(this);
                    d.process(function() {
                        return e.fileupload("process", d)
                    }), b.call(this, c, d)
                }
            },
            processActions: {},
            _processFile: function(b, c) {
                var d = this,
                    e = a.Deferred().resolveWith(d, [b]),
                    f = e.promise();
                return this._trigger("process", null, b), a.each(b.processQueue, function(b, e) {
                    var g = function(b) {
                        return c.errorThrown ? a.Deferred().rejectWith(d, [c]).promise() : d.processActions[e.action].call(d, b, e)
                    };
                    f = f.pipe(g, e.always && g)
                }), f.done(function() {
                    d._trigger("processdone", null, b), d._trigger("processalways", null, b)
                }).fail(function() {
                    d._trigger("processfail", null, b), d._trigger("processalways", null, b)
                }), f
            },
            _transformProcessQueue: function(b) {
                var c = [];
                a.each(b.processQueue, function() {
                    var d = {},
                        e = this.action,
                        f = this.prefix === !0 ? e : this.prefix;
                    a.each(this, function(c, e) {
                        "string" === a.type(e) && "@" === e.charAt(0) ? d[c] = b[e.slice(1) || (f ? f + c.charAt(0).toUpperCase() + c.slice(1) : c)] : d[c] = e
                    }), c.push(d)
                }), b.processQueue = c
            },
            processing: function() {
                return this._processing
            },
            process: function(b) {
                var c = this,
                    d = a.extend({}, this.options, b);
                return d.processQueue && d.processQueue.length && (this._transformProcessQueue(d), 0 === this._processing && this._trigger("processstart"), a.each(b.files, function(e) {
                    var f = e ? a.extend({}, d) : d,
                        g = function() {
                            return b.errorThrown ? a.Deferred().rejectWith(c, [b]).promise() : c._processFile(f, b)
                        };
                    f.index = e, c._processing += 1, c._processingQueue = c._processingQueue.pipe(g, g).always(function() {
                        c._processing -= 1, 0 === c._processing && c._trigger("processstop")
                    })
                })), this._processingQueue
            },
            _create: function() {
                this._super(), this._processing = 0, this._processingQueue = a.Deferred().resolveWith(this).promise()
            }
        })
    }),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["jquery", "load-image", "load-image-meta", "load-image-exif", "load-image-ios", "canvas-to-blob", "./jquery.fileupload-process"], a) : a(window.jQuery, window.loadImage)
    }(function(a, b) {
        "use strict";
        a.blueimp.fileupload.prototype.options.processQueue.unshift({
            action: "loadImageMetaData",
            disableImageHead: "@",
            disableExif: "@",
            disableExifThumbnail: "@",
            disableExifSub: "@",
            disableExifGps: "@",
            disabled: "@disableImageMetaDataLoad"
        }, {
            action: "loadImage",
            prefix: !0,
            fileTypes: "@",
            maxFileSize: "@",
            noRevoke: "@",
            disabled: "@disableImageLoad"
        }, {
            action: "resizeImage",
            prefix: "image",
            maxWidth: "@",
            maxHeight: "@",
            minWidth: "@",
            minHeight: "@",
            crop: "@",
            orientation: "@",
            disabled: "@disableImageResize"
        }, {
            action: "saveImage",
            disabled: "@disableImageResize"
        }, {
            action: "saveImageMetaData",
            disabled: "@disableImageMetaDataSave"
        }, {
            action: "resizeImage",
            prefix: "preview",
            maxWidth: "@",
            maxHeight: "@",
            minWidth: "@",
            minHeight: "@",
            crop: "@",
            orientation: "@",
            thumbnail: "@",
            canvas: "@",
            disabled: "@disableImagePreview"
        }, {
            action: "setImage",
            name: "@imagePreviewName",
            disabled: "@disableImagePreview"
        }), a.widget("blueimp.fileupload", a.blueimp.fileupload, {
            options: {
                loadImageFileTypes: /^image\/(gif|jpeg|png)$/,
                loadImageMaxFileSize: 1e7,
                imageMaxWidth: 1920,
                imageMaxHeight: 1080,
                imageOrientation: !1,
                imageCrop: !1,
                disableImageResize: !0,
                previewMaxWidth: 80,
                previewMaxHeight: 80,
                previewOrientation: !0,
                previewThumbnail: !0,
                previewCrop: !1,
                previewCanvas: !0
            },
            processActions: {
                loadImage: function(c, d) {
                    if (d.disabled) return c;
                    var e = this,
                        f = c.files[c.index],
                        g = a.Deferred();
                    return "number" === a.type(d.maxFileSize) && f.size > d.maxFileSize || d.fileTypes && !d.fileTypes.test(f.type) || !b(f, function(a) {
                        a.src && (c.img = a), g.resolveWith(e, [c])
                    }, d) ? c : g.promise()
                },
                resizeImage: function(c, d) {
                    if (d.disabled || !c.canvas && !c.img) return c;
                    d = a.extend({
                        canvas: !0
                    }, d);
                    var e, f = this,
                        g = a.Deferred(),
                        h = d.canvas && c.canvas || c.img,
                        i = function(a) {
                            !a || a.width === h.width && a.height === h.height || (c[a.getContext ? "canvas" : "img"] = a), c.preview = a, g.resolveWith(f, [c])
                        };
                    return c.exif && (d.orientation === !0 && (d.orientation = c.exif.get("Orientation")), d.thumbnail && (e = c.exif.get("Thumbnail"))) ? (b(e, i, d), g.promise()) : h ? (i(b.scale(h, d)), g.promise()) : c
                },
                saveImage: function(b, c) {
                    if (!b.canvas || c.disabled) return b;
                    var d = this,
                        e = b.files[b.index],
                        f = e.name,
                        g = a.Deferred(),
                        h = function(a) {
                            a.name || (e.type === a.type ? a.name = e.name : e.name && (a.name = e.name.replace(/\..+$/, "." + a.type.substr(6)))), b.files[b.index] = a, g.resolveWith(d, [b])
                        };
                    if (b.canvas.mozGetAsFile) h(b.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(e.type) && f || (f && f.replace(/\..+$/, "") || "blob") + ".png", e.type));
                    else {
                        if (!b.canvas.toBlob) return b;
                        b.canvas.toBlob(h, e.type)
                    }
                    return g.promise()
                },
                loadImageMetaData: function(c, d) {
                    if (d.disabled) return c;
                    var e = this,
                        f = a.Deferred();
                    return b.parseMetaData(c.files[c.index], function(b) {
                        a.extend(c, b), f.resolveWith(e, [c])
                    }, d), f.promise()
                },
                saveImageMetaData: function(a, b) {
                    if (!(a.imageHead && a.canvas && a.canvas.toBlob) || b.disabled) return a;
                    var c = a.files[a.index],
                        d = new Blob([a.imageHead, this._blobSlice.call(c, 20)], {
                            type: c.type
                        });
                    return d.name = c.name, a.files[a.index] = d, a
                },
                setImage: function(a, b) {
                    return a.preview && !b.disabled && (a.files[a.index][b.name || "preview"] = a.preview), a
                }
            }
        })
    }),
    function(a) {
        "use strict";
        "function" == typeof define && define.amd ? define(["jquery", "./jquery.fileupload-process"], a) : a(window.jQuery)
    }(function(a) {
        "use strict";
        a.blueimp.fileupload.prototype.options.processQueue.push({
            action: "validate",
            always: !0,
            acceptFileTypes: "@",
            maxFileSize: "@",
            minFileSize: "@",
            maxNumberOfFiles: "@",
            disabled: "@disableValidation"
        }), a.widget("blueimp.fileupload", a.blueimp.fileupload, {
            options: {
                getNumberOfFiles: a.noop,
                messages: {
                    maxNumberOfFiles: "Maximum number of files exceeded",
                    acceptFileTypes: "File type not allowed",
                    maxFileSize: "File is too large",
                    minFileSize: "File is too small"
                }
            },
            processActions: {
                validate: function(b, c) {
                    if (c.disabled) return b;
                    var d = a.Deferred(),
                        e = this.options,
                        f = b.files[b.index];
                    return "number" === a.type(c.maxNumberOfFiles) && (e.getNumberOfFiles() || 0) + b.files.length > c.maxNumberOfFiles ? f.error = e.i18n("maxNumberOfFiles") : !c.acceptFileTypes || c.acceptFileTypes.test(f.type) || c.acceptFileTypes.test(f.name) ? c.maxFileSize && f.size > c.maxFileSize ? f.error = e.i18n("maxFileSize") : "number" === a.type(f.size) && f.size < c.minFileSize ? f.error = e.i18n("minFileSize") : delete f.error : f.error = e.i18n("acceptFileTypes"), f.error || b.files.error ? (b.files.error = !0, d.rejectWith(this, [b])) : d.resolveWith(this, [b]), d.promise()
                }
            }
        })
    });
var W2P = W2P || {};
! function(a) {
    "use strict";
    a.W2P["class"] || (a.W2P["class"] = {});
    var b = a.W2P["class"];
    b.Color = function(a, b, c, d) {
        if (this.rgb = b, this.cmyk = c, this.spot = d, this.hex = a, this.hex)
            for (;
                "number" != typeof this.hex && this.hex.hex;) this.hex = this.hex.hex
    }, b.Color.prototype = {
        friendlyValues: function() {
            var a = "",
                b = this.cmyk;
            if (b && (a += " CMYK(" + parseInt(100 * b.c) + "," + parseInt(100 * b.m) + "," + parseInt(100 * b.y) + "," + parseInt(100 * b.k) + ")"), this.rgb || this.hex < 256) {
                for (var c = this.hex.toString(16).toUpperCase(); c.length < 6;) c = "0" + c;
                a += " RGB #" + c
            }
            return a + (this.spot ? " : " + this.spot.toUpperCase() : "")
        },
        toWebString: function() {
            var a = parseInt(this.getRGB().r).toString(16),
                b = parseInt(this.getRGB().g).toString(16),
                c = parseInt(this.getRGB().b).toString(16);
            return "#" + (1 === a.length ? "0" + a : a) + (1 === b.length ? "0" + b : b) + (1 === c.length ? "0" + c : c)
        },
        toWebStringAformat: function(a) {
            var b = this.getRGB();
            return "rgba(" + parseInt(b.r) + "," + parseInt(b.g) + "," + parseInt(b.b) + "," + a + ")"
        },
        toString: function() {
            return "<color> <rgb>" + this.getRGB().toString() + "</rgb> <cmyk>" + this.getCMYK().toString() + "</cmyk> <hex>" + this.getHEX() + "</hex> <name>" + this.spot + "</name> </color> "
        },
        clone: function() {
            return new b.Color(this.hex, this.rgb ? new RGB(this.rgb.r, this.rgb.g, this.rgb.b) : void 0, this.cmyk ? new CMYK(this.cmyk.c, this.cmyk.m, this.cmyk.y, this.cmyk.k) : void 0, this.spot)
        },
        getRGB: function() {
            return this.rgb || (this.hex < 256 ? this.rgb = new Hex(this.hex).toRGB() : this.cmyk ? this.rgb = this.cmyk.toRGB() : this.rgb = new RGB(0, 0, 0)), this.rgb
        },
        getHEX: function() {
            return 256 == this.hex && (this.rgb ? this.hex = this.rgb.toHex().hex : this.cmyk ? this.hex = this.cmyk.toHex().hex : this.hex = 255), this.hex
        },
        getCMYK: function() {
            return this.cmyk && (this.hex < 256 ? this.cmyk = new Hex(this.hex).toCMYK() : this.rgb ? this.cmyk = this.rgb.toCMYK() : this.cmyk = new CMYK(0, 0, 0, 0)), this.cmyk
        }
    }, b.ColorData = fabric.util.createClass({
        initialize: function(a, c, d, e, f) {
            this.type = a || "solid", this.colors = c || [new b.Color(new Hex(0))], this.positions = d || [1], this.alphas = e || [1], this.rotation = parseFloat(f || 0)
        },
        toString: function() {
            var a = "<colordata> ";
            a += "<colors> ";
            for (var b = 0; b < this.colors.length; b++) a += this.colors[b].toString();
            return a += "</colors> ", a += "<positions>" + this.positions.join(",") + "</positions> ", a += "<alphas>" + this.alphas.join(",") + "</alphas> ", a += "<type>" + this.type + "</type>", a += "<rotation>" + this.rotation + "</rotation> ", a += "</colordata>"
        },
        clone: function() {
            return new b.ColorData(this.type, b.utils.cloneArray(this.colors, !0), b.utils.cloneArray(this.positions, !1), b.utils.cloneArray(this.alphas, !1), this.rotation)
        }
    }), b.StrokeData = fabric.util.createClass({
        initialize: function(a, c, d, e) {
            this.type = d || "solid", this.width = a || 0, this.alpha = c || 1, this.fill = e || new b.ColorData
        },
        toString: function() {
            return "<strokedata> <width>" + this.width + "</width> <alpha>" + this.alpha + "</alpha> <type>" + this.type + "</type> <fill>" + this.fill.toString() + "</fill> </strokedata>"
        },
        clone: function() {
            return new b.StrokeData(this.width, this.alpha, this.type, this.fill.clone())
        }
    }), b.ImageData = fabric.util.createClass({
        initialize: function(a, b, c, d, e, f, g) {
            this.url = a || "", this.thumbnail = b || "", this.fillmode = c || "", this.filedestination = d || "userfiles", this.bytes = e || "", this.width = f || -1, this.height = g || -1
        },
        toString: function() {
            var a = "<imagedata> ";
            return a += "<url>" + this.url + "</url> ", a += "<thumbnail></thumbnail> ", a += "<fillmode>" + this.fillmode + "</fillmode> ", a += "<width>" + this.width + "</width> ", a += "<height>" + this.height + "</height> ", a += "</imagedata>"
        },
        clone: function() {
            return new b.ImageData(this.url, this.thumbnail, this.fillmode, this.filedestination, this.bytes)
        }
    }), b.FillData = fabric.util.createClass({
        initialize: function(a, c, d, e, f) {
            this.type = a || "color", this.colorData = c || null, this.imageData = d || null, this.strokeData = e || new b.StrokeData, this.alpha = void 0 === f ? 1 : f
        },
        toString: function() {
            var a = "<fill> ";
            return a += "<type>" + this.type + "</type> ", a += "<alpha>" + this.alpha + "</alpha> ", a += this.colorData.toString() || "", a += this.imageData.toString() || "", a += this.strokeData.toString() || "", a += "</fill> "
        },
        clone: function() {
            return new b.FillData(this.type, this.colorData.clone(), this.imageData ? this.imageData.clone() : null, this.strokeData ? this.strokeData.clone() : null, this.alpha)
        }
    })
}(this);
var W2P = W2P || {};
! function(a) {
    "use strict";
    a.W2P["class"] || (a.W2P["class"] = {});
    var b = a.W2P["class"];
    b.FontData = fabric.util.createClass({
        initialize: function(a, b, c, d) {
            this.fontFamily = a || "Arial", this.bold = b || !1, this.italic = c || !1, this.index = d || -1, this.ndata = null, this.bdata = null, this.idata = null, this.bidata = null
        }
    })
}(this);
var W2P = W2P || {};
! function(a) {
    "use strict";
    a.W2P["class"] || (a.W2P["class"] = {});
    var b = a.W2P["class"],
        c = jQuery;
    b.Page = fabric.util.createClass({
        initialize: function(c, g, h) {
            this.pageData = new b.PageData(c.pageData), this.iCanvas = document.createElement("canvas"), this.iCanvas.id = "page-" + b.utils.generateReference(), h.append(this.iCanvas), this.canvas = new fabric.Canvas(this.iCanvas.id), this.canvas.controlsAboveOverlay = !0, this.canvas.renderOnAddRemove = !0, this.updateCanvasDimension(), this.canvas.pageData = this.pageData, this.canvas.page = this, this.updatePageBackground(!1, !0), this.pageData.foregroundSource && this.setPageOverlay(), this.canvas.on("object:selected", function(a) {
                PPR.getGlobalConfig("events").fire("canvas-object-selected", a)
            }), this.canvas.on("mouse:up", function(a) {
                PPR.getGlobalConfig("events").fire("canvas-object-selected", a), PPR.getGlobalConfig("events").fire("canvas-up", a)
            }), this.canvas.on("mouse:down", function(b) {
                PPR.getGlobalConfig("events").fire(Date.now() - (a.W2P.MODEL.runtime.act.lastMousDown || 0) < 500 ? "canvas-object-dblclick" : "canvas-down", b), a.W2P.MODEL.runtime.act.lastMousDown = Date.now()
            }), this.canvas.on("selection:cleared", function(a) {
                PPR.getGlobalConfig("events").fire("canvas-object-cleared", a)
            }), this.canvas.on("object:modified", function(a) {
                PPR.getGlobalConfig("events").fire("canvas-object-modified", a)
            }), this.canvas.on("text:changed", function(a) {
                PPR.getGlobalConfig("events").fire("canvas-text-changed", a)
            }), this.canvas.on("object:scaling", function(a) {
                PPR.getGlobalConfig("events").fire("canvas-object-scaled", a)
            }), W2P.MODEL.lib.config.enableSnapping === !0 && f(this.canvas), e(this.canvas), (W2P.MODEL.lib.config.showGridLines === !0 || this.pageData.bleed || this.pageData.margin || this.pageData.hfoldlines.length || this.pageData.vfoldlines.length) && (this.canvas.observeGuidelines = new d(this.canvas, this.pageData));
            var i = this;
            if (c.items.forEach(function(b, c) {
                    b.index = c, a.W2P.services.pages.objToControl(b, i, !1)
                }), c.groups && c.groups.length) {
                W2P.MODEL.runtime.act.ggg = c.groups;
                var j = this.canvas;
                setTimeout(function() {
                    c.groups.forEach(function(a) {
                        PPR.getService("pages").createGroup(a, j)
                    })
                }, 3e3)
            }
            this.createTemplate(), this.parent = jQuery("#" + this.iCanvas.id).parent().detach(), this.parent.css({
                left: W2P["class"].utils.getPixels(this.pageData.canvasDimension.left, this.pageData.scaling) + "px",
                top: W2P["class"].utils.getPixels(this.pageData.canvasDimension.top, this.pageData.scaling) + "px"
            })
        },
        calDimension: function() {
            return {
                w: W2P["class"].utils.getPixels(this.pageData.fWidth, this.pageData.scaling) - W2P["class"].utils.getPixels(this.pageData.canvasDimension.left, this.pageData.scaling) - W2P["class"].utils.getPixels(this.pageData.canvasDimension.right, this.pageData.scaling),
                h: W2P["class"].utils.getPixels(this.pageData.fHeight, this.pageData.scaling) - W2P["class"].utils.getPixels(this.pageData.canvasDimension.top, this.pageData.scaling) - W2P["class"].utils.getPixels(this.pageData.canvasDimension.bottom, this.pageData.scaling)
            }
        },
        updateCanvasDimension: function() {
            var a = this.calDimension();
            this.canvas.setDimensions({
                width: a.w,
                height: a.h
            })
        },
        setPageOverlay: function() {
            if (this.pageData.foregroundSource)
                if (".svg" === this.pageData.foregroundSource.substr(this.pageData.foregroundSource.length - 4).toLowerCase()) c.ajax({
                    type: "GET",
                    dataType: "text",
                    url: W2P["class"].utils.returnPath(this.pageData.foregroundSource),
                    success: function(a) {
                        fabric.loadSVGFromString(a, function(b, c) {
                            var d = fabric.util.groupSVGElements(b, c);
                            d.type = "shape", d.url = W2P["class"].utils.returnPath(this.pageData.foregroundSource), d.setCoords(), d.rawsvg = a, this.canvas.setOverlayImage(d, this.canvas.renderAll.bind(this.canvas))
                        })
                    },
                    error: function(a, b, c) {
                        _app.reportError(new Error("Error loading Foreground " + c))
                    }
                });
                else {
                    var a = this;
                    fabric.Image.fromURL(W2P["class"].utils.returnPath(this.pageData.foregroundSource), function(b) {
                        setTimeout(function() {
                            a.canvas.overlayImage = b, b.set({
                                width: a.canvas.width,
                                height: a.canvas.height,
                                originX: "left",
                                originY: "top"
                            }), a.canvas.setOverlayImage(b, a.canvas.renderAll.bind(a.canvas))
                        }, 1e3)
                    }, {
                        crossOrigin: ""
                    })
                }
        },
        fetchItemByID: function(a, b) {
            for (var c = 0; c < this.canvas._objects.length; c++)
                if (this.canvas._objects[c].getRef() === a) {
                    var d = this.canvas._objects[c];
                    return b !== !0 && this.canvas.remove(d), d
                }
        },
        updatePageBackground: function(a, b, d) {
            switch (this.pageData.fillData.type) {
                case "color":
                    switch (this.pageData.fillData.colorData.type) {
                        case "solid":
                            this.canvas.backgroundImage = "", this.canvas.backgroundColor = this.pageData.fillData.colorData.colors[0].toWebStringAformat(this.pageData.fillData.alpha), this.canvas.renderAll.bind(this.canvas)
                    }
                    break;
                case "transparent":
                    this.canvas.setBackgroundImage("", this.canvas.renderAll.bind(this.canvas)), this.canvas.backgroundColor = "";
                    break;
                case "image":
                case "shape":
                    if (a) this.canvas.backgroundImage.set({
                        opacity: this.pageData.fillData.alpha
                    }), this.canvas.renderAll.bind(this.canvas);
                    else if (this.canvas.backgroundColor = "", "image" != this.pageData.fillData.type || b) {
                        var e = this,
                            f = function(a) {
                                setTimeout(function() {
                                    e.pageData.fillData.imageData.width = a.width, e.pageData.fillData.imageData.height = a.height, e.canvas.setBackgroundImage(a, e.canvas.renderAll.bind(e.canvas), {
                                        scaleX: e.canvas.width / a.width,
                                        scaleY: e.canvas.height / a.height,
                                        originX: "left",
                                        originY: "top",
                                        opacity: e.pageData.fillData.alpha
                                    }), e.canvas.backgroundImage.elementId = W2P["class"].utils.generateReference()
                                }, 1e3)
                            };
                        d ? f(d) : fabric.Image.fromURL(W2P["class"].utils.returnPath(this.pageData.fillData.imageData.url), f, {
                            crossOrigin: ""
                        })
                    } else {
                        var g = W2P["class"].utils.stripURL(this.pageData.fillData.imageData.url),
                            h = new fabric.Image(fabric.util.createImage()),
                            i = c("#" + g).length ? document.getElementById(g) : document.getElementById("pp-img-holder");
                        h.setElement(d || i), h.setCoords(), h.set({
                            width: this.canvas.width,
                            height: this.canvas.height,
                            originX: "left",
                            originY: "top",
                            opacity: this.pageData.fillData.alpha
                        }), h.crossOrigin = "", h.canvas = this.canvas, this.canvas.setBackgroundImage(h, this.canvas.renderAll.bind(this.canvas)), this.canvas.backgroundImage.elementId = W2P["class"].utils.generateReference(), d || fabric.util.loadImage(W2P["class"].utils.returnPath(this.pageData.fillData.imageData.url), function(a) {
                            h.setElement(a), h.set({
                                width: h.canvas.width,
                                height: h.canvas.height
                            }), h.setCoords(), h.canvas.renderAll()
                        }, document, "")
                    }
            }
            this.updateCanvasDimension(), this.canvas.renderAll()
        },
        reRenderTexts: function() {
            this.canvas._objects.forEach(function(a) {
                a instanceof fabric.IText && (a.setText(a.text), a.setCoords(), a.caching = !0)
            }), this.canvas.renderAll()
        },
        renderWithScale: function(a) {
            var b = this.calDimension();
            this.canvas.observeGuidelines && this.canvas.observeGuidelines.update(this.pageData);
            for (var d = this.canvas.getObjects(), e = b.w / this.canvas.width, f = 0, g = d.length; g > f; f++) d[f].scaleX *= e, d[f].scaleY *= e, d[f].top *= e, d[f].left *= e, d[f].setCoords(), d[f].d && d[f].clipTo && d[f].drop_target && (d[f].drop_target.scaleX *= e, d[f].drop_target.scaleY *= e, d[f].drop_target.top *= e, d[f].drop_target.left *= e), "image" === d[f].type && d[f].calcDPIFnc();
            this.updateCanvasDimension(), this.refreshBackground(), this.pageData.foregroundSource && this.adjustPageOverlay(), a !== !0 && (c(this.parent).css({
                left: W2P["class"].utils.getPixels(this.pageData.canvasDimension.left, this.pageData.scaling) + "px",
                top: W2P["class"].utils.getPixels(this.pageData.canvasDimension.top, this.pageData.scaling) + "px"
            }), PPR.broadcast("stage-resize"), PPR.broadcast("stage-adjusted")), this.canvas.renderAll()
        },
        refreshBackground: function() {
            "image" !== this.pageData.fillData.type && "shape" !== this.pageData.fillData.type || this.canvas.backgroundImage && ("image" === this.pageData.fillData.type ? this.canvas.backgroundImage.set({
                width: this.canvas.width,
                height: this.canvas.height,
                scaleX: 1,
                scaleY: 1
            }) : this.canvas.backgroundImage.set({
                scaleX: this.canvas.width / this.canvas.backgroundImage.width,
                scaleY: this.canvas.height / this.canvas.backgroundImage.height
            }), this.canvas.backgroundImage.setCoords()), this.canvas.renderAll()
        },
        adjustPageOverlay: function() {
            this.canvas.overlayImage && (this.canvas.overlayImage.set({
                width: this.canvas.width,
                height: this.canvas.height,
                originX: "left",
                originY: "top"
            }), this.canvas.setOverlayImage(this.canvas.overlayImage, this.canvas.renderAll.bind(this.canvas)))
        },
        scaleToFit: function(a, b, d) {
            var e, f = W2P["class"].utils.getPixels(this.pageData.fWidth, this.pageData.scaling),
                g = W2P["class"].utils.getPixels(this.pageData.fHeight, this.pageData.scaling),
                h = W2P["class"].utils.getCStage(d);
            e = h.h - g < h.w - f ? h.h / g : h.w / f, this.pageData.scaling *= e;
            var i = this.calDimension();
            if (a === !0) {
                e = i.w / this.canvas.width;
                for (var j = this.canvas.getObjects(), k = 0, l = j.length; l > k; k++) j[k].scaleX *= e, j[k].scaleY *= e, j[k].top *= e, j[k].left *= e, j[k].setCoords(), void 0 !== j[k].d && "" !== j[k].d && void 0 !== j[k].clipTo && "" !== j[k].clipTo && void 0 !== j[k].drop_target && (j[k].drop_target.scaleX *= e, j[k].drop_target.scaleY *= e, j[k].drop_target.top *= e, j[k].drop_target.left *= e), "image" === j[k].type && j[k].calcDPIFnc()
            }
            this.canvas.observeGuidelines && this.canvas.observeGuidelines.update(this.pageData), this.updateCanvasDimension(), !a || "image" !== this.pageData.fillData.type && "shape" !== this.pageData.fillData.type || (this.canvas.backgroundImage.set({
                width: i.w,
                height: i.h
            }), this.canvas.backgroundImage.setCoords(), this.canvas.renderAll()), this.pageData.foregroundSource && this.adjustPageOverlay(), c(this.parent).css({
                left: W2P["class"].utils.getPixels(this.pageData.canvasDimension.left, this.pageData.scaling) + "px",
                top: W2P["class"].utils.getPixels(this.pageData.canvasDimension.top, this.pageData.scaling) + "px"
            }), b !== !0 && (PPR.broadcast("stage-resize"), PPR.broadcast("stage-adjusted")), this.canvas.renderAll()
        },
        toObj: function() {
            var a = {
                pageData: this.pageData
            };
            if (a.groups = PPR.getService("pages").parseGroups(this.canvas), a.items = PPR.getService("pages").itemsToString(this.canvas), a.groups && a.groups.length) {
                W2P.MODEL.runtime.act.ggg = a.groups;
                var b = this.canvas;
                setTimeout(function() {
                    a.groups.forEach(function(a) {
                        PPR.getService("pages").createGroup(a, b)
                    })
                }, 3e3)
            }
            return a
        },
        updatePage: function() {
            this.canvas.observeGuidelines ? this.canvas.observeGuidelines.update(this.pageData) : this.canvas.observeGuidelines = new d(this.canvas, this.pageData), this.updateCanvasDimension(), this.pageData.foregroundSource ? this.setPageOverlay(this.pageData.foregroundSource, this.canvas) : this.canvas.overlayImage = null, PPR.broadcast("stage-resize"), PPR.broadcast("stage-adjusted"), this.createTemplate()
        },
        createTemplate: function() {
            if (!this.pageData.templateSource) return void(this.templateImage = null);
            var a = this;
            "svg" === this.pageData.templateSource.split(".").pop().toLowerCase() ? c.ajax({
                type: "POST",
                dataType: "json",
                crossDomain: !0,
                url: W2P.MODEL.server.taskServer + "?t=fetchsvg",
                data: {
                    path: W2P["class"].utils.returnPath(a.pageData.templateSource)
                },
                success: function(b) {
                    fabric.loadSVGFromString(b.data, function(b, c) {
                        a.templateImage = fabric.util.groupSVGElements(b, c), a.templateImage.type = "shape"
                    })
                }
            }) : fabric.util.loadImage(this.pageData.templateSource, function(b) {
                a.templateImage = new fabric.Image(b), a.templateImage.crossOrigin = "", a.templateImage.setCoords()
            }, document, "")
        },
        swapDimensions: function() {
            var a = this.pageData.fWidth,
                b = this.pageData.fHeight;
            this.pageData.fWidth = b, this.pageData.fHeight = a, a = this.pageData.canvasDimension.left, b = this.pageData.canvasDimension.top, this.pageData.canvasDimension.left = a, this.pageData.canvasDimension.top = b, a = this.pageData.canvasDimension.right, b = this.pageData.canvasDimension.bottom, this.pageData.canvasDimension.right = a, this.pageData.canvasDimension.bottom = b, this.updateCanvasDimension(), this == W2P.MODEL.runtime.design.cPage && this.scaleToFit()
        },
        editPageSize: function(a, b, c) {
            if ("number" == typeof a && "number" == typeof b) {
                var d = this.pageData.fWidth,
                    e = this.pageData.fHeight;
                if (this.pageData.fWidth = a, this.pageData.fHeight = b, this.updateCanvasDimension(), c === !0) {
                    var f = d / a,
                        g = e / b;
                    this.canvas.getObjects().forEach(function(a) {
                        a.top *= f, a.left *= g, a.setCoords()
                    })
                }
                this.scaleToFit(!0)
            }
        },
        destroy: function() {
            this.iCanvas && jQuery("#" + this.iCanvas.id).parent().detach();
            for (var a = 0, b = W2P.MODEL.runtime.design.pages.length; b > a; a++)
                if (this == W2P.MODEL.runtime.design.pages[a]) {
                    W2P.MODEL.runtime.design.pages.splice(a, 1);
                    break
                }
            this == W2P.MODEL.runtime.design.cPage && PPR.getGlobalConfig("events").fire("select-page", 0), delete this.iCanvas, delete this.pageData, delete this.canvas
        }
    });
    var d = function(b, c) {
            function d() {
                if (i.save(), i.lineWidth = j.lib.config.guideLineWidth, j.lib.config.showGridLines === !0) {
                    i.strokeStyle = j.lib.config.gridLineColor;
                    for (var a = 0; a < Math.round(b.width / j.lib.config.gridLinesInterval); a++) i.moveTo(a * j.lib.gridLinesInterval, 0), i.lineTo(a * j.lib.config.gridLinesInterval, b.height);
                    for (a = 0; a < Math.round(b.height / j.lib.config.gridLinesInterval); a++) i.moveTo(0, a * j.lib.config.gridLinesInterval), i.lineTo(b.width, a * j.lib.config.gridLinesInterval)
                }
                if (e && (i.strokeStyle = j.lib.config.bleedLineColor, i.beginPath(), i.moveTo(e, e), i.lineTo(e, b.height - e), i.moveTo(b.width - e, e), i.lineTo(b.width - e, b.height - e), i.moveTo(e, e), i.lineTo(b.width - e, e), i.moveTo(e, b.height - e), i.lineTo(b.width - e, b.height - e), i.stroke()), f && (i.strokeStyle = j.lib.config.marginLineColor, i.beginPath(), i.moveTo(f, f), i.lineTo(f, b.height - f), i.moveTo(b.width - f, f), i.lineTo(b.width - f, b.height - f), i.moveTo(f, f), i.lineTo(b.width - f, f), i.moveTo(f, b.height - f), i.lineTo(b.width - f, b.height - f), i.stroke()), g.length) {
                    for (i.strokeStyle = j.lib.config.foldLineColor, i.beginPath(), a = 0; a < g.length; a++) i.moveTo(0, g[a]), i.lineTo(b.width, g[a]);
                    i.stroke()
                }
                if (h.length) {
                    for (i.strokeStyle = j.lib.config.foldLineColor, i.beginPath(), a = 0; a < h.length; a++) i.moveTo(h[a], 0), i.lineTo(h[a], b.height);
                    i.stroke()
                }
                i.restore()
            }
            var e, f, g, h, i = b.getSelectionContext(),
                j = a.W2P.MODEL;
            return this.update = function(a) {
                e = 0, f = 0, a.bleed && (e = W2P["class"].utils.getPixels(a.bleed)), a.margin && (f = W2P["class"].utils.getPixels(a.margin)), g = [], h = [];
                for (var b = 0; b < a.hfoldlines.length; b++) g.push(W2P["class"].utils.getPixels(a.hfoldlines[b]));
                for (b = 0; b < a.vfoldlines.length; b++) h.push(W2P["class"].utils.getPixels(a.vfoldlines[b]))
            }, this.update(c), b.on("before:render", function() {
                b.clearContext(b.contextTop)
            }), b.on("after:render", function() {
                j.runtime.act.clearTopLayer || j.runtime.act.eGroups === !0 || d()
            }), this
        },
        e = function(b) {
            var c = a.W2P.MODEL;
            b.on("after:render", function() {
                if (c.runtime.act.cGroups && c.runtime.act.eGroups) {
                    var a = b.getSelectionContext();
                    a.save(), a.lineWidth = c.lib.config.guideLineWidth;
                    var d, e, f = !1,
                        g = 20,
                        h = b.getActiveGroup() ? b.getActiveGroup()._objects : [],
                        i = b.getActiveGroup() ? b.getActiveGroup().getBoundingRect() : {};
                    c.runtime.act.cGroups.items.forEach(function(a) {
                        d = b.page.fetchItemByID(a.id, !0), d && (e = -1 !== h.indexOf(d) ? i : d.getBoundingRect(), e.bottom = e.top + e.height, e.right = e.left + e.width, f || (f = {
                            left: e.left,
                            right: e.right,
                            bottom: e.bottom,
                            top: e.top
                        }), f.left = Math.min(f.left, e.left), f.top = Math.min(f.top, e.top), f.right = Math.max(f.right, e.right), f.bottom = Math.max(f.bottom, e.bottom))
                    }), f && (a.strokeStyle = "#FF3ADF", a.beginPath(), a.moveTo(f.left + g, f.top), a.lineTo(f.left, f.top), a.lineTo(f.left, f.top + g), a.moveTo(f.left, f.bottom - g), a.lineTo(f.left, f.bottom), a.lineTo(f.left + g, f.bottom), a.moveTo(f.right - g, f.top), a.lineTo(f.right, f.top), a.lineTo(f.right, f.top + g), a.moveTo(f.right, f.bottom - g), a.lineTo(f.right, f.bottom), a.lineTo(f.right - g, f.bottom), a.stroke()), a.restore()
                }
            })
        },
        f = function(b) {
            function c() {
                f.save(), f.lineWidth = g.lib.config.guideLineWidth, f.strokeStyle = g.lib.config.snapLineColor, f.beginPath(), d && fabric.util.drawDashedLine(f, d[0], d[1], d[2], d[3], [10, 10]), e && fabric.util.drawDashedLine(f, e[0], e[1], e[2], e[3], [10, 10]), f.stroke(), f.restore()
            }
            var d, e, f = b.getSelectionContext(),
                g = a.W2P.MODEL;
            b.on("object:rotating", function(a) {
                g.runtime.act.snapOff || a.e.ctrlKey === !0 || a.e.shiftKey === !0 || (a.target.getAngle() % 45 <= 5 ? a.target.angle = a.target.getAngle() - a.target.getAngle() % 45 : (a.target.getAngle() + 5) % 45 <= 5 && (a.target.angle = a.target.getAngle() + (a.target.getAngle() + 5) % 45))
            }), b.on("object:moving", function(a) {
                if (!g.runtime.act.snapOff && a.e.ctrlKey !== !0 && a.e.shiftKey !== !0) {
                    if ("function" == typeof a.target.clipTo) return a.target.left > a.target.drop_target.left && (a.target.left = a.target.drop_target.left), a.target.top > a.target.drop_target.top && (a.target.top = a.target.drop_target.top), a.target.left + a.target.getWidth() < a.target.drop_target.left + a.target.drop_target.getWidth() && (a.target.left = a.target.drop_target.left + a.target.drop_target.getWidth() - a.target.getWidth()), void(a.target.top + a.target.getHeight() < a.target.drop_target.top + a.target.drop_target.getHeight() && (a.target.top = a.target.drop_target.top + a.target.drop_target.getHeight() - a.target.getHeight()));
                    var c = b.getObjects(),
                        f = b._currentTransform;
                    if (!(c.length < 1 || !f || a.target.getTLock() && !g.c.isAdmin)) {
                        var h, i, j;
                        d = e = null, a.target.setCoords();
                        var k = a.target.getBoundingRect(),
                            l = !1,
                            m = !1,
                            n = !1,
                            o = !1;
                        if (g.runtime.act.eGroups !== !0 && (j = Math.abs(Math.round(k.left + k.width / 2 - b.width / 2)), j <= g.lib.config.snapRange && (a.target.centerH(), d = [parseInt(b.width / 2), 0, parseInt(b.width / 2), b.height], l = !0), j = Math.abs(Math.round(k.left - b.width / 2)), j <= g.lib.config.snapRange && !l && (a.target.left = b.width / 2, a.target instanceof fabric.IText && "left" !== a.target.getTextAlign() && "justify" !== a.target.getTextAlign() && (a.target.left += "right" === a.target.getTextAlign() ? k.width : parseInt(k.width / 2)), d = [parseInt(b.width / 2), 0, parseInt(b.width / 2), b.height], l = n = !0), j = Math.abs(Math.round(k.left + k.width - b.width / 2)), j <= g.lib.config.snapRange && !l && (a.target.left = b.width / 2 - k.width, a.target instanceof fabric.IText && "left" !== a.target.getTextAlign() && "justify" !== a.target.getTextAlign() && (a.target.left += "right" === a.target.getTextAlign() ? k.width : parseInt(k.width / 2)), d = [parseInt(b.width / 2), 0, parseInt(b.width / 2), b.height], l = n = !0), j = Math.abs(Math.round(k.top + k.height / 2 - b.height / 2)), j <= g.lib.config.snapRange && (a.target.centerV(), e = [0, parseInt(b.height / 2), b.width, parseInt(b.height / 2)], m = !0), j = Math.abs(Math.round(k.top - b.height / 2)), j <= g.lib.config.snapRange && !m && (a.target.top = b.height / 2, e = [0, parseInt(b.height / 2), b.width, parseInt(b.height / 2)], m = o = !0), j = Math.abs(Math.round(k.top + k.height - b.height / 2)), j <= g.lib.config.snapRange && !m && (a.target.top = b.height / 2 - k.height, e = [0, parseInt(b.height / 2), b.width, parseInt(b.height / 2)],
                                m = o = !0)), l !== !0 && m !== !0)
                            for (var p = 0, q = c.length; q > p; p++) c[p] != a.target && "undefined" == typeof c[p].group && c[p].evented !== !1 && (h = c[p], i = h.getBoundingRect(), j = Math.abs(Math.round(k.left - i.left)), j <= g.lib.config.snapRange && !l && (a.target.left = i.left + (a.target.left - k.left), d = [i.left, 0, i.left, b.height], l = !0), j = Math.abs(Math.round(k.top + k.height - (i.top + i.height))), j <= g.lib.config.snapRange && !m && (a.target.top = i.top + i.height - k.height, e = [0, i.top + i.height, b.width, i.top + i.height], m = o = !0), j = Math.abs(Math.round(k.top - i.top)), j <= g.lib.config.snapRange && !m && (a.target.top = i.top + (a.target.top - k.top), e = [0, i.top, b.width, i.top], m = !0), j = Math.abs(Math.round(k.left + k.width - (i.left + i.width))), j <= g.lib.config.snapRange && !l && (a.target.left = i.left + i.width - k.width, a.target instanceof fabric.IText && "left" !== a.target.getTextAlign() && "justify" !== a.target.getTextAlign() && (a.target.left += "right" === a.target.getTextAlign() ? k.width : parseInt(k.width / 2)), d = [i.left + i.width, 0, i.left + i.width, b.height], l = n = !0))
                    }
                }
            }), b.on("before:render", function() {
                b.clearContext(b.contextTop)
            }), b.on("after:render", function() {
                (d || e) && c()
            }), b.on("mouse:up", function() {
                e = d = null, b.renderAll()
            })
        };
    b.PageData = fabric.util.createClass({
        initialize: function(a) {
            this.zLeft = 0, this.zTop = 0, this.scaling = a.scaling || 1, this.title = a.title, this.render = a.render, this.thumbnailImage = a.thumbnailImage, this.renderCanvasOffset = a.renderCanvasOffset, this.fWidth = a.fWidth, this.fHeight = a.fHeight, this.bleed = parseFloat(a.bleed instanceof Array ? a.bleed[0] : a.bleed) || 0, this.margin = a.margin || (a.mlines ? a.mlines instanceof Array ? parseFloat(a.mlines[0]) : a.mlines.split(",")[0] : 0), this.hfoldlines = a.hfoldlines || [], this.vfoldlines = a.vfoldlines || [], this.mlines = a.mlines, this.clines = a.clines, this.templateSource = "" === a.templateSource ? void 0 : a.templateSource, this.templateTint = a.templateTint, this.foregroundIsMask = a.foregroundIsMask, this.renderForeground = a.renderForeground, this.foregroundSource = "" === a.foregroundSource ? void 0 : a.foregroundSource, this.foregroundDimension = new b.DimenstionData(a.foregroundDimension.top, a.foregroundDimension.left, a.foregroundDimension.right, a.foregroundDimension.bottom, a.foregroundDimension.width, a.foregroundDimension.height), this.canvasDimension = new b.DimenstionData(a.canvasDimension.top, a.canvasDimension.left, a.canvasDimension.right, a.canvasDimension.bottom, a.canvasDimension.width, a.canvasDimension.height), this.fillData = new b.FillData(a.fillData.type, new b.ColorData(a.fillData.colorData.type, b.utils.toColorData(a.fillData.colorData.colors), a.fillData.colorData.positions, a.fillData.colorData.alphas, a.fillData.colorData.rotation), a.fillData.imageData ? new b.ImageData(a.fillData.imageData.url || "", a.fillData.imageData.thumbnail || "", a.fillData.imageData.fillmode || "", null, null, a.fillData.imageData.width || -1, a.fillData.imageData.height || -1) : new b.ImageData, a.fillData.strokeData ? new b.StrokeData(a.fillData.strokeData.width, a.fillData.strokeData.alpha, a.fillData.strokeData.type, null) : new b.StrokeData, a.fillData.alpha), this.index = a.index || W2P.MODEL.runtime.design.pages.length
        },
        clone: function() {}
    }), b.DimenstionData = fabric.util.createClass({
        initialize: function(a, b, c, d, e, f) {
            this.top = parseFloat(a || 0), this.left = parseFloat(b || 0), this.right = parseFloat(c || 0), this.bottom = parseFloat(d || 0), this.width = parseFloat(e || -1), this.height = parseFloat(f || -1)
        },
        toString: function() {
            var a = "<dimensiondata>";
            return a += "<left>" + this.left + "</left>", a += "<right>" + this.right + "</right>", a += "<top>" + this.top + "</top>", a += "<bottom>" + this.bottom + "</bottom>", a += "<width>" + this.width + "</width>", a += "<height>" + this.height + "</height>", a += "</dimensiondata>"
        }
    })
}(this), Box.Application.addService("actions", function(a) {
    "use strict";

    function b(b) {
        var c = b.data;
        "function" == typeof u.functions.onValidation && u.functions.onValidation(c), a.broadcast("validation-loaded", c), u.server = c.server, u.c.accntStatus = c.accntStatus, u.c.maxUploadSize = c.maxUploadSize, u.c.imageToken = c.imageToken, u.c.uniqueId = c.uniqueId, u.c.projectId = u.c.isDesign ? "" : "edit" === u.c.mode ? u.c.projectId : c.uniqueId, "new" === u.c.designId && (u.c.designId = c.uniqueId), x.loadStyle(u.server.cloudFront + "app/styles/source.css"), "function" == typeof u.functions.onReady && u.functions.onReady(), u.c.autoInitialize && x.loadLib()
    }

    function c(b) {
        var c = b.data;
        a.broadcast("lib-loaded", c), "function" == typeof u.functions.onResourceLoaded && (c = u.functions.onResourceLoaded(c)), c.language && "function" == typeof u.functions.onLanguageLoaded && (c.language = u.functions.onLanguageLoaded(c.language), c.language || a.reportError(new Error("Language file not passed back from your custom function"))), u.lib.config = c.config, u.lib.layout = c.layout, u.lib.design = c.design || u.c.design || {}, u.lib.project = c.project, u.lib.modules = c.resources.modules, u.lib.moduleLayouts = c.moduleLayouts, u.lib.theme = w.fetchItemFrmArray(c.theme, "title", c.config.theme), u.lib.lang = c.language || u.c.lang, d();
        var e;
        if (c.resources.colors && (w.sortArr(c.resources.colors, "title"), u.lib.colors = [], c.resources.colors.forEach(function(a) {
                e = {
                    title: a.title,
                    colors: []
                }, a.colors = a.data.split(","), a.colors.forEach(function(a) {
                    e.colors.push(w.stringToColor(a))
                }), u.lib.colors.push(e)
            }), u.lib.userColors = {
                title: u.lib.lang.my_colors,
                colors: []
            }, u.lib.colors.push(u.lib.userColors)), c.resources.images && (w.sortArr(c.resources.images, "title"), u.lib.images = c.resources.images), c.resources.backgroundimages && (w.sortArr(c.resources.backgroundimages, "title"), u.lib.bgImages = c.resources.backgroundimages), c.resources["text-arts"] && (w.sortArr(c.resources["text-arts"], "title"), u.lib["text-arts"] = c.resources["text-arts"]), c.resources.userimages && (u.lib.userImages = c.resources.userimages), c.resources.fonts) {
            w.sortArr(c.resources.fonts, "fontFamily"), u.lib.fonts = [new B.FontData("Arial", !0, !0, 0)], u.runtime.act.cFont = u.lib.fonts[0];
            for (var f, g = {
                    google: {
                        families: []
                    },
                    custom: {
                        families: []
                    },
                    active: function() {
                        u.runtime.act.fontsLoaded = !0, v.fire("fonts-loaded")
                    }
                }, h = "<style>", i = "", j = 0, k = c.resources.fonts.length; k > j; j++) f = c.resources.fonts[j], "arial" !== f.fontFamily.toLowerCase() && (u.lib.fonts.push(new B.FontData(f.fontFamily, f.bold, f.italic, j + 1)), f.isGoogle ? (g.google.families.push(f.fontFamily), f.bold && g.google.families.push(f.fontFamily + ":bold"), f.italic && g.google.families.push(f.fontFamily + ":italic"), f.bold && f.italic && g.google.families.push(f.fontFamily + ":bolditalic")) : (g.custom.families.push(f.fontFamily), i = f.fontFamily.split(" ").join("_").toLowerCase(), h += "@font-face { font-family: '" + f.fontFamily + "'; src: local('" + f.fontFamily + "'), url('" + u.server.cloudFront + "fonts/woff/" + i + ".woff') format('woff'); font-weight: normal; font-style: normal; }", f.bold && (h += "@font-face { font-family: '" + f.fontFamily + "'; src: local('" + f.fontFamily + "'), url('" + u.server.cloudFront + "fonts/woff/" + i + "_b.woff') format('woff'); font-weight: bold; font-style: normal; }"), f.italic && (h += "@font-face { font-family: '" + f.fontFamily + "'; src: local('" + f.fontFamily + "'), url('" + u.server.cloudFront + "fonts/woff/" + i + "_i.woff') format('woff'); font-weight: normal; font-style: italic; }"), f.bold && f.italic && (h += "@font-face { font-family: '" + f.fontFamily + "'; src: local('" + f.fontFamily + "'), url('" + u.server.cloudFront + "fonts/woff/" + i + "_bi.woff') format('woff'); font-weight: bold; font-style: italic; }")));
            if (h += "</style>", t(h).appendTo("head"), g.google.families.length || delete g.google, g.custom.families.length || delete g.custom, !WebFont) return void a.reportError(new Error("WebFont script not initialized"));
            WebFont.load(g)
        }
        A.presetFabric();
        var l = "";
        if (u.lib.modules) {
            var m = "string" == typeof u.lib.modules ? JSON.parse(u.lib.modules) : u.lib.modules;
            t.each(m, function(a, b) {
                u.runtime.modules[a] = b
            })
        }
        t.each(u.runtime.modules, function(a, b) {
            u.lib.moduleLayouts && (l += u.lib.moduleLayouts[a] || "")
        }), u.lib.layout = u.lib.layout.replace("<!--MODS-->", l);
        var n = document.createElement("link");
        n.rel = "stylesheet", n.href = u.server.cloudFront + "app/styles/style.css", document.head.appendChild(n), u.runtime.act.libLoaded = !0, a.broadcast("lib-ready"), v.fire("lib-ready"), "function" == typeof u.functions.onLibReady && u.functions.onLibReady()
    }

    function d() {
        u.lib.theme && u.runtime.act.styleSource && (t("head").append("<style>" + u.runtime.act.styleSource.split('"color1"').join(u.lib.theme.color1).split('"color2"').join(u.lib.theme.color2).split('"color3"').join(u.lib.theme.color3).split('"color4"').join(u.lib.theme.color4).split('"color5"').join(u.lib.theme.color5).split('"backgroundImage"').join("" === u.lib.theme.backgroundImage ? "https://dta8vnpq1ae34.cloudfront.net/resources/images/data/bg.jpg" : u.lib.theme.backgroundImage) + "</style>"), delete u.runtime.act.styleSource)
    }

    function e(b) {
        if (m(), !u.runtime.act.libLoaded) return void(u.runtime.act.standByData = b || !0);
        if (b === !0 && (b = !1), v.fire("before-show"), t.unblockUI(), t("head").append('<meta name="viewport" content="width=device-width, user-scalable=no" />'), t(u.c.parentDiv).length ? (t(u.c.parentDiv).empty().append(u.lib.container || u.lib.layout), t("#pp-container").css({
                width: t(u.c.parentDiv).width(),
                height: t(u.c.parentDiv).height()
            })) : (t.blockUI({
                message: u.lib.container || u.lib.layout,
                css: {
                    background: "#FFFFFF",
                    border: "none",
                    bottom: 0,
                    cursor: "default",
                    left: 0,
                    margin: 0,
                    padding: 0,
                    right: 0,
                    top: 0,
                    width: "100%"
                },
                overlayCSS: {
                    cursor: "default",
                    opacity: 1
                },
                baseZ: 9999999
            }), t("html").css("overflow", "hidden"), t("#pp-container").css({
                width: window.innerWidth,
                height: window.innerHeight
            })), u.lib.container) return h(), void(u.lib.container = null);
        var c;
        c = b ? b : "edit" === u.c.mode && u.lib.project ? u.lib.project : u.lib.design, u.lib.design || (u.lib.design = c), u.runtime.ui.container = t("#pp-container").css("opacity", 0), u.runtime.ui.container.css("overflow", "hidden"), a.startAll(u.runtime.ui.container[0]), setTimeout(function() {
            y.loadDesign(c), a.broadcast("init-layout"), f(), setTimeout(function() {
                h()
            }, 1e3), u.runtime.act.standByData && (u.runtime.act.standByData = null), u.runtime.ui.container.css("opacity", 1)
        }, 500)
    }

    function f() {
        u.c.langSycned || (t("[pp-lang]").each(function() {
            "INPUT" == this.tagName.toUpperCase() ? t(this).prop("value", u.lib.lang[t(this).attr("pp-lang")]) : t(this).text(u.lib.lang[t(this).attr("pp-lang")])
        }), u.c.langSycned = !0)
    }

    function g() {
        (u.c.autoShow || u.runtime.act.standByData) && e(u.runtime.act.standByData)
    }

    function h() {
        u.c.isAdmin || l(), u.runtime.design.cPage && u.runtime.design.cPage.canvas.renderAll(), a.broadcast("resize"), v.fire("after-show"), a.broadcast("after-show"), "function" == typeof u.functions.onShown && u.functions.onShown()
    }

    function i() {
        u.runtime.design.pages.length && setTimeout(function() {
            v.fire("select-page", u.runtime.design.dPage || 0)
        }, 500), a.broadcast("design-loaded")
    }

    function j() {
        (u.lib.design.showPresetForm || u.lib.design.showtextpresetform || u.lib.design.showTextPresetForm) && "edit" !== u.c.mode && !u.runtime.act.presetFormShown ? v.fire("show-preset-form") : (u.c.isAdmin || k(), u.runtime.act.appReady = !0)
    }

    function k() {
        u.lib.design.welcomeMsg && a.broadcast("dialog", {
            text: u.lib.design.welcomeMsg,
            buttons: {
                ok: {
                    click: "close"
                }
            }
        })
    }

    function l() {
        s || (t("[data-tip]").each(function() {
            z.create({
                target: t(this)
            })
        }), t("[data-intro]").each(function() {
            var a = t(this),
                b = a.attr("data-intro");
            0 === b.indexOf("{") && b.lastIndexOf("}") === b.length - 1 && b.length > 2 && a.attr("data-intro", u.lib.lang[b.substr(1).substring(0, b.length - 2)] || "")
        }), s = !0)
    }

    function m() {
        function b(a) {
            if (a.clipboardData) {
                var b = a.clipboardData.items;
                if (b)
                    for (var c = 0; c < b.length; c++) - 1 !== b[c].type.indexOf("text/plain") && b[c].getAsString(function(a) {
                        var b = u.runtime.design.cPage.canvas.getActiveObject();
                        b && /text/.test(b.type) && (b.insertChars(a), u.runtime.design.cPage.canvas.renderAll())
                    })
            }
        }
        r || (t(document).on("keydown", function(b) {
            if (u.runtime.act.appReady && 0 != u.runtime.design.pages.length && "text" !== b.currentTarget.type && !t(":focus").is("input") && !t(":focus").is("textarea")) {
                var c = u.runtime.design.cPage.canvas.getActiveObject();
                if (c) {
                    if (1 == c.isEditing) return;
                    8 === b.keyCode && b.preventDefault()
                }
                if (null != u.runtime.page.cItem || u.runtime.design.cPage.canvas.getActiveGroup()) {
                    var d = 1;
                    if (u.runtime.design.cPage.canvas.getActiveObject() && 1 == u.runtime.design.cPage.canvas.getActiveObject().isEditing) return;
                    var e = u.runtime.design.cPage.canvas.getActiveGroup() || u.runtime.design.cPage.canvas.getActiveObject();
                    b.keyCode >= 37 && b.keyCode <= 40 && u.runtime.design.undo.push({
                        target: u.runtime.design.cPage.canvas.getActiveObject() || u.runtime.design.cPage.canvas.getActiveGroup(),
                        prop: "transform",
                        val: w.captureProps(u.runtime.design.cPage.canvas.getActiveObject() || u.runtime.design.cPage.canvas.getActiveGroup())
                    }), (b.ctrlKey || b.shiftKey) && (d = 10);
                    var f = !1;
                    switch (b.keyCode) {
                        case 37:
                            u.runtime.act.textEditMode || e.tLocked || (e.setLeft(e.getLeft() - d), f = !0);
                            break;
                        case 38:
                            u.runtime.act.textEditMode || e.tLocked || (e.setTop(e.getTop() - d), f = !0);
                            break;
                        case 39:
                            u.runtime.act.textEditMode || e.tLocked || (e.setLeft(e.getLeft() + d), f = !0);
                            break;
                        case 40:
                            u.runtime.act.textEditMode || e.tLocked || (e.setTop(e.getTop() + d), f = !0)
                    }
                    f && (e.setCoords(), u.runtime.design.cPage.canvas.renderAll(), a.broadcast("context-move"), b.preventDefault(), b.stopImmediatePropagation())
                } else switch (b.keyCode) {
                    case 37:
                        !u.runtime.act.textEditMode && u.runtime.act.previewShowing && a.broadcast("select-preview", "-");
                        break;
                    case 39:
                        !u.runtime.act.textEditMode && u.runtime.act.previewShowing && a.broadcast("select-preview", "+")
                }
            }
        }), t(document).on("keyup", function(b) {
            if (u.runtime.design.pages && 0 !== u.runtime.design.pages.length && "text" !== b.currentTarget.type && !t(":focus").is("input") && !t(":focus").is("textarea")) {
                var c = u.runtime.design.cPage ? u.runtime.design.cPage.canvas.getActiveObject() : null;
                if (!c || (8 === b.keyCode && b.preventDefault(), !c.isEditing)) switch (b.keyCode) {
                    case 46:
                        v.fire("delete-items");
                        break;
                    case 88:
                        b.ctrlKey && c && (/text/.test(c.type) || v.fire("cut-items"));
                        break;
                    case 86:
                        b.ctrlKey && c && (/text/.test(c.type) || v.fire("paste-items"));
                        break;
                    case 67:
                        b.ctrlKey && /text/.test(c.type) && v.fire("copy-items");
                        break;
                    case 90:
                        b.ctrlKey && v.fire("undo");
                        break;
                    case 89:
                        b.ctrlKey && v.fire("redo");
                        break;
                    case 27:
                        u.runtime.ui.pack.unblock(), u.runtime.act.caretMode && (v.fire("end-caret"), a.broadcast("alert-cancel", u.lib.lang.text_cancelled)), a.broadcast("escape")
                }
            }
        }), window.addEventListener("paste", b), r = !0)
    }

    function n(b) {
        b.data ? a.broadcast("show-preview-closed") : (u.lib.container = t(".pp-container").detach(), u.c.parentDiv ? (u.c.parentDiv.hide(), u.c.parentDivHidden = !0) : (t.unblockUI(), t("html").css("overflow", "auto"))), "function" == typeof u.functions.onClose && u.functions.onClose()
    }

    function o() {
        u.c.mode = "edit", u.c.parentDivHidden ? (u.c.parentDiv.show(), u.c.parentDivHidden = !1) : u.lib.container ? e() : a.broadcast("hide-preview"), v.fire("select-page", u.runtime.design.dPage), u.runtime.design.cPage.scaleToFit(!0)
    }

    function p(a) {
        e(a.data)
    }

    function q() {
        y.loadDesign(u.lib.design), v.fire("select-page", u.runtime.design.dPage || 0), a.broadcast("app-reloaded")
    }
    var r, s, t = a.getGlobal("jQuery"),
        u = a.getGlobalConfig("model"),
        v = a.getGlobalConfig("events"),
        w = a.getService("utils"),
        x = a.getService("comm"),
        y = a.getService("designs"),
        z = a.getService("pop-over"),
        A = a.getService("pages"),
        B = a.getGlobal("W2P")["class"];
    return v.on("validation-loaded", b), v.on("lib-loaded", c), v.on("lib-ready", g), v.on("design-loaded", i), v.on("app-ready", j), v.on("close-app", n), v.on("resume-app", o), v.on("show-editor", p), v.on("reload-app", q), v.on("set-theme", d), {
        start: function() {
            t('<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>').appendTo("head"), u.c.apiKey ? x.validate(u.c.apiKey) : (a.reportError(new Error("Invalid apiKey type")), console.error("Invalid apiKey type!"), console.info("Application will not close"))
        },
        show: function(a) {
            return e(a)
        }
    }
}), Box.Application.addService("comm", function(a) {
    "use strict";

    function b(a, b, c, f, g, h) {
        b && e.server.urlToken && (b.connectsid = e.server.urlToken), d.ajax({
            type: "POST",
            dataType: g || "json",
            cache: !1,
            crossDomain: !0,
            url: a,
            data: b,
            success: c,
            error: f,
            xhrFields: h ? void 0 : {
                withCredentials: !0
            }
        })
    }

    function c(a, b, c, e, f, g) {
        d.ajax({
            type: "GET",
            dataType: e || "json",
            cache: f || !1,
            crossDomain: !0,
            url: a,
            success: b,
            error: c
        })
    }
    var d = a.getGlobal("jQuery"),
        e = a.getGlobalConfig("model"),
        f = a.getGlobalConfig("events");
    return {
        fetchPost: function(a, c, d, f, g, h) {
            b("http" === a.substr(0, 4) || "//" === a.substr(0, 2) ? a : e.c.appApiUrl + a, c, d, f, g, h)
        },
        fetchGet: function(a, b, d) {
            c("http" === a.substr(0, 4) || "//" === a.substr(0, 2) ? a : e.c.appApiUrl + a, b, d)
        },
        validate: function(c) {
            b(e.c.appApiUrl + "validate", {
                apiKey: c,
                userId: e.c.userId,
                client: e.c.client,
                version: e.c.version
            }, function(b) {
                b.error ? ("function" == typeof e.functions.onValidationError && e.functions.onValidationError(b), a.reportError(new Error("Validation error"))) : f.fire("validation-loaded", b)
            }, function() {
                a.reportError(new Error("Error validating apiKey"))
            })
        },
        loadStyle: function(b) {
            c(b, function(a) {
                e.runtime.act.styleSource = a, f.fire("set-theme")
            }, function(b) {
                a.reportError(new Error("Error loading StyleSource"))
            }, "text", !0)
        },
        loadLib: function() {
            return e.c.libCache[e.c.designId] ? (f.fire("lib-loaded", e.c.libCache[e.c.designId]), !0) : (b(e.c.appApiUrl + "fetch-multi", {
                isUserProject: e.c.isUserProject,
                language: e.c.lang ? void 0 : e.c.langCode,
                design: e.c.designId,
                resources: e.c.isUserproject ? "" : e.c.designId,
                project: "edit" === e.c.mode ? e.c.projectId : void 0,
                isDesign: e.c.isDesign,
                theme: "",
                config: ""
            }, function(a) {
                e.c.designId && (e.c.libCache[e.c.designId] = a), f.fire("lib-loaded", a)
            }, function() {
                a.reportError(new Error("Error loading library"))
            }), void(e.runtime.act.libLoaded = !1))
        }
    }
}), Box.Application.addService("designs", function(a) {
    "use strict";

    function b(a) {
        for (var b, e, f, g, h, i, j = 0, k = a.pages.length, l = 0; k > l; l++)(a.pages[l].pageData.fWidth > j || a.pages[l].pageData.fHeight > j) && (b = l, j = Math.max(a.pages[l].pageData.fWidth, a.pages[l].pageData.fHeight));
        e = a.pages[b].pageData.fWidth, f = a.pages[b].pageData.fHeight, g = a.scaling, c.runtime.design.unit = a.unit, c.runtime.design.cScaling = 1;
        var m = d.getCStage();
        for (h = m.w / m.h > e / f ? m.h / d.getPixels(parseFloat(f)) : m.w / d.getPixels(parseFloat(e)), i = h / g, a.scaling = h, l = 0; k > l; l++)
            for (var n = 0, o = a.pages[l].items.length; o > n; n++) {
                if (a.pages[l].items[n].scaleX *= i, a.pages[l].items[n].scaleY *= i, a.pages[l].items[n].top *= i, a.pages[l].items[n].left *= i, void 0 !== a.pages[l].items[n].d && "" !== a.pages[l].items[n].d && void 0 !== a.pages[l].items[n].clipTo && "" !== a.pages[l].items[n].clipTo && void 0 !== a.pages[l].items[n].drop_target && (a.pages[l].items[n].drop_target.scaleX *= i, a.pages[l].items[n].drop_target.scaleY *= i, a.pages[l].items[n].drop_target.top *= i, a.pages[l].items[n].drop_target.left *= i), "string" == typeof a.pages[l].items[n].maskShape && "" !== a.pages[l].items[n].maskShape) {
                    var p = JSON.parse(a.pages[l].items[n].maskShape);
                    p.scaleX *= i, p.scaleY *= i, p.top *= i, p.left *= i, a.pages[l].items[n].maskShape = JSON.stringify(p)
                }
                if (a.pages[l].items[n].title && c.c.userData && !c.runtime.isAdmin && ("i-text" === a.pages[l].items[n].type || "textbox" === a.pages[l].items[n].type) && "edit" !== c.c.mode) {
                    var q = a.pages[l].items[n].title.toLowerCase().split(" ").join("_");
                    c.c.userData[q] && (a.pages[l].items[n].text = c.c.userData[q])
                }
            }
        return a
    }
    var c = a.getGlobalConfig("model"),
        d = a.getService("utils"),
        e = a.getService("pages"),
        f = a.getGlobalConfig("events"),
        g = a.getGlobal("W2P")["class"];
    return {
        loadDesign: function(d) {
            if (f.fire("discard-selection"), f.fire("remove-page", "all"), c.runtime.design.pages = [], c.runtime.design.cPage = null, c.runtime.page.cItem = null, c.runtime.page.cItems = [], c.runtime.act.eGroup = !1, "" === d) return a.reportError(new Error("Empty design source")), !1;
            c.c.designId || (c.c.designId = d.designId || d.id), c.c.isAdmin && "new" === c.c.mode || (d = b(d)), c.runtime.design.showTextPresetForm = d.showtextpresetform === !0 || d.showTextPresetForm === !0, c.runtime.design.title = d.title || "", c.runtime.design.disableImageClick = d.disableImageClick === !0, c.runtime.design.cScaling = d.scaling || 1, c.runtime.design.layout = d.layout || "default", c.runtime.design.welcomeMsg = d.welcomeMsg, c.runtime.design.thumbnailImage = d.thumbnailImage, c.runtime.design.defaultTab = d.defaultTab || "bg-colors", d.defaultFont && c.lib.fonts.forEach(function(a) {
                a.fontFamily.toLowerCase() === d.defaultFont.toLowerCase() && (c.runtime.act.cFont = a)
            }), c.runtime.design.dPage = d.dPage || 0, c.runtime.act.singlePageMode = d.singlePageMode, c.runtime.design.meta = void 0, c.runtime.design.newTextColorString = d.newTextColor, c.runtime.design.hideImagePanel = d.hideImagePanel, c.runtime.design.hideTextPanel = d.hideTextPanel, c.runtime.design.hideBackgroundPanel = d.hideBackgroundPanel, c.runtime.design.showPresetForm = d.showPresetForm, c.runtime.design.pdfDownload = d.pdfDownload, c.runtime.act.greyScaleUploads = d.greyScaleUploads, c.runtime.act.sublimation = d.sublimation, d.newTextColor ? (c.runtime.design.newTextColorString = d.newTextColor, c.runtime.design.newTextColor = new g.ColorData("solid", [g.utils.stringToColor(d.newTextColor)])) : c.runtime.design.newTextColor = new g.ColorData("solid"), c.runtime.design.unit = d.unit, "edit" === c.c.mode && (c.c.product = d.product);
            for (var h = 0; h < d.pages.length; h++) e.createPage(d.pages[h]);
            c.runtime.design.undo = [], c.runtime.design.redo = [], f.fire("design-loaded"), setTimeout(function() {
                f.fire("fonts-loaded")
            }, 3e3)
        }
    }
}), Box.Application.addService("image-editor", function(a) {
    "use strict";

    function b() {
        g = new Aviary.Feather({
            apiKey: j.c.imageToken,
            language: j.c.langCode.replace("pt-br", "pt_BR"),
            appendTo: j.runtime.ui.pack[0],
            enableCORS: !0,
            theme: "minimum",
            launchDelay: 500,
            tools: ["enhance", "effects", "vignette", "colorsplash", "overlays", "lighting", "color", "blemish", "focus", "redeye", "whiten", "resize", "crop", "frames", "stickers", "orientation", "warmth", "brightness", "contrast", "saturation", "sharpness", "draw"],
            onSave: d,
            onSaveHiRes: d
        })
    }

    function c(a) {
        "undefined" != typeof a.signature ? (h.hiRes = !0, g.updateConfig({
            apiKey: a.apiKey,
            salt: a.salt,
            timestamp: a.timestamp,
            signature: a.signature.toLowerCase(),
            jpgQuality: 91,
            encryptionMethod: a.encryptionMethod,
            onSaveButtonClicked: function() {
                return g.saveHiRes(), !1
            }
        })) : h.hiRes = !1
    }

    function d(b, c) {
        var d = m.generateReference(),
            e = j.server.cdnBaseUrl + j.server.idx + "/userfiles/aviary/" + (h.elementid || d) + "." + m.getExtension(h.getElement().src);
        a.broadcast("alert-processing", j.lib.lang.loading_image), fabric.util.loadImage(c, function(b) {
            b.id = m.generateReference(), b.url = e, k.fire("set-image", {
                type: "image",
                target: h.isBg ? "bg" : h,
                url: e,
                newImg: b
            }), "function" == typeof i && i(), h = null, i = null, a.broadcast("alert-hide")
        }, document, "", "&save=true&dest=" + j.server.idx + "/userfiles/aviary/" + (h.elementid || d) + "." + m.getExtension(h.getElement().src)), g.close()
    }

    function e(a) {
        g || b(), h = a.data.image || j.runtime.page.cItem, 1 === j.c.accntStatus && l.fetchPost("fetch-signature", {
            type: "aviary"
        }, c), i = a.data.callBack, "bg" === a.data.type ? (h.isBg = !0, g.launch({
            image: h.getElement(),
            url: h.getSrc(),
            hiresUrl: h.getSrc(),
            forceCropPreset: [j.lib.lang.canvas_size, a.data.ratio],
            forceCropMessage: j.lib.lang.bg_crop_message
        })) : "custom" === a.data.type && a.data.opts ? g.launch(a.data.opts) : "image" === j.runtime.page.cItem.type && g.launch({
            image: h.getElement(),
            url: h.getSrc(),
            hiresUrl: h.getSrc()
        })
    }

    function f() {
        "image" === j.runtime.design.cPage.pageData.fillData.type && e({
            data: {
                type: "bg",
                ratio: j.runtime.design.cPage.canvas.width + ":" + j.runtime.design.cPage.canvas.height,
                image: j.runtime.design.cPage.canvas.backgroundImage
            }
        })
    }
    var g, h, i, j = a.getGlobalConfig("model"),
        k = a.getGlobalConfig("events"),
        l = (a.getGlobal("jQuery"), a.getService("comm")),
        m = a.getService("utils");
    return k.on("show-image-editor", e), k.on("edit-bgImage", f), {
        init: function() {
            b()
        },
        launch: function(a) {
            e({
                data: a
            })
        }
    }
}), Box.Application.addService("images", function(a) {
    "use strict";

    function b(a, b) {
        a.length && r("#" + b).append('<option value="' + (a.length - 1) + '">' + a[a.length - 1].title + "</option>")
    }

    function c(a, b, c) {
        if (a.length) {
            var d = "";
            a.forEach(function(a, b) {
                d += '<option value="' + b + '">' + a.title + "</option>"
            }), c === !0 && (d += '<option value="my">' + q.lib.lang.my_pictures + "</option>"), r("#" + b).append(d)
        }
    }

    function d(a, b, c) {
        var d = '<div class="pp-image-list pp-uses-scroll" id="' + b + '" >';
        return a.forEach(function(a) {
            d += f(a, c)
        }), r(d + "</div>")
    }

    function e(b) {
        var c, e, f = q.lib[b + "Conf"];
        c = r("#" + f.select).val(), f && (f.current && r("#" + f.current).hide(), "my" === c ? (f.current = "pp_userImages_div", r("#" + f.panel).append(q.runtime.ui.userImages.show())) : 0 === r("#pp_" + b + "-" + c).length ? (e = "pp_" + b + "-" + c, q.lib[b][c] && (r("#" + f.panel).append(d(q.lib[b][c].items, e, f.target)), f.current = e)) : (f.current = "pp_" + b + "-" + c, r("#" + f.current).show()), a.broadcast("update-scrolls", f.current))
    }

    function f(a, b) {
        var c = t.stripURL(a.url),
            d = "",
            e = "";
        return "user-images" === b && (d = "onmouseenter=\"jQuery('#pp-rmvbtn-" + c + "').css('display', 'inline'); jQuery('#pp-rmvbtn-" + c + "').show()\" onmouseleave=\"jQuery('#pp-rmvbtn-" + c + "').hide()\"", e = '<div data-type="pp-rmvBtn" class="pp-thumb-rmv-btn" rmvPath="' + a.url + '" id="pp-rmvbtn-' + c + '"><i class="pp-icon-remove_circle pp-med-icon pp-red-icon"></i></div>'), "svg" === t.getExtension(a.url) ? '<a id="pp-' + c + '" ' + d + ' class="pp-image-thumb-btn" ><img urldata="' + a.url + '" type="shape" target="' + b + '" id="' + c + '" src="' + a.url + '" type="image/svg+xml" class="pp-shape-thumbnail">' + e + "</a>" : "text-arts" === a.type ? '<a id="pp-' + c + '" ' + d + ' class="pp-image-thumb-btn" style="overflow: hidden" ><div type="text-arts" urldata="' + a.url + '" style="background-size: contain; background-image:url(\'' + a.thumbnail + '\')" class="pp-img-thumb-div"></div>' + e + "</a>" : '<a id="pp-' + c + '" ' + d + ' class="pp-image-thumb-btn" style="overflow: hidden" ><div style="background-image:url(\'' + a.thumbnail + '\')" class="pp-img-thumb-div"><img target="' + b + '" mHeight="' + a.height + '" mWidth="' + a.width + '" type="image" id="' + c + '" urldata="' + a.url + '" src="' + a.thumbnail + '" class="pp-image-thumbnail" ></div>' + e + "</a>"
    }

    function g(a) {
        o && "shape" !== o.attr("type") && (q.runtime.design.cPage.canvas.forEachObject(function(b) {
            1 > a && (b.oldAlpha = b.getOpacity()), b.setOpacity(1 == a ? b.oldAlpha : a)
        }), q.runtime.design.cPage.canvas.renderAll())
    }

    function h(a) {
        g(1), q.runtime.act.dragging = !1, p = !1
    }

    function i(a) {
        var b = r(a.data.target);
        b.attr("urldata") && 0 === b.closest(q.runtime.ui.panels.bg).length ? (o = b, q.runtime.act.dragging = !0) : (q.runtime.act.dragging = !1, p = !1)
    }

    function j(a) {
        p = !0, g(u)
    }

    function k(a) {
        if (q.runtime.act.dragging && (a.data.preventDefault(), "shape" !== o.attr("type"))) {
            var b = r(a.data.target).offset();
            q.runtime.design.cPage.canvas.forEachObject(function(c) {
                "shape" !== c.type && !c.drop_target || c.getIsReference() || (l(c.getBoundingRect(), {
                    x: a.data.originalEvent.pageX - b.left,
                    y: a.data.originalEvent.pageY - b.top
                }) && c.d ? (c.setOpacity(1), q.runtime.page.dTarget = c.drop_target || c) : 1 === c.getOpacity() && c.setOpacity(u), q.runtime.design.cPage.canvas.renderAll())
            })
        }
    }

    function l(a, b) {
        return b.x >= a.left && b.y >= a.top && b.x <= a.left + a.width && b.y < a.top + a.height
    }

    function m(a) {
        p = !1, q.runtime.page.dTarget = null, g(1)
    }

    function n(a) {
        a.data.preventDefault();
        var b = r(a.data.target).offset();
        q.runtime.act.dragging && p && s.fire("load-image", {
            type: o.attr("type"),
            id: o.attr("id"),
            url: o.attr("urldata"),
            width: o.attr("mWidth"),
            height: o.attr("mHeight"),
            x: a.data.originalEvent.pageX - b.left,
            y: a.data.originalEvent.pageY - b.top
        }), q.runtime.act.dragging = !1
    }
    var o, p, q = a.getGlobalConfig("model"),
        r = a.getGlobal("jQuery"),
        s = a.getGlobalConfig("events"),
        t = a.getService("utils"),
        u = .5;
    return s.on("start-item-drag", i), s.on("end-item-drag", h), s.on("drag-enter-stage", j), s.on("drag-over-stage", k), s.on("drag-leave-stage", m), s.on("drag-drop", n), {
        laySelector: function(a, b, d) {
            c(a, b, d)
        },
        appendToSelector: function(a, c, d) {
            b(a, c, d)
        },
        layImages: function(a, b, c) {
            return d(a, b, c)
        },
        changeImageCat: function(a) {
            e(a)
        },
        createThumb: function(a, b) {
            return f(a, b)
        }
    }
}), Box.Application.addService("pages", function(a) {
    "use strict";

    function b(b) {
        if (sa.runtime.act.colorItemMode) {
            if (sa.runtime.page.cItems.length) {
                var c = new Aa.ColorData("solid", [b.data]);
                switch (sa.runtime.page.cItems[0].type) {
                    case "i-text":
                    case "textbox":
                        sa.runtime.page.cItems.forEach(function(a) {
                            sa.runtime.design.undo.push({
                                target: a,
                                prop: "filldata",
                                val: {
                                    fill: a.fill,
                                    fillData: a.fillData
                                }
                            }), c = new Aa.ColorData("solid", [b.data]), sa.runtime.act.fontColFill ? (a.fill = c.colors[0].toWebString(), a.fillData.colorData = c) : (a.stroke = c.colors[0].toWebString(), a.fillData.strokeData || (a.fillData.strokeData = new Aa.StrokeData(1)), a.fillData.strokeData.fill.colors = [c.colors[0]], a.strokeWidth || (a.strokeWidth = 1, a.fillData.strokeData.width = 1))
                        }), a.broadcast("change-color-opt-index", 0);
                        break;
                    case "shape":
                        if (sa.runtime.page.cItems[0].paths)
                            for (var e = 0; e < sa.runtime.page.cItems[0].paths.length; e++) sa.runtime.page.cItems[0].paths[e].fill == sa.runtime.act.cArray[parseInt(sa.runtime.act.sColorOptIndex)] && (sa.runtime.design.undo.push({
                                target: sa.runtime.page.cItems[0],
                                prop: "filldata",
                                val: {
                                    idx: e,
                                    fill: sa.runtime.page.cItems[0].paths[e].fill,
                                    fillData: sa.runtime.page.cItems[0].fillData[sa.runtime.page.cItems[0].paths[e].fill]
                                }
                            }), sa.runtime.page.cItems[0].paths[e].fill = c.colors[0].toWebString(), sa.runtime.page.cItems[0].fillData[e].nValue = c.colors[0].toWebString(), sa.runtime.page.cItems[0].fillData[e].colorData = c.colors[0]);
                        else sa.runtime.page.cItems[0].fill == sa.runtime.act.cArray[parseInt(sa.runtime.act.sColorOptIndex)] && (sa.runtime.design.undo.push({
                            target: sa.runtime.page.cItems[0],
                            prop: "filldata",
                            val: {
                                idx: 0,
                                fill: sa.runtime.page.cItems[0].fill,
                                fillData: sa.runtime.page.cItems[0].fillData[sa.runtime.page.cItems[0].fill]
                            }
                        }), sa.runtime.page.cItems[0].fill = c.colors[0].toWebString(), sa.runtime.page.cItems[0].fillData[0].nValue = c.colors[0].toWebString(), sa.runtime.page.cItems[0].fillData[0].colorData = c.colors[0]);
                        sa.runtime.act.cArray[parseInt(sa.runtime.act.sColorOptIndex)] = c.colors[0].toWebString()
                }
                sa.runtime.design.cPage.canvas.renderAll()
            }
        } else sa.runtime.design.cPage && (d({
            fillType: "color",
            fillData: new Aa.FillData("color", new Aa.ColorData("solid", [b.data]))
        }), a.broadcast("update-ui"))
    }

    function c() {
        sa.runtime.act.colorItemMode && sa.runtime.page.cItem && sa.runtime.page.cItem instanceof fabric.IText && (0 == sa.runtime.act.sColorOptIndex ? sa.runtime.act.fontColFill ? sa.runtime.page.cItem.fill = sa.runtime.page.cItem.fillData.colorData.colors[0].toWebString() : (sa.runtime.page.cItem.stroke = sa.runtime.page.cItem.fillData.strokeData.fill.colors[0].toWebString(), sa.runtime.page.cItem.strokeWidth || (sa.runtime.page.cItem.strokeWidth = 1, sa.runtime.page.cItem.fillData.strokeData.width = 1)) : sa.runtime.act.fontColFill ? sa.runtime.page.cItem.setFill() : sa.runtime.page.cItem.setStroke(), sa.runtime.design.cPage.canvas.renderAll())
    }

    function d(a) {
        switch (sa.runtime.design.cPage.pageData.fillData.type = a.fillType, a.fillType) {
            case "color":
                "string" == typeof a.fillColor ? (sa.runtime.design.cPage.pageData.fillData.type = "color", sa.runtime.design.cPage.pageData.fillData.colorData.type = "solid", sa.runtime.design.cPage.pageData.fillData.colorData.colors[0] = sa.lib.colors[a.fillColor.split(",")[0]].colors[a.fillColor.split(",")[1]]) : sa.runtime.design.cPage.pageData.fillData = a.fillData;
                break;
            case "shape":
            case "image":
                sa.runtime.design.cPage.pageData.fillData.imageData = new Aa.ImageData(a.newUrl || a.url)
        }
        sa.runtime.design.cPage.updatePageBackground(!1, !1, a.url)
    }

    function e(a) {
        "bg-color" === a.data.target && sa.runtime.design.cPage ? "color" === sa.runtime.design.cPage.pageData.fillData.type && (sa.runtime.design.cPage.pageData.fillData.alpha = parseFloat(a.data.value), sa.runtime.design.cPage.updatePageBackground()) : (sa.runtime.design.undo.push({
            target: sa.runtime.design.cPage.canvas.getActiveObject() || sa.runtime.design.cPage.canvas.getActiveGroup(),
            prop: "opacity",
            val: (sa.runtime.design.cPage.canvas.getActiveObject() || sa.runtime.design.cPage.canvas.getActiveGroup()).opacity
        }), sa.runtime.design.undo.length > 1 && sa.runtime.design.undo[sa.runtime.design.undo.length - 1].prop === sa.runtime.design.undo[sa.runtime.design.undo.length - 2].prop && sa.runtime.design.undo[sa.runtime.design.undo.length - 1].target === sa.runtime.design.undo[sa.runtime.design.undo.length - 2].target && sa.runtime.design.undo.pop(), sa.runtime.page.cItems.forEach(function(b) {
            b.setOpacity(parseFloat(a.data.value))
        }), sa.runtime.design.cPage.canvas.renderAll())
    }

    function f(b) {
        "bg-color" === b.data && sa.runtime.design.cPage && "color" === sa.runtime.design.cPage.pageData.fillData.type && a.broadcast("opacity-set-slider", sa.runtime.design.cPage.pageData.fillData.alpha)
    }

    function g() {
        sa.runtime.design.cPage && (sa.runtime.design.cPage.canvas.discardActiveGroup(), sa.runtime.design.cPage.canvas.discardActiveObject()), sa.runtime.page.cItem = null, sa.runtime.page.cItems = [], a.broadcast("context-hide")
    }

    function h(b, c) {
        if (a.broadcast("page-select-start"), g(), sa.runtime.design.cPage) {
            if (sa.runtime.design.cPage.pageData.index === b) return;
            za("#" + sa.runtime.design.cPage.iCanvas.id).parent().detach()
        }
        if (b >= sa.runtime.design.pages.length && (b = 0), !(0 > b)) {
            if (c) {
                var d = document.createElement("img");
                d.src = sa.runtime.design.cPage.canvas.toDataURL(), sa.runtime.ui.pack.append(d), za(d).css({
                    top: sa.runtime.ui.stage.element.css("top"),
                    left: sa.runtime.ui.stage.element.css("left"),
                    position: "absolute"
                }), TweenLite.to(d, .5, {
                    ease: Power2.easeOut,
                    opacity: 0,
                    onComplete: function() {
                        za(d).remove()
                    }
                })
            }
            sa.runtime.design.cPage = sa.runtime.design.pages[b], sa.runtime.ui.stage.element.append(sa.runtime.design.cPage.parent), za(sa.runtime.design.cPage.parent).css({
                left: ua.getPixels(sa.runtime.design.cPage.pageData.canvasDimension.left) + "px",
                top: ua.getPixels(sa.runtime.design.cPage.pageData.canvasDimension.top) + "px"
            }), a.broadcast("stage-set-template"), a.broadcast("stage-resize"), sa.runtime.design.cPage.canvas.setDimensions({
                width: sa.runtime.design.cPage.canvas.getWidth(),
                height: sa.runtime.design.cPage.canvas.getHeight()
            }), sa.runtime.design.cPage.canvas.renderAll(), a.broadcast("page-select-end", b)
        }
    }

    function i(a) {
        a.set({
            clipTo: function(b) {
                var c = new fabric.Path(a.d);
                c.set({
                    originX: "center",
                    originY: "center",
                    left: (a.drop_target.getLeft() - a.getWidth() / 2 - a.getLeft()) / a.getScaleX() + a.drop_target.getScaleX() * c.pathOffset.x / a.getScaleX(),
                    top: (a.drop_target.getTop() - a.getHeight() / 2 - a.getTop()) / a.getScaleY() + a.drop_target.getScaleY() * c.pathOffset.y / a.getScaleY(),
                    scaleX: 1 / a.getScaleX() * a.drop_target.scaleX,
                    scaleY: 1 / a.getScaleY() * a.drop_target.scaleY,
                    perPixelTargetFind: !0,
                    angle: 360 - a.getAngle(),
                    opacity: 0,
                    fill: "none"
                }), c.render(b)
            }
        }), a.lockRotation = !0, a.hasRotatingPoint = !1, a.drop_target.img = a, a.drop_target.d = a.d, a.drop_target.scalex = a.drop_target.scaleX, a.drop_target.scaley = a.drop_target.scaleY
    }

    function j(b, c, d, e) {
        var f;
        switch (b.type) {
            case "image":
                if (!b.url && !b.src) return null;
                if (f = new fabric.Image(fabric.util.createImage()), f.visible = !1, f.d = b.d, b.maskShape && (f.drop_target = j(JSON.parse(b.maskShape), c, !1, f)), f.maskShape = b.maskShape, f.crossOrigin = "", f.isLoading = !0, f.reference = b.reference || ua.generateReference(), sa.runtime.act.eGroups === !0 && sa.runtime.act.cGroups.items.push({
                        id: f.getRef(),
                        type: "image"
                    }), f.url = b.url || b.src, c.canvas.add(f), d) f.setElement(b._element), f.d && b.clipTo && i(f), f.visible = f.isLoading = !0;
                else {
                    var g = ua.stripURL(b.url || b.src);
                    sa.runtime.act.globalLoadItems[g] = f, f.elementid = b.elementid, fabric.util.loadImage(ua.returnPath(b.url || b.src), function(a) {
                        a.id = f.elementid = ua.generateReference(), f.setElement(a), f.visible = !0, 1 == f.bg ? f.set({
                            width: f.canvas.width,
                            height: f.canvas.height
                        }) : void 0 != f.d && "" != f.d && null != f.d && void 0 != b.clipTo && "" != b.clipTo && null != b.clipTo && "function" == typeof f.drop_target.getLeft && i(f), f.calcDPIFnc(), f.setCoords(), f.canvas.renderAll(), f.isLoading = !1, sa.lib.config.lockAspect && f.setControlsVisibility({
                            mb: !1,
                            mt: !1,
                            mr: !1,
                            ml: !1
                        })
                    }, document, "")
                }
                f.set({
                    width: b.width,
                    height: b.height,
                    top: b.top,
                    left: b.left,
                    elementid: b.elementid,
                    opacity: isNaN(b.opacity) || null == b.opacity ? 1 : b.opacity,
                    scaleX: b.scaleX,
                    scaleY: b.scaleY,
                    angle: b.angle,
                    flipX: b.flipX,
                    flipY: b.flipY
                }), f.setCoords();
                break;
            case "shape":
                var h = b.index || c.canvas.getObjects().length;
                e && (f = {}), fabric.loadSVGFromString(b.rawsvg, function(d, g) {
                    if (f = fabric.util.groupSVGElements(d, g), f.isLoading = !0, f.type = "shape", f.rawsvg = b.rawsvg, f.url = b.src || b.url, f.clickMask = b.clickMask, c.canvas.add(f), f.set({
                            width: b.width,
                            height: b.height,
                            top: b.top,
                            left: b.left,
                            opacity: b.opacity,
                            scaleX: b.scaleX,
                            scaleY: b.scaleY,
                            angle: b.angle,
                            flipX: b.flipX,
                            flipY: b.flipY
                        }), sa.lib.config.lockAspect && f.setControlsVisibility({
                            mb: !1,
                            mt: !1,
                            mr: !1,
                            ml: !1
                        }), f.setCoords(), f.fillData = JSON.parse(JSON.stringify(b.fillData)), f.paths) {
                        1 === f.paths.length && (f.paths[0].setOpacity(1), f.d = f.paths[0].d);
                        for (var j = 0; j < f.fillData.length; j++) f.paths[j] && (f.fillData[j].colorData ? f.paths[j].fill = new Aa.Color(f.fillData[j].colorData.hex, new RGB(f.fillData[j].colorData.rgb.r, f.fillData[j].colorData.rgb.g, f.fillData[j].colorData.rgb.b)).toWebString() : void 0 !== f.fillData[j].oValue && (f.paths[j].fill = f.fillData[j].oValue))
                    } else f.fillData[0].colorData && (f.fill = new Aa.Color(f.fillData[0].colorData.hex, new RGB(f.fillData[0].colorData.rgb.r, f.fillData[0].colorData.rgb.g, f.fillData[0].colorData.rgb.b)).toWebString());
                    f.type = b.type, f.title = b.title, f.vd = b.vd, f.chain = b.chain, f.tLocked = 1 == b.tLocked, f.includeInForm = 1 == b.includeInForm, f.eLocked = b.eLocked === !0, f.isReference = b.isReference, f.hideContext = b.hideContext, f.reference = b.reference || ua.generateReference(), f.selectable = !(!sa.c.isAdmin && (1 == b.isReference || 1 == f.eLocked)), f.evented = !(!sa.c.isAdmin && (1 == b.isReference || 1 == f.eLocked)), sa.runtime.act.eGroups === !0 && sa.runtime.act.cGroups.items.push({
                        id: f.getRef(),
                        type: "shape"
                    }), sa.c.isAdmin || (f.lockMovementX = f.lockMovementY = f.lockRotation = f.lockScalingX = f.lockScalingY = 1 == f.tLocked), 1 != f.tLocked || sa.c.isAdmin || (f.cornerSize = 0), void 0 !== e ? (e.drop_target = f, c.canvas.remove(f), e.visible === !0 && (i(e), e.setCoords(), e.canvas.renderAll())) : f.moveTo(h), c.canvas.renderAll(), f.isLoading = !1, c === sa.runtime.design.cPage && a.broadcast("item-added-to-c-canvas")
                });
                break;
            case "i-text":
            case "textbox":
                var k = {
                    originX: b.originX,
                    fontFamily: b.fontFamily,
                    fontSize: b.fontSize,
                    fontStyle: b.fontStyle,
                    fontWeight: b.fontWeight,
                    lineHeight: -1 === b.text.indexOf("\n") && 1.3 == b.lineHeight ? 1 : b.lineHeight,
                    textAlign: b.textAlign,
                    fill: b.fill,
                    width: b.width,
                    height: b.height,
                    top: b.top,
                    left: b.left,
                    opacity: b.opacity,
                    textDecoration: b.textDecoration,
                    scaleX: b.scaleX,
                    scaleY: b.scaleY,
                    angle: b.angle,
                    flipX: b.flipX,
                    flipY: b.flipY,
                    editable: !0,
                    strokeWidth: b.stroke ? b.strokeWidth : 0,
                    stroke: b.stroke
                };
                if (f = "i-text" === b.type ? new fabric.IText(b.text, k) : new fabric.Textbox(b.text, k), c.canvas.add(f), "i-text" === b.type && f.setControlsVisibility({
                        mb: !1,
                        mt: !1,
                        mr: !1,
                        ml: !1
                    }), f.reference = b.reference || ua.generateReference(), sa.runtime.act.eGroups === !0 && sa.runtime.act.cGroups.items.push({
                        id: f.getRef(),
                        type: b.type
                    }), f.setCoords(), "undefined" != typeof b.fillData)
                    if (d) f.fillData = b.fillData.clone();
                    else {
                        var l = b.fillData.colorData ? new Aa.ColorData(b.fillData.colorData.type, ua.toColorData(b.fillData.colorData.colors), b.fillData.colorData.positions, b.fillData.colorData.alphas, b.fillData.colorData.rotation) : new Aa.ColorData;
                        f.fillData = new Aa.FillData(b.fillData.type, l, b.fillData.imageData ? new Aa.ImageData(b.fillData.imageData.url || "", b.fillData.imageData.thumbnail || "", b.fillData.imageData.fillmode || "", null, null, b.fillData.imageData.width || -1, b.fillData.imageData.height || -1) : new Aa.ImageData, b.fillData.strokeData ? new Aa.StrokeData(b.fillData.strokeData.width, b.fillData.strokeData.alpha, b.fillData.strokeData.type, null) : new Aa.StrokeData, b.fillData.alpha)
                    }
                else f.fillData = new Aa.FillData("color", new Aa.ColorData)
        }
        return f && (f.type = b.type, f.title = b.title, f.vd = b.vd, f.chain = b.chain, f.tLocked = 1 == b.tLocked, f.includeInForm = 1 == b.includeInForm, f.eLocked = b.eLocked === !0, f.isReference = b.isReference, f.hideContext = b.hideContext, f.selectable = !(!sa.c.isAdmin && (1 == b.isReference || 1 == f.eLocked)), f.evented = !(!sa.c.isAdmin && (1 == b.isReference || 1 == f.eLocked)), sa.c.isAdmin || (f.lockMovementX = f.lockMovementY = f.lockRotation = f.lockScalingX = f.lockScalingY = 1 == f.tLocked), 1 != f.tLocked || sa.c.isAdmin || (f.cornerSize = 0)), f
    }

    function k() {
        fabric.Object.NUM_FRACTION_DIGITS = 17, fabric.Object.prototype.setELock = function(a) {
            this.eLocked = a || !1
        }, fabric.Object.prototype.setTLock = function(a) {
            this.tLocked = a || !1
        }, fabric.Object.prototype.getELock = function() {
            return void 0 === this.eLocked ? !1 : this.eLocked
        }, fabric.Object.prototype.getTLock = function() {
            return void 0 === this.tLocked ? !1 : this.tLocked
        }, fabric.Object.prototype.setIncludeInForm = function(a) {
            this.includeInForm = a || ""
        }, fabric.Object.prototype.getIncludeInForm = function() {
            return void 0 === this.includeInForm ? "" : this.includeInForm
        }, fabric.Object.prototype.setIsReference = function(a) {
            this.isReference = a || !1
        }, fabric.Object.prototype.getIsReference = function() {
            return void 0 === this.isReference ? !1 : this.isReference
        }, fabric.Object.prototype.setHideContext = function(a) {
            this.hideContext = a || !1
        }, fabric.Object.prototype.getHideContext = function() {
            return void 0 === this.hideContext ? !1 : this.hideContext
        }, fabric.Object.prototype.setTitle = function(a) {
            this.title = a || ""
        }, fabric.Object.prototype.getTitle = function() {
            return void 0 === this.title ? "" : this.title
        }, fabric.Object.prototype.setChain = function(a) {
            this.chain = a || ""
        }, fabric.Object.prototype.getChain = function() {
            return void 0 === this.chain ? "" : this.chain
        }, fabric.Object.prototype.setRef = function(a) {
            this.reference = a || ""
        }, fabric.Object.prototype.getRef = function() {
            return void 0 === this.reference && (this.reference = "C" + ua.generateReference()), this.reference
        }, fabric.Object.prototype.getClickMask = function() {
            return this.clickMask
        }, fabric.Object.prototype.setClickMask = function(a) {
            this.clickMask = a
        }, fabric.IText.prototype.caching = fabric.Textbox.prototype.caching = !1, fabric.Canvas.prototype.getObjectByReference = function(a) {
            for (var b = this.getObjects(), c = 0; c < b.length; c++)
                if (b[c].reference === a) return b[c]
        }, fabric.Object.prototype.cornerColor = sa.lib.config.anchorFillColor, fabric.Object.prototype.cornerStrokeColor = sa.lib.config.anchorStrokeColor, fabric.Object.prototype.cornerStyle = "rect", fabric.Object.prototype.transparentCorners = !1, W2P.isMobile ? fabric.Object.prototype.cornerSize = sa.lib.config.anchorMobileSize - 5 : fabric.Object.prototype.cornerSize = sa.lib.config.anchorDesktopSize, fabric.Object.prototype.controlsAboveOverlay = !0, fabric.Object.prototype.originX = "left", fabric.Object.prototype.originY = "top", fabric.Object.prototype.setFSize = function(a) {
            return this instanceof fabric.IText && !isNaN(a) ? (this.scaleX = this.scaleY = a / 40 * this.canvas.pageData.scaling * sa.runtime.design.cScaling, this.canvas.renderAll(), a) : void 0
        }, fabric.Object.prototype.getFSize = function() {
            return this instanceof fabric.IText ? sa.lib.config.decimalPointTextSize ? Math.round(40 * this.getScaleX() / (this.canvas.pageData.scaling * sa.runtime.design.cScaling) * 10) / 10 : parseInt(40 * this.getScaleX() / (this.canvas.pageData.scaling * sa.runtime.design.cScaling)) : void 0
        }, fabric.Image.prototype.beforeScaleFnc = m, fabric.Image.prototype.calcDPIFnc = l
    }

    function l(a) {
        sa.lib.config.dpiCheck && sa.lib.config.dpiValue && (this.maxScaleLimit = Math.min(this.height / sa.lib.config.dpiValue / ua.getInches(parseFloat(this.canvas.pageData.fHeight)), this.width / sa.lib.config.dpiValue / ua.getInches(parseFloat(this.canvas.pageData.fWidth))) / sa.runtime.design.cScaling * this.canvas.pageData.scaling, a || this.set({
            scaleX: this.scaleX,
            scaleY: this.scaleY
        }))
    }

    function m(a, b, c) {
        if (!sa.runtime.page || !b) return a;
        if (!sa.runtime.page.cItem) return a;
        if ("function" == typeof sa.runtime.page.cItem.clipTo) {
            var d = (sa.runtime.page.cItem.getScaleX() - a) * sa.runtime.page.cItem.width,
                e = (sa.runtime.page.cItem.getScaleY() - a) * sa.runtime.page.cItem.height;
            if ("ml" === b && "scaleX" === c && d + sa.runtime.page.cItem.left > sa.runtime.page.cItem.drop_target.left) return sa.runtime.page.cItem.getScaleX();
            if (("tl" === b || "bl" === b) && "scaleX" === c && (d + sa.runtime.page.cItem.left > sa.runtime.page.cItem.drop_target.left || e + sa.runtime.page.cItem.top > sa.runtime.page.cItem.drop_target.top)) return sa.runtime.page.cItem.getScaleX();
            if ("mt" === b && "scaleY" === c && e + sa.runtime.page.cItem.top > sa.runtime.page.cItem.drop_target.top) return sa.runtime.page.cItem.getScaleY();
            if (("tl" === b || "tr" === b) && "scaleY" === c && (e + sa.runtime.page.cItem.top > sa.runtime.page.cItem.drop_target.top || d + sa.runtime.page.cItem.left > sa.runtime.page.cItem.drop_target.left)) return sa.runtime.page.cItem.getScaleY();
            if ("mr" === b && "scaleX" === c && sa.runtime.page.cItem.left + sa.runtime.page.cItem.getWidth() - d < sa.runtime.page.cItem.drop_target.left + sa.runtime.page.cItem.drop_target.getWidth()) return sa.runtime.page.cItem.getScaleX();
            if (("br" === b || "mr" === b || "tr" === b) && "scaleX" === c && (sa.runtime.page.cItem.left + sa.runtime.page.cItem.getWidth() - d < sa.runtime.page.cItem.drop_target.left + sa.runtime.page.cItem.drop_target.getWidth() || sa.runtime.page.cItem.top + sa.runtime.page.cItem.getHeight() - e < sa.runtime.page.cItem.drop_target.top + sa.runtime.page.cItem.drop_target.getHeight())) return sa.runtime.page.cItem.getScaleX();
            if ("mb" === b && "scaleY" === c && sa.runtime.page.cItem.top + sa.runtime.page.cItem.getHeight() - e < sa.runtime.page.cItem.drop_target.top + sa.runtime.page.cItem.drop_target.getHeight()) return sa.runtime.page.cItem.getScaleY();
            if (("bl" === b || "mb" === b || "br" === b) && "scaleY" === c && (sa.runtime.page.cItem.top + sa.runtime.page.cItem.getHeight() - e < sa.runtime.page.cItem.drop_target.top + sa.runtime.page.cItem.drop_target.getHeight() || sa.runtime.page.cItem.left + sa.runtime.page.cItem.getWidth() - d < sa.runtime.page.cItem.drop_target.left + sa.runtime.page.cItem.drop_target.getWidth())) return sa.runtime.page.cItem.getScaleY()
        }
        return a
    }

    function n(b, c, d, e, f) {
        if ("shape" === b) sa.runtime.act.appReady && a.broadcast("alert-processing", sa.lib.lang.loading_shape), va.fetchPost(sa.server.taskServer + "?t=fetchsvg", {
            path: ua.returnPath(c)
        }, function(b) {
            fabric.loadSVGFromString(b.data, function(g, h) {
                var i = fabric.util.groupSVGElements(g, h);
                if (i.type = "shape", i.fillData = [], i.paths) {
                    1 === i.paths.length && (i.setOpacity(i.paths[0].opacity), i.paths[0].setOpacity(1), i.d = i.paths[0].d);
                    for (var j = 0; j < i.paths.length; j++) i.fillData[j] = {
                        oValue: i.paths[j].fill,
                        nValue: i.paths[j].fill
                    }
                } else i.fillData[0] = {
                    oValue: i.fill,
                    nValue: i.fill
                };
                i.id = ua.generateReference(), i.url = ua.returnPath(c), i.rawsvg = b.data, e && (e.add(i), f && i.set(f), i.setCoords(), e.renderAll()), sa.lib.config.lockAspect && i.setControlsVisibility({
                    mb: !1,
                    mt: !1,
                    mr: !1,
                    ml: !1
                }), "function" == typeof d && d(i), sa.runtime.act.appReady && a.broadcast("alert-hide")
            })
        }, void 0, void 0, !0);
        else if ("image" === b) {
            if (sa.runtime.act.appReady && a.broadcast("alert-processing", sa.lib.lang.loading_image), e) {
                var g = ua.stripURL(c),
                    h = new fabric.Image(fabric.util.createImage());
                if (sa.runtime.act.globalLoadItems[g] = h, h.elementid = g, za("#" + g).length) {
                    var i = document.getElementById(g);
                    h.setElement(i), h.set({
                        width: parseInt(za(i).attr("mWidth")),
                        height: parseInt(za(i).attr("mHeight"))
                    })
                }
                h.crossOrigin = "", h.setCoords(), h.url = ua.returnPath(c), e.add(h), sa.lib.config.lockAspect && h.setControlsVisibility({
                    mb: !1,
                    mt: !1,
                    mr: !1,
                    ml: !1
                }), "function" == typeof d && za("#" + g).length && d(h)
            }
            fabric.util.loadImage(ua.returnPath(c), function(b) {
                e && (b.id = h.elementid = ua.generateReference(), h.setElement(b), f && h.set(f), h.calcDPIFnc(), h.setCoords(), h.canvas.renderAll(), h.perPixelTargetFind = !0), "function" == typeof d && 0 === za("#" + g).length && d(h || b), sa.runtime.act.appReady && a.broadcast("alert-hide")
            }, document, "")
        }
    }

    function o(b, c) {
        !c && b.data.canvas && (c = b.data.canvas);
        var d = za("#" + b.data.id).length ? za("#" + b.data.id).closest(sa.runtime.ui.panels.bg).length > 0 : !1;
        n(b.data.type, b.data.url, function(e) {
            if (d) p({
                data: {
                    url: b.data.url,
                    type: b.data.type,
                    newImg: e,
                    target: "bg"
                }
            });
            else if (sa.runtime.page.dTarget || b.data.targetShape) {
                if (sa.runtime.page.dTarget || (sa.runtime.page.dTarget = b.data.targetShape), e.drop_target = sa.runtime.page.dTarget, e.d = sa.runtime.page.dTarget.d, e.calcDPIFnc(!0), !ua.checkMaskDpi(e.drop_target, parseFloat(b.data.width || e.width) * e.maxScaleLimit, parseFloat(b.data.height || e.height) * e.maxScaleLimit)) return (c || sa.runtime.design.cPage.canvas).remove(e), a.broadcast("flash-show", {
                    text: sa.lib.lang.image_low_res || "Sorry, Photo is of low resolution",
                    icon: "error",
                    delay: 4e3
                }), va.fetchPost("delete-asset", {
                    path: b.data.url
                }), void a.broadcast("update-uploaders");
                if (sa.runtime.page.dTarget.img) e.moveTo((c || sa.runtime.design.cPage.canvas).getObjects().indexOf(sa.runtime.page.dTarget.img)), e.maskShape = sa.runtime.page.dTarget.img.maskShape, (c || sa.runtime.design.cPage.canvas).remove(sa.runtime.page.dTarget.img);
                else {
                    var f = U(sa.runtime.page.dTarget);
                    f.opacity = sa.runtime.page.dTarget.oldAlpha, e.maskShape = JSON.stringify(f), sa.runtime.page.dTarget.iniLeft = sa.runtime.page.dTarget.getLeft(), sa.runtime.page.dTarget.iniTop = sa.runtime.page.dTarget.getTop(), sa.runtime.page.dTarget.scalex = sa.runtime.page.dTarget.getScaleX(), sa.runtime.page.dTarget.scaley = sa.runtime.page.dTarget.getScaleY(), sa.runtime.page.dTarget.angle = sa.runtime.page.dTarget.getAngle(), e.moveTo(e.canvas.getObjects().indexOf(sa.runtime.page.dTarget)), e.canvas.remove(sa.runtime.page.dTarget)
                }
                var g = e.width / e.drop_target.getWidth() < e.height / e.drop_target.getHeight() ? e.drop_target.width * e.drop_target.getScaleX() / e.getWidth() : e.drop_target.height * e.drop_target.getScaleY() / e.getHeight();
                if (e.set({
                        clipTo: function(a) {
                            e.setCoords();
                            var b = new fabric.Path(e.drop_target.d);
                            b.set({
                                originX: "center",
                                originY: "center",
                                left: (e.drop_target.getLeft() - e.getWidth() / 2 - e.getLeft()) / e.getScaleX() + e.drop_target.getScaleX() * b.pathOffset.x / e.getScaleX(),
                                top: (e.drop_target.getTop() - e.getHeight() / 2 - e.getTop()) / e.getScaleY() + e.drop_target.getScaleY() * b.pathOffset.y / e.getScaleY(),
                                scaleX: 1 / e.getScaleX() * e.drop_target.getScaleX(),
                                scaleY: 1 / e.getScaleY() * e.drop_target.getScaleY(),
                                flipX: e.drop_target.getFlipX(),
                                flipY: e.drop_target.getFlipY(),
                                perPixelTargetFind: !0,
                                angle: 360 - e.getAngle(),
                                opacity: 0,
                                fill: "none"
                            }), b.render(a)
                        },
                        left: e.drop_target.left - (g * e.getWidth() / 2 - e.drop_target.width * e.drop_target.getScaleX() / 2),
                        top: e.drop_target.top - (g * e.getHeight() / 2 - e.drop_target.height * e.drop_target.getScaleY() / 2),
                        angle: e.drop_target.angle,
                        scaleX: g,
                        scaleY: g
                    }), e.lockRotation = !0, e.hasRotatingPoint = !1, e.drop_target.img = e, sa.lib.config.lockAspect && e.setControlsVisibility({
                        mb: !1,
                        mt: !1,
                        mr: !1,
                        ml: !1
                    }), e.setCoords(), e.canvas && e.canvas.renderAll(), !b.data.slave && sa.runtime.page.dTarget.chain && !b.data.ignoreChains) {
                    var h = sa.runtime.page.dTarget.chain;
                    sa.runtime.page.dTarget = null, b.data.slave = !0, ua.findItems(null, null, null, h).forEach(function(a) {
                        b.data.targetShape = a, o(b, a.canvas)
                    })
                }
                sa.runtime.page.dTarget = null, setTimeout(function() {
                    a.broadcast("item-added-to-c-canvas", b)
                }, 300)
            } else {
                if ("function" == typeof e.calcDPIFnc && e.calcDPIFnc(), ua.scaleToCanvas(e, sa.runtime.design.cPage.canvas), b.data.x && b.data.y) e.set({
                    left: b.data.x - 45,
                    top: b.data.y - 45,
                    opacity: 1
                }), e.setCoords(), sa.runtime.design.cPage.canvas.setActiveObject(e).renderAll();
                else {
                    var i = e.getTop(),
                        j = sa.runtime.design.cPage.canvas.height / 4;
                    e.set({
                        top: j > i ? 0 : j,
                        opacity: 0
                    }), e.animate("opacity", 1, {
                        duration: 250
                    }), e.animate("top", i, {
                        onChange: sa.runtime.design.cPage.canvas.renderAll.bind(sa.runtime.design.cPage.canvas),
                        duration: 300,
                        onComplete: function() {
                            e.setCoords(), sa.runtime.design.cPage.canvas.setActiveObject(e).renderAll()
                        }
                    })
                }
                sa.runtime.design.undo.push({
                    target: sa.runtime.design.cPage.canvas,
                    prop: "remove",
                    val: e
                }), setTimeout(function() {
                    a.broadcast("image-added-to-c-canvas", {
                        clicked: b.data.clicked,
                        image: e
                    })
                }, 500)
            }
        }, d ? void 0 : c || sa.runtime.design.cPage.canvas, null, b.data.callSecond), a.broadcast("update-ui")
    }

    function p(b) {
        switch (b.data.target) {
            case "bg":
                var c = b.data.pageIndex ? sa.runtime.design.pages[b.data.pageIndex] : sa.runtime.design.cPage;
                c.pageData.fillData.type = b.data.type, c.pageData.fillData.imageData = new Aa.ImageData(b.data.url), c.updatePageBackground(!1, !1, b.data.newImg), a.broadcast("page-bg-changed");
                break;
            default:
                b.data.target.setElement(b.data.newImg), b.data.target.setCoords(), b.data.target.url = b.data.url, b.data.target.canvas.renderAll(), ta.fire("image-set", b.data.target)
        }
    }

    function q(b) {
        if (ta.fire("discard-selection"), b) {
            if (sa.runtime.design.cPage.pageData.scaling <= .2 && "-" === b) return;
            b = "+" === b ? .1 : -.1, sa.runtime.design.cPage.pageData.scaling += b
        }
        if (W2P.isMobile || sa.runtime.design.cPage.pageData.templateSource) sa.runtime.design.cPage.renderWithScale();
        else {
            var c = document.createElement("img");
            c.src = sa.runtime.design.cPage.canvas.toDataURL(), sa.runtime.ui.stage.element.css("opacity", 0), za(c).insertAfter(".pp-stage"), za(c).css({
                top: sa.runtime.ui.stage.element.css("top"),
                left: sa.runtime.ui.stage.element.css("left"),
                width: sa.runtime.ui.stage.element.css("width"),
                height: sa.runtime.ui.stage.element.css("height"),
                position: "absolute"
            }), sa.runtime.design.cPage.renderWithScale(), TweenLite.to(c, .5, {
                ease: Power2.easeOut,
                top: sa.runtime.ui.stage.element.css("top"),
                left: sa.runtime.ui.stage.element.css("left"),
                width: sa.runtime.ui.stage.element.width(),
                height: sa.runtime.ui.stage.element.height(),
                onComplete: function() {
                    sa.runtime.ui.stage.element.css("opacity", 1), za(c).remove()
                }
            })
        }
        a.broadcast("after-zoom")
    }

    function r(a) {
        q(a.data)
    }

    function s() {
        sa.runtime.design.pages && (sa.runtime.design.pages.forEach(function(a) {
            a.scaleToFit(!0)
        }), sa.runtime.design.cPage && setTimeout(function() {
            sa.runtime.design.cPage.refreshBackground()
        }, 1e3))
    }

    function t() {
        sa.runtime.design.cPage.canvas.getActiveObject() ? (sa.runtime.page.cItems = [sa.runtime.design.cPage.canvas.getActiveObject()], sa.runtime.page.cItem = sa.runtime.design.cPage.canvas.getActiveObject()) : sa.runtime.design.cPage.canvas.getActiveGroup() ? (sa.runtime.page.cItems = sa.runtime.design.cPage.canvas.getActiveGroup()._objects, sa.runtime.page.cItem = null) : (sa.runtime.page.cItems = [], sa.runtime.page.cItem = null)
    }

    function u(b) {
        b.data.e && "mousedown" === b.data.e.type || (t(), sa.runtime.page.cItems.length && (sa.runtime.page.cItem ? sa.runtime.act.isEditing || a.broadcast("context-show") : sa.runtime.page.cItems.length > 1 && a.broadcast("context-show"), a.broadcast("canvas-object-selected", b.data)))
    }

    function v(b) {
        if (a.broadcast("canvas-up"), sa.runtime.act.caretMode) {
            a.broadcast("alert-info", sa.lib.lang.text_added), g();
            var c = new fabric.IText(sa.lib.config.default_new_text_string, {
                left: b.data.e.offsetX || b.data.e.layerX,
                top: b.data.e.offsetY || b.data.e.layerY,
                fontFamily: sa.runtime.act.cFont.fontFamily,
                editable: !0,
                strokeWidth: 0
            });
            c.setControlsVisibility({
                mb: !1,
                mt: !1,
                mr: !1,
                ml: !1
            }), sa.runtime.design.cPage.canvas.add(c), sa.runtime.design.cPage.canvas.setActiveObject(c), sa.runtime.page.cItem = sa.runtime.page.cItems[0] = c, sa.runtime.page.cItem.fillData = new Aa.FillData("color", sa.runtime.design.newTextColor.clone(), null, new Aa.StrokeData(0)), sa.runtime.page.cItem.fill = sa.runtime.design.newTextColor.colors[0].toWebString(), sa.runtime.act.eGroups === !0 && sa.runtime.act.cGroups.items.push({
                id: sa.runtime.page.cItem.getRef(),
                type: sa.runtime.page.cItem.type
            }), c.setCoords(), sa.runtime.design.cPage.canvas.renderAll(), setTimeout(function() {
                a.broadcast("context-show"), a.broadcast("show-text-editor")
            }, 500), B(), sa.runtime.act.initialText = c.text, sa.runtime.design.undo.push({
                target: sa.runtime.design.cPage.canvas,
                prop: "remove",
                val: c
            })
        }
        aa()
    }

    function w(b) {
        a.broadcast("context-hide"), a.broadcast("canvas-down"), sa.runtime.act.initialText = null, (sa.runtime.design.cPage.canvas.getActiveObject() || sa.runtime.design.cPage.canvas.getActiveGroup()) && (sa.runtime.act.initialProps = ua.captureProps(sa.runtime.design.cPage.canvas.getActiveObject() || sa.runtime.design.cPage.canvas.getActiveGroup()), sa.runtime.design.cPage.canvas.getActiveObject() && sa.runtime.design.cPage.canvas.getActiveObject() instanceof fabric.IText && (sa.runtime.act.initialText = sa.runtime.design.cPage.canvas.getActiveObject().text))
    }

    function x(b) {
        t(), a.broadcast("context-hide"), a.broadcast("canvas-object-cleared")
    }

    function y(b) {
        a.broadcast("context-hide"), a.broadcast("canvas-object-modified"), t(), sa.runtime.act.initialProps && sa.runtime.design.undo.push({
            target: sa.runtime.design.cPage.canvas.getActiveObject() || sa.runtime.design.cPage.canvas.getActiveGroup(),
            prop: "transform",
            val: sa.runtime.act.initialProps
        })
    }

    function z(b) {
        sa.runtime.act.initialText && sa.runtime.design.undo.push({
            target: sa.runtime.design.cPage.canvas.getActiveObject(),
            prop: "text",
            val: sa.runtime.act.initialText
        }), sa.runtime.act.initialText = null, sa.runtime.page.cItem.chain && L(sa.runtime.page.cItem), a.broadcast("canvas-text-changed", sa.runtime.page.cItem.getRef())
    }

    function A(b) {
        sa.runtime.page.cItem && ("i-text" === sa.runtime.page.cItem.type && a.broadcast("flash-show", {
            text: sa.runtime.page.cItem.getFSize(),
            icon: "font-size"
        }), a.broadcast("canvas-object-scaled"))
    }

    function B() {
        if (!(!sa.runtime.page.cItem instanceof fabric.IText)) {
            var b = ua.getFont(sa.runtime.page.cItem.fontFamily);
            b && (b.bold === !0 ? (za("[data-type='ctx-text-bold']").removeClass("pp-btn-greyed").children().removeClass("pp-btn-greyed"), "bold" === sa.runtime.page.cItem.getFontWeight() ? za("[data-type='ctx-text-bold']").addClass("pp-btn-selected-hot") : za("[data-type='ctx-text-bold']").removeClass("pp-btn-selected-hot")) : za("[data-type='ctx-text-bold']").removeClass("pp-btn-selected-hot").addClass("pp-btn-greyed").children().addClass("pp-btn-greyed"), b.italic === !0 ? (za("[data-type='ctx-text-italic']").removeClass("pp-btn-greyed").children().removeClass("pp-btn-greyed"), "italic" === sa.runtime.page.cItem.getFontStyle() ? za("[data-type='ctx-text-italic']").addClass("pp-btn-selected-hot") : za("[data-type='ctx-text-italic']").removeClass("pp-btn-selected-hot")) : (za("[data-type='ctx-text-italic']").removeClass("pp-btn-selected-hot"), za("[data-type='ctx-text-italic']").addClass("pp-btn-greyed").children().addClass("pp-btn-greyed")), "underline" === sa.runtime.page.cItem.getTextDecoration() ? za("[data-type='ctx-text-underline']").addClass("pp-btn-selected-hot") : za("[data-type='ctx-text-underline']").removeClass("pp-btn-selected-hot"), "i-text" === sa.runtime.page.cItem.type ? za("[data-type='ctx-toggle-textbox']").addClass("pp-btn-selected-hot") : za("[data-type='ctx-toggle-textbox']").removeClass("pp-btn-selected-hot"), za("[data-type='ctx-text-left'], [data-type='ctx-text-right'], [data-type='ctx-text-center']").removeClass("pp-btn-selected-hot"), za("[data-type='ctx-text-" + sa.runtime.page.cItem.getTextAlign() + "']").addClass("pp-btn-selected-hot"), za(".pp-context-font-div").html(sa.runtime.page.cItem.fontFamily).css({
                "font-family": sa.runtime.page.cItem.fontFamily
            }).attr("title", sa.runtime.page.cItem.fontFamily), za("[data-type='font-size']").is(":focus") && sa.lib.config.decimalPointTextSize || za("[data-type='font-size']").val(sa.runtime.page.cItem.getFSize()), za("[data-type='font-linespacing']").val(parseInt(10 * sa.runtime.page.cItem.getLineHeight()) - 10), za("[data-type='font-stroke']").val(10 * (sa.runtime.page.cItem.getStrokeWidth() || 0)), a.broadcast("text-prop-synced"))
        }
    }

    function C() {
        (sa.runtime.design.cPage.canvas.getActiveObject() || sa.runtime.design.cPage.canvas.getActiveGroup()) && (D(), I())
    }

    function D() {
        if (sa.runtime.design.cPage.canvas.getActiveObject()) sa.runtime.act.clipBoard = [sa.runtime.design.cPage.canvas.getActiveObject().toObject(ra)], sa.runtime.act.clipBoardGroup = null, a.broadcast("show-paste-btn");
        else if (sa.runtime.design.cPage.canvas.getActiveGroup()) {
            var b = sa.runtime.design.cPage.canvas.getActiveGroup();
            sa.runtime.act.clipBoardGroup = {
                top: b.top,
                left: b.left
            }, b = b._objects, sa.runtime.act.clipBoard = [];
            for (var c = 0, d = b.length; d > c; c++) sa.runtime.act.clipBoard.push(b[c].toObject(ra));
            a.broadcast("show-paste-btn")
        }
    }

    function E(a, b) {
        if ("image" === a.type && a.d && "" != a.d && a.clipTo && "" != a.clipTo) {
            var c = "string" == typeof a.maskShape ? JSON.parse(a.maskShape) : a.maskShape;
            c.index = sa.runtime.design.cPage.canvas.getObjects().indexOf(a);
            var d = j(c, sa.runtime.design.cPage, !1);
            sa.runtime.design.undo.push({
                target: a.canvas,
                prop: "remove",
                val: d
            })
        }
        if (sa.runtime.design.undo.push({
                target: a,
                prop: "depth",
                val: sa.runtime.design.cPage.canvas.getObjects().indexOf(a)
            }), sa.runtime.design.undo.push({
                target: a.canvas,
                prop: "add",
                val: a
            }), sa.runtime.design.cPage.canvas.discardActiveObject(), b) sa.runtime.design.cPage.canvas.remove(a);
        else {
            var e = a.top,
                f = a.opacity;
            setTimeout(function() {
                a.animate("top", sa.runtime.design.cPage.canvas.height, {
                    onChange: sa.runtime.design.cPage.canvas.renderAll.bind(sa.runtime.design.cPage.canvas),
                    duration: 200,
                    onComplete: function() {
                        sa.runtime.design.cPage.canvas.remove(a), a.set({
                            top: e,
                            opacity: f
                        })
                    }
                }), a.animate("opacity", 0, {
                    duration: 100
                })
            }, 50)
        }
    }

    function F(b) {
        if (a.broadcast("context-hide"), sa.runtime.design.cPage && (sa.runtime.design.cPage.canvas.getActiveGroup() || sa.runtime.design.cPage.canvas.getActiveObject())) {
            if (sa.runtime.design.cPage.canvas.getActiveGroup()) {
                var c = sa.runtime.design.cPage.canvas.getActiveGroup()._objects;
                g();
                for (var d = 0, e = c.length; e > d; d++) E(c.pop(), b)
            } else sa.runtime.design.cPage.canvas.getActiveObject() && E(sa.runtime.design.cPage.canvas.getActiveObject(), b);
            sa.runtime.design.cPage.canvas.renderAll()
        }
    }

    function G() {
        D(), F(!0)
    }

    function H(a, b) {
        var c, d = [],
            e = ua.generateReference();
        a.forEach(function(a) {
            a.reference = ua.generateReference(), a.gr = e, d.push(a.reference), j(a, sa.runtime.design.cPage, !b)
        }), setTimeout(function() {
            var a = [],
                f = [];
            sa.runtime.design.cPage.canvas._objects.forEach(function(b) {
                d.indexOf(b.reference) > -1 && b.reference && a.push(b)
            }), d.forEach(function(b) {
                f.push(ua.fetchItemFrmArray(a, "reference", b))
            }), a.forEach(function(a) {
                sa.runtime.design.cPage.canvas.remove(a)
            }), c = new fabric.Group(f, {
                originX: "left",
                originY: "top"
            }), sa.runtime.design.cPage.canvas.add(c), b ? ua.scaleToCanvas(c, sa.runtime.design.cPage.canvas, !0) : (sa.runtime.design.cPage.canvas.centerObject(c), c.setCoords()), sa.runtime.design.cPage.canvas.setActiveObject(c), sa.runtime.design.cPage.canvas.renderAll(), sa.runtime.act.eGroups === !0 && sa.runtime.act.cGroups.items.push({
                id: sa.runtime.page.cItem.getRef(),
                type: "group"
            }), c.groupId = e
        }, 150), setTimeout(function() {
            sa.runtime.design.cPage.canvas.renderAll()
        }, 1e3)
    }

    function I() {
        for (var a, b, c = 0; c < sa.runtime.act.clipBoard.length; c++) b = sa.runtime.act.clipBoard[c], sa.runtime.act.clipBoardGroup ? (b.top = sa.runtime.act.clipBoardGroup.top + b.top + 5, b.left = sa.runtime.act.clipBoardGroup.left + b.left + 5) : (b.top += 5, b.left += 5), "group" === b.type ? H(b.objects) : a = j(b, sa.runtime.design.cPage, !0), a && (sa.runtime.design.undo.push({
            target: sa.runtime.design.cPage.canvas,
            prop: "remove",
            val: a
        }), a.setCoords());
        1 === sa.runtime.act.clipBoard.length && "undefined" != typeof a && sa.runtime.design.cPage.canvas.setActiveObject(a), sa.runtime.design.cPage.canvas.renderAll()
    }

    function J(a) {
        var b, c = 5,
            d = 5;
        if (sa.runtime.design.undo.push({
                target: sa.runtime.design.cPage.canvas.getActiveObject() || sa.runtime.design.cPage.canvas.getActiveGroup(),
                prop: "transform",
                val: ua.captureProps(sa.runtime.design.cPage.canvas.getActiveObject() || sa.runtime.design.cPage.canvas.getActiveGroup())
            }), sa.runtime.design.cPage.canvas.getActiveObject()) switch (b = sa.runtime.design.cPage.canvas.getActiveObject(), a.data) {
            case "left":
                sa.runtime.design.cPage.pageData.bleed[0] && (c += ua.getPixels(sa.runtime.design.cPage.pageData.bleed[0])), b instanceof fabric.IText && "right" === b.textAlign ? b.setLeft(c + b.getBoundingRectWidth()) : b instanceof fabric.IText && "center" === b.textAlign ? b.setLeft(c + b.getBoundingRectWidth() / 2) : b.setLeft(c), b.setCoords();
                break;
            case "right":
                c = ua.getPixels(sa.runtime.design.cPage.pageData.fWidth) - c, sa.runtime.design.cPage.pageData.bleed[1] && (c -= ua.getPixels(sa.runtime.design.cPage.pageData.bleed[1])), b instanceof fabric.IText && "right" === b.textAlign ? b.setLeft(c) : b instanceof fabric.IText && "center" === b.textAlign ? b.setLeft(c - b.getBoundingRectWidth() / 2) : b.setLeft(c - sa.runtime.design.cPage.canvas.getActiveObject().getBoundingRectWidth()), b.setCoords();
                break;
            case "vertical":
                sa.runtime.design.cPage.canvas.centerObjectH(b), b.setCoords();
                break;
            case "top":
                sa.runtime.design.cPage.pageData.bleed[2] && (d += ua.getPixels(sa.runtime.design.cPage.pageData.bleed[2])), b.setTop(d), b.setCoords();
                break;
            case "bottom":
                d = ua.getPixels(sa.runtime.design.cPage.pageData.fHeight) - d, sa.runtime.design.cPage.pageData.bleed[3] && (d -= ua.getPixels(sa.runtime.design.cPage.pageData.bleed[3])), b.setTop(d - b.getBoundingRectHeight()), b.setCoords();
                break;
            case "horizontal":
                sa.runtime.design.cPage.canvas.centerObjectV(b), b.setCoords()
        } else if (sa.runtime.design.cPage.canvas.getActiveGroup()) {
            switch (b = sa.runtime.design.cPage.canvas.getActiveGroup(), a.data) {
                case "left":
                    for (var e = 0; e < b._objects.length; e++) b._objects[e] instanceof fabric.IText && "right" === b._objects[e].textAlign ? b._objects[e].setLeft(b._objects[e].getBoundingRectWidth() - b.width / 2) : b._objects[e] instanceof fabric.IText && "center" === b._objects[e].textAlign ? b._objects[e].setLeft(-(b.width / 2 - b._objects[e].getBoundingRectWidth() / 2)) : b._objects[e].setLeft(-b.width / 2);
                    break;
                case "right":
                    for (e = 0; e < b._objects.length; e++) b._objects[e] instanceof fabric.IText && "right" === b._objects[e].textAlign ? b._objects[e].setLeft(b.width / 2) : b._objects[e] instanceof fabric.IText && "center" === b._objects[e].textAlign ? b._objects[e].setLeft(b.width / 2 - b._objects[e].getBoundingRectWidth() / 2) : b._objects[e].setLeft(b.width / 2 - b._objects[e].getBoundingRectWidth());
                    break;
                case "vertical":
                    for (e = 0; e < b._objects.length; e++) b._objects[e] instanceof fabric.IText && "right" === b._objects[e].textAlign ? b._objects[e].setLeft(b._objects[e].getBoundingRectWidth() / 2) : b._objects[e] instanceof fabric.IText && "center" === b._objects[e].textAlign ? b._objects[e].setLeft(0) : b._objects[e].setLeft(-b._objects[e].getBoundingRectWidth() / 2);
                    break;
                case "top":
                    for (e = 0; e < b._objects.length; e++) b._objects[e].setTop(-b.height / 2);
                    break;
                case "bottom":
                    for (e = 0; e < b._objects.length; e++) b._objects[e].setTop(b.height / 2 - b._objects[e].getHeight());
                    break;
                case "horizontal":
                    for (e = 0; e < b._objects.length; e++) b._objects[e].setTop(-b._objects[e].getHeight() / 2)
            }
            b.setObjectsCoords(), b.setCoords()
        }
        sa.runtime.design.cPage.canvas.renderAll()
    }

    function K(a) {
        var b = sa.runtime.design.cPage.canvas.getActiveObject();
        if (b) switch (sa.runtime.design.undo.push({
            target: b,
            prop: "depth",
            val: sa.runtime.design.cPage.canvas.getObjects().indexOf(b)
        }), a.data) {
            case "up":
                b.bringForward();
                break;
            case "down":
                b.sendBackwards();
                break;
            case "bottom":
                b.sendToBack();
                break;
            case "top":
                b.bringToFront()
        }
    }

    function L(a) {
        ua.findItems(null, null, null, a.chain).forEach(function(b) {
            b != a && (b.text = a.text, b.setCoords())
        }), sa.runtime.design.cPage.canvas.renderAll()
    }

    function M(b) {
        sa.runtime.act.initialText && sa.runtime.design.undo.push({
            target: sa.runtime.page.cItem,
            prop: "text",
            val: sa.runtime.act.initialText
        }), sa.runtime.act.initialText = null, sa.runtime.page.cItem instanceof fabric.IText && (sa.runtime.page.cItem.text = b.data, sa.runtime.page.cItem.setCoords(), sa.runtime.page.cItem.chain && "" !== sa.runtime.page.cItem.chain && L(sa.runtime.page.cItem), sa.runtime.design.cPage.canvas.renderAll(), a.broadcast("context-move"), setTimeout(function() {
            a.broadcast("text-edited", sa.runtime.page.cItem.getRef())
        }, 100))
    }

    function N(a) {
        if (sa.runtime.page.cItems.length) {
            var b, c, d;
            switch (a.data) {
                case "bold":
                    sa.runtime.design.undo.push({
                        target: sa.runtime.page.cItems[0],
                        prop: "fmt",
                        val: {
                            type: "fontWeight",
                            val: sa.runtime.page.cItems[0].fontWeight
                        }
                    }), b = "bold" === sa.runtime.page.cItems[0].getFontWeight() ? "normal" : "bold", c = "fontWeight";
                    break;
                case "italic":
                    sa.runtime.design.undo.push({
                        target: sa.runtime.page.cItems[0],
                        prop: "fmt",
                        val: {
                            type: "fontStyle",
                            val: sa.runtime.page.cItems[0].fontStyle
                        }
                    }), b = "italic" === sa.runtime.page.cItems[0].getFontStyle() ? "normal" : "italic", c = "fontStyle";
                    break;
                case "underline":
                    sa.runtime.design.undo.push({
                        target: sa.runtime.page.cItems[0],
                        prop: "fmt",
                        val: {
                            type: "textDecoration",
                            val: sa.runtime.page.cItems[0].textDecoration
                        }
                    }), b = "underline" === sa.runtime.page.cItems[0].getTextDecoration() ? "" : "underline", c = "textDecoration";
                    break;
                case "left":
                case "center":
                case "right":
                    sa.runtime.design.undo.push({
                        target: sa.runtime.page.cItems[0],
                        prop: "fmt",
                        val: {
                            type: "textAlign",
                            val: sa.runtime.page.cItems[0].textAlign
                        }
                    }), c = "textAlign", b = a.data, d = a.data;
                    break;
                case "justify":
                    sa.runtime.design.undo.push({
                        target: sa.runtime.page.cItems[0],
                        prop: "fmt",
                        val: {
                            type: "textAlign",
                            val: sa.runtime.page.cItems[0].textAlign
                        }
                    }), c = "textAlign", b = a.data, d = "left";
                    break;
                default:
                    switch (a.data.prop) {
                        case "size":
                            sa.runtime.page.cItems[0].setFSize(a.data.value);
                            break;
                        case "lineSpacing":
                            sa.runtime.page.cItems[0].setLineHeight(a.data.value);
                            break;
                        case "strokeWidth":
                            sa.runtime.page.cItems[0] && a.data.value > 0 && sa.runtime.page.cItems[0].setStroke(sa.runtime.page.cItems[0].fillData.strokeData.fill.colors[0].toWebString() || "#000000"), 0 === a.data.value && sa.runtime.page.cItems[0].setStroke(null), sa.runtime.page.cItems[0].setStrokeWidth(a.data.value), sa.runtime.page.cItems[0].fillData.strokeData.width = a.data.value;
                            break;
                        case "font":
                            sa.runtime.page.cItems[0] instanceof fabric.IText && sa.lib.fonts[a.data.value] && (sa.runtime.design.undo.push({
                                target: sa.runtime.page.cItem,
                                prop: "font",
                                val: {
                                    weight: sa.runtime.page.cItem.fontWeight,
                                    style: sa.runtime.page.cItem.fontStyle,
                                    type: "fontFamily",
                                    family: sa.runtime.page.cItem.fontFamily
                                }
                            }), sa.runtime.page.cItems[0].fontFamily = sa.lib.fonts[a.data.value].fontFamily, "bold" == sa.runtime.page.cItems[0].getFontWeight() && (sa.lib.fonts[a.data.value].bold || (sa.runtime.page.cItems[0].fontWeight = "normal")), "italic" == sa.runtime.page.cItems[0].getFontStyle() && (sa.lib.fonts[a.data.value].italic || (sa.runtime.page.cItems[0].fontStyle = "normal"))), sa.lib.fonts[a.data.value] && (sa.runtime.act.cFont = sa.lib.fonts[a.data.value])
                    }
                    sa.runtime.page.cItems[0].setCoords()
            }
            c && sa.runtime.page.cItems.forEach(function(a) {
                a[c] = b, d && a.adjustPosition(d), a.setCoords()
            }), sa.runtime.design.cPage.canvas.renderAll(), setTimeout(function() {
                B()
            }, 200)
        }
    }

    function O(a, b) {
        var c, d, e = [];
        return a.items.forEach(function(a) {
            "group" === a.type && a.items ? (c = O(a, b), c && (e.push(c), b.remove(c))) : (c = b.page.fetchItemByID(a.id), c && e.push(c))
        }), e.length && (d = new fabric.Group(e, {
            originX: "left",
            originY: "top"
        }), b.add(d), a.depth && d.moveTo(a.depth)), d
    }

    function P(a) {
        for (var b = [], c = [], d = 0; d < a._objects.length; d++) "group" === a._objects[d].type && (a._objects[d]._tempDepth = d, c.push(a._objects[d]));
        return c.forEach(function(a) {
            b.push(Q(a, !0))
        }), b
    }

    function Q(b, c, d) {
        a.broadcast("context-hide"), b && (sa.runtime.page.cItem = b);
        var e = sa.runtime.page.cItem.canvas;
        if ("group" === sa.runtime.page.cItem.type) {
            var f = {
                    items: [],
                    id: sa.runtime.page.cItem.groupID,
                    type: "group",
                    depth: b._tempDepth
                },
                g = sa.runtime.page.cItem._objects;
            return sa.runtime.page.cItem._restoreObjectsState(), e.remove(sa.runtime.page.cItem), g.forEach(function(a) {
                e.add(a.setCoords()), c ? "group" === a.type && d ? f.items.push(Q(a, !0)) : f.items.push({
                    id: a.getRef(),
                    type: a.type
                }) : delete a.gr
            }), f
        }
    }

    function R() {
        if (sa.runtime.design.cPage.canvas.getActiveGroup()) {
            var a, b = [],
                c = ua.generateReference();
            sa.runtime.design.cPage.canvas.getActiveGroup()._objects.forEach(function(a) {
                a.gr = c, b.push(a)
            }), sa.runtime.design.cPage.canvas.discardActiveGroup(), b.forEach(function(a) {
                a.canvas.remove(a)
            }), a = new fabric.Group(b, {
                originX: "left",
                originY: "top"
            }), a.groupID = c, sa.runtime.design.cPage.canvas.add(a), sa.runtime.design.cPage.canvas.setActiveObject(a).renderAll(), sa.runtime.page.cItem = a, sa.runtime.act.eGroups === !0 && sa.runtime.act.cGroups.items.push({
                id: sa.runtime.page.cItem.getRef(),
                type: "group"
            })
        }
    }

    function S() {
        O(sa.runtime.act.cGroups, sa.runtime.design.cPage.canvas);
        var b = sa.runtime.design.cPage.canvas._objects;
        b.forEach(function(a) {
            a.grValues && (a.set(a.grValues), delete a.grValues)
        }), sa.runtime.act.eGroups = !1, a.broadcast("hide-group-exit-btn"), sa.runtime.design.cPage.canvas.renderAll()
    }

    function T() {
        if ("group" === sa.runtime.page.cItem.type) {
            var b = sa.runtime.design.cPage.canvas._objects;
            b.forEach(function(a) {
                a !== sa.runtime.page.cItem && (a.grValues = {
                    opacity: a.opacity,
                    selectable: a.selectable === !0,
                    evented: a.evented === !0
                }, a.set({
                    opacity: .1,
                    selectable: !1,
                    evented: !1
                }))
            }), sa.runtime.act.eGroups = !0, sa.runtime.act.cGroups = Q(sa.runtime.page.cItem, !0, !0), a.broadcast("show-group-exit-btn")
        }
    }

    function U(a) {
        a.setCoords();
        var b = a.toObject(qa);
        return b.aWidth = ua.getMeActualValue(a.getWidth()), b.aHeight = ua.getMeActualValue(a.getHeight()), b.aXpos = ua.getMeActualValue(a.getLeft()), b.aYpos = ua.getMeActualValue(a.getTop()), delete b.paths, a instanceof fabric.IText && (b.svg = a.toSVG()), b
    }

    function V(a) {
        for (var b = [], c = 0; c < a._objects.length; c++) b.push(U(a._objects[c]));
        return b
    }

    function W(a) {
        h(a.data)
    }

    function X(b) {
        var c, d, e, f;
        ua.findItems(b.data.ref, null, null, b.data.chain).forEach(function(g) {
            c = b.data.image.toObject(ra), e = g.getWidth(), b.data.isImage ? (d = j(c, g.canvas.page, !0), d.moveTo(g.index), f = e / d.getWidth() * d.getScaleX(), d.set({
                scaleX: f,
                scaleY: f,
                top: g.top,
                left: g.left,
                opacity: g.opacity,
                angle: g.angle
            }), d.isLoading = !1) : (d = c, f = e / b.data.image.getWidth() * b.data.image.getScaleX(), d.scaleX = d.scaleY = f, d.top = g.top, d.left = g.left, d.opacity = g.opacity, d.angle = g.angle), d.title = g.title, d.chain = g.chain, d.tLocked = g.tLocked, d.includeInForm = g.includeInForm, d.hideContext = g.hideContext, d.reference = g.reference, d.index = g.index, b.data.isImage && b.data.opts.editPictureAfterUpload && setTimeout(function() {
                wa.launch({
                    image: d,
                    type: "custom",
                    opts: {
                        image: d.getElement(),
                        url: d.getSrc(),
                        hiresUrl: d.getSrc(),
                        forceCropPreset: b.data.opts.forceEditorCrop ? ["Picture Ratio", g.getWidth() + ":" + g.getHeight()] : void 0,
                        forceCropMessage: sa.lib.lang.bg_crop_message
                    },
                    callBack: function() {
                        d.setCoords(), f = e / d.getWidth() * d.getScaleX(), d.set({
                            scaleX: f,
                            scaleY: f
                        }), g.canvas.renderAll(), a.broadcast("image-updated", {
                            id: b.data.ref
                        })
                    }
                })
            }, 500), b.data.isImage ? d.setCoords() : j(d, g.canvas.page, !0), g.canvas.remove(g), a.broadcast("image-updated", {
                id: b.data.ref
            })
        }), b.data.image.canvas && b.data.image.canvas.remove(b.data.image), sa.runtime.design.cPage && sa.runtime.design.cPage.canvas.renderAll()
    }

    function Y() {
        sa.runtime.ui.pack.unblock(), a.broadcast("alert-error", sa.lib.lang.network_error)
    }

    function Z() {
        a.broadcast("project-saved"), sa.runtime.ui.pack.unblock(), sa.runtime.act.dontShowSavedAlert || a.broadcast("alert-ok", sa.lib.lang.design_saved), "function" == typeof sa.functions.onSave && sa.functions.onSave({
            source: JSON.parse(JSON.stringify(sa.runtime.design.saveSource)),
            projectId: sa.c.projectId,
            numPages: sa.runtime.design.savePages.length,
            previews: sa.runtime.act.previewStack,
            pdfDownload: sa.runtime.design.pdfDownload,
            meta: sa.runtime.design.meta || {}
        })
    }

    function $(b) {
        if (sa.runtime.act.delayFF === !0) return va.fetchPost("ping", {}, $, Y, "json", !0), void(sa.runtime.act.delayFF = !1);
        if (b && b.imageUrl && sa.runtime.act.previewStack.push(b.imageUrl), sa.runtime.act.cntr < sa.runtime.design.savePages.length) {
            var c = sa.runtime.design.savePages[sa.runtime.act.cntr];
            sa.runtime.act.cntr++, va.fetchPost(sa.server.taskServer + "?t=saveFile", {
                dest: "images/" + (sa.c.isDesign ? "designs/" : "previews/") + ((sa.c.isDesign ? sa.c.designId : sa.c.projectId) + "_" + sa.runtime.act.cntr + ".jpg"),
                source: c.render,
                buck: sa.server.rscBucket,
                format: "base64"
            }, $, Y, "json", !0), a.broadcast("alert-modal", sa.lib.lang.saving_preview + " " + sa.runtime.act.cntr + " / " + sa.runtime.act.oLength)
        } else sa.runtime.design.saveSource.previews = sa.runtime.act.previewStack, va.fetchPost("save-project", {
            id: sa.c.projectId || sa.c.designId,
            source: JSON.stringify(sa.runtime.design.saveSource),
            isUserproject: sa.c.isUserproject,
            designFolder: sa.c.designFolder,
            mode: sa.c.mode,
            designId: sa.c.designId,
            isDesign: sa.c.isDesign
        }, Z, Y), a.broadcast("alert-modal", sa.lib.lang.saving_design)
    }

    function _(b) {
        sa.runtime.design.savePages = sa.runtime.act.singlePageMode ? [sa.runtime.design.cPage] : sa.runtime.design.pages, a.broadcast("before-start-save"), sa.runtime.design.savePages.forEach(function(a) {
            xa.renderPage(a, !0)
        }), sa.lib.design || (sa.lib.design = sa.lib.project), sa.runtime.design.saveSource = {
            version: W2P.version,
            _author: String(sa.c.userId),
            showPresetForm: sa.runtime.design.showPresetForm || sa.lib.design.showtextpresetform,
            hideBackgroundPanel: sa.runtime.design.hideBackgroundPanel || sa.lib.design.hidebackgroundpanel,
            hideTextPanel: sa.runtime.design.hideTextPanel || !1,
            hideImagePanel: sa.runtime.design.hideImagePanel || !1,
            product: sa.c.product,
            disableImageClick: sa.runtime.design.disableImageClick,
            thumbnailImage: sa.runtime.design.thumbnailImage,
            designId: sa.c.designId || sa.lib.design.designId || sa.lib.design.designid,
            projectId: sa.c.projectId,
            productId: sa.c.product ? sa.c.product.id : "",
            layout: sa.runtime.design.layout,
            defaultTab: sa.runtime.design.defaultTab,
            title: sa.runtime.design.title,
            scaling: sa.runtime.design.cScaling,
            newTextColor: sa.runtime.design.newTextColorString,
            unit: sa.runtime.design.unit || sa.lib.design.unit,
            welcomeMsg: sa.runtime.design.welcomeMsg,
            dPage: sa.runtime.design.dPage,
            singlePageMode: sa.runtime.act.singlePageMode,
            renderBleed: sa.runtime.design.renderBleed,
            printCutMarks: sa.lib.config.printCutMarks,
            pdfDownload: sa.runtime.design.pdfDownload,
            pdfColor: sa.lib.config.renderPdfRgb ? "RGB" : "CMYK",
            pages: []
        }, sa.runtime.design.savePages.forEach(function(a) {
            a.pageData.scaling = 1, a.renderWithScale(!0), sa.runtime.design.saveSource.pages.push(a.toObj())
        }), b.data && b.data.customSave || (a.broadcast("before-save"), sa.runtime.act.cntr = 0, sa.runtime.act.oLength = sa.runtime.design.savePages.length, sa.runtime.act.previewStack = [], $())
    }

    function aa() {
        sa.runtime.design.cPage.canvas.defaultCursor = "default", sa.runtime.design.cPage.canvas.hoverCursor = "move", sa.runtime.design.cPage.canvas.selection = !0, sa.runtime.act.caretMode = !1, sa.runtime.act.caretMode && ta.fire("show-files-div")
    }

    function ba() {
        return sa.runtime.act.caretMode ? void aa() : (a.broadcast("alert-info", sa.lib.lang.click_to_add_text), sa.runtime.act.caretMode = !0, g(), sa.runtime.design.cPage.canvas.defaultCursor = sa.runtime.design.cPage.canvas.hoverCursor = "text", void(sa.runtime.design.cPage.canvas.selection = !1))
    }

    function ca(b) {
        var c = {
                target: b.target,
                prop: b.prop,
                val: null
            },
            d = c.target;
        switch (b.prop) {
            case "transform":
                c.val = ua.captureProps(d), d.set({
                    left: b.val.left,
                    top: b.val.top,
                    width: b.val.width,
                    height: b.val.height,
                    scaleX: b.val.scaleX,
                    scaleY: b.val.scaleY,
                    angle: b.val.angle
                }), d.setCoords();
                break;
            case "add":
                b.target.add(b.val), c = {
                    target: b.target,
                    prop: "remove",
                    val: b.val
                }, da();
                break;
            case "remove":
                b.target.remove(b.val), c = {
                    target: b.target,
                    prop: "add",
                    val: b.val
                };
                break;
            case "depth":
                c.val = d.canvas.getObjects().indexOf(d), d.moveTo(b.val);
                break;
            case "opacity":
                c.val = b.target.opacity, b.target.opacity = parseFloat(b.val);
                break;
            case "filldata":
                b.target instanceof fabric.IText ? (c.val = {
                    fill: b.target.fill,
                    fillData: b.target.fillData ? b.target.fillData.clone() : null
                }, b.target.fillData = b.val.fillData, b.target.fill = b.val.fill) : "shape" == b.target.type && (c.val = {
                    idx: b.val.idx,
                    fill: b.target.paths[b.val.idx].fill,
                    fillData: b.target.fillData[b.target.paths[b.val.idx].fill]
                }, b.target.paths[b.val.idx].fill = b.val.fill, b.target.fillData[b.val.fill] = b.val.fillData);
                break;
            case "text":
                c.val = b.target.text, b.target.text = b.val;
                break;
            case "fmt":
                c.val = {
                    type: b.val.type,
                    val: b.target[b.val.type]
                }, b.target[b.val.type] = b.val.val;
                break;
            case "font":
                c.val = {
                    weight: b.target.fontWeight,
                    style: b.target.fontStyle,
                    type: b.val.type,
                    val: b.target[b.val.type]
                }, b.target.fontWeight = b.val.weight, b.target.fontStyle = b.val.style, b.target.fontFamily = b.val.family;
                break;
            default:
                c.val = b.val
        }
        return a.broadcast("context-hide"), sa.runtime.design.cPage.canvas.renderAll(), c
    }

    function da() {
        sa.runtime.design.undo.length && sa.runtime.design.redo.push(ca(sa.runtime.design.undo.pop()))
    }

    function ea() {
        sa.runtime.design.redo.length && sa.runtime.design.undo.push(ca(sa.runtime.design.redo.pop()))
    }

    function fa() {
        if (sa.runtime.page.cItem instanceof fabric.IText) {
            var a = JSON.parse(JSON.stringify(sa.runtime.page.cItem.toObject(qa))),
                b = sa.runtime.design.cPage.canvas.getObjects().indexOf(sa.runtime.page.cItem),
                c = sa.runtime.page.cItem;
            sa.runtime.design.cPage.canvas.discardActiveObject(), c.remove(), "i-text" === a.type ? a.type = "textbox" : "textbox" === a.type && (a.type = "i-text");
            var d = j(a, sa.runtime.design.cPage);
            d.moveTo(b), sa.runtime.page.cItem = d, sa.runtime.page.cItems = [d], sa.runtime.design.cPage.canvas.setActiveObject(d), sa.runtime.design.cPage.canvas.renderAll()
        }
    }

    function ga(a) {
        if ("number" == typeof a.data && sa.runtime.design.pages[a.data]) {
            sa.runtime.design.pages[a.data].destroy()
        } else if (sa.runtime.design.pages && "all" === a.data && sa.runtime.design.pages.length) {
            sa.runtime.design.cPage = null;
            for (var b = 0, c = sa.runtime.design.pages.length; c > b; b++) sa.runtime.design.pages[0].destroy()
        }
    }

    function ha(b) {
        if (!sa.runtime.page.cItem) return !1;
        if ("group" === sa.runtime.page.cItem.type) {
            var c = sa.runtime.page.cItem.toDataURL(),
                d = [];
            sa.runtime.page.cItem._objects.forEach(function(a) {
                d.push(a.toObject(qa))
            }), sa.runtime.page.cItem.setCoords(), a.broadcast("alert-processing", sa.lib.lang.processing), va.fetchPost("save-text-arts", {
                imgBase64: c,
                content: JSON.stringify({
                    items: d
                }),
                newFolderTitle: b.data.newFolderTitle,
                folderId: b.data.folderId
            }, function(b) {
                var c = ya.createThumb({
                    type: "text-arts",
                    url: b.url,
                    thumbnail: b.thumbnail
                });
                za("#" + sa.lib["text-artsConf"].current).append(c), a.broadcast("update-scrolls", sa.lib["text-artsConf"].current), a.broadcast("style-export-complete", b), a.broadcast("alert-hide")
            })
        }
    }

    function ia(b) {
        H(b.items, !0), a.broadcast("alert-hide")
    }

    function ja(b) {
        a.broadcast("alert-processing", sa.lib.lang["loading_text-arts"]), va.fetchGet(ua.returnPath(b.data), ia)
    }

    function ka(b) {
        return sa.runtime.page.cItem ? void setTimeout(function() {
            switch (sa.runtime.page.cItem.type) {
                case "group":
                    T();
                    break;
                case "i-text":
                case "textbox":
                    a.broadcast("show-text-editor")
            }
        }, 200) : !1
    }

    function la() {
        sa.runtime.design.cPage && sa.runtime.design.cPage.swapDimensions()
    }

    function ma(a) {
        a = a.data
        var b = null;
        if ("number" == typeof a.w && "number" == typeof a.h) b = {
            title: a.t,
            render: !0,
            renderCanvasOffset: !0,
            fWidth: a.w,
            fHeight: a.h,
            index: sa.runtime.design.pages.length,
            scaling: 1,
            foregroundDimension: {
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                width: 0,
                height: 0
            },
            canvasDimension: {
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                width: a.w,
                height: a.h
            },
            fillData: new Aa.FillData("color", new Aa.ColorData("solid", [ua.rgbToColor("#FFFFFF")]), new Aa.ImageData, new Aa.StrokeData, 1)
        };
        else {
            if ("object" != typeof a.w) return;
            b = a.w, b.index = sa.runtime.design.pages.length
        }
        var c = new Aa.Page({
            pageData: b,
            items: []
        }, sa.runtime, sa.runtime.ui.stage.element);
        sa.runtime.design.pages.push(c), c.scaleToFit()
    }

    function na() {
        sa.runtime.design.cPage && setTimeout(function() {
            sa.runtime.design.cPage.refreshBackground()
        }, 1e3)
    }

    function oa() {
        sa.runtime.act.fontsLoaded && sa.runtime.design.cPage && (sa.runtime.design.pages.forEach(function(a) {
            a.reRenderTexts()
        }), fabric.IText.prototype.caching = fabric.Textbox.prototype.caching = !0)
    }

    function pa() {
        "function" == typeof sa.functions.onDesignLoaded && sa.functions.onDesignLoaded(sa.runtime.design)
    }
    var qa = ["fillData", "elementid", "url", "title", "reference", "chain", "tLocked", "eLocked", "isReference", "includeInForm", "rawsvg", "d", "drop_target", "maskShape", "hideContext", "vd", "clickMask"],
        ra = ["fillData", "elementid", "url", "_element", "rawsvg", "d", "drop_target", "clickMask", "title"],
        sa = a.getGlobalConfig("model"),
        ta = a.getGlobalConfig("events"),
        ua = a.getService("utils"),
        va = a.getService("comm"),
        wa = a.getService("image-editor"),
        xa = a.getService("renders"),
        ya = a.getService("images"),
        za = a.getGlobal("jQuery"),
        Aa = a.getGlobal("W2P")["class"];
    return ta.on("export-group", ha), ta.on("change-color", b), ta.on("load-image", o), ta.on("set-image", p), ta.on("opacity-change", e), ta.on("opacity-shown", f), ta.on("zoom-page", r), ta.on("resize", s), ta.on("canvas-object-selected", u), ta.on("canvas-up", v), ta.on("canvas-down", w), ta.on("canvas-object-cleared", x), ta.on("canvas-object-modified", y), ta.on("canvas-text-changed", z), ta.on("canvas-object-scaled", A), ta.on("sync-text-props", B), ta.on("color-opt-index-changed", c), ta.on("copy-items", D), ta.on("clone-items", C), ta.on("cut-items", G), ta.on("paste-items", I), ta.on("delete-items", F), ta.on("align-items", J), ta.on("stack-items", K), ta.on("edit-text", M), ta.on("format-text", N), ta.on("create-group", R), ta.on("ungroup", function(a) {
        Q()
    }), ta.on("edit-group", T), ta.on("exit-edit-group", S), ta.on("select-page", W), ta.on("swap-images", X), ta.on("start-save", _), ta.on("start-new-text", ba), ta.on("end-caret", aa), ta.on("undo", da), ta.on("redo", ea), ta.on("discard-selection", g), ta.on("toggle-textbox", fa), ta.on("remove-page", ga), ta.on("load-text-art", ja), ta.on("canvas-object-dblclick", ka), ta.on("page-swap-dimension", la), ta.on("new-page", ma), ta.on("window-focused", na), ta.on("fonts-loaded", oa), ta.on("design-loaded", pa), {
        createGroup: function(a, b) {
            return O(a, b)
        },
        parseGroups: function(a) {
            return P(a)
        },
        itemsToString: function(a) {
            return V(a)
        },
        createPage: function(a) {
            sa.runtime.design.pages.push(new Aa.Page(a, sa.runtime, sa.runtime.ui.stage.element))
        },
        selectPage: function(a, b) {
            h(a || 0, b)
        },
        objToControl: function(a, b, c, d) {
            j(a, b, c, d)
        },
        presetFabric: function() {
            k()
        },
        loadItem: function(a, b, c, d, e) {
            n(a, b, c, d, e)
        }
    }
}), Box.Application.addService("pop-over", function(a) {
    "use strict";
    var b = a.getGlobalConfig("model"),
        c = (a.getGlobalConfig("events"), a.getGlobal("jQuery")),
        d = a.getService("utils"),
        e = (a.getGlobal("W2P")["class"], fabric.util.createClass({
            initialize: function(a) {
                this.target = a.target || [], this.trigger = a.trigger || "mouseenter", this.fadeIn = a.fadeIn || .2, this.fadeOut = a.fadeOut || .2, this.delay = a.delay || .4, a.content ? this.content = a.content : this.target.length && (this.content = this.target.attr("data-tip") || ""), "string" == typeof this.content && 0 === this.content.indexOf("{") && this.content.lastIndexOf("}") === this.content.length - 1 && this.content.length > 2 && (this.content = '<span style="text-align:center">' + b.lib.lang[this.content.split("}").join("").split("{").join("")] + "</span>"), this.anchor = a.anchor || this.target.attr("anchor") || "r", this.ahide = void 0 === a.ahide ? !0 : a.ahide, this.offset = a.offset || 5, this.showfn = a.show, this.hidefn = a.hide, this.html = jQuery('<div class="pp-tip" />'), this.arrow = jQuery('<i class="pp-med-icon"></i>').appendTo(this.html), a.css && this.html.addClass(a.css), this.createMe()
            },
            createMe: function() {
                this.html.html(""), this.html.append(this.arrow), this.content && this.html.append(this.content), this.target.length && (this.target.bind(this.trigger, this, this.show), this.ahide && (this.target.bind("mouseleave", this, this.hide), this.target.bind("mousedown", this, this.hide)))
            },
            attachContent: function(a) {
                this.content = a, this.html.append(this.content), this.arrow.appendTo(this.html)
            },
            setContent: function(a) {
                this.content = a, this.html.html(this.content), this.arrow.appendTo(this.html)
            },
            forceShow: function(a, b, d) {
                b && (this.anchor = b), this.target && c(this.target).removeClass("pp-btn-selected-hot"), a && (this.target = a), this.show({
                    data: this
                }, d)
            },
            show: function(a, c) {
                if (b.runtime.act.popStack.length) {
                    var d = b.runtime.act.popStack[b.runtime.act.popStack.length - 1];
                    !d.ahide && "click" != a.data.trigger || d == c || d.hide({
                        data: b.runtime.act.popStack.pop()
                    })
                }
                "click" == a.data.trigger && a.data.target.addClass("pp-btn-selected-hot"), a.data.position(), a.data.target.tween && a.data.target.tween.kill(), a.data.target.tween = TweenLite.to(a.data.html, a.data.fadeIn, {
                    autoAlpha: 1,
                    delay: a.data.delay,
                    onStart: "function" == typeof a.data.showfn ? a.data.showfn : null
                }), setTimeout(function() {
                    b.runtime.act.popStack.push(a.data)
                }, 500)
            },
            hide: function(a) {
                void 0 !== a ? ("click" == a.data.trigger && a.data.target.removeClass("pp-btn-selected-hot"), a.data.target.tween && a.data.target.tween.kill(), a.data.target.tween = TweenLite.to(a.data.html, a.data.fadeOut, {
                    autoAlpha: 0,
                    onComplete: "function" == typeof a.data.hidefn ? a.data.hidefn : null
                })) : (this.target.removeClass("pp-btn-selected-hot"), this.target.tween && this.target.tween.kill(), this.target.tween = TweenLite.to(this.html, this.fadeOut, {
                    autoAlpha: 0,
                    onComplete: "function" == typeof this.hidefn ? this.hidefn : null
                }))
            },
            position: function() {
                this.html.appendTo(b.runtime.ui.pack);
                var a, c, e = d.adjustOffset(this.target.offset()),
                    f = b.runtime.ui.pack,
                    g = -1;
                switch (this.anchor) {
                    case "r":
                        a = e.left + this.target.outerWidth() + 15, c = e.top + this.target.outerHeight() / 2 - this.html.outerHeight() / 2, 0 > c && (c = 0), g = e.top + this.target.outerHeight() / 2 - c - 16, c + this.html.outerHeight() > f.height() && (g += c + this.html.outerHeight() - f.height(), c = f.height() - this.html.outerHeight() - 5), this.arrow.removeClass().addClass("pp-tip-icon").addClass("pp-icon-caret-left"), this.arrow.css({
                            left: -9,
                            top: g
                        });
                        break;
                    case "l":
                        a = e.left - this.html.outerWidth() - 15, c = e.top + this.target.outerHeight() / 2 - this.html.height() / 2, 0 > c && (c = 0), g = e.top + this.target.outerHeight() / 2 - c - 16, c + this.html.outerHeight() > f.height() && (g += c + this.html.outerHeight() - f.height(), c = f.height() - this.html.outerHeight() - 5), this.arrow.removeClass().addClass("pp-tip-icon").addClass("pp-icon-caret-right"), this.arrow.css({
                            left: this.html.outerWidth() - 1,
                            top: g
                        });
                        break;
                    case "b":
                        a = e.left + this.target.outerWidth() / 2 - this.html.outerWidth() / 2, c = e.top + this.target.outerHeight() + 19, this.arrow.removeClass().addClass("pp-tip-icon").addClass("pp-icon-caret-up"), g = -20;
                        var h = this.html.outerWidth() / 2 - 8;
                        0 >= a && (h = this.target.outerWidth() / 2 - 8), this.arrow.css({
                            top: g,
                            left: h
                        });
                        break;
                    case "t":
                        this.arrow.removeClass().addClass("pp-tip-icon").addClass("pp-icon-caret-down");
                        var h = this.html.outerWidth() / 2 - 8;
                        a = e.left + this.target.outerWidth() / 2 - this.html.outerWidth() / 2, c = e.top - this.html.outerHeight() - 15, 0 >= a && (h = this.target.outerWidth() / 2 - 8), this.arrow.css({
                            top: this.html.outerHeight() - 12,
                            left: h
                        })
                }
                0 >= a && (a = 0), 0 >= c && (c = 0), this.html.css({
                    top: parseInt(c),
                    left: parseInt(a)
                })
            }
        }));
    return {
        create: function(a) {
            return new e(a)
        }
    }
}), Box.Application.addService("renders", function(a) {
    "use strict";

    function b(a, b, c) {
        if (b.templateImage) {
            var f, g = new fabric.Canvas;
            g.setDimensions({
                width: e.getPixels(b.pageData.fWidth, b.pageData.scaling),
                height: e.getPixels(b.pageData.fHeight, b.pageData.scaling)
            }), g.add(b.templateImage), b.templateImage.set({
                width: e.getPixels(b.pageData.fWidth, b.pageData.scaling),
                height: e.getPixels(b.pageData.fHeight, b.pageData.scaling)
            }), b.templateImage.setCoords(), d.runtime.act.delayFF = !0;
            var h, i = a.src;
            h = document.createElement("img"), h.src = i, f = new fabric.Image(fabric.util.createImage());
            var j = setInterval(function() {
                h.width && h.height && (clearInterval(j), f.crossOrigin = "", f.setElement(h), f.set({
                    scale: b.pageData.scaling,
                    width: e.getPixels(b.pageData.canvasDimension.width, b.pageData.scaling),
                    height: e.getPixels(b.pageData.canvasDimension.height, b.pageData.scaling),
                    left: e.getPixels(b.pageData.canvasDimension.left, b.pageData.scaling),
                    top: e.getPixels(b.pageData.canvasDimension.top, b.pageData.scaling)
                }), f.setCoords(), g.add(f), f.setCoords(), g.renderAll(), c ? b.render = g.toDataURL({
                    multiplier: 1 / b.pageData.scaling
                }) : a.src = g.toDataURL({
                    multiplier: 1 / b.pageData.scaling
                }))
            }, 1);
            return g.renderAll(), g.toDataURL({
                multiplier: 1 / b.pageData.scaling
            })
        }
        return a.src
    }

    function c(c, f) {
        if (c.canvas) {
            d.runtime.act.hidePrevForeground && !f && c.canvas.setOverlayImage(null);
            var g = c.canvas,
                h = c.pageData,
                i = {
                    multiplier: (W2P.isMobile ? 550 : g.width > g.height ? 800 : 600) / Math.max(g.width, g.height),
                    format: f ? "jpeg" : "png",
                    quality: f ? d.lib.config.imageencodequality / 100 : 1
                },
                j = document.createElement("img");
            h.bleed && !h.templateSource && (i.left = e.getPixels(h.bleed, h.scaling), i.top = e.getPixels(h.bleed, h.scaling), i.width = g.width - e.getPixels(h.bleed, h.scaling) - e.getPixels(h.bleed, h.scaling), i.height = g.height - e.getPixels(h.bleed, h.scaling) - e.getPixels(h.bleed, h.scaling)), d.runtime.act.clearTopLayer = !0, g._objects.forEach(function(a) {
                a.getIsReference() === !0 && a.setVisible(!1)
            }), g.renderAll(), h.templateSource && (i = i.format = "png"), c.render = g.toDataURL(i), j.src = c.render, h.templateSource && (j.src = c.render = b(j, c, f)), d.runtime.act.clearTopLayer = !1, g._objects.forEach(function(a) {
                a.getIsReference() === !0 && a.setVisible(!0)
            }), g.renderAll(), c.previewImage = j, a.broadcast("after-render", c)
        }
    }
    var d = a.getGlobalConfig("model"),
        e = (a.getGlobalConfig("events"), a.getService("utils"));
    return {
        renderPage: function(a, b) {
            return c(a, b)
        }
    }
}), Box.Application.addService("uploader", function(a) {
    "use strict";

    function b(b, d, e, i) {
        0 !== b.length && (b.fileupload({
            url: g.c.appApiUrl + "upload/",
            dataType: "json",
            autoUpload: !0,
            dropZone: d,
            pasteZone: null,
            multipart: !0,
            singleFileUploads: !0,
            sequentialUploads: !0,
            disableImageResize: !0,
            previewMaxWidth: g.c.thumbResolution,
            previewMaxHeight: g.c.thumbResolution,
            previewCrop: !0,
            xhrFields: {
                withCredentials: !0
            }
        }).on("fileuploadsubmit", function(a, b) {
            b.formData = {
                connectsid: g.server.urlToken,
                grayscale: 1 === g.c.accntStatus ? g.runtime.act.greyScaleUploads : !1,
                flatSvg: g.lib.config.flatSvg,
                vectorDpi: g.lib.config.vectorDpi || 150,
                flatAll: g.lib.config.flatAll
            }
        }).on("fileuploadadd", function(b, d) {
            var h = c(d.originalFiles[0].name, d.originalFiles[0].size);
            if (h.length > 0) return a.broadcast("alert-warning", h.join("\n")), void d.abort();
            d.context = f('<a class="pp-image-thumb-btn" />').appendTo(e || g.runtime.ui.userImages);
            var i = f(e || g.runtime.ui.userImages);
            TweenLite.to(i, .2, {
                scrollTop: i[0].scrollHeight,
                onComplete: function() {
                    i.perfectScrollbar("update")
                }
            }), f('<div class="pp-faded" />').appendTo(d.context)
        }).on("fileuploadprocessalways", function(b, c) {
            var d = c.index,
                e = c.files[d],
                h = f(c.context.children()[d]);
            c.files.error ? (a.broadcast("alert-flash", {
                message: g.c.lang.file_upload_error,
                type: "cancel"
            }), f(c.context).remove()) : (e.preview && h.prepend(e.preview), f('<div class="pp-loading" style="width:40px; height:40px;"></div>').appendTo(f(c.context)).circleProgress({
                value: 0,
                size: 40,
                thickness: 6,
                fill: {
                    color: "#EEEEEE"
                }
            }), a.broadcast("update-scrolls", "pp_userImages_div"))
        }).on("fileuploaddone", function(b, c) {
            var d;
            c.result ? f.each(c.result.files, function(b, e) {
                e.url ? setTimeout(function() {
                    d ? f('<a class="pp-image-thumb-btn" />').appendTo(g.runtime.ui.userImages).append(f(h.createThumb(e, "userImages")).html()) : (f(c.context).empty(), f(c.context).append(f(h.createThumb(e, "userImages")).html())), d = !0, a.broadcast("update-scrolls", "pp_userImages_div"), "function" == typeof i && i(e)
                }, 2e3) : e.error && (a.broadcast("alert-flash", {
                    message: g.c.lang.file_upload_error,
                    type: "cancel"
                }), f(c.context).detach(), a.broadcast("update-scrolls", "pp_userImages_div"))
            }) : (a.broadcast("alert-flash", {
                message: g.c.lang.file_upload_error,
                type: "cancel"
            }), f(c.context).detach(), a.broadcast("update-scrolls", "pp_userImages_div"))
        }).on("fileuploadfail", function(b, c) {
            f.each(c.files, function(b, d) {
                a.broadcast("alert-flash", {
                    message: g.c.lang.file_upload_error,
                    type: "cancel"
                }), f(c.context).detach(), a.broadcast("update-scrolls", "pp_userImages_div")
            })
        }).on("fileuploadprogress", function(a, b) {
            f(b.context).find(".pp-loading").circleProgress("value", b.loaded / b.total)
        }).prop("disabled", !f.support.fileInput), d && d.on("dragleave", function(a) {
            f(a.target).css("background-color", "rgba(0, 0, 0, 0)")
        }).on("dragenter", function(a) {
            f(a.target).css("background-color", "rgba(255, 255, 255, 0.33)")
        }).on("drop", function(a) {
            f(a.target).css("background-color", "rgba(0, 0, 0, 0)")
        }))
    }

    function c(a, b) {
        var c = [],
            d = 1 === g.c.accntStatus ? l : k,
            e = "." + a.split(".").pop().toLowerCase();
        return d.test(e) || c.push(g.c.lang.error_upload_type), b > g.c.maxUploadSize && c.push(g.c.lang.error_upload_file_too_large), c
    }

    function d(b, d, h, i, k) {
        0 !== b.length && (b.fileupload({
            url: g.c.appApiUrl + "upload/",
            dataType: "json",
            autoUpload: !0,
            dropZone: b,
            disableImagePreview: !0,
            xhrFields: {
                withCredentials: !0
            }
        }).on("fileuploadsubmit", function(a, b) {
            b.formData = {
                connectsid: g.server.urlToken,
                grayscale: 1 === g.c.accntStatus ? g.runtime.act.greyScaleUploads : !1,
                flatSvg: g.lib.config.flatSvg,
                vectorDpi: g.lib.config.vectorDpi || 150,
                flatAll: g.lib.config.flatAll
            }
        }).on("fileuploadadd", function(b, e) {
            var f = c(e.originalFiles[0].name, e.originalFiles[0].size);
            return f.length > 0 ? (a.broadcast("alert-warning", f.join("\n")), void e.abort()) : (a.broadcast("upload-add", d), void a.broadcast("alert-uploading", g.lib.lang.processing))
        }).on("fileuploaddone", function(b, c) {
            c.result ? (c.result.files.length > 1 && j.fire("bulk-uploads", {
                files: c.result.files,
                id: d,
                opts: k || {}
            }), f.each(c.result.files, function(b, f) {
                f.url ? setTimeout(function() {
                    "function" == typeof h ? h(f, d, c.result.files.length > 1) : e(f, d, k), a.broadcast("upload-add", {
                        id: d,
                        url: f.url
                    })
                }, 2e3) : f.error && (a.broadcast("alert-flash", {
                    message: g.c.lang.file_upload_error,
                    type: "cancel"
                }), "function" == typeof i && i(f, d))
            })) : (a.broadcast("alert-flash", {
                message: g.c.lang.file_upload_error,
                type: "cancel"
            }), "function" == typeof i && i(file, d)), a.broadcast("alert-hide")
        }).on("fileuploadfail", function(b, c) {
            f.each(c.files, function(b, c) {
                a.broadcast("alert-flash", {
                    message: g.c.lang.file_upload_error,
                    type: "cancel"
                }), "function" == typeof i && i(c, d)
            }), a.broadcast("alert-hide")
        }).on("fileuploadprogressall", function(a, b) {
            f(".pp-progress").circleProgress("value", b.loaded / b.total)
        }).prop("disabled", !f.support.fileInput), b.css("background-color", "#000"), b.on("dragleave", function(a) {
            f(a.target).css("opacity", 0)
        }).on("dragenter", function(a) {
            f(a.target).css("opacity", .3)
        }).on("drop", function(a) {
            f(a.target).css("opacity", 0)
        }))
    }

    function e(a, b, c) {
        i.loadItem(a.isImage ? "image" : "shape", a.url, function(d) {
            "bg" === f("[iRef='" + b + "']").attr("target") ? (j.fire("set-image", {
                type: a.isImage ? "image" : "shape",
                target: "bg",
                url: a.url,
                newImg: d,
                pageIndex: b
            }), a.isImage && setTimeout(function() {
                j.fire("edit-bgImage")
            }, 500)) : j.fire("swap-images", {
                ref: b,
                chain: f("[iRef='" + b + "']").attr("chain"),
                opts: c || {},
                image: d,
                isImage: a.isImage,
                url: a.url
            })
        }, g.runtime.design.cPage.canvas)
    }
    var f = a.getGlobal("jQuery"),
        g = a.getGlobalConfig("model"),
        h = (a.getService("utils"), a.getService("images")),
        i = a.getService("pages"),
        j = a.getGlobalConfig("events"),
        k = (a.getService("image-editor"), /(\.|\/)(gif|jpe?g|png|svg)$/i),
        l = /(\.|\/)(gif|jpe?g|png|svg|psd|tif|tiff|bmp|cdr|ai|eps|pdf|ps)$/i;
    return {
        init: function(a, c, d, e) {
            b(a, c, d, e)
        },
        mnml: function(a, b, c, e, f) {
            d(a, b, c, e, f)
        }
    }
}), Box.Application.addService("utils", function(a) {
    "use strict";

    function b(a) {
        var b = a.rgb || "",
            c = a.cmyk || "",
            d = a.hex || "",
            e = a.name || a.spot || "";
        return "number" == typeof d ? d = new Hex(d) : d.hex && (d = new Hex(d.hex)), d && (d = new Hex(d)), b && (b = new RGB(b.r, b.g, b.b)), c && (c = new CMYK(c.c, c.m, c.y, c.k)), "" === b && ("" !== c ? b = c.toRGB() : "" !== d && (b = d.toRGB())), "" === c && ("" !== b ? c = b.toCMYK() : "" !== d && (c = d.toCMYK())), "" === d && ("" !== b ? d = b.toHex() : "" !== c && (d = c.toHex())), new f.Color(d, b, c, e)
    }

    function c(a, b, c, d) {
        var f = [],
            g = c ? [e.runtime.design.pages[c]] : e.runtime.design.pages;
        return g.forEach(function(c) {
            c.canvas._objects.forEach(function(c) {
                (a && c.reference && c.reference === a || b && c.title && c.title === b || d.length && c.chain === d) && f.push(c);
            })
        }), f
    }
    var d = a.getGlobal("jQuery"),
        e = a.getGlobalConfig("model"),
        f = a.getGlobal("W2P")["class"];
    return d.fn.insertAt = function(a, b) {
        var c = this.children().size();
        return index < 0 && (a = Math.max(0, c + 1 + a)), this.append(b), c > a && this.children().eq(a).before(this.children().last()), this
    }, Object.size = function(a) {
        var b, c = 0;
        for (b in a) a.hasOwnProperty(b) && c++;
        return c
    }, {
        oneDecimal: function(a) {
            return Math.round(10 * a) / 10
        },
        checkMaskDpi: function(a, b, c) {
            return e.lib.config.dpiCheck && e.lib.config.dpiValue ? b > a.getWidth() && c > a.getHeight() : !0
        },
        checkAllLoaded: function() {
            for (var a = 0; a < e.runtime.design.pages.length; a++) {
                var b = e.runtime.design.pages[a].canvas._objects;
                if (e.runtime.design.pages[a].isLoading === !0) return !1;
                for (var c = 0; c < b.length; c++)
                    if ("image" === b[c].type && b[c].isLoading === !0) return !1
            }
            return !0
        },
        fetchItemFrmArray: function(a, b, c) {
            for (var d = 0, e = a.length; e > d; d++)
                if (a[d][b] === c) return a[d]
        },
        captureProps: function(a) {
            return {
                left: a.left,
                top: a.top,
                width: a.width,
                height: a.height,
                scaleX: a.scaleX,
                scaleY: a.scaleY,
                angle: a.angle
            }
        },
        findItems: function(a, b, d, e) {
            return e || (e = ""), c(a, b, d, e)
        },
        detectFF: function() {
            return window.navigator.userAgent.toLowerCase().indexOf("firefox") > -1
        },
        fetchIcon: function(a) {
            var b = "apps";
            switch (a) {
                case "ok":
                    b = "thumbs-o-up";
                    break;
                case "warning":
                    b = "warning";
                    break;
                case "cancel":
                    b = "highlight_remove";
                    break;
                case "error":
                    b = "thumbs-o-down";
                    break;
                case "font-size":
                    b = "font-size";
                    break;
                case "info":
                    b = "info2";
                    break;
                case "zip":
                    b = "file-zip";
                    break;
                case "video-camera":
                case "icon-pictures":
                case "upload":
                    b = a
            }
            return b
        },
        getStageBounds: function() {
            return {
                t: e.runtime.ui.config.topHeight,
                b: e.runtime.ui.container.height() - e.runtime.ui.config.bottomHeight,
                h: e.runtime.ui.container.height() - e.runtime.ui.config.topHeight - e.runtime.ui.config.bottomHeight,
                w: e.runtime.ui.container.width() - (e.runtime.ui.config.leftPanelWidth + d(".pp-panels").position().left),
                l: e.runtime.ui.config.leftPanelWidth + d(".pp-panels").position().left,
                r: e.runtime.ui.container.width()
            }
        },
        getCStage: function(a) {
            return {
                w: e.runtime.ui.container.width() + (a ? -150 : (W2P.isMobile ? -40 : -180) - (e.runtime.ui.config.maxi && !e.runtime.ui.config.forceHidePanel ? e.runtime.ui.config.leftPanelWidth : 0)),
                h: e.runtime.ui.container.height() - (W2P.isMobile ? 30 : 100) - e.runtime.ui.config.topHeight - e.runtime.ui.config.bottomHeight
            }
        },
        scaleToCanvas: function(a, b, c) {
            a.setCoords(), (a.getWidth() > b.getWidth() || a.getHeight() > b.getHeight() || c) && a.scale(a.getWidth() - b.getWidth() > a.getHeight() - b.getHeight() ? .7 * b.getWidth() / a.getWidth() : .7 * b.getHeight() / a.getHeight()), a.center(), a.setCoords()
        },
        checkIntersection: function(a, b) {
            var c = b.offset();
            return !(a.x > c.left && a.x < c.left + b.outerWidth() && a.y > c.top && a.y < c.top + b.outerHeight())
        },
        adjustOffset: function(a) {
            return a.left -= d(e.runtime.ui.container).offset().left, a.top -= d(e.runtime.ui.container).offset().top, a
        },
        rgbToColor: function(a) {
            var b = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            a = a.replace(b, function(a, b, c, d) {
                return b + b + c + c + d + d
            });
            var c = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);
            return new f.Color(256, new RGB(parseInt(c[1], 16), parseInt(c[2], 16), parseInt(c[3], 16)))
        },
        returnPath: function(a) {
            return a.split("pitchprint").join("pitchprint.cdn/"), "//" == a.substr(0, 2) ? location.protocol + a : "http" == a.substr(0, 4) || "www" == a.substr(0, 3) ? a : e.c.gUrlPrfx + a
        },
        getLanguage: function() {
            return e.lib.lang
        },
        broadcast: function(b, c) {
            a.broadcast(b, c)
        },
        getMeActualValueInches: function(a) {
            return this.getInches(this.getMeActualValue(a))
        },
        getMeActualValue: function(a, b) {
            b = b || (e.runtime.design.cPage ? 1 : e.runtime.design.cPage.pageData.scaling);
            var c;
            switch (e.runtime.design.unit) {
                case "inches":
                    c = this.convert(a, "pixeltoinches");
                    break;
                case "cm":
                    c = this.convert(a, "pixeltocm");
                    break;
                case "feet":
                    c = this.convert(a, "pixeltofeet");
                    break;
                default:
                    c = a
            }
            return c / (e.runtime.design.cScaling * b)
        },
        getPixels: function(a, b) {
            b = b || (e.runtime.design.cPage ? e.runtime.design.cPage.pageData.scaling : 1);
            var c;
            switch (e.runtime.design.unit) {
                case "inches":
                    c = this.convert(a, "inchestopixel");
                    break;
                case "cm":
                    c = this.convert(a, "cmtopixel");
                    break;
                case "feet":
                    c = this.convert(a, "feettopixel");
                    break;
                default:
                    c = a
            }
            return parseInt(c * b * (e.runtime.design.cScaling || 1))
        },
        getInches: function(a) {
            switch (e.runtime.design.unit) {
                case "cm":
                    return this.convert(a, "cmtoinches");
                case "feet":
                    return this.convert(a, "feettoinches");
                default:
                    return a
            }
        },
        convert: function(a, b) {
            var c = 0;
            switch (b) {
                case "cmtoinches":
                    c = a / 2.54;
                    break;
                case "inchestocm":
                    c = 2.54 * a;
                    break;
                case "inchestopixel":
                    c = a * e.c.screenDPI;
                    break;
                case "pixeltoinches":
                    c = a / e.c.screenDPI;
                    break;
                case "pixeltocm":
                    c = a / e.c.screenDPI * 2.54;
                    break;
                case "cmtopixel":
                    c = a / 2.54 * e.c.screenDPI;
                    break;
                case "pixeltofeet":
                    c = a / e.c.screenDPI / 12;
                    break;
                case "feettopixel":
                    c = a * e.c.screenDPI * 12;
                    break;
                case "feettoinches":
                    c = 12 * a
            }
            return c
        },
        cloneArray: function(a, b) {
            for (var c = [], d = 0, e = a.length; e > d; d++) c[d] = b ? a[d].clone() : a[d];
            return c
        },
        sortArr: function(a, b) {
            return a.sort(function(a, c) {
                return a[b].toLowerCase() > c[b].toLowerCase() ? 1 : -1
            }), a
        },
        stringToColor: function(a) {
            if ("string" != typeof a) return a;
            var b, c, d, e, g, h, i, j, k;
            return e = a.split("|"), 3 != e.length ? new f.Color(0) : (String(e[0]).length >= 7 && (g = String(e[0]).split(" "), g.length >= 4 && (h = g[0] / 100, i = g[1] / 100, j = g[2] / 100, k = g[3] / 100, b = new CMYK(h, i, j, k), c = b.toHex().hex)), String(e[1]).length >= 1 && (c = parseInt("0x" + String(e[1]).substr(1)), d = new Hex(c).toRGB()), new f.Color(c, d, b, String(e[2])))
        },
        toColorData: function(a) {
            var c = [];
            if (a instanceof Array)
                for (var d = 0, e = a.length; e > d; d++) c.push(b(a[d]));
            else c.push(b(a));
            return c
        },
        generateID: function() {
            return parseInt(999999 * Math.random()) + "_" + parseInt(12345 * Math.random()) + "_" + Date.now() + "_" + Math.floor(1234 * Math.random()) + parseInt(999999 * Math.random())
        },
        generateReference: function() {
            return this.md5(e.c.uniqueId + this.generateID() + 999999 * Math.random()).toLowerCase()
        },
        getExtension: function(a) {
            return a.substr(a.lastIndexOf(".") + 1).split("%").shift()
        },
        stripURL: function(a) {
            return a.split("/").pop().split("?").shift().split(".").join("_").split(" ").join("").split("=").join("").split("&").join("")
        },
        getFont: function(a) {
            for (var b = 0, c = e.lib.fonts.length; c > b; b++)
                if (e.lib.fonts[b].fontFamily.toLowerCase() === a.toLowerCase()) return e.lib.fonts[b]
        },
        md5: function(a) {
            function b(a, b) {
                return a << b | a >>> 32 - b
            }

            function c(a, b) {
                var c, d, e, f, g;
                return e = 2147483648 & a, f = 2147483648 & b, c = 1073741824 & a, d = 1073741824 & b, g = (1073741823 & a) + (1073741823 & b), c & d ? 2147483648 ^ g ^ e ^ f : c | d ? 1073741824 & g ? 3221225472 ^ g ^ e ^ f : 1073741824 ^ g ^ e ^ f : g ^ e ^ f
            }

            function d(a, b, c) {
                return a & b | ~a & c
            }

            function e(a, b, c) {
                return a & c | b & ~c
            }

            function f(a, b, c) {
                return a ^ b ^ c
            }

            function g(a, b, c) {
                return b ^ (a | ~c)
            }

            function h(a, e, f, g, h, i, j) {
                return a = c(a, c(c(d(e, f, g), h), j)), c(b(a, i), e)
            }

            function i(a, d, f, g, h, i, j) {
                return a = c(a, c(c(e(d, f, g), h), j)), c(b(a, i), d)
            }

            function j(a, d, e, g, h, i, j) {
                return a = c(a, c(c(f(d, e, g), h), j)), c(b(a, i), d)
            }

            function k(a, d, e, f, h, i, j) {
                return a = c(a, c(c(g(d, e, f), h), j)), c(b(a, i), d)
            }

            function l(a) {
                for (var b, c = a.length, d = c + 8, e = (d - d % 64) / 64, f = 16 * (e + 1), g = Array(f - 1), h = 0, i = 0; c > i;) b = (i - i % 4) / 4, h = i % 4 * 8, g[b] = g[b] | a.charCodeAt(i) << h, i++;
                return b = (i - i % 4) / 4, h = i % 4 * 8, g[b] = g[b] | 128 << h, g[f - 2] = c << 3, g[f - 1] = c >>> 29, g
            }

            function m(a) {
                var b, c, d = "",
                    e = "";
                for (c = 0; 3 >= c; c++) b = a >>> 8 * c & 255, e = "0" + b.toString(16), d += e.substr(e.length - 2, 2);
                return d
            }

            function n(a) {
                a = a.replace(/\r\n/g, "\n");
                for (var b = "", c = 0; c < a.length; c++) {
                    var d = a.charCodeAt(c);
                    128 > d ? b += String.fromCharCode(d) : d > 127 && 2048 > d ? (b += String.fromCharCode(d >> 6 | 192), b += String.fromCharCode(63 & d | 128)) : (b += String.fromCharCode(d >> 12 | 224), b += String.fromCharCode(d >> 6 & 63 | 128), b += String.fromCharCode(63 & d | 128))
                }
                return b
            }
            var o, p, q, r, s, t, u, v, w, x = Array(),
                y = 7,
                z = 12,
                A = 17,
                B = 22,
                C = 5,
                D = 9,
                E = 14,
                F = 20,
                G = 4,
                H = 11,
                I = 16,
                J = 23,
                K = 6,
                L = 10,
                M = 15,
                N = 21;
            for (a = n(a), x = l(a), t = 1732584193, u = 4023233417, v = 2562383102, w = 271733878, o = 0; o < x.length; o += 16) p = t, q = u, r = v, s = w, t = h(t, u, v, w, x[o + 0], y, 3614090360), w = h(w, t, u, v, x[o + 1], z, 3905402710), v = h(v, w, t, u, x[o + 2], A, 606105819), u = h(u, v, w, t, x[o + 3], B, 3250441966), t = h(t, u, v, w, x[o + 4], y, 4118548399), w = h(w, t, u, v, x[o + 5], z, 1200080426), v = h(v, w, t, u, x[o + 6], A, 2821735955), u = h(u, v, w, t, x[o + 7], B, 4249261313), t = h(t, u, v, w, x[o + 8], y, 1770035416), w = h(w, t, u, v, x[o + 9], z, 2336552879), v = h(v, w, t, u, x[o + 10], A, 4294925233), u = h(u, v, w, t, x[o + 11], B, 2304563134), t = h(t, u, v, w, x[o + 12], y, 1804603682), w = h(w, t, u, v, x[o + 13], z, 4254626195), v = h(v, w, t, u, x[o + 14], A, 2792965006), u = h(u, v, w, t, x[o + 15], B, 1236535329), t = i(t, u, v, w, x[o + 1], C, 4129170786), w = i(w, t, u, v, x[o + 6], D, 3225465664), v = i(v, w, t, u, x[o + 11], E, 643717713), u = i(u, v, w, t, x[o + 0], F, 3921069994), t = i(t, u, v, w, x[o + 5], C, 3593408605), w = i(w, t, u, v, x[o + 10], D, 38016083), v = i(v, w, t, u, x[o + 15], E, 3634488961), u = i(u, v, w, t, x[o + 4], F, 3889429448), t = i(t, u, v, w, x[o + 9], C, 568446438), w = i(w, t, u, v, x[o + 14], D, 3275163606), v = i(v, w, t, u, x[o + 3], E, 4107603335), u = i(u, v, w, t, x[o + 8], F, 1163531501), t = i(t, u, v, w, x[o + 13], C, 2850285829), w = i(w, t, u, v, x[o + 2], D, 4243563512), v = i(v, w, t, u, x[o + 7], E, 1735328473), u = i(u, v, w, t, x[o + 12], F, 2368359562), t = j(t, u, v, w, x[o + 5], G, 4294588738), w = j(w, t, u, v, x[o + 8], H, 2272392833), v = j(v, w, t, u, x[o + 11], I, 1839030562), u = j(u, v, w, t, x[o + 14], J, 4259657740), t = j(t, u, v, w, x[o + 1], G, 2763975236), w = j(w, t, u, v, x[o + 4], H, 1272893353), v = j(v, w, t, u, x[o + 7], I, 4139469664), u = j(u, v, w, t, x[o + 10], J, 3200236656), t = j(t, u, v, w, x[o + 13], G, 681279174), w = j(w, t, u, v, x[o + 0], H, 3936430074), v = j(v, w, t, u, x[o + 3], I, 3572445317), u = j(u, v, w, t, x[o + 6], J, 76029189), t = j(t, u, v, w, x[o + 9], G, 3654602809), w = j(w, t, u, v, x[o + 12], H, 3873151461), v = j(v, w, t, u, x[o + 15], I, 530742520), u = j(u, v, w, t, x[o + 2], J, 3299628645), t = k(t, u, v, w, x[o + 0], K, 4096336452), w = k(w, t, u, v, x[o + 7], L, 1126891415), v = k(v, w, t, u, x[o + 14], M, 2878612391), u = k(u, v, w, t, x[o + 5], N, 4237533241), t = k(t, u, v, w, x[o + 12], K, 1700485571), w = k(w, t, u, v, x[o + 3], L, 2399980690), v = k(v, w, t, u, x[o + 10], M, 4293915773), u = k(u, v, w, t, x[o + 1], N, 2240044497), t = k(t, u, v, w, x[o + 8], K, 1873313359), w = k(w, t, u, v, x[o + 15], L, 4264355552), v = k(v, w, t, u, x[o + 6], M, 2734768916), u = k(u, v, w, t, x[o + 13], N, 1309151649), t = k(t, u, v, w, x[o + 4], K, 4149444226), w = k(w, t, u, v, x[o + 11], L, 3174756917), v = k(v, w, t, u, x[o + 2], M, 718787259), u = k(u, v, w, t, x[o + 9], N, 3951481745), t = c(t, p), u = c(u, q), v = c(v, r), w = c(w, s);
            var O = m(t) + m(u) + m(v) + m(w);
            return O.toLowerCase()
        }
    }
}), Box.Application.addBehavior("all-behavs", function(a) {
    "use strict";
    var b = a.getGlobalConfig("model"),
        c = a.getService("images"),
        d = a.getGlobalConfig("events"),
        e = a.getGlobal("jQuery");
    return {
        onclick: function(c, f, g) {
            var h, i = !0;
            switch (g) {
                case "ui-flap":
                    b.runtime.ui.config.forceHidePanel = !b.runtime.ui.config.forceHidePanel, a.broadcast("adjust-layout");
                    break;
                case "show-panel-admin":
                case "show-panel-bg":
                case "show-panel-images":
                case "show-panel-texts":
                case "show-panel-module-data-form":
                case "show-panel-module-design-selector":
                    a.broadcast("select-panel", {
                        button: f,
                        eType: g.replace("show-panel-", "")
                    });
                    break;
                case "show-tab-bg-colors":
                case "show-tab-bg-images":
                case "show-tab-images-images":
                case "show-tab-images-facebook":
                case "show-tab-images-instagram":
                case "show-tab-images-userImages":
                case "show-tab-images-search":
                    a.broadcast("select-tab", g.replace("show-tab-", ""));
                    break;
                case "show-custom-color":
                    a.broadcast("show-custom-color");
                    break;
                case "add-new-color-btn":
                    a.broadcast("add-new-color-btn");
                    break;
                case "color-clicked":
                    if (e(c.target).attr("val")) {
                        var j = e(c.target).attr("val").split(",");
                        d.fire("change-color", b.lib.colors[j[0]].colors[j[1]])
                    } else i = !1;
                    break;
                case "text-art-clicked":
                    e(c.target).attr("urldata") ? (d.fire("load-text-art", e(c.target).attr("urldata")), setTimeout(function() {
                        a.broadcast("hide-panel")
                    }, 300)) : i = !1;
                    break;
                case "image-clicked":
                    e(c.target).attr("urldata") ? (h = e(c.target), b.runtime.act.routeImage ? a.broadcast("set-admin-image", {
                        url: h.attr("urldata")
                    }) : "bg" !== h.attr("type") && b.lib.design.disableImageClick && !b.c.isAdmin || (d.fire("load-image", {
                        type: h.attr("type"),
                        id: h.attr("id"),
                        url: h.attr("urldata"),
                        width: h.attr("mWidth"),
                        height: h.attr("mHeight"),
                        clicked: !0
                    }), setTimeout(function() {
                        a.broadcast("hide-panel")
                    }, 300))) : i = !1;
                    break;
                case "show-opacity-tool":
                    a.broadcast("show-opacity-tool", {
                        target: e(f),
                        anchor: e(f).attr("anchor"),
                        point: {
                            x: c.pageX,
                            y: c.pageY
                        }
                    });
                    break;
                case "pp-bg-changeto-userImages":
                    d.fire("bg-change-to-userImages");
                    break;
                case "search-pixabay":
                    a.broadcast("search-pixabay", e(f).attr("more"));
                    break;
                case "load-more":
                    a.broadcast("load-more", e(f).attr("more"));
                    break;
                case "pp-rmvBtn":
                    a.broadcast("remove-image-item", {
                        id: e(f).attr("id").replace("pp-rmvbtn-", ""),
                        path: e(f).attr("rmvPath")
                    });
                    break;
                case "show-facebook-login":
                    a.broadcast("show-facebook-login");
                    break;
                case "nav-next":
                    a.broadcast("nav-next");
                    break;
                case "nav-prev":
                    a.broadcast("nav-prev");
                    break;
                case "show-instagram-login":
                    a.broadcast("show-instagram-login");
                    break;
                case "app-close":
                    a.broadcast("app-close-start");
                    break;
                case "app-reload":
                    a.broadcast("app-reload-start");
                    break;
                case "toggle-snap":
                    b.runtime.act.snapOff = !b.runtime.act.snapOff, a.broadcast("snap-toggled");
                    break;
                case "page-swap-dimension":
                    d.fire("page-swap-dimension");
                    break;
                case "zoom":
                    d.fire("zoom-page", e(f).attr("val"));
                    break;
                case "undo":
                    d.fire("undo");
                    break;
                case "redo":
                    d.fire("redo");
                    break;
                case "clone-items":
                    d.fire("clone-items");
                    break;
                case "show-image-editor":
                case "ctx-edit-picture":
                    var k = {};
                    "bg" === e(f).attr("target") && (k = {
                        type: "bg",
                        ratio: b.runtime.design.cPage.canvas.width + ":" + b.runtime.design.cPage.canvas.height,
                        image: b.runtime.design.cPage.canvas.backgroundImage
                    }), d.fire("show-image-editor", k);
                    break;
                case "ctx-color":
                    a.broadcast("show-color-panel", {
                        anchor: "l",
                        selector: "[data-type='ctx-color']"
                    });
                    break;
                case "color-font-switch":
                    a.broadcast("toggle-color-font-switch");
                    break;
                case "color-opt":
                    a.broadcast("change-color-opt-index", e(f).attr("idx").replace("ct", ""));
                    break;
                case "ctx-copy":
                    d.fire("copy-items");
                    break;
                case "ctx-cut":
                    d.fire("cut-items");
                    break;
                case "ctx-delete":
                    d.fire("delete-items");
                    break;
                case "ctx-opacity":
                    a.broadcast("show-opacity-tool", {
                        target: e(f),
                        anchor: "t"
                    });
                    break;
                case "ctx-text-edit":
                    a.broadcast("show-text-editor");
                    break;
                case "ctx-toggle-textbox":
                    d.fire("toggle-textbox");
                    break;
                case "ctx-text-bold":
                case "ctx-text-italic":
                case "ctx-text-underline":
                case "ctx-text-left":
                case "ctx-text-center":
                case "ctx-text-right":
                case "ctx-text-justify":
                    d.fire("format-text", g.replace("ctx-text-", ""));
                    break;
                case "ctx-group":
                    d.fire("create-group");
                    break;
                case "ctx-ungroup":
                    d.fire("ungroup");
                    break;
                case "ctx-edit-group":
                    d.fire("edit-group");
                    break;
                case "ctx-toggle-photo-expand":
                    d.fire("toggle-photo-expand");
                    break;
                case "exit-group-btn":
                    d.fire("exit-edit-group");
                    break;
                case "paste-btn":
                    d.fire("paste-items");
                    break;
                case "font-clicked":
                    d.fire("format-text", {
                        prop: "font",
                        value: parseInt(e(c.target).attr("val"))
                    });
                    break;
                case "align":
                    d.fire("align-items", e(f).attr("val"));
                    break;
                case "depth":
                    d.fire("stack-items", e(f).attr("val"));
                    break;
                case "preview-close":
                    a.broadcast("hide-preview");
                    break;
                case "app-finish":
                    a.broadcast("show-preview", !0);
                    break;
                case "show-preview":
                    a.broadcast("show-preview");
                    break;
                case "preview-nav":
                    a.broadcast("select-preview", e(f).attr("val"));
                    break;
                case "preset-submit":
                    a.broadcast("submit-preview");
                    break;
                case "preview-submit":
                    "function" == typeof b.functions.onSaveButtonClicked ? b.functions.onSaveButtonClicked() : d.fire("start-save");
                    break;
                case "ds-select-page":
                    d.fire("select-page", parseInt(e(f).attr("idx")));
                    break;
                case "add-new-text-btn":
                    d.fire("start-new-text"), setTimeout(function() {
                        a.broadcast("hide-panel")
                    }, 300);
                    break;
                case "help":
                    introJs().start();
                    break;
                case "pack":
                    a.broadcast("pack-clicked", {
                        x: c.pageX,
                        y: c.pageY
                    });
                    break;
                case "export-group":
                    a.broadcast("start-export-group");
                    break;
                case "show-add-ts-cat":
                    a.broadcast("show-add-ts-cat");
                    break;
                case "pan":
                    a.broadcast("pan");
                    break;
                default:
                    f && g ? e(f).attr("isMod") ? a.broadcast(g, e(f).attr("iRef") || e(f).attr("id")) : i = !1 : f || g ? i = !1 : a.broadcast("stage-clicked", {
                        x: c.pageX,
                        y: c.pageY
                    })
            }
            i && c.stopImmediatePropagation()
        },
        oninput: function(c, f, g) {
            switch (g) {
                case "text-editor":
                    d.fire("edit-text", e(f).val());
                    break;
                case "font-size":
                    isNaN(parseInt(e(f).val())) || d.fire("format-text", {
                        prop: "size",
                        value: b.lib.config.decimalPointTextSize ? e(f).val() : parseInt(e(f).val())
                    });
                    break;
                case "check-basics":
                    a.broadcast("check-basics")
            }
        },
        onchange: function(b, d, f) {
            var g = !0;
            switch (f) {
                case "bgImages":
                    c.changeImageCat(f);
                    break;
                case "images":
                    c.changeImageCat(f);
                    break;
                case "facebook":
                    a.broadcast("change-fb-album");
                    break;
                case "styles-cat":
                    c.changeImageCat("text-arts");
                    break;
                default:
                    a.broadcast(f, e(d).attr("iRef") || e(d).attr("id"))
            }
            g && b.stopImmediatePropagation()
        }
    }
}), Box.Application.addModule("navigator", function(a) {
    "use strict";

    function b() {
        i.css({
            left: (m.runtime.ui.config.maxi && !m.runtime.ui.config.forceHidePanel ? m.runtime.ui.config.leftPanelWidth : 0) + "px"
        })
    }

    function c() {
        !p || m.runtime.ui.config.maxi && !m.runtime.ui.config.forceHidePanel ? p || !m.runtime.ui.config.maxi && m.runtime.ui.config.forceHidePanel || (TweenLite.to(i, .5, {
            left: m.runtime.ui.config.leftPanelWidth,
            ease: Power2.easeInOut
        }), p = !0) : (TweenLite.to(i, .5, {
            left: 0,
            delay: .4,
            ease: Power2.easeInOut
        }), p = !1)
    }

    function d() {
        j = l("#pp_nav_lbtn").detach(), k = l("#pp_nav_rbtn").detach(), b(), c()
    }

    function e() {
        if (m.runtime.ui.stage.element) {
            var a = n.adjustOffset(m.runtime.ui.stage.element.offset()),
                b = (m.runtime.ui.container.height() + m.runtime.ui.config.topHeight - m.runtime.ui.config.bottomHeight - j.height()) / 2,
                c = a.left - 25 - j.width(),
                d = a.left + m.runtime.ui.stage.element.width() + 30;
            c < (m.runtime.ui.config.maxi && !m.runtime.ui.config.forceHidePanel ? m.runtime.ui.config.leftPanelWidth : 10) && (c = m.runtime.ui.config.maxi && !m.runtime.ui.config.forceHidePanel ? m.runtime.ui.config.leftPanelWidth + 10 : 10), d > m.runtime.ui.pack.width() - k.width() - 10 && (d = m.runtime.ui.pack.width() - 2 - k.width()), j.css({
                top: b
            }), k.css({
                top: b
            }), TweenLite.to(j, .4, {
                left: c,
                ease: Power2.easeInOut
            }), TweenLite.to(k, .4, {
                left: d,
                ease: Power2.easeInOut
            })
        }
    }

    function f() {
        m.runtime.design.pages.length > 1 && !m.c.disableNavButtons ? (j.show(), k.show(), j.parent().length || m.runtime.ui.pack.append(j), k.parent().length || m.runtime.ui.pack.append(k), e(), 0 === m.runtime.design.cPage.pageData.index ? j.addClass("pp-nav-disabled") : j.removeClass("pp-nav-disabled"), m.runtime.design.cPage.pageData.index === m.runtime.design.pages.length - 1 ? k.addClass("pp-nav-disabled") : k.removeClass("pp-nav-disabled")) : (j.hide(), k.hide()), l(".pp-nav-title").text(m.runtime.navTitle || m.runtime.design.cPage.pageData.title)
    }

    function g(a) {
        var b = m.runtime.design.cPage.pageData.index + (a ? 1 : -1);
        b >= 0 && b < m.runtime.design.pages.length && o.selectPage(b, !0)
    }

    function h(a) {
        j && k && (k.css(a ? {
            "pointer-events": "none"
        } : {
            "pointer-events": "auto"
        }), j.css(a ? {
            "pointer-events": "none"
        } : {
            "pointer-events": "auto"
        }))
    }
    var i, j, k, l = a.getGlobal("jQuery"),
        m = a.getGlobalConfig("model"),
        n = a.getService("utils"),
        o = a.getService("pages"),
        p = !0;
    return {
        init: function() {
            i = l(a.getElement()), d()
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "adjust-layout", "page-select-end", "nav-next", "nav-prev", "stage-adjusted", "set-navs", "alert-processing", "alert-hide"],
        onmessage: function(a, d) {
            switch (a) {
                case "stage-adjusted":
                    setTimeout(function() {
                        e()
                    }, 200);
                    break;
                case "resize":
                    b(), setTimeout(function() {
                        e()
                    }, 200);
                    break;
                case "adjust-layout":
                    c();
                    break;
                case "set-navs":
                case "page-select-end":
                    f();
                    break;
                case "nav-next":
                    g(!0);
                    break;
                case "nav-prev":
                    g(!1);
                    break;
                case "alert-hide":
                    h();
                    break;
                case "alert-processing":
                    h(!0)
            }
        }
    }
}), Box.Application.addModule("panel-menus", function(a) {
    "use strict";

    function b(a, b, c) {
        e.append(g('<li><a data-type="' + a + '" ' + (c ? 'data-tip="{' + c + '}" anchor="b"' : "") + ' class="pp-large-icon-only-btn"><i class="pp-icon-' + b + ' pp-large-icon"></i></a></li>'))
    }

    function c(a) {
        f && f.removeClass("pp-btn-selected"), f = g(a), f.length && f.addClass("pp-btn-selected")
    }
    var d, e, f, g = a.getGlobal("jQuery");
    a.getGlobalConfig("model");
    return {
        init: function() {
            d = g(a.getElement()), e = g(".pp-panel-menus-ul")
        },
        behaviors: ["all-behavs"],
        messages: ["create-tab-btn", "toggle-panel-btn"],
        onmessage: function(a, d) {
            switch (a) {
                case "create-tab-btn":
                    b(d.dt, d.icon, d.tip);
                    break;
                case "toggle-panel-btn":
                    c(d)
            }
        }
    }
}), Box.Application.addModule("primary-menus", function(a) {
    "use strict";

    function b() {
        h = i("#pp_primary_menus_ul"), i(j.c.parentDiv).length > 0 && i('[data-type="app-close"]').remove()
    }

    function c(a, b, c, d) {
        h.prepend(i("<li><a " + c + ' data-type="' + a + '" ' + (d ? 'data-tip="{' + d + '}" anchor="b"' : "") + ' class="pp-large-icon-only-btn"><i class="pp-icon-' + b + ' pp-large-icon"></i></a></li>'))
    }

    function d() {
        a.broadcast("dialog", {
            text: j.lib.lang.close_alert,
            icon: "warning",
            buttons: {
                ok: {
                    label: j.lib.lang.button_label_yes,
                    click: function() {
                        j.runtime.ui.pack.unblock(), setTimeout(function() {
                            k.fire("close-app")
                        }, 500)
                    }
                },
                cancel: {
                    label: j.lib.lang.button_label_no,
                    click: "close"
                }
            }
        })
    }

    function e() {
        a.broadcast("dialog", {
            text: j.lib.lang.reload_alert,
            icon: "warning",
            buttons: {
                ok: {
                    label: j.lib.lang.button_label_yes,
                    click: function() {
                        k.fire("reload-app")
                    }
                },
                cancel: {
                    label: j.lib.lang.button_label_no,
                    click: "close"
                }
            }
        })
    }

    function f(a) {
        g && g.css(a ? {
            opacity: "0.5",
            "pointer-events": "none"
        } : {
            opacity: "1",
            "pointer-events": "auto"
        })
    }
    var g, h, i = a.getGlobal("jQuery"),
        j = a.getGlobalConfig("model"),
        k = a.getGlobalConfig("events");
    return {
        init: function() {
            g = i(a.getElement()), b()
        },
        behaviors: ["all-behavs"],
        messages: ["app-close-start", "app-reload-start", "create-primary-btn", "alert-processing", "alert-hide"],
        onmessage: function(a, b) {
            switch (a) {
                case "app-close-start":
                    d();
                    break;
                case "app-reload-start":
                    e();
                    break;
                case "create-primary-btn":
                    c(b.dt, b.icon, b.attr, b.tip);
                    break;
                case "alert-hide":
                    f();
                    break;
                case "alert-processing":
                    f(!0)
            }
        }
    }
}), Box.Application.addModule("sec-menus", function(a) {
    "use strict";

    function b() {
        m.css({
            left: (B.runtime.ui.config.maxi && !B.runtime.ui.config.forceHidePanel ? B.runtime.ui.config.leftPanelWidth : 0) + "px"
        })
    }

    function c() {
        !C || B.runtime.ui.config.maxi && !B.runtime.ui.config.forceHidePanel ? C || !B.runtime.ui.config.maxi && B.runtime.ui.config.forceHidePanel || (TweenLite.to(m, .5, {
            left: B.runtime.ui.config.leftPanelWidth,
            delay: .4,
            ease: Power2.easeInOut
        }), C = !0) : (TweenLite.to(m, .5, {
            left: 0,
            delay: .4,
            ease: Power2.easeInOut
        }), C = !1)
    }

    function d() {
        n = x(".pp-sec-menus"), q = x('<div style="position:absolute;cursor: move"></div>'), B.runtime.ui.container.append(q), e(), q.hide(), x("[data-type='pan']").length || x('<li><a data-type="pan" class="pp-small-link-button-trans"><i class="pp-icon-open_with pp-med-icon"></i></a></li>').insertAfter(x(x("[data-type='zoom']")[1]).parent()), r = x(x("[data-type='pan']").parent()).hide(), x("[data-type='paste-btn'], [data-type='clone-items'], [data-type='export-group'], [data-type='exit-group-btn']").hide(), b(), c()
    }

    function e() {
        q.on("mousedown", function(a) {
            s = !0, t = a.clientX, u = a.clientY, v = B.runtime.design.cPage.pageData.zLeft, w = B.runtime.design.cPage.pageData.zTop
        }), q.on("mousemove", function(b) {
            if (s) {
                var c = b.clientX - t,
                    d = b.clientY - u;
                B.runtime.design.cPage.pageData.zLeft = v + c, B.runtime.design.cPage.pageData.zTop = w + d, a.broadcast("position-stage")
            }
        }), q.on("mouseup", function(a) {
            s = !1
        })
    }

    function f() {
        B.runtime.act.snapOff ? x("[data-type='toggle-snap']").removeClass("pp-btn-selected-hot") : x("[data-type='toggle-snap']").addClass("pp-btn-selected-hot")
    }

    function g() {
        o || (setTimeout(function() {
            y.create({
                anchor: "t",
                ahide: !1,
                target: x("[data-type='exit-group-btn']"),
                content: B.lib.lang.exit_group_tip
            }).forceShow()
        }, 500), o = !0)
    }

    function h() {
        B.runtime.page.cItems.length > 1 ? x("[data-type='clone-items']").hide() : "group" === B.runtime.page.cItem.type ? (x("[data-type='export-group']").show(), x("[data-type='clone-items']").hide()) : (x("[data-type='export-group']").hide(), x("[data-type='clone-items']").show())
    }

    function i() {
        x("[data-type='clone-items'], [data-type='export-group']").hide()
    }

    function j() {
        var a = B.runtime.ui.stage.element.height(),
            b = B.runtime.ui.stage.element.width(),
            c = B.runtime.ui.stage.element.position(),
            d = z.getStageBounds();
        b > d.w || c.left < d.l || c.left + b > d.r || a > d.h || c.top < d.t || c.top + a > d.b ? r.show() : (p = !1, r.hide(), k())
    }

    function k() {
        p ? (x("[data-type='pan']").addClass("pp-btn-selected-hot"), q.show(), A.fire("discard-selection"), l()) : (x("[data-type='pan']").removeClass("pp-btn-selected-hot"), q.hide())
    }

    function l() {
        if (p) {
            var a = z.getStageBounds();
            q.css({
                width: a.w,
                height: a.h,
                top: a.t,
                left: a.l
            })
        }
    }
    var m, n, o, p, q, r, s, t, u, v, w, x = a.getGlobal("jQuery"),
        y = a.getService("pop-over"),
        z = a.getService("utils"),
        A = a.getGlobalConfig("events"),
        B = a.getGlobalConfig("model"),
        C = !0;
    return {
        init: function() {
            m = x(a.getElement()), d(), f()
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "adjust-layout", "snap-toggled", "show-paste-btn", "show-group-exit-btn", "hide-group-exit-btn", "canvas-object-cleared", "canvas-object-selected", "after-zoom", "pan", "escape"],
        onmessage: function(a, d) {
            switch (a) {
                case "snap-toggled":
                    f();
                    break;
                case "resize":
                    b(), l();
                    break;
                case "adjust-layout":
                    c();
                    break;
                case "show-paste-btn":
                    x("[data-type='paste-btn']").show();
                    break;
                case "hide-group-exit-btn":
                    x("[data-type='exit-group-btn']").hide();
                    break;
                case "show-group-exit-btn":
                    x("[data-type='exit-group-btn']").show(), g();
                    break;
                case "canvas-object-cleared":
                    i();
                    break;
                case "canvas-object-selected":
                    h();
                    break;
                case "after-zoom":
                    j();
                    break;
                case "escape":
                    p && (p = !1, k());
                    break;
                case "pan":
                    p = !p, k()
            }
        }
    }
}), Box.Application.addModule("pack", function(a) {
    "use strict";

    function b() {
        f.css({
            width: h.runtime.ui.container.width(),
            height: h.runtime.ui.container.height(),
            position: "absolute",
            top: 0
        })
    }

    function c(a) {
        var b;
        a && g("#" + a).length ? (b = g("#" + a), b.height(h.runtime.ui.container.height() - (b.offset().top - h.runtime.ui.container.offset().top) + "px"), b.perfectScrollbar(b.hasClass("ps-container") ? "update" : {
            suppressScrollX: !0
        })) : g(".pp-uses-scroll").each(function() {
            b = g(this), b.height(h.runtime.ui.container.height() - (b.offset().top - h.runtime.ui.container.offset().top) + "px"), b.perfectScrollbar(b.hasClass("ps-container") ? "update" : {
                suppressScrollX: !0
            })
        })
    }

    function d(a) {
        var b = h.runtime.act.popStack[h.runtime.act.popStack.length - 1];
        b.ahide || i.checkIntersection(a, b.html) && h.runtime.act.popStack.pop().hide()
    }

    function e() {
        h.runtime.act.popStack.length && (h.runtime.act.popStack.forEach(function(a) {
            a.hide()
        }), h.runtime.act.popStack = [])
    }
    var f, g = a.getGlobal("jQuery"),
        h = a.getGlobalConfig("model"),
        i = a.getService("utils"),
        j = a.getGlobalConfig("events");
    return {
        init: function() {
            f = h.runtime.ui.pack = g(a.getElement()), b()
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "init-layout", "before-show", "update-scrolls", "after-tab-change", "after-panel-change", "canvas-object-cleared", "clear-all-popups", "page-select-start", "stage-clicked", "pack-clicked"],
        onmessage: function(a, f) {
            switch (a) {
                case "before-show":
                case "resize":
                    b(), c();
                    break;
                case "update-scrolls":
                    c(f);
                    break;
                case "init-layout":
                    b();
                    break;
                case "after-panel-change":
                case "after-tab-change":
                    c();
                    break;
                case "clear-all-popups":
                case "canvas-object-cleared":
                case "page-select-start":
                    e();
                    break;
                case "stage-clicked":
                    h.runtime.act.popStack.length && d(f);
                    break;
                case "pack-clicked":
                    h.runtime.design.cPage && j.fire("discard-selection")
            }
        }
    }
}), Box.Application.addModule("panel-bg", function(a) {
    "use strict";

    function b() {
        l.c.stopDefaultPanels ? g.remove() : (!l.lib.design.hidebackgroundpanel && !l.lib.design.hideBackgroundPanel || l.c.isAdmin) && (a.broadcast("create-tab-btn", {
            icon: "texture",
            dt: "show-panel-bg",
            tip: "background_tip"
        }), l.runtime.ui.panels.bg = g, a.broadcast("add-panel", g), c(), j = !0)
    }

    function c() {
        k("#pp_sec_bg_tabs_titles").append('<li data-type="show-tab-bg-colors"> <a><i class="pp-icon-format_color_fill pp-med-icon"></i></a> </li>'), k("#pp_sec_bg_tabs_panels").append('<div class="pp-tab-div1 pp-hidden" id="pp_tab_bg_colors">'), l.runtime.ui.tabs["bg-colors"] = k("#pp_tab_bg_colors")
    }

    function d(a) {
        h && h.removeClass("pp-btn-tab-selected"), h = k("[data-type='show-tab-" + a + "']"), h.length && h.addClass("pp-btn-tab-selected")
    }

    function e() {
        return l.runtime.design.cPage && "image" === l.runtime.design.cPage.pageData.fillData.type ? (k("#pp_show_bg_editor").removeClass("pp-disabled"), void k("#pp_bg_opacity_btn").addClass("pp-disabled")) : (k("#pp_show_bg_editor").addClass("pp-disabled"), void k("#pp_bg_opacity_btn").removeClass("pp-disabled"))
    }

    function f(b) {
        b && "bg" === b.split("-")[0] && j && (d(b), "bg-colors" === b && a.broadcast("attach-color-panel", {
            elem: k("#pp_tab_bg_colors"),
            colorItemMode: !1
        }), i && TweenLite.to(i, .3, {
            autoAlpha: 0
        }), i = l.runtime.ui.tabs[b], TweenLite.to(i, .3, {
            autoAlpha: 1
        }), e())
    }
    var g, h, i, j, k = a.getGlobal("jQuery"),
        l = a.getGlobalConfig("model");
    return {
        init: function() {
            g = k(a.getElement())
        },
        behaviors: ["all-behavs"],
        messages: ["panel-ready", "select-tab", "after-show", "page-select-end", "update-ui", "page-bg-changed"],
        onmessage: function(a, c) {
            switch (a) {
                case "panel-ready":
                    b();
                    break;
                case "select-tab":
                    f(c);
                    break;
                case "after-show":
                    i || f("bg-colors"), e();
                    break;
                case "page-bg-changed":
                case "update-ui":
                case "page-select-end":
                    e()
            }
        }
    }
}), Box.Application.addModule("panel-images", function(a) {
    "use strict";

    function b() {
        k.c.stopDefaultPanels ? e.remove() : k.lib.design.hideImagePanel && !k.c.isAdmin || (a.broadcast("create-tab-btn", {
            icon: "images",
            dt: "show-panel-images",
            tip: "picture_tip"
        }), k.runtime.ui.panels.images = e, a.broadcast("add-panel", e), h = !0), i = a.getService("image-editor")
    }

    function c(a) {
        g && g.removeClass("pp-btn-tab-selected"), g = j("[data-type='show-tab-" + a + "']"), g.length && g.addClass("pp-btn-tab-selected")
    }

    function d(b) {
        b && "images" === b.split("-")[0] && h && (c(b), "bg-colors" === b && a.broadcast("attach-color-panel", {
            elem: j("#pp_tab_bg_colors"),
            colorItemMode: !1
        }), f && TweenLite.to(f, .3, {
            autoAlpha: 0
        }), f = k.runtime.ui.tabs[b], TweenLite.to(f, .3, {
            autoAlpha: 1
        }))
    }
    var e, f, g, h, i, j = a.getGlobal("jQuery"),
        k = a.getGlobalConfig("model");
    return {
        init: function() {
            e = j(a.getElement())
        },
        behaviors: ["all-behavs"],
        messages: ["panel-ready", "select-tab", "after-show"],
        onmessage: function(a, c) {
            switch (a) {
                case "panel-ready":
                    b();
                    break;
                case "select-tab":
                    d(c);
                    break;
                case "after-show":
                    f || d("images-images")
            }
        }
    }
}), Box.Application.addModule("panel-texts", function(a) {
    "use strict";

    function b() {
        if (f.c.stopDefaultPanels) c.remove();
        else if (!f.lib.design.hideTextPanel || f.c.isAdmin) {
            if (a.broadcast("create-tab-btn", {
                    icon: "type",
                    dt: "show-panel-texts",
                    tip: "text_tip"
                }), f.runtime.ui.panels.texts = c, a.broadcast("add-panel", c), !d("#pp_sec_text-arts_panels").length) return;
            e.laySelector(f.lib["text-arts"], "pp_styles_cat_selector"), f.lib["text-artsConf"] = {
                panel: "pp_styles_panels_div",
                select: "pp_styles_cat_selector",
                target: "text-arts",
                clickable: !0
            }, e.changeImageCat("text-arts")
        }
    }
    var c, d = a.getGlobal("jQuery"),
        e = a.getService("images"),
        f = a.getGlobalConfig("model");
    return {
        init: function() {
            c = d(a.getElement())
        },
        behaviors: ["all-behavs"],
        messages: ["panel-ready"],
        onmessage: function(a, c) {
            switch (a) {
                case "panel-ready":
                    b()
            }
        }
    }
}), Box.Application.addModule("panels", function(a) {
    "use strict";

    function b() {
        l = m(".pp-panels-container")
    }

    function c() {
        k.css({
            height: p.runtime.ui.pack.height() - k.position().top,
            left: (p.runtime.ui.config.maxi && !p.runtime.ui.config.forceHidePanel ? 0 : -p.runtime.ui.config.leftPanelWidth) + "px"
        })
    }

    function d() {
        !n || p.runtime.ui.config.maxi && !p.runtime.ui.config.forceHidePanel ? n || !p.runtime.ui.config.maxi && p.runtime.ui.config.forceHidePanel || (TweenLite.to(k, .4, {
            left: 0,
            ease: Power2.easeOut
        }), p.runtime.ui.panelShown = !0, n = !0) : (TweenLite.to(k, .4, {
            left: "-=" + p.runtime.ui.config.leftPanelWidth,
            ease: Power2.easeOut
        }), p.runtime.ui.panelShown = !1, n = !1), TweenLite.to("#pp-left-flap-icon", .5, {
            left: n ? "-20px" : "10px",
            delay: .4
        })
    }

    function e() {
        d(), a.broadcast("panel-ready"), p.runtime.ui.hideFlaps && m(".pp-left-flap").hide()
    }

    function f(a) {
        a.length && l.append(a)
    }

    function g(b, c) {
        n || c || (TweenLite.to(k, .2, {
            left: 0,
            ease: Power2.easeOut
        }), n = !0), "string" == typeof b && (b = {
            button: "[data-type='show-panel-" + b + "']",
            eType: b
        }), a.broadcast("toggle-panel-btn", b.button), p.runtime.ui.currentPanel != p.runtime.ui.panels[b.eType] && (p.runtime.ui.currentPanel && TweenLite.to(p.runtime.ui.currentPanel, .3, {
            autoAlpha: 0
        }), p.runtime.ui.currentPanel = p.runtime.ui.panels[b.eType], TweenLite.to(p.runtime.ui.currentPanel, .3, {
            autoAlpha: 1
        }), a.broadcast("after-panel-change", b.eType))
    }

    function h() {
        var b;
        switch (p.runtime.design.altDefaultPanel || p.runtime.design.defaultTab) {
            case "bg-colors":
                g("bg", !0), b = "bg-colors";
                break;
            case "bg-pictures":
                g("bg", !0), b = "bg-images";
                break;
            case "picture-gallery":
                g("images", !0), b = "images-images";
                break;
            case "custom-image-div":
                g("images", !0), b = "images-userImages";
                break;
            case "facebook-gallery":
                g("images", !0), b = "images-facebook";
                break;
            case "instagram-gallery":
                g("images", !0), b = "images-instagram";
                break;
            case "search-gallery":
                g("images", !0), b = "images-search";
                break;
            case "admin":
                g("admin", !0);
                break;
            case "text":
                g("text", !0);
                break;
            default:
                g("bg", !0), b = "bg-colors"
        }!n || p.runtime.ui.config.maxi && !p.runtime.ui.config.forceHidePanel || j(), a.broadcast("select-tab", b)
    }

    function i(a) {
        o.checkIntersection(a, k) && j()
    }

    function j() {
        TweenLite.to(k, .2, {
            left: "-=" + p.runtime.ui.config.leftPanelWidth,
            ease: Power2.easeOut
        }), n = !1
    }
    var k, l, m = a.getGlobal("jQuery"),
        n = !0,
        o = a.getService("utils"),
        p = a.getGlobalConfig("model");
    return {
        init: function() {
            k = m(a.getElement()), b()
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "adjust-layout", "add-panel", "init-layout", "after-show", "select-panel", "stage-clicked", "pack-clicked", "hide-panel"],
        onmessage: function(a, b) {
            switch (a) {
                case "resize":
                    c();
                    break;
                case "add-panel":
                    f(b);
                    break;
                case "adjust-layout":
                    d();
                    break;
                case "init-layout":
                    e();
                    break;
                case "after-show":
                    h();
                    break;
                case "select-panel":
                    g(b);
                    break;
                case "pack-clicked":
                case "stage-clicked":
                    !n || p.runtime.ui.config.maxi && !p.runtime.ui.config.forceHidePanel || i(b);
                    break;
                case "hide-panel":
                    !n || p.runtime.ui.config.maxi && !p.runtime.ui.config.forceHidePanel || j()
            }
        }
    }
}), Box.Application.addModule("module-canvas-adjuster", function(a) {
    "use strict";

    function b() {
        if (!x) {
            if (r = D.runtime.modules.ca) {
                var b = "";
                return w = r.lockAspectRatio || r.photoMode, r.dockUi ? (q.empty().hide(), b = '<style>.pp-ca-inputdiv { border-radius: 4px; padding: 8px; height: 36px; background-color: rgba(255, 255, 255, 0.4); } </style><div id="pp_mod_ca_customdiv" style="display: block;margin-right: 10px;margin-top: 3px;"><div class="pp-ca-inputdiv pp-flex-display" style=""><i class="pp-icon-code pp-context-icon pp-ca-darcol" style="color: white !important;font-weight: bold;font-size: 18px;"></i><input data-type="mod-ca-input" idx="w" type="text" value="" id="pp-ca-width" class="pp-ca-input"></div><div class="pp-ca-togglediv pp-flex-display" style="opacity: 0.8;"><img ismod="1" data-type="mod-ca-aspectlock" id="pp_ca_lockimg" src="https://dta8vnpq1ae34.cloudfront.net/images/zlock.png"></div><div class="pp-ca-inputdiv pp-flex-display"><i class="pp-icon-unfold_more pp-context-icon pp-ca-darcol" style="color: white !important;font-weight: bold;font-size: 18px;"></i><input data-type="mod-ca-input" idx="h" type="text" value="" id="pp-ca-height" class="pp-ca-input"></div></div>', q = C(b), q.appendTo(C(".pp-navigator").empty().css("pointer-events", "auto")), C("[data-type='mod-ca-input']").on("input", function(a) {
                    h(C(a.currentTarget).attr("idx")), u.length && v.length && !isNaN(u.val()) && !isNaN(v.val()) && parseFloat(u.val()) > 0 && parseFloat(u.val()) > 2 * D.runtime.design.cPage.pageData.bleed && parseFloat(v.val()) > 0 && parseFloat(v.val()) > 2 * D.runtime.design.cPage.pageData.bleed && g(parseFloat(u.val()), parseFloat(v.val()))
                })) : (q.removeClass("pp-hidden").show(), D.runtime.ui.container.append(q), a.broadcast("create-primary-btn", {
                    icon: "transform",
                    dt: "show-canvas-adjuster-form",
                    attr: 'isMod="1" data-intro="{help_ca_button}"',
                    tip: "ca_button_tooltip"
                })), r.photoMode && (r.linkPages = !1), b = "", r.presets.forEach(function(a, c) {
                    b += '<option value="' + c + '">' + a.title + " (" + a.width + " x " + a.height + ")</option>"
                }), C("#pp_mod_ca_title").html(r.title + " (" + D.runtime.design.unit + ")"), b && !r.photoMode ? C("#pp_mod_ca_select").html('<option value="-1">...</option>' + b) : C("#pp_mod_ca_select").hide(), r.customValues || r.photoMode ? C("#pp_ca_lockimg").attr("src", D.server.cloudFront + "images/" + (w ? "zlock" : "zunlock") + ".png") : C("#pp_mod_ca_customdiv").hide(), u = C("#pp-ca-width"), v = C("#pp-ca-height"), f(), e(), void(x = !0)
            }
            Box.Application.stop(a.getElement()), C(a.getElement()).remove()
        }
    }

    function c() {
        D.runtime.design.cPage && (d(), TweenLite.to(q, .4, {
            ease: Power2.easeOut,
            top: 0
        }), s = !0)
    }

    function d() {
        D.runtime.design.cPage && (u.val(parseFloat(D.runtime.design.cPage.pageData.fWidth)), v.val(parseFloat(D.runtime.design.cPage.pageData.fHeight)), r.ratios = [parseFloat(D.runtime.design.cPage.pageData.fWidth) - (B ? 0 : 2 * D.runtime.design.cPage.pageData.bleed), parseFloat(D.runtime.design.cPage.pageData.fHeight) - (B ? 0 : 2 * D.runtime.design.cPage.pageData.bleed)])
    }

    function e() {
        TweenLite.to(q, .4, {
            ease: Power2.easeOut,
            top: -(q.outerHeight() + 10)
        }), s = !1
    }

    function f() {
        q.css("left", parseInt((D.runtime.ui.container.width() - q.width()) / 2) + "px")
    }

    function g(a, b) {
        r.linkPages && D.runtime.design.pages.length > 1 ? D.runtime.design.pages.forEach(function(c) {
            c.editPageSize(a, b, !0)
        }) : (D.runtime.design.cPage.editPageSize(a, b, !0), l()), t = !0, "function" == typeof D.functions.onCaUpdate && D.functions.onCaUpdate(j())
    }

    function h(a) {
        if (isNaN(u.val())) return void u.val(D.runtime.design.cPage.pageData.fWidth);
        if (isNaN(v.val())) return void v.val(D.runtime.design.cPage.pageData.fHeight);
        for (var b = "-1", c = 0; c < r.presets.length; c++)
            if (r.presets[c].width == parseFloat(u.val()) && r.presets[c].height == parseFloat(v.val())) {
                b = c;
                break
            }
        if (w)
            if ("w" === a) {
                if (parseFloat(u.val()) <= 0 || parseFloat(u.val()) < 2 * D.runtime.design.cPage.pageData.bleed) return;
                v.val(E.oneDecimal((parseFloat(u.val()) - (B ? 0 : 2 * D.runtime.design.cPage.pageData.bleed)) * (r.ratios[1] / r.ratios[0]) + (B ? 0 : 2 * D.runtime.design.cPage.pageData.bleed)))
            } else {
                if (parseFloat(v.val()) <= 0 || parseFloat(v.val()) < 2 * D.runtime.design.cPage.pageData.bleed) return;
                u.val(E.oneDecimal((parseFloat(v.val()) - (B ? 0 : 2 * D.runtime.design.cPage.pageData.bleed)) * (r.ratios[0] / r.ratios[1]) + (B ? 0 : 2 * D.runtime.design.cPage.pageData.bleed)))
            }
        C("#pp-modca-select").val(b), t = !1
    }

    function i() {
        if (-1 != C("#pp_mod_ca_select").val()) {
            var a = r.presets[parseInt(C("#pp_mod_ca_select").val())];
            u.val(a.width), v.val(a.height), g(parseFloat(a.width), parseFloat(a.height))
        }
    }

    function j() {
        var a = {
            isCustom: r.customValues,
            values: []
        };
        return D.runtime.design.pages.forEach(function(b) {
            a.values.push(r.customValues ? b.pageData.fWidth * b.pageData.fHeight : b.pageData.fWidth + "x" + b.pageData.fHeight)
        }), a
    }

    function k() {
        r && (D.runtime.design.meta || (D.runtime.design.meta = {}), D.runtime.design.meta.ppCanvasAdjustment = j())
    }

    function l() {
        if (y) {
            var a = B ? 0 : 2 * D.runtime.design.cPage.pageData.bleed,
                b = a ? E.oneDecimal(E.getPixels(a)) : 0;
            y.scaleToHeight(D.runtime.design.cPage.canvas.getHeight() - b), y.center(), y.setCoords(), D.runtime.design.cPage.canvas.renderAll()
        }
    }

    function m(b) {
        if (b) y && !b.update && D.runtime.design.cPage.canvas.contains(y) && D.runtime.design.cPage.canvas.remove(y), y = b.image;
        else if (!y) return;
        var c = y.width,
            e = y.height,
            f = B ? 0 : 2 * D.runtime.design.cPage.pageData.bleed,
            g = f ? E.oneDecimal(E.getPixels(f)) : 0;
        D.runtime.design.cPage.canvas.getWidth() > c > D.runtime.design.cPage.canvas.getHeight() / e ? (y.scaleToWidth(D.runtime.design.cPage.canvas.getWidth() - g), D.runtime.design.cPage.editPageSize(D.runtime.design.cPage.pageData.fWidth, E.oneDecimal(D.runtime.design.cPage.pageData.fHeight * (y.getHeight() / D.runtime.design.cPage.canvas.getHeight()) + f))) : (y.scaleToHeight(D.runtime.design.cPage.canvas.getHeight() - g), D.runtime.design.cPage.editPageSize(E.oneDecimal(D.runtime.design.cPage.pageData.fWidth * (y.getWidth() / D.runtime.design.cPage.canvas.getWidth()) + f), D.runtime.design.cPage.pageData.fHeight)), y.center(), y.setCoords(), y.tLocked = y.lockMovementX = y.lockMovementY = y.lockRotation = y.lockScalingX = y.lockScalingY = !0, y.cornerSize = 0, D.runtime.design.cPage.canvas.renderAll(), d(), a.broadcast("context-move"), !z && f && (z = C('<a data-type="ctx-toggle-photo-expand" class="pp-context-btn"><i id="toggle-expand-icon" class="pp-icon-enlarge pp-med-icon"></i></a>').appendTo(C('[data-type="ctx-delete"]').parent()), A = C("#toggle-expand-icon")), n()
    }

    function n() {
        B ? A.removeClass("pp-icon-enlarge").addClass("pp-icon-shrink") : A.removeClass("pp-icon-shrink").addClass("pp-icon-enlarge")
    }

    function o() {
        B = !B, m()
    }

    function p() {
        r.lockAspectRatio || (w = !w, C("#pp_ca_lockimg").prop("src", D.server.cloudFront + "images/" + (w ? "zlock" : "zunlock") + ".png"))
    }
    var q, r, s, t, u, v, w, x, y, z, A, B, C = a.getGlobal("jQuery"),
        D = a.getGlobalConfig("model"),
        E = (a.getService("comm"), a.getService("designs"), a.getService("utils")),
        F = a.getGlobalConfig("events");
    return F.on("image-set", function(a) {
        y && a.data && r.photoMode && y.getRef() === a.data.getRef() && m({
            image: a.data,
            update: !0
        })
    }), F.on("toggle-photo-expand", o), {
        init: function() {
            q = C(a.getElement())
        },
        behaviors: ["all-behavs"],
        messages: ["design-loaded", "init-layout", "resize", "show-canvas-adjuster-form", "mod-ca-cancel", "mod-ca-ok", "project-saved", "mod-ca-aspectlock", "image-added-to-c-canvas", "page-select-end"],
        oninput: function(a, b, c) {
            "mod-ca-input" === c && h(C(b).attr("idx"))
        },
        onchange: function(a, b, c) {
            "mod-ca-select" === c && i()
        },
        onmessage: function(a, h) {
            switch (a) {
                case "design-loaded":
                    b();
                    break;
                case "init-layout":
                    r.showOnStart && c();
                    break;
                case "resize":
                    f();
                    break;
                case "show-canvas-adjuster-form":
                    s ? e() : c();
                    break;
                case "mod-ca-ok":
                    t || !u.length || !v.length || isNaN(u.val()) || isNaN(v.val()) || g(parseFloat(u.val()), parseFloat(v.val())), e();
                    break;
                case "mod-ca-cancel":
                    t && g(r.ratios[0], r.ratios[1]), e();
                    break;
                case "project-saved":
                    k();
                    break;
                case "mod-ca-aspectlock":
                    p();
                    break;
                case "image-added-to-c-canvas":
                    r.photoMode && h.clicked && m(h);
                    break;
                case "page-select-end":
                    d()
            }
        }
    }
}), Box.Application.addModule("module-color-template", function(a) {
    "use strict";

    function b() {
        if (!g) {
            if (f = i.runtime.modules.ct, f && f.items) return e.removeClass("pp-hidden").show(), f.title ? h("#pp_mod_ct_title").html(f.title) : h("#pp_mod_ct_title").remove(), c(), void(g = !0);
            Box.Application.stop(a.getElement()), h(a.getElement()).remove()
        }
    }

    function c() {
        var a, b = h("#pp_ct_page_stack_container");
        i.runtime.design.pages.forEach(function(b) {
            b.pageData.templateSource && (a = !0)
        }), a && f.items.length ? f.items.forEach(function(a, c) {
            b.append('<a idx="' + c + '" data-type="color-template-btn" style="background-color: ' + a.color + '" class="pp-color-thumb-btn"> </a>')
        }) : e.hide()
    }

    function d(b) {
        f.items[b] && j !== b && (i.runtime.design.pages.forEach(function(a, c) {
            a.pageData.templateSource && (a.pageData.templateSource = f.items[b].pages[c], a.createTemplate())
        }), a.broadcast("stage-set-template"), j = b)
    }
    var e, f, g, h = a.getGlobal("jQuery"),
        i = a.getGlobalConfig("model"),
        j = (a.getService("comm"), a.getService("designs"), a.getGlobalConfig("events"), 0);
    return {
        init: function() {
            e = h(a.getElement())
        },
        onclick: function(a, b, c) {
            "color-template-btn" === c && (a.stopImmediatePropagation(), d(parseInt(h(b).attr("idx"))))
        },
        behaviors: ["all-behavs"],
        messages: ["design-loaded"],
        onmessage: function(a, c) {
            switch (a) {
                case "design-loaded":
                    b()
            }
        }
    }
}), Box.Application.addModule("module-data-form", function(a) {
    "use strict";

    function b() {
        m.runtime.ui.panels["module-data-form"] = j, l("#pp_form_data_title").html(k.title), a.broadcast("add-panel", j), k.exclusive ? l(".pp-panels").css("top", 0) : (l("#pp_form_data_title").removeClass("pp-sec-mod-dataform-title"), a.broadcast("create-tab-btn", {
            icon: "magic-wand",
            dt: "show-panel-module-data-form"
        }))
    }

    function c() {
        var a, b;
        l("#pp_form_data_content_div").empty(), m.runtime.design.pages.forEach(function(c, d) {
            a = l('<div id="pp_form_data_page_' + d + '" class="pp-uses-scroll pp-mod-df-page" ></div>'), l("#pp_form_data_content_div").append(a), k.editBackground && a.append('<div class="pp-mod-df-div"><div class="pp-mod-df-item-title-div pp-mod-df-item-title-div-bg"><span>' + m.lib.lang.title_background + "</span> " + ("color" === c.pageData.fillData.type ? '<a id="pp_mod_fd_col_' + d + '" iRef="' + d + '" target="bg" style="top:1px" data-type="mod-df-color-show" class="pp-mod-df-small-btn" ><i class="pp-icon-format_color_fill pp-med-icon pp-mod-df-small-icon"></i></a>' : '<a style="top:1px" class="pp-mod-df-small-btn" ><i class="pp-icon-upload pp-med-icon pp-mod-df-small-icon"></i></a> <input iRef="' + d + '" target="bg" class="pp-mod-df-upldInpt-bg" type="file" id="pp_mod_df_upldBtn_' + d + '" name="files" >') + " </div>"), c.canvas._objects.forEach(function(c, d) {
                if (c.includeInForm === !0 && c.title) {
                    switch (b = "<div " + (k.editBackground || 0 !== d ? "" : 'style="margin-top:0"') + ' class="pp-mod-df-div" id="pp_mod_item_' + c.reference + '">', b += '<div class="pp-mod-df-item-title-div"><span>' + c.title + "</span></div>", c.type) {
                        case "textbox":
                        case "i-text":
                            b += '<div class="pp-mod-df-item-content-div"><textarea class="pp-mod-df-ta" row="' + c.text.split("\n").length + '" id="mod_df_tx_' + c.reference + '" data-type="mod-df-text-change" iRef="' + c.reference + '" >' + c.text + '</textarea> <a id="pp_mod_fd_col_' + c.reference + '" iRef="' + c.reference + '" data-type="mod-df-color-show" class="pp-mod-df-small-btn" ><i class="pp-icon-format_color_fill pp-med-icon pp-mod-df-small-icon"></i></a></div>';
                            break;
                        case "shape":
                        case "image":
                            b += '<div id="pp_mod_df_bg' + c.reference + '" class="pp-mod-df-item-content-div pp-mod-df-item-content-bg" style="background-image: url(\'' + c.toDataURL({
                                quality: .8
                            }) + '\')"> <a class="pp-mod-df-small-btn" ><i class="pp-icon-upload pp-med-icon pp-mod-df-small-icon"></i></a> <input chain="' + (c.chain || "") + '" iRef="' + c.reference + '" class="pp-mod-df-upldInpt" type="file" id="pp_mod_df_upldBtn_' + c.reference + '" name="files" ></div>'
                    }
                    a.append(b + "</div>")
                }
            })
        }), l(".pp-mod-df-ta").each(function() {
            h(l(this))
        }), l(".pp-mod-df-upldInpt, .pp-mod-df-upldInpt-bg").each(function() {
            n.mnml(l(this), l(this).attr("iRef"), null, null, {
                editPictureAfterUpload: k.editPictureAfterUpload,
                forceEditorCrop: k.forceEditorCrop
            })
        }), f()
    }

    function d(a, b) {
        m.runtime.page.cItem = e(b), m.runtime.page.cItems = [m.runtime.page.cItem], m.runtime.act.initialText = m.runtime.page.cItem.text, m.runtime.design.undo.length > 0 && m.runtime.design.undo[m.runtime.design.undo.length - 1].target == m.runtime.page.cItem && "text" === m.runtime.design.undo[m.runtime.design.undo.length - 1].prop && (m.runtime.act.initialText = null), o.fire("edit-text", a)
    }

    function e(a) {
        for (var b = 0, c = m.runtime.design.cPage.canvas._objects.length; c > b; b++)
            if (m.runtime.design.cPage.canvas._objects[b].reference == a) return m.runtime.design.cPage.canvas._objects[b]
    }

    function f() {
        m.runtime.design.cPage && (l(".pp-mod-df-page").hide(), l("#pp_form_data_page_" + m.runtime.design.cPage.pageData.index).show(400), setTimeout(function() {
            a.broadcast("update-scrolls", "pp_form_data_page_" + m.runtime.design.cPage.pageData.index)
        }, 1e3))
    }

    function g(a) {
        l(".pp-mod-df-div").removeClass("pp-mod-df-shadow"), l("#pp_mod_item_" + a.reference).length && l("#pp_mod_item_" + a.reference).addClass("pp-mod-df-shadow")
    }

    function h(a) {
        a.height(0), a.height(Math.min(a[0].scrollHeight - 10, 120) + "px")
    }

    function i(a) {
        if (l("#pp_mod_df_bg" + a).length) {
            var b = p.findItems(a);
            b.length && l("#pp_mod_df_bg" + a).css("background-image", "url('" + b.pop().toDataURL({
                quality: .8
            }) + "')")
        }
    }
    var j, k, l = a.getGlobal("jQuery"),
        m = a.getGlobalConfig("model"),
        n = a.getService("uploader"),
        o = (a.getService("comm"), a.getGlobalConfig("events")),
        p = a.getService("utils");
    return {
        init: function() {
            return (k = m.runtime.modules.df || a.getConfig()) ? ((k.defaultTab || k.exclusive) && (m.runtime.design.altDefaultPanel = "module-data-form"), j = l(a.getElement()), k.exclusive && (m.c.stopDefaultPanels = !0, m.runtime.ui.hideFlaps = !0), void(k.defaultTab && j.removeClass("pp-hidden"))) : (Box.Application.stop(a.getElement()), void l(a.getElement()).remove())
        },
        oninput: function(a, b, c) {
            "mod-df-text-change" === c && (a.stopImmediatePropagation(), h(l(b)), d(l(b).val(), l(b).attr("iRef")))
        },
        onclick: function(b, c, d) {
            if ("mod-df-color-show" === d) {
                b.stopImmediatePropagation();
                var f = l(c).attr("iRef");
                "bg" == l(c).attr("target") ? m.runtime.act.colorItemMode = !1 : (m.runtime.page.cItem = e(f), m.runtime.page.cItems = [m.runtime.page.cItem], m.runtime.act.colorItemMode = !0), a.broadcast("show-color-panel", {
                    selector: "#pp_mod_fd_col_" + f,
                    anchor: "r"
                })
            }
        },
        behaviors: ["all-behavs"],
        messages: ["design-loaded", "page-select-end", "canvas-object-selected", "canvas-object-cleared", "image-updated", "text-edited", "panel-ready", "after-show", "canvas-text-changed"],
        onmessage: function(d, e) {
            switch (d) {
                case "design-loaded":
                    setTimeout(function() {
                        c()
                    }, 2e3);
                    break;
                case "page-select-end":
                    f();
                    break;
                case "canvas-object-selected":
                    if (e.target) {
                        var j = m.runtime.design.cPage.canvas.getActiveObject();
                        j ? g(j) : l(".pp-mod-df-div").removeClass("pp-mod-df-shadow")
                    }
                    break;
                case "image-updated":
                    setTimeout(function() {
                        i(e.id)
                    }, 200);
                    break;
                case "canvas-object-cleared":
                    l(".pp-mod-df-div").removeClass("pp-mod-df-shadow");
                    break;
                case "canvas-text-changed":
                case "text-edited":
                    var n = p.findItems(e);
                    n.length && l("#mod_df_tx_" + e).length && n[0] instanceof fabric.IText && (l("#mod_df_tx_" + e).text(n[0].text), h(l("#mod_df_tx_" + e)));
                    break;
                case "panel-ready":
                    b();
                    break;
                case "after-show":
                    setTimeout(function() {
                        (k.defaultTab || k.exclusive) && a.broadcast("select-panel", "module-data-form")
                    }, 200)
            }
        }
    }
}), Box.Application.addModule("module-design-selector", function(a) {
    "use strict";

    function b() {
        m.runtime.ui.panels["module-design-selector"] = f, l("#pp_ds_title").html(g.title || g.label), a.broadcast("add-panel", f), l("#pp_form_data_title").removeClass("pp-sec-mod-dataform-title"), a.broadcast("create-tab-btn", {
            icon: "apps",
            dt: "show-panel-module-design-selector"
        }), m.runtime.act.singlePageMode = g.selLayout
    }

    function c() {
        if (!h && g) {
            var b = l('<div id="pp_ds_list" class="pp-uses-scroll pp-mod-df-page" ></div>');
            l("#pp_ds_content_div").append(b), l.each(m.c.designStack, function(a, c) {
                g.prevAsThumb ? b.append('<a id="pp_ds_btn_' + c.id + '"  designId="' + c.id + '" data-type="design-select" class="pp-image-thumb-btn pp-ds-thumb " ><div style="background-image:url(\'' + c.thumbnailImage + '\')" class="pp-img-thumb-div pp-ds-div"><div>' + c.title + "</div></div></a>") : b.append('<a id="pp_ds_btn_' + c.id + '" designId="' + c.id + '" data-type="design-select" class="pp-image-thumb-btn pp-ds-thumb-list" ><div class="pp-img-thumb-div pp-ds-div-list">' + c.title + "</div></a>")
            }), j = l("#pp_ds_page_stack"), g.selLayout ? (m.c.disableNavButtons = i = !0, m.runtime.ui.pack.append(j.show()), d()) : j.hide(), setTimeout(function() {
                a.broadcast("update-scrolls", "pp_ds_list")
            }, 1e3), h = !0
        }
    }

    function d() {
        var a = l("#pp_ds_page_stack_container");
        i && m.runtime.design.pages.length > 1 && j ? (j.show(), a.html(""), m.runtime.design.pages.forEach(function(b, c) {
            a.append('<a id="pp-ds-thumb-' + c + '" data-type="ds-select-page" idx="' + c + '" class="pp-image-thumb-btn pp-ds-page-thumb"><img src="' + (b.pageData.thumbnailImage || m.c.rscBase + "images/designs/" + m.c.designId + "_" + (c + 1) + ".jpg") + '" class="pp-page-layout-thumb-img"></a>')
        }), l("#pp-ds-thumb-0").addClass("pp-dsSelected")) : j && j.hide()
    }

    function e(b) {
        b !== m.c.designId && (a.broadcast("alert-processing", m.lib.lang.loading + " " + m.c.designStack[b].title + ".. "), n.fetchPost("fetch/design", {
            id: b
        }, function(c) {
            c.error ? a.reportError(new Error("Error loading design..")) : (m.c.designId = b, m.lib.design = c.design, o.loadDesign(c.design)), a.broadcast("alert-hide")
        }, function(b) {
            a.reportError(new Error("Error loading design file..")), a.broadcast("alert-hide")
        }))
    }
    var f, g, h, i, j, k, l = a.getGlobal("jQuery"),
        m = a.getGlobalConfig("model"),
        n = a.getService("comm"),
        o = a.getService("designs"),
        p = a.getGlobalConfig("events");
    return {
        init: function() {
            return (g = m.runtime.modules.ds) ? (f = l(a.getElement()), void b()) : (g = {
                enabled: !1
            }, Box.Application.stop(a.getElement()), void l(a.getElement()).remove())
        },
        onclick: function(a, b, c) {
            "design-select" === c && (a.stopImmediatePropagation(), e(l(b).attr("designId")))
        },
        behaviors: ["all-behavs"],
        messages: ["design-loaded", "init-layout", "page-select-end", "preview-start", "before-start-save"],
        onmessage: function(b, e) {
            switch (b) {
                case "init-layout":
                    c();
                    break;
                case "design-loaded":
                    if (k) return;
                    m.runtime.navTitle = m.runtime.design.title, d(), k = !0, g.defTab && setTimeout(function() {
                        a.broadcast("select-panel", {
                            button: l('[data-type="show-panel-module-design-selector"]'),
                            eType: "module-design-selector"
                        })
                    }, 2e3), p.fire("mod-design-selector-created");
                    break;
                case "page-select-end":
                    l(".pp-dsSelected").removeClass("pp-dsSelected"), l("#pp-ds-thumb-" + e).addClass("pp-dsSelected"), m.runtime.design.dPage = m.runtime.design.cPage.pageData.index;
                    break;
                case "preview-start":
                    g.selLayout && (m.runtime.design.pPages = [m.runtime.design.cPage]);
                    break;
                case "before-start-save":
                    m.runtime.design.cPage.pageData.title = m.lib.design.title + " - " + m.runtime.design.cPage.pageData.title, g.selLayout && (m.runtime.design.savePages = [m.runtime.design.cPage])
            }
        }
    }
}), Box.Application.addModule("module-shuffle", function(a) {
    "use strict";

    function b(a) {
        a.css("visibility", "visible"), S.runtime.ui.pack.block({
            message: a,
            css: {
                padding: "0",
                margin: "0",
                width: "100%",
                left: "0",
                right: "0",
                top: "0",
                bottom: "0",
                textAlign: "center",
                background: "rgb(255, 255, 255)",
                border: "none",
                cursor: "default",
                "z-index": 999999
            },
            overlayCSS: {
                cursor: "default",
                opacity: 1
            }
        }), setTimeout(function() {
            D = a.parent(), C = a
        }, 500)
    }

    function c() {
        setTimeout(function() {
            z.css({
                opacity: "0.5",
                transform: "matrix(0.7, 0, 0, 0.7, 0, 0)"
            }), b(z), TweenLite.to(z, .6, {
                ease: Power2.easeOut,
                opacity: 1,
                scale: 1
            })
        }, 1e3)
    }

    function d(a) {
        C && TweenLite.to(C, .4, {
            ease: Power2.easeOut,
            autoAlpha: 0,
            scale: .7,
            onComplete: function() {
                C.css({
                    opacity: "1",
                    transform: "matrix(1, 0, 0, 1, 0, 0)",
                    display: "none"
                }), C.hide().appendTo(y), a || S.runtime.ui.pack.unblock()
            }
        }), a && (a.show(), a.css({
            visibility: "visible",
            opacity: "0.5",
            transform: "matrix(0.7, 0, 0, 0.7, 0, 0)"
        }).appendTo(D), TweenLite.to(a, .6, {
            ease: Power2.easeOut,
            opacity: 1,
            scale: 1,
            delay: .2,
            onComplete: function() {
                C = a
            }
        }))
    }

    function e() {
        if (!(Y.length < 1)) {
            var a, b = f(Y.slice(0));
            S.runtime.design.cPage.canvas.forEachObject(function(c) {
                "shape" !== c.type && !c.drop_target || c.getIsReference() || (b.length || (b = f(Y.slice(0))), a = b.pop(), X.fire("load-image", {
                    url: a.url,
                    type: "image",
                    targetShape: c.drop_target || c
                }))
            })
        }
    }

    function f(a) {
        for (var b, c, d = a.length; d; b = parseInt(Math.random() * d), c = a[--d], a[d] = a[b], a[b] = c);
        return a
    }

    function g(a) {
        J = [], L = {}, K = R("#pp_facebook_cat_selector").on("change", h);
        for (var b = 0, c = a.data.length; c > b; b++) J.push({
            name: a.data[b].name,
            id: a.data[b].id,
            count: a.data[b].count
        }), K.append('<option value="' + a.data[b].id + '">&#9662; ' + a.data[b].name + "</option>");
        h()
    }

    function h() {
        P = K.val(), L[P] ? (k(P), i()) : j(P)
    }

    function i() {
        if (L[P]) {
            var a;
            J.forEach(function(b) {
                b.id === P && (a = b)
            }), a.count == Object.size(L[P].data) ? O.parent().length && (O = O.detach()) : a.count > Object.size(L[P].data) && R("#" + L[P].panel).append(O)
        }
    }

    function j(a, b) {
        function c(c) {
            if (c.error);
            else {
                var d, e = {};
                c.data.forEach(function(c) {
                    d = W.stripURL(c.source), e[d] = Z[d] = {
                        url: c.source,
                        thumbnail: c.picture,
                        width: c.width,
                        height: c.height,
                        id: d
                    }, b && (L[a].data[d] = e[d], R("#" + L[a].panel).append(U.createThumb(e[d], "images")))
                }), b || (L[a] = {
                    data: e,
                    panel: "pp-blanks"
                }, k(a)), L[a].next = c.paging ? c.paging.next : void 0, i()
            }
        }
        var d;
        b && L[a] && (d = L[a].next), O.parent().length && (O = O.detach()), d ? T.fetchGet(d, c) : T.fetchPost("fboauth/photos", {
            albumId: a
        }, c)
    }

    function k(a) {
        if (M && M.hide(), R("#" + L[a].panel).length) R("#" + L[a].panel).show();
        else {
            L[a].panel = "pp-fb-" + a;
            var b, c = R('<div id="' + L[a].panel + '"></div>');
            R("#mod-sf-p2-img-cont").append(c);
            for (var d in L[a].data) L[a].data.hasOwnProperty(d) && (b = L[a].data[d], c.append(U.createThumb(b, "userImages")), R('<div idx="' + b.id + '" id="mod-sf-' + b.id + '" class="mod-sf-close-btn opaque-btn mod-sf-btn-fb-close"><i class="pp-icon-checkmark pp-med-icon mod-sf-check-icon"></i></div>').appendTo(R("#" + b.id).parent().parent()).click(l));
            setTimeout(function() {
                R(".pp-image-thumb-btn").addClass("mod-sf-thumb-mod")
            }, 1e3)
        }
        R("#mod-sf-p2-title").html(N), M = R("#" + L[a].panel)
    }

    function l(a) {
        a.stopPropagation();
        var b, c = R(a.currentTarget).attr("idx");
        Y.forEach(function(a, d) {
            a.id === c && (b = d)
        }), "undefined" != typeof b ? (Y.splice(b, 1), R("#mod-sf-" + c).addClass("opaque-btn")) : (Y.push(Z[c]), R("#mod-sf-" + c).removeClass("opaque-btn")), t()
    }

    function m() {
        O = O.detach(), Q && T.fetchGet(Q, null, function(a) {
            n(a, !0)
        })
    }

    function n(a, b) {
        var c, d = R("#mod-sf-p2-img-cont");
        Q = a.pagination.next_url, a.data.forEach(function(a) {
            c = W.stripURL(a.images.standard_resolution.url), I[c] = {
                url: a.images.standard_resolution.url,
                thumbnail: a.images.thumbnail.url,
                width: a.images.standard_resolution.width,
                height: a.images.standard_resolution.height,
                id: c
            }, d.append(U.createThumb(I[c], "userImages")), R('<div idx="' + I[c].id + '" id="mod-sf-' + I[c].id + '" class="mod-sf-close-btn opaque-btn"><i class="pp-icon-checkmark pp-med-icon mod-sf-check-icon"></i></div>').appendTo(R("#" + I[c].id).parent().parent()).click(o)
        }), setTimeout(function() {
            R(".pp-image-thumb-btn").addClass("mod-sf-thumb-mod")
        }, 1e3), Q && d.append(O), R("#mod-sf-p2-title").html(N)
    }

    function o(a) {
        a.stopPropagation();
        var b, c = R(a.currentTarget).attr("idx");
        Y.forEach(function(a, d) {
            a.id === c && (b = d)
        }), "undefined" != typeof b ? (Y.splice(b, 1), R("#mod-sf-" + c).addClass("opaque-btn")) : (Y.push(I[c]), R("#mod-sf-" + c).removeClass("opaque-btn")), t()
    }

    function p() {
        T.fetchPost("fboauth/albums", null, g)
    }

    function q() {
        I = {}, R("#mod-sf-p2-img-cont").empty(), T.fetchPost("igoauth/images", null, n)
    }

    function r(b, c) {
        var d = 1e3,
            e = 500,
            f = screen.width / 2 - d / 2,
            g = screen.height / 2 - e / 2;
        R("#mod-sf-p2-title").html('<img src="' + S.c.rscBase + 'images/loaders/spinner.svg" >'), G = window.open(b, "loginwindow", "width=" + d + ", height=" + e + ", top=" + g + ", left=" + f), G.focus(), G ? H = setInterval(function() {
            G.closed && (clearInterval(H), c())
        }, 1e3) : a.broadcast("alert-warning", S.lib.lang.browser_popup_blocked || "Kindly permit the login popup in your browser.")
    }

    function s(a) {
        var b = R(a.currentTarget);
        switch (b.attr("data-type")) {
            case "mod-sf-p1-upload":
                E = "u", d(A), R("#mod-sf-p2-title").removeClass("mod-sf-p2-title-fb").html(N), R("#mod-sf-fb-select").hide();
                break;
            case "mod-sf-p1-fb":
                E = "f", d(A), R("#mod-sf-p2-title").addClass("mod-sf-p2-title-fb"), R("#mod-sf-fb-select").show(), S.server.facebook === !0 ? p() : r(S.runtime.apiUrl.facebook + "?client_id=" + S.server.facebookCred.client + "&redirect_uri=" + S.server.facebookCred.uri + "&response_type=code&scope=user_photos", p);
                break;
            case "mod-sf-p1-ig":
                E = "i", d(A), R("#mod-sf-p2-title").removeClass("mod-sf-p2-title-fb"), R("#mod-sf-fb-select").hide(), S.server.instagram === !0 ? q() : r(S.runtime.apiUrl.instagram + "?client_id=" + S.server.instagramCred.client + "&redirect_uri=" + S.server.instagramCred.uri + "&response_type=code", q);
                break;
            case "mod-sf-p1-close":
                setTimeout(function() {
                    X.fire("close-app")
                }, 500);
                break;
            case "mod-sf-p2-back":
                d(z);
                break;
            case "mod-sf-p2-next":
                Y.length >= $.minimumImages && (d(), e());
                break;
            case "mod-sf-pages-close":
                d();
                break;
            case "mod-sf-sel-page":
                F = !0, X.fire("select-page", parseInt(b.attr("idx")))
        }
        t()
    }

    function t() {
        Y.length < $.minimumImages ? R("#mod-sf-p2-next").addClass("mod-sf-btn-disabled") : R("#mod-sf-p2-next").removeClass("mod-sf-btn-disabled")
    }

    function u(a) {
        (a || R(".mod-sf-page")).find("[data-type]").each(function() {
            "mod-sf" === R(this).attr("data-type").substr(0, 6) && R(this).unbind("click").click(s)
        })
    }

    function v(a) {
        a.id = a.name.replace(".", "_"), Y.push(a), t(), setTimeout(function() {
            R(".pp-image-thumb-btn").addClass("mod-sf-thumb-mod")
        }, 1e3), R('<div idx="' + a.id + '" id="mod-sf-' + a.id + '" class="mod-sf-close-btn"><i class="pp-icon-times pp-med-icon mod-sf-close-icon"></i></div>').appendTo(R("#" + a.id).parent().parent()).click(w)
    }

    function w(a) {
        var b, c = R(a.currentTarget).attr("idx");
        R(a.currentTarget).parent().remove(), Y.forEach(function(a, d) {
            a.id === c && (b = d)
        }), Y.splice(b, 1), t()
    }

    function x() {
        var a = R("#mod-sf-pages-cont");
        S.runtime.design.pages.length > 1 ? (a.html(""), S.runtime.design.pages.forEach(function(b, c) {
            a.append('<a id="pp-ds-thumb-' + c + '" data-type="mod-sf-sel-page" idx="' + c + '" class="pp-image-thumb-btn pp-ds-page-thumb"><img src="' + (b.pageData.thumbnailImage || S.c.rscBase + "images/designs/" + S.c.designId + "_" + (c + 1) + ".jpg") + '" class="pp-page-layout-thumb-img"></a>')
        }), R("#pp-ds-thumb-0").addClass("pp-dsSelected"), u(R("#mod-sf-pages-cont"))) : R('[data-type="p3-styles"]').hide()
    }
    var y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R = a.getGlobal("jQuery"),
        S = a.getGlobalConfig("model"),
        T = a.getService("comm"),
        U = (a.getService("designs"), a.getService("images")),
        V = a.getService("uploader"),
        W = a.getService("utils"),
        X = a.getGlobalConfig("events"),
        Y = [],
        Z = {},
        $ = {
            selLayout: !0,
            minimumImages: 3
        };
    return {
        init: function() {
            y = R(a.getElement()), S.runtime.ui.config.forceHidePanel = S.runtime.act.singlePageMode = !0, V.init(R(".mod-sf-upld"), R("#mod-sf-p2-img-cont"), R("#mod-sf-p2-img-cont"), v), N = R("#mod-sf-p2-title").html(), u(), z = R("#mod-sf-p1").hide(), A = R("#mod-sf-p2").hide(), B = R("#mod-sf-pages").hide(), O = R('<a data-type="load-more" more="sf" id="pp_sf_more" class="pp-image-thumb-btn"><div class="pp-img-thumb-div" style="background-image:url(\'//dta8vnpq1ae34.cloudfront.net/images/more.png\')"> </div></a>')
        },
        onclick: function(a, c, d) {
            switch (d) {
                case "p3-back":
                    b(A.show());
                    break;
                case "p3-wand":
                    e();
                    break;
                case "p3-styles":
                    b(B.show());
                    break;
                case "p3-finish":
                    S.runtime.act.dontShowSavedAlert = !0, X.fire("discard-selection"), X.fire("start-save")
            }
        },
        behaviors: ["all-behavs"],
        messages: ["design-loaded", "init-layout", "page-select-end", "preview-start", "before-start-save", "load-more"],
        onmessage: function(a, b) {
            switch (a) {
                case "init-layout":
                    c();
                    break;
                case "design-loaded":
                    x();
                    break;
                case "page-select-end":
                    R(".pp-dsSelected").removeClass("pp-dsSelected"), R("#pp-ds-thumb-" + b).addClass("pp-dsSelected"), S.runtime.design.dPage = S.runtime.design.cPage.pageData.index, F && (e(), d()), R(".pp-nav-title").html(S.runtime.design.cPage.pageData.title);
                    break;
                case "preview-start":
                    $.selLayout && (S.runtime.design.pPages = [S.runtime.design.cPage]);
                    break;
                case "before-start-save":
                    S.runtime.design.cPage.pageData.title = S.lib.design.title + " - " + S.runtime.design.cPage.pageData.title, $.selLayout && (S.runtime.design.savePages = [S.runtime.design.cPage]);
                    break;
                case "load-more":
                    "sf" === b && ("f" === E ? j(P, !0) : "i" === E && m())
            }
        }
    }
}), Box.Application.addModule("module-variable-data", function(a) {
    "use strict";

    function b() {
        if (!F) {
            if (r = H.runtime.modules.vd) return q.show(), H.runtime.ui.container.append(q), a.broadcast("create-primary-btn", {
                icon: "content_copy",
                dt: "show-variable-data-form",
                attr: 'isMod="1" data-intro="{help_vd_button}"',
                tip: "vd_button_tooltip"
            }), v = r.vdData ? 0 : 1, t = G("#pp_vd_step1"), u = G("#pp_vd_step2"), c(), r.step > 0 ? (t.hide(), u.show(), f(r.vdData), r.vdPages = !1) : (u.hide(), t.show()), k(), setTimeout(function() {
                j()
            }, 300), void(F = !0);
            Box.Application.stop(a.getElement()), q.remove()
        }
    }

    function c() {
        G("#pp_mod_vd_upload").fileupload({
            url: H.c.appApiUrl + "upload/",
            dataType: "json",
            autoUpload: !0,
            formData: {
                connectsid: H.server.urlToken
            },
            dropZone: null,
            pasteZone: null,
            singleFileUploads: !0,
            sequentialUploads: !0,
            disableImageResize: !0,
            xhrFields: {
                withCredentials: !0
            }
        }).on("fileuploadadd", function(b, c) {
            var d = [],
                e = /(\.|\/)(xls|xlsx|csv)$/i,
                f = "." + c.originalFiles[0].name.split(".").pop().toLowerCase();
            return e.test(f) || d.push(H.lib.lang.vd_wrong_files), d.length > 0 ? (a.broadcast("alert-warning", d.join("\n")), void c.abort()) : void 0
        }).on("fileuploadprocessalways", function(a, b) {
            b.files.error || b.error ? G(b.context).remove() : (G("#pp_mod_vd_upload_icon").hide(), G("#pp_mod_vd_upload_label").html('<img class="pp-img-25-width" src="' + H.server.cloudFront + 'images/loaders/spinner.svg" >').css("pointer-events", "none"))
        }).on("fileuploaddone", function(b, c) {
            G("#pp_mod_vd_upload_icon").show(), G("#pp_mod_vd_upload_label").html(H.lib.lang.vd_import_btn_label).css("pointer-events", "auto"), c.error ? a.broadcast("alert-error", H.lib.lang.network_error) : f(c.result, !0)
        }).on("fileuploadfail", function(b, c) {
            G("#pp_mod_vd_upload_icon").show(), G("#pp_mod_vd_upload_label").html(H.lib.lang.vd_import_btn_label).css("pointer-events", "auto"), a.broadcast("alert-error", H.lib.lang.network_error)
        }).prop("disabled", !G.support.fileInput)
    }

    function d(a, b) {
        switch (b = b || a.vd, a.type) {
            case "i-text":
            case "textbox":
                if (a.oVal || (a.oVal = a.text), "-1" == b) a.text = a.oVal;
                else if (b) {
                    var c = a.oVal.split("\n");
                    c.splice(0, 1, "{" + b + "}"), a.text = c.length > 1 ? c.join("\n") : "{" + b + "}"
                }
                break;
            case "image":
                a.oVal || (a.oVal = a.url);
                break;
            case "shape":
                a.oVal || (a.oVal = a.rawsvg)
        }
        a.setCoords()
    }

    function e() {
        if (w && v) {
            K.fire("discard-selection"), G(".pp-vd-conf").remove();
            var a, b, c = H.runtime.design.cPage.canvas.getObjects();
            c.forEach(function(a) {
                a.getIsReference() !== !0 && d(a)
            }), H.runtime.design.cPage.canvas.renderAll(), c.forEach(function(c) {
                c.getIsReference() === !0 || "i-text" !== c.type && "textbox" !== c.type && "image" !== c.type || (a = c.getBoundingRect(), H.runtime.ui.stage.element.append('<a isMod="1" data-type="mod-vd-pick" id="pp_vd_' + c.getRef() + '" iRef="' + c.getRef() + '" class="pp-vd-conf"> ' + (c.vd ? c.vd : L) + " </a>"), b = G("#pp_vd_" + c.getRef()), TweenLite.to(b, .4, {
                    ease: Power2.easeOut,
                    "background-color": c.vd ? "rgba(0,170,0,0.8)" : "rgba(17, 167, 219, 0.8)",
                    top: a.top + (a.height - b.outerHeight()) / 2 + "px",
                    left: a.left + (a.width - b.outerWidth()) / 2 + "px"
                }))
            })
        }
    }

    function f(a, b) {
        v = 1, w = a, o(), x = '<div style="position:absolute" id="pp_vd_selector"><select style="height:auto" data-type="pp-vd-select" id="pp_vd_select" class="pp-mod-vd-select" ><option value="-1">None</option>';
        for (var c in a[0]) x += '<option value="' + c + '">' + c + "</option>";
        x += "</select></div>", y = G(x).appendTo(H.runtime.ui.pack).hide(), z = G("#pp_vd_select"), t.hide(), u.show(), G(".pp-nav-title").html(H.runtime.design.cPage.pageData.title), b && e(), TweenLite.to(q, .4, {
            ease: Power2.easeOut,
            left: 10
        })
    }

    function g(a) {
        A = a, y.show(), z.val(H.runtime.design.cPage.canvas.getObjectByReference(a).vd || -1);
        var b = G("#pp_vd_" + a),
            c = b.position();
        y.css({
            top: 5 + c.top + b.outerHeight() + H.runtime.ui.stage.element.position().top + "px",
            left: c.left + (b.outerWidth() - z.outerWidth()) / 2 + H.runtime.ui.stage.element.position().left + "px"
        })
    }

    function h(a) {
        if (a) {
            var b = G("#pp_vd_" + a);
            b.html("-1" == z.val() ? L : z.val());
            var c = H.runtime.design.cPage.canvas.getObjectByReference(a);
            c.vd = "-1" == z.val() ? "" : z.val(), d(c, z.val()), H.runtime.design.cPage.canvas.renderAll();
            var e = c.getBoundingRect();
            TweenLite.to(b, .4, {
                ease: Power2.easeOut,
                "background-color": "-1" == z.val() ? "rgba(17, 167, 219, 0.8)" : "rgba(0,170,0,0.8)",
                top: e.top + (e.height - b.outerHeight()) / 2 + "px",
                left: e.left + (e.width - b.outerWidth()) / 2 + "px"
            }), y.hide()
        }
    }

    function i() {
        TweenLite.to(q, .4, {
            ease: Power2.easeOut,
            top: 0
        }), e(), s = !0
    }

    function j() {
        G(".pp-vd-conf").remove(), TweenLite.to(q, .4, {
            ease: Power2.easeOut,
            top: -(q.outerHeight() + 10)
        }), s = !1
    }

    function k() {
        q.css("left", parseInt((H.runtime.ui.container.width() - q.width()) / 2) + "px")
    }

    function l() {
        K.fire("select-page", 0), H.runtime.act.overidePreview = !0, B = H.runtime.design.pages;
        var b = [],
            c = 0,
            d = 1;
        B.forEach(function(a) {
            b.push(JSON.stringify(a.toObj()))
        }), H.runtime.design.pages = [], w.forEach(function(a) {
            b.forEach(function(b) {
                b = JSON.parse(b), b.items.forEach(function(b) {
                    if (!b.isReference && a[b.vd]) switch (b.type) {
                        case "i-text":
                        case "textbox":
                            b.text = String(a[b.vd]);
                            break;
                        case "image":
                            b.url = String(a[b.vd]);
                            break;
                        case "shape":
                            b.rawsvg = String(a[b.vd])
                    }
                    b.reference = I.generateReference()
                }), b.pageData.title = b.pageData.title + " - Record " + d, b.pageData.index = c, c++, J.createPage(b)
            }), d++
        }), a.broadcast("alert-processing", H.lib.lang.processing), D = setInterval(function() {
            I.checkAllLoaded() && (clearInterval(D), E = !0, a.broadcast("alert-hide"), H.runtime.act.overidePreview = !1, a.broadcast("show-preview", !0))
        }, 1e3), K.fire("select-page", 0), j()
    }

    function m() {
        r && w && (H.runtime.design.meta || (H.runtime.design.meta = {}), H.runtime.design.meta.records = w.length)
    }

    function n(a) {
        E && (a && (C = [], H.runtime.design.pages.forEach(function(a) {
            a.pageData.scaling = 1, a.renderWithScale(!0), C.push(a.toObj())
        })), H.runtime.design.pages = B, o(), K.fire("select-page", 0), E = !1)
    }

    function o(a) {
        H.runtime.design.pages.forEach(function(b) {
            b.canvas.getObjects().forEach(function(c) {
                if (a === !0 && delete c.vd, c.oVal) switch (c.type) {
                    case "i-text":
                    case "textbox":
                        c.text = String(c.oVal);
                        break;
                    case "image":
                        c.url = String(c.oVal);
                        break;
                    case "shape":
                        c.rawsvg = String(c.oVal)
                }
                b.canvas.renderAll()
            })
        })
    }

    function p(a) {
        G(".pp-vd-conf").remove(), u.hide(), t.show(), o(!0), v = 0, w = null, B = null, C = null, E = !1, a && j()
    }
    var q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G = a.getGlobal("jQuery"),
        H = a.getGlobalConfig("model"),
        I = (a.getService("comm"), a.getService("utils")),
        J = a.getService("pages"),
        K = (a.getService("designs"), a.getGlobalConfig("events")),
        L = '<i style="font-size: 18px;" class="pp-icon-link pp-med-icon"></i>';
    return {
        init: function() {
            q = G(a.getElement())
        },
        behaviors: ["all-behavs"],
        messages: ["design-loaded", "resize", "show-variable-data-form", "mod-vd-cancel", "project-saved", "mod-vd-pick", "page-select-end", "stage-clicked", "pack-clicked", "pp-vd-select", "after-zoom", "mod-ca-render", "mod-ca-back", "hide-preview", "reload-app", "before-preview"],
        onmessage: function(a, c) {
            switch (a) {
                case "design-loaded":
                    b();
                    break;
                case "resize":
                    k();
                    break;
                case "show-variable-data-form":
                    s ? j() : i();
                    break;
                case "mod-vd-cancel":
                    p(!0);
                    break;
                case "project-saved":
                    m();
                    break;
                case "mod-vd-pick":
                    g(c);
                    break;
                case "page-select-end":
                    s && w && e();
                    break;
                case "pack-clicked":
                case "stage-clicked":
                    y && y.hide();
                    break;
                case "pp-vd-select":
                    h(A);
                    break;
                case "after-zoom":
                    s && w && e();
                    break;
                case "mod-ca-render":
                    l();
                    break;
                case "mod-ca-back":
                    p();
                    break;
                case "hide-preview":
                    E && n();
                    break;
                case "reload-app":
                    (C || w) && p(!0);
                    break;
                case "before-preview":
                    !E && w && l()
            }
        }
    }
}), Box.Application.addModule("stage", function(a) {
    "use strict";

    function b() {
        c(), h()
    }

    function c() {
        var a, b, c = p.runtime.design.cPage ? q.getPixels(p.runtime.design.cPage.pageData.fWidth) : 50,
            d = p.runtime.design.cPage ? q.getPixels(p.runtime.design.cPage.pageData.fHeight) : 50;
        a = (p.runtime.ui.container.height() + p.runtime.ui.config.topHeight - p.runtime.ui.config.bottomHeight - d) / 2 + (p.runtime.design.cPage ? p.runtime.design.cPage.pageData.zTop : 0), b = (p.runtime.ui.container.width() - c + (p.runtime.ui.config.maxi && !p.runtime.ui.config.forceHidePanel ? p.runtime.ui.config.leftPanelWidth : 0)) / 2 + (p.runtime.design.cPage ? p.runtime.design.cPage.pageData.zLeft : 0), l.css({
            top: a + "px",
            left: b + "px",
            width: c + "px",
            height: d + "px",
            "background-size": "100%"
        })
    }

    function d() {
        !t || p.runtime.ui.config.maxi && !p.runtime.ui.config.forceHidePanel ? t || !p.runtime.ui.config.maxi && p.runtime.ui.config.forceHidePanel || (TweenLite.to(l, .5, {
            left: (p.runtime.ui.container.width() - l.width() + p.runtime.ui.config.leftPanelWidth) / 2,
            delay: .2,
            onComplete: function() {
                a.broadcast("stage-adjusted")
            }
        }), t = !0) : (TweenLite.to(l, .5, {
            left: (p.runtime.ui.container.width() - l.width()) / 2,
            delay: .2,
            onComplete: function() {
                a.broadcast("stage-adjusted")
            }
        }), t = !1), p.runtime.design.cPage && (p.runtime.design.cPage.pageData.zLeft = 0)
    }

    function e() {
        var a = "";
        "" !== p.runtime.design.cPage.pageData.templateSource && p.runtime.design.cPage.pageData.templateSource ? (a = "url('" + p.runtime.design.cPage.pageData.templateSource + "')", l.addClass("pp-stage-template")) : l.removeClass("pp-stage-template"), l.css({
            "background-size": "100%",
            "background-image": a,
            width: q.getPixels(p.runtime.design.cPage.pageData.fWidth) + "px",
            height: q.getPixels(p.runtime.design.cPage.pageData.fHeight) + "px"
        })
    }

    function f(a, b, c) {
        p.runtime.design.cPage.canvas.forEachObject(function(d) {
            d.d && "shape" === d.type && d.reference === b && (d.chain && c || (d.setCoords(), r.fire("load-image", {
                url: a.url,
                type: "image",
                targetShape: d,
                ignoreChains: !0,
                width: a.width,
                height: a.height
            })))
        })
    }

    function g(a) {
        if (a = a.data, a.id && a.opts.chain) {
            var b = q.findItems("", "", !1, a.opts.chain),
                c = 0;
            b.forEach(function(b) {
                a.files[c] && b.d && "shape" === b.type && (b.setCoords(), r.fire("load-image", {
                    url: a.files[c].url,
                    type: "image",
                    targetShape: b,
                    canvas: b.canvas,
                    ignoreChains: !0
                }), c++)
            })
        }
    }

    function h() {
        if (o(".pp-stage-upload-inputs").hide(), p.runtime.design.cPage && !p.c.isAdmin) {
            var a = !1;
            p.runtime.design.cPage.canvas.forEachObject(function(b) {
                if ("shape" === b.type && b.clickMask && b.d) {
                    var c = b.getRef(),
                        d = o("#cm-" + c).length ? o("#cm-" + c) : o('<input id="cm-' + c + '" type="file" name="files" class="pp-stage-upload-inputs">').appendTo(m);
                    d.hasClass("applied") || s.mnml(d.addClass("applied"), c, f, !1, {
                        chain: b.chain
                    }), d.css(b.getBoundingRect()).show(), a = !0
                }
            }), a ? (m.show(), n = !0) : (m.hide(), n = !1)
        }
    }

    function i(a) {
        "string" == typeof a && (p.runtime.design.cPage.canvas.forEachObject(function(b) {
            b.d && "shape" === b.type && b.reference === a && (o("#cm-" + a).hide(), b.setCoords())
        }), p.runtime.design.cPage.canvas.renderAll())
    }

    function j() {
        m.hide()
    }

    function k() {
        n && m.show()
    }
    var l, m, n, o = a.getGlobal("jQuery"),
        p = a.getGlobalConfig("model"),
        q = a.getService("utils"),
        r = a.getGlobalConfig("events"),
        s = a.getService("uploader"),
        t = !0;
    return {
        init: function() {
            l = p.runtime.ui.stage.element = o(a.getElement()), m = o('<div class="pp-stage-files"></div>').appendTo(l), l.on("dragenter", function(a) {
                r.fire("drag-enter-stage", a)
            }), l.on("dragleave", function(a) {
                r.fire("drag-leave-stage", a)
            }), l.on("dragover", function(a) {
                r.fire("drag-over-stage", a)
            }), l.on("drop", function(a) {
                r.fire("drag-drop", a)
            }), b(), r.on("start-item-drag", j), r.on("start-new-text", j), r.on("end-item-drag", k), r.on("show-files-div", k), r.on("bulk-uploads", g)
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "adjust-layout", "stage-resize", "stage-set-template", "update-uploaders", "page-select-end", "upload-add", "item-added-to-c-canvas", "context-shown", "context-hidden", "dialog-shown", "dialog-hidden", "position-stage"],
        onmessage: function(a, f) {
            switch (a) {
                case "resize":
                    b();
                    break;
                case "adjust-layout":
                    d();
                    break;
                case "stage-resize":
                    b();
                    break;
                case "stage-set-template":
                    e();
                    break;
                case "item-added-to-c-canvas":
                case "page-select-end":
                case "update-uploaders":
                    h();
                    break;
                case "upload-add":
                    i(f);
                    break;
                case "dialog-shown":
                case "context-shown":
                    j();
                    break;
                case "dialog-hidden":
                case "context-hidden":
                    k();
                    break;
                case "position-stage":
                    c()
            }
        }
    }
}), Box.Application.addModule("background-images", function(a) {
    "use strict";

    function b() {}

    function c() {
        g("#pp_sec_bg_tabs_titles").append('<li data-type="show-tab-bg-images"> <a><i class="pp-icon-pictures pp-med-icon"></i></a> </li>'), i.runtime.ui.tabs["bg-images"] = g("#pp_tab_bg_images"), k.laySelector(i.lib.bgImages, "pp_bg_cat_selector", !0), i.runtime.ui.mods["bg-images"] = f, i.lib.bgImagesConf = {
            panel: "pp_bg_image_panels_div",
            select: "pp_bg_cat_selector",
            target: "bg",
            clickable: !0
        }, k.changeImageCat("bgImages"), g("#pp-bg-upload-btn").length && j.init(g("#pp-bg-upload-btn"))
    }

    function d() {
        i.runtime.design.cPage && ("image" === i.runtime.design.cPage.pageData.fillData.type ? g("#pp_show_bg_editor").removeClass("pp-disabled") : g("#pp_show_bg_editor").addClass("pp-disabled"))
    }

    function e() {
        g("#pp_bg_cat_selector").val("my"), k.changeImageCat("bgImages")
    }
    var f, g = a.getGlobal("jQuery"),
        h = a.getGlobalConfig("events"),
        i = a.getGlobalConfig("model"),
        j = a.getService("uploader"),
        k = a.getService("images");
    return h.on("bg-change-to-userImages", e), {
        init: function() {
            f = g(a.getElement()), !i.lib.design.hidebackgroundpanel && !i.lib.design.hideBackgroundPanel && 0 !== i.lib.bgImages.length || i.c.isAdmin ? c() : (Box.Application.stop(a.getElement()), f.hide(), f = null)
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "update-ui", "after-tab-change", "after-panel-change", "page-select-end"],
        onmessage: function(a, c) {
            switch (a) {
                case "resize":
                    b();
                    break;
                case "page-select-end":
                case "update-ui":
                    d();
                    break;
                case "after-panel-change":
                case "after-tab-change":
                    "bg" !== c && "bg-images" !== c || "my" != g("#pp_bg_cat_selector").val() || k.changeImageCat("bgImages")
            }
        }
    }
}), Box.Application.addModule("facebook", function(a) {
    "use strict";

    function b() {
        r("#pp_sec_images_tabs_titles").append('<li data-type="show-tab-images-facebook"> <a><i class="pp-icon-facebook-square pp-med-icon"></i></a> </li>'), p = r('<a data-type="load-more" more="fb" id="pp_fb_more" class="pp-image-thumb-btn"><div class="pp-img-thumb-div" style="background-image:url(\'//dta8vnpq1ae34.cloudfront.net/images/more.png\')"> </div></a>'), s.runtime.ui.tabs["images-facebook"] = r("#pp_tab_images_facebook"), s.lib.facebookConf = {
            panel: "pp_tab_images_facebook",
            select: "pp_facebook_cat_selector",
            target: "images",
            contentDiv: "pp_facebook_panels_div",
            clickable: !0
        }
    }

    function c() {
        u.fetchPost("fboauth/albums", null, e)
    }

    function d() {
        var b = 1e3,
            d = 500,
            e = screen.width / 2 - b / 2,
            f = screen.height / 2 - d / 2;
        n = window.open(s.runtime.apiUrl.facebook + "?client_id=" + s.server.facebookCred.client + "&redirect_uri=" + s.server.facebookCred.uri + "&response_type=code&scope=user_photos", "facebookwindow", "width=" + b + ", height=" + d + ", top=" + f + ", left=" + e), n ? (n.focus(), o = setInterval(function() {
            n.closed && (clearInterval(o), c())
        }, 1e3)) : a.broadcast("alert-warning", s.lib.lang.browser_popup_blocked || "Kindly permit the login popup in your browser.")
    }

    function e(a) {
        if (a.error) n || d();
        else {
            r("#pp_facebook_login_btn").hide(), r("#pp_facebook_cat_selector").show(), l = [];
            for (var b = r("#" + s.lib.facebookConf.select), c = 0, e = a.data.length; e > c; c++) l.push({
                name: a.data[c].name,
                id: a.data[c].id,
                count: a.data[c].count
            }), b.append('<option value="' + a.data[c].id + '">' + a.data[c].name + "</option>");
            f()
        }
    }

    function f() {
        q = r("#" + s.lib.facebookConf.select).val(), v[q] ? (i(q), h()) : g(q)
    }

    function g(a, b) {
        function c(c) {
            if (c.error);
            else {
                var d, e = v[a] ? v[a].data : [];
                c.data.forEach(function(c) {
                    d = {
                        thumbnail: c.picture,
                        url: c.source,
                        width: c.width,
                        height: c.height
                    }, b && v[a] && r("#" + v[a].panel).append(t.createThumb(d, "images")), e.push(d)
                }), b && v[a] || (v[a] = {
                    data: e,
                    panel: "pp-blanks"
                }, i(a)), v[a].next = c.paging ? c.paging.next : void 0, h()
            }
        }
        var d;
        b && v[a] && (d = v[a].next), p.parent().length && (p = p.detach()), d ? u.fetchGet(d, c) : u.fetchPost("fboauth/photos", {
            albumId: a
        }, c)
    }

    function h() {
        if (v[q]) {
            var a;
            l.forEach(function(b) {
                b.id === q && (a = b)
            }), a.count == v[q].data.length ? p.parent().length && (p = p.detach()) : a.count > v[q].data.length && r("#" + v[q].panel).append(p)
        }
    }

    function i(b) {
        m && m.hide(), r("#" + v[b].panel).length ? (r("#" + v[b].panel).show(), r("#" + v[b].panel).perfectScrollbar("update")) : (v[b].panel = "pp-fb-" + b, r("#" + s.lib.facebookConf.contentDiv).append(t.layImages(v[b].data, v[b].panel, "images")), a.broadcast("update-scrolls", v[b].panel)), m = r("#" + v[b].panel)
    }

    function j() {
        s.runtime.ui.tabs["images-facebook"] && (s.server.facebook ? (r("#pp_facebook_login_btn").hide(), c()) : r("#pp_facebook_cat_selector").hide())
    }
    var k, l, m, n, o, p, q, r = a.getGlobal("jQuery"),
        s = a.getGlobalConfig("model"),
        t = a.getService("images"),
        u = a.getService("comm"),
        v = {};
    return {
        init: function() {
            return k = r(a.getElement()), s.c.hideImagePanel || s.lib.config.facebook !== !0 || s.c.stopDefaultPanels ? void this.destroy() : (b(), void(s.runtime.ui.mods.facebook = k))
        },
        destroy: function() {
            k.remove(), k = null
        },
        behaviors: ["all-behavs"],
        messages: ["init-layout", "change-fb-album", "show-facebook-login", "load-more"],
        onmessage: function(a, b) {
            switch (a) {
                case "init-layout":
                    s.c.stopDefaultPanels ? this.destroy() : j();
                    break;
                case "change-fb-album":
                    f();
                    break;
                case "show-facebook-login":
                    d();
                    break;
                case "load-more":
                    "fb" === b && g(q, !0)
            }
        }
    }
}), Box.Application.addModule("images", function(a) {
    "use strict";

    function b() {
        f.lib.images.length && (e("#pp_sec_images_tabs_titles").append('<li data-type="show-tab-images-images"> <a><i class="pp-icon-pictures pp-med-icon"></i></a> </li>'), f.runtime.ui.tabs["images-images"] = e("#pp_tab_images_images"), g.laySelector(f.lib.images, "pp_images_cat_selector"), f.runtime.ui.mods.images = c, f.lib.imagesConf = {
            panel: "pp_images_panels_div",
            select: "pp_images_cat_selector",
            target: "images",
            clickable: !0
        }, g.changeImageCat("images"))
    }
    var c, d, e = a.getGlobal("jQuery"),
        f = a.getGlobalConfig("model"),
        g = a.getService("images");
    a.getService("utils");
    return {
        init: function() {
            return c = e(a.getElement()), f.c.hideImagePanel !== !0 || f.c.isAdmin ? (b(), d = a.getService("image-editor"), void d.init()) : void this.destroy()
        },
        destroy: function() {
            c.remove(), c = null
        },
        behaviors: ["all-behavs"],
        messages: ["after-tab-change", "after-panel-change"],
        onmessage: function(b, c) {
            switch (b) {
                case "after-panel-change":
                case "after-tab-change":
                    "images" !== c && "images-images" !== c || !f.lib.imagesConf || a.broadcast("update-scrolls", f.lib.imagesConf.current)
            }
        }
    }
}), Box.Application.addModule("instagram", function(a) {
    "use strict";

    function b() {}

    function c() {
        n("#pp_sec_images_tabs_titles").append('<li data-type="show-tab-images-instagram"> <a><i class="pp-icon-instagram pp-med-icon"></i></a> </li>'), l = n('<a data-type="load-more" more="ig" id="pp_ig_more" class="pp-image-thumb-btn"><div class="pp-img-thumb-div" style="background-image:url(\'//dta8vnpq1ae34.cloudfront.net/images/more.png\')"> </div></a>'), o.runtime.ui.tabs["images-instagram"] = n("#pp_tab_images_instagram"), o.lib.instagramConf = {
            panel: "pp_tab_images_instagram",
            select: "pp_instagram_cat_selector",
            target: "images",
            contentDiv: "pp_instagram_panels_div",
            clickable: !0
        }
    }

    function d() {
        q.fetchPost("igoauth/images", null, g)
    }

    function e() {
        var b = 1e3,
            c = 500,
            e = screen.width / 2 - b / 2,
            f = screen.height / 2 - c / 2;
        j = window.open(o.runtime.apiUrl.instagram + "?client_id=" + o.server.instagramCred.client + "&redirect_uri=" + o.server.instagramCred.uri + "&response_type=code", "instagramwindow", "width=" + b + ", height=" + c + ", top=" + f + ", left=" + e), j.focus(), j ? k = setInterval(function() {
            j.closed && (clearInterval(k), d())
        }, 1e3) : a.broadcast("alert-warning", o.lib.lang.browser_popup_blocked || "Kindly permit the login popup in your browser.")
    }

    function f() {
        l = l.detach(), m && q.fetchGet(m, null, function(a) {
            g(a, !0)
        })
    }

    function g(b, c) {
        if (b.error) j || e();
        else {
            n("#pp_instgram_login_sec").hide(), m = b.pagination.next_url;
            var d, f = [],
                g = n("#pp_instagram_images");
            b.data.forEach(function(a) {
                d = {
                    url: a.images.standard_resolution.url,
                    thumbnail: a.images.thumbnail.url,
                    width: a.images.standard_resolution.width,
                    height: a.images.standard_resolution.height
                }, c === !0 ? g.length && g.append(p.createThumb(d, "images")) : f.push(d)
            }), f.length && n("#" + o.lib.instagramConf.contentDiv).append(p.layImages(f, "pp_instagram_images", "images")), m && n("#pp_instagram_images").append(l), a.broadcast("update-scrolls", "pp_instagram_images")
        }
    }

    function h() {
        o.runtime.ui.tabs["images-instagram"] && o.server.instagram === !0 && (n("#pp_instgram_login_sec").hide(), d())
    }
    var i, j, k, l, m, n = a.getGlobal("jQuery"),
        o = a.getGlobalConfig("model"),
        p = a.getService("images"),
        q = a.getService("comm");
    return {
        init: function() {
            return i = n(a.getElement()), o.c.hideImagePanel === !0 || o.lib.config.instagram !== !0 || o.c.stopDefaultPanels ? void this.destroy() : (c(), void(o.runtime.ui.mods.instagram = i))
        },
        destroy: function() {
            i.remove(), i = null
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "init-layout", "show-instagram-login", "load-more"],
        onmessage: function(a, c) {
            switch (a) {
                case "resize":
                    b();
                    break;
                case "init-layout":
                    o.c.stopDefaultPanels ? this.destroy() : h();
                    break;
                case "show-instagram-login":
                    e();
                    break;
                case "load-more":
                    "ig" === c && f()
            }
        }
    }
}), Box.Application.addModule("search", function(a) {
    "use strict";

    function b() {}

    function c() {
        q("#pp_sec_images_tabs_titles").append('<li data-type="show-tab-images-search"> <a><i class="pp-icon-search pp-med-icon"></i></a> </li>'), r.runtime.ui.tabs["images-search"] = q("#pp_tab_images_search"), r.lib.searchConf = {
            panel: "pp_search_panels_div",
            target: "images",
            contentDiv: "pp_search_content_div",
            clickable: !0
        }, k = 0, j = q('<div class="pp-search-loader"><img src="//dta8vnpq1ae34.cloudfront.net/images/bar_loader_white.gif" ></div>'), n = q('<a data-type="search-pixabay" more="yes" id="pp_search_more" class="pp-image-thumb-btn"><div class="pp-img-thumb-div" style="background-image:url(\'//dta8vnpq1ae34.cloudfront.net/images/more.png\')"> </div></a>'), o = q('<div id="pp_search_content_div" class="pp-image-list pp-uses-scroll" ></div>'), q("#" + r.lib.searchConf.panel).append(o), a.broadcast("update-scrolls", r.lib.searchConf.contentDiv), 2 === r.lib.config.pixabay.split(",").length ? r.lib.config.pixabay = {
            username: r.lib.config.pixabay.split(",")[0].replace(" ", ""),
            key: r.lib.config.pixabay.split(",")[1].replace(" ", "")
        } : r.lib.config.pixabay = {
            username: null,
            key: r.lib.config.pixabay
        }, q("#pp_search_input").keypress(function(a) {
            13 == a.which && g()
        })
    }

    function d() {}

    function e(b) {
        i = !1, j = j.detach(), b.hits.forEach(function(a) {
            o.append(q(s.createThumb({
                url: a.imageURL,
                thumbnail: a.previewURL,
                width: a.imageWidth,
                height: a.imageHeight
            }, "images")))
        }), p ? (k = 1, l = b.totalHits) : k++, a.broadcast("update-scrolls", r.lib.searchConf.contentDiv), l > 20 * k && o.append(n), TweenLite.to(o, .2, {
            ease: Power2.easeInOut,
            scrollTop: o[0].scrollHeight
        })
    }

    function f(b) {
        i = !1, j.parent().length && (j = j.detach()), a.reportError(new Error("Error loading PixaBay data")), a.broadcast("alert-error", r.lib.lang.network_error)
    }

    function g(a) {
        p = !a, i || (a ? (n.parent().length && (n = n.detach()), o.append(j)) : (o.perfectScrollbar("destroy"), q(o.children()).remove(), o.append(j), m = q("#pp_search_input").val().split(" ").join("+"), q("#" + r.lib.searchConf.contentDiv).perfectScrollbar({
            suppressScrollX: !0
        })), t.fetchGet(r.runtime.apiUrl.pixabay + (-1 === r.lib.config.pixabay.key.indexOf("-") ? "?username=" + r.lib.config.pixabay.username + "&" : "?") + "key=" + r.lib.config.pixabay.key + "&image_type=photo&lang=" + r.c.langCode + "&response_group=high_resolution&q=" + m + (a ? "&page=" + (k + 1) : ""), e, f), TweenLite.to(o, .2, {
            ease: Power2.easeInOut,
            scrollTop: o[0].scrollHeight
        }), i = !0)
    }
    var h, i, j, k, l, m, n, o, p, q = a.getGlobal("jQuery"),
        r = a.getGlobalConfig("model"),
        s = a.getService("images"),
        t = a.getService("comm");
    return {
        init: function() {
            return h = q(a.getElement()), r.lib.config.pixabay ? r.lib.config.pixabay.length < 2 ? void this.destroy() : (c(), void(r.runtime.ui.mods.search = h)) : void this.destroy()
        },
        destroy: function() {
            h.remove(), h = null
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "init-layout", "search-pixabay"],
        onmessage: function(a, c) {
            switch (a) {
                case "resize":
                    b();
                    break;
                case "search-pixabay":
                    g("yes" == c);
                    break;
                case "init-layout":
                    d()
            }
        }
    }
}), Box.Application.addModule("user-images", function(a) {
    "use strict";

    function b() {}

    function c() {
        g("#pp_sec_images_tabs_titles").append('<li data-type="show-tab-images-userImages"> <a><i class="pp-icon-user pp-med-icon"></i></a> </li>'), h.runtime.ui.tabs["images-userImages"] = g("#pp_tab_images_userImages"), h.lib.userImagesConf = {
            panel: "pp_userImages_panels_div",
            target: "user-images",
            clickable: !0
        }, h.runtime.ui.userImages = k.layImages(h.lib.userImages, "pp_userImages_div", "user-images"), g("#pp-my-upload-btn").length && j.init(g("#pp-my-upload-btn"), h.runtime.ui.userImages)
    }

    function d() {
        g("#" + h.lib.userImagesConf.panel).append(h.runtime.ui.userImages.show()), a.broadcast("update-scrolls", "pp_userImages_div")
    }

    function e(a) {
        TweenLite.to("#pp-" + a.id, .4, {
            autoAlpha: 0,
            width: "0px",
            onComplete: function() {
                g("#pp-" + a.id).remove()
            }
        }), i.fetchPost("delete-asset", {
            path: a.path
        })
    }
    var f, g = a.getGlobal("jQuery"),
        h = a.getGlobalConfig("model"),
        i = a.getService("comm"),
        j = a.getService("uploader"),
        k = a.getService("images");
    return {
        init: function() {
            return f = g(a.getElement()), h.c.hideImagePanel === !0 || h.c.stopDefaultPanels ? void this.destroy() : (c(), void(h.runtime.ui.mods["user-images"] = f))
        },
        destroy: function() {
            f.remove(), f = null
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "after-tab-change", "after-panel-change", "remove-image-item", "init-layout"],
        onmessage: function(a, c) {
            switch (a) {
                case "resize":
                    b();
                    break;
                case "after-panel-change":
                case "after-tab-change":
                    "images" !== c && "images-userImages" !== c || d();
                    break;
                case "init-layout":
                    h.c.stopDefaultPanels && this.destroy();
                    break;
                case "remove-image-item":
                    e(c)
            }
        }
    }
}), Box.Application.addModule("alert", function(a) {
    "use strict";

    function b() {
        d()
    }

    function c(a, b) {
        g && g.kill(), h(".pp-alert-text").html(a || ""), "upld" === b ? (h(".pp-alert-anim").hide(), h(".pp-alert-icon").html('<div class="pp-progress" style="margin-top:2px; width:35px; height:35px;"></div>'), h(".pp-progress").circleProgress({
            value: 0,
            size: 35,
            thickness: 5,
            fill: {
                color: "#EEE"
            }
        })) : b ? (h(".pp-alert-anim").hide(), h(".pp-alert-icon").html('<i class="pp-icon-' + i.fetchIcon(b) + '" style="font-size:40px"></i>').show(), setTimeout(function() {
            d()
        }, 4e3)) : (h(".pp-alert-icon").hide(), h(".pp-alert-anim").show()), g = TweenLite.to(f, .4, {
            right: 0,
            ease: Power2.easeOut
        })
    }

    function d() {
        g && g.kill(), g = TweenLite.to(f, .4, {
            right: -f.outerWidth() - 1,
            ease: Power2.easeOut,
            delay: .5
        })
    }

    function e(a) {
        return h("#pp-alert-modal-msg").length ? void h("#pp-alert-modal-msg").html(a) : (j.runtime.ui.pack.unblock(), void j.runtime.ui.pack.block({
            message: '<div class="pp-alert-modal-div"><img src="' + j.server.cloudFront + 'images/loaders/spinner.svg" ><div id="pp-alert-modal-msg" style="margin-top: 10px">' + a + "</div></div>",
            css: {
                padding: "0",
                margin: "0",
                width: "100%",
                left: "0",
                right: "0",
                top: "0",
                bottom: "0",
                textAlign: "center",
                background: "#000",
                border: "none",
                cursor: "default"
            },
            overlayCSS: {
                cursor: "default",
                opacity: 1
            }
        }))
    }
    var f, g, h = a.getGlobal("jQuery"),
        i = a.getService("utils"),
        j = a.getGlobalConfig("model");
    return {
        init: function() {
            f = h(a.getElement()), j.runtime.ui.alert = f, b()
        },
        messages: ["alert-processing", "alert-uploading", "alert-hide", "alert-info", "alert-warning", "alert-cancel", "alert-error", "alert-ok", "alert-modal"],
        onmessage: function(a, b) {
            switch (a) {
                case "alert-hide":
                    d();
                    break;
                case "alert-processing":
                    c(b);
                    break;
                case "alert-uploading":
                    c(b, "upld", !0);
                    break;
                case "alert-modal":
                    e(b);
                    break;
                case "alert-ok":
                case "alert-info":
                case "alert-warning":
                case "alert-cancel":
                case "alert-error":
                    c(b, a.split("-")[1])
            }
        }
    }
}), Box.Application.addModule("colors", function(a) {
    "use strict";

    function b() {
        if (r.runtime.act.fontColFill = !0, r.runtime.act.sColorOptIndex = 0, r.lib.colors.length) {
            var b = q("#pp_color_selector"),
                c = q("#pp_color_panels_div"),
                g = "";
            b.length && c.length && (r.lib.colors.forEach(function(a, d) {
                b.append('<option value="' + d + '">' + a.title + "</option>"), g = '<section class="pp-color-panel-item-sec">', a.colors.forEach(function(a, b) {
                    g += '<a val="' + d + "," + b + '" style="background-color:' + a.toWebString() + '" class="pp-color-thumb-btn" title="' + a.friendlyValues() + '" > </a> '
                }), d === r.lib.colors.length - 1 && (g += '<a data-type="add-new-color-btn" id="pp_new_col_btn" class="pp-color-thumb-btn pp-new-color-btn pp-flex-display" ></a>'), c.append(g + "</section>")
            }), r.runtime.ui.newColorBtn = q("#pp_new_col_btn"), r.runtime.ui.colorPicker = q("#pp_color_picker").farbtastic({
                callback: f,
                width: 250
            }), r.runtime.ui.colorPickerTool = a.getService("pop-over").create({
                trigger: "",
                anchor: "r",
                content: q("#pp_color_picker_div").detach(),
                ahide: !1,
                hide: d
            }), p = a.getService("pop-over").create({
                trigger: "click",
                anchor: "r",
                ahide: !1
            }));
            for (var h = "", i = 0; 10 > i; i++) h += '<a data-type="color-opt" idx="ct' + i + '" class="pp-color-thumb-sel" > </a>';
            h += '<a data-type="color-opt" idx="ct-1" class="pp-color-thumb-sel pp-color-thumb-trans" > </a>', q("#pp_color_opts_sec").prepend(h), q(".pp-color-panels-div-parent").perfectScrollbar({
                suppressScrollX: !0
            }), q(".pp-color-panel-item-sec").hide(), q("#pp_color_panels_div").css("height", "380px")
        }
        e(), o.hide(), r.runtime.ui.colorPanel = o
    }

    function c() {
        q(".pp-color-panels-div-parent").height(q(".pp-colors").outerHeight() - q(".pp-color-panels-div-parent").position().top), q(".pp-color-panels-div-parent").perfectScrollbar("update")
    }

    function d() {
        r.runtime.ui.newColorBtn.css("opacity", 1)
    }

    function e() {
        r.runtime.ui.currenColorPanel && r.runtime.ui.currenColorPanel.hide(), r.runtime.ui.currenColorPanel = q(q("#pp_color_panels_div").children()[parseInt(q("#pp_color_selector").val())]), r.runtime.ui.currenColorPanel.show(), c(), q("#pp_color_panels_div").css("height", "380px")
    }

    function f(a) {
        r.runtime.ui.currentSpot && (r.runtime.ui.currentSpot.css("background-color", a), u.fire("mini-show", {
            icon: "format_color_fill",
            value: a
        }), u.fire("change-color", t.rgbToColor(a)), r.lib.userColors.colors[r.lib.userColors.colors.length - 1] = t.rgbToColor(a))
    }

    function g() {
        r.runtime.ui.currentSpot = q('<a val="' + (r.lib.colors.length - 1) + "," + r.lib.userColors.colors.length + '" style="background-color:#000" class="pp-color-thumb-btn" > </a>').insertBefore(r.runtime.ui.newColorBtn), r.lib.userColors.colors.push(new s.Color(256)), r.runtime.ui.newColorBtn.css("opacity", 0), r.runtime.ui.colorPickerTool.forceShow(r.runtime.ui.currentSpot, !1, p)
    }

    function h() {
        r.runtime.design.cPage && (r.runtime.act.colorItemMode ? (q("#pp_color_opts_sec").show(), q("#pp_bg_opacity_btn").addClass("pp-disabled"), q(".pp-color-thumb-sel").hide(), r.runtime.act.sColorOptIndex = 0, r.runtime.page.cItems.length && ("shape" === r.runtime.page.cItems[0].type ? (q(".pp-color-thumb-trans").hide(), q(".pp-color-thumb-switch").hide()) : (q(".pp-color-thumb-trans").show(), q("[idx='ct0']").show(), q(".pp-color-thumb-switch").show())), q(".pp-colors").addClass("pp-colors-bg"), k()) : (q("#pp_color_opts_sec").hide(), "color" === r.runtime.design.cPage.pageData.fillData.type ? q("#pp_bg_opacity_btn").removeClass("pp-disabled") : q("#pp_bg_opacity_btn").addClass("pp-disabled"), q(".pp-colors").removeClass("pp-colors-bg")), c())
    }

    function i(a) {}

    function j(b) {
        r.runtime.ui.currentPanel == r.runtime.ui.panels.bg && r.runtime.ui.currentBgImagesTab == r.runtime.ui.tabs["bg-colors"] && a.broadcast("select-tab", (r.runtime.ui.tabs["bg-images"] ? "bg" : "images") + "-images"), p.attachContent(o.show());
        var c, d;
        "string" == typeof b ? c = "#" + b : (c = b.selector, d = b.anchor), p.forceShow(q(c), d), r.runtime.act.colorItemMode = "bg" !== q(c).attr("target"), h()
    }

    function k() {
        if (r.runtime.design.cPage && r.runtime.act.colorItemMode && r.runtime.page.cItems.length)
            if ("shape" === r.runtime.page.cItems[0].type) {
                if (r.runtime.act.cArray = [], r.runtime.page.cItem.paths)
                    for (var a = 0, b = r.runtime.page.cItem.paths.length; b > a; a++) r.runtime.page.cItem.paths[a].fill && -1 === r.runtime.act.cArray.indexOf(r.runtime.page.cItem.paths[a].fill) && r.runtime.act.cArray.push(r.runtime.page.cItem.paths[a].fill);
                else r.runtime.page.cItem.fill ? r.runtime.act.cArray.push(r.runtime.page.cItem.fill) : q("#pp_color_opts_sec").hide();
                for (var a = 0; a < r.runtime.act.cArray.length; a++) q("[idx='ct" + a + "']").css({
                    display: "",
                    "background-color": r.runtime.act.cArray[a]
                }).show();
                q("[idx='ct0']").addClass("pp-color-thumb-selected")
            } else if ("i-text" === r.runtime.page.cItems[0].type) {
            var c;
            r.runtime.act.fontColFill ? (q("[idx='ct0']").css({
                display: "",
                "background-color": r.runtime.page.cItems[0].fill || r.runtime.page.cItems[0].fillData.colorData.colors[0].toWebString()
            }), c = !r.runtime.page.cItems[0].fill) : (q("[idx='ct0']").css({
                display: "",
                "background-color": r.runtime.page.cItems[0].stroke || r.runtime.page.cItems[0].fillData.strokeData.fill.colors[0].toWebString()
            }), c = !r.runtime.page.cItems[0].stroke), c ? (q("[idx='ct0']").removeClass("pp-color-thumb-selected"), q(".pp-color-thumb-trans").addClass("pp-color-thumb-selected")) : (q("[idx='ct0']").addClass("pp-color-thumb-selected"), q(".pp-color-thumb-trans").removeClass("pp-color-thumb-selected"))
        }
    }

    function l(a) {
        q("[idx='ct" + r.runtime.act.sColorOptIndex + "']").removeClass("pp-color-thumb-selected"), r.runtime.act.sColorOptIndex = a, q("[idx='ct" + a + "']").addClass("pp-color-thumb-selected"), u.fire("color-opt-index-changed")
    }

    function m() {
        r.runtime.act.fontColFill = !r.runtime.act.fontColFill, TweenLite.to(q(".pp-color-thumb-switch-tab"), .3, {
            left: r.runtime.act.fontColFill ? 34 : 2,
            ease: Power2.easeOut
        }), k()
    }

    function n(a) {
        r.runtime.act.colorItemMode && -1 != r.runtime.act.sColorOptIndex && q("[idx='ct" + r.runtime.act.sColorOptIndex + "']").css("background-color", new s.ColorData("solid", [a.data]).colors[0].toWebString())
    }
    var o, p, q = a.getGlobal("jQuery"),
        r = a.getGlobalConfig("model"),
        s = a.getGlobal("W2P")["class"],
        t = a.getService("utils"),
        u = a.getGlobalConfig("events");
    return u.on("change-color", n), {
        init: function() {
            o = q(a.getElement()), b()
        },
        behaviors: ["all-behavs"],
        messages: ["change-color-opt-index", "show-custom-color", "add-new-color-btn", "update-ui", "design-loaded", "after-tab-change", "after-panel-change", "page-select-end", "show-color-panel", "attach-color-panel", "toggle-color-font-switch"],
        onmessage: function(a, b) {
            switch (a) {
                case "after-panel-change":
                case "after-tab-change":
                    i(b);
                    break;
                case "attach-color-panel":
                    0 === b.elem.children().length && (b.elem.append(o), o.show(), r.runtime.act.colorItemMode = b.colorItemMode, h());
                    break;
                case "show-custom-color":
                    q("#pp_color_selector").val(r.lib.colors.length - 1), e();
                    break;
                case "add-new-color-btn":
                    g();
                    break;
                case "page-select-end":
                case "design-loaded":
                case "update-ui":
                    h();
                    break;
                case "show-color-panel":
                    j(b);
                    break;
                case "toggle-color-font-switch":
                    m();
                    break;
                case "change-color-opt-index":
                    l(b)
            }
        },
        onchange: function(a, b, c) {
            "change-color-cat" === c && e()
        }
    }
}), Box.Application.addModule("context", function(a) {
    "use strict";

    function b() {
        l = C.create({
            trigger: "click",
            anchor: "t",
            ahide: !1,
            target: D("[data-type='ctx-align']"),
            content: D('<div class="pp-flex-div"><a data-type="align" val="bottom" class="pp-context-btn pp-flex-display"><i class="pp-icon-border_bottom pp-med-icon"></i></a> <a data-type="align" val="top" class="pp-context-btn pp-flex-display"><i class="pp-icon-border_top pp-med-icon"></i></a> <a data-type="align" val="right" class="pp-context-btn pp-flex-display"><i class="pp-icon-border_right pp-med-icon"></i></a> <a data-type="align" val="left" class="pp-context-btn pp-flex-display"><i class="pp-icon-border_left pp-med-icon"></i></a> <a data-type="align" val="vertical" class="pp-context-btn pp-flex-display"><i class="pp-icon-border_vertical pp-med-icon"></i></a> <a data-type="align" val="horizontal" class="pp-context-btn pp-flex-display"><i class="pp-icon-border_horizontal pp-med-icon"></i></a> </div>')
        }), m = C.create({
            trigger: "click",
            anchor: "t",
            ahide: !1,
            target: D("[data-type='ctx-depth']"),
            content: D('<div class="pp-flex-div"><a data-type="depth" val="up" class="pp-context-btn pp-flex-display"><i class="pp-icon-angle-up pp-med-icon"></i></a> <a data-type="depth" val="down" class="pp-context-btn pp-flex-display"><i class="pp-icon-angle-down pp-med-icon"></i></a> <a data-type="depth" val="top" class="pp-context-btn pp-flex-display"><i class="pp-icon-angle-double-up pp-med-icon"></i></a> <a data-type="depth" val="bottom" class="pp-context-btn pp-flex-display"><i class="pp-icon-angle-double-down pp-med-icon"></i></a> </div>')
        }), t = D('<div class="pp-flex-div pp-slider-div" id="pp_font_size_sld_div"></div>').appendTo(j)[0], noUiSlider.create(t, {
            start: 10,
            step: 1,
            range: {
                min: 4,
                max: 100
            }
        }), y = D("[data-type='font-size']"), t.noUiSlider.on("slide", function(a) {
            y.blur(), B.fire("format-text", {
                prop: "size",
                value: parseInt(a[0])
            })
        }), o = C.create({
            trigger: "click",
            anchor: "b",
            ahide: !1,
            target: D(".pp-context-text-size-div"),
            content: D("#pp_font_size_sld_div").detach(),
            show: function() {
                A.runtime.page.cItem && t.noUiSlider.set(A.runtime.page.cItem.getFSize()), x = !0
            },
            hide: function() {
                x = !1
            }
        }), u = D('<div class="pp-flex-div pp-slider-div" id="pp_font_lineheight_sld_div"></div>').appendTo(j)[0], noUiSlider.create(u, {
            start: 1.2,
            step: .1,
            range: {
                min: .2,
                max: 4
            }
        }), u.noUiSlider.on("slide", function(a) {
            B.fire("format-text", {
                prop: "lineSpacing",
                value: parseFloat(a[0])
            })
        }), p = C.create({
            trigger: "click",
            anchor: "b",
            ahide: !1,
            target: D(".pp-context-text-linespacing-div"),
            content: D("#pp_font_lineheight_sld_div").detach(),
            show: function() {
                A.runtime.page.cItem && u.noUiSlider.set(A.runtime.page.cItem.getLineHeight()), x = !0
            },
            hide: function() {
                x = !1
            }
        }), v = D('<div class="pp-flex-div pp-slider-div" id="pp_font_stroke_sld_div"></div>').appendTo(j)[0], noUiSlider.create(v, {
            start: 1,
            step: .5,
            range: {
                min: 0,
                max: 5
            }
        }), v.noUiSlider.on("slide", function(a) {
            B.fire("format-text", {
                prop: "strokeWidth",
                value: parseFloat(a[0])
            })
        }), q = C.create({
            trigger: "click",
            anchor: "b",
            ahide: !1,
            target: D(".pp-context-text-stroke-div"),
            content: D("#pp_font_stroke_sld_div").detach(),
            show: function() {
                A.runtime.page.cItem && v.noUiSlider.set(A.runtime.page.cItem.getStrokeWidth()), x = !0
            },
            hide: function() {
                x = !1
            }
        });
        var a = D('<div data-type="font-clicked" class="pp-font-list-div" id="pp_font_list_div"></div>').appendTo(j),
            b = "";
        A.lib.fonts.forEach(function(a, c) {
            b += '<a class="pp-font-btn-list" ><div val="' + c + '" class="pp-font-list-itm" style="font-family:\'' + a.fontFamily + "' !important\">" + a.fontFamily + "</div></a>"
        }), a.append(b), a.perfectScrollbar({
            suppressScrollX: !0
        }), r = C.create({
            trigger: "click",
            anchor: "l",
            ahide: !1,
            target: D(".pp-context-font"),
            content: a.detach()
        }), s = D(".pp-context-text-editor"), i()
    }

    function c() {
        A.runtime.page.cItem && x && A.runtime.page.cItem instanceof fabric.IText && t.noUiSlider.set(A.runtime.page.cItem.getFSize())
    }

    function d() {
        (A.runtime.page.cItem || A.runtime.page.cItems) && (!A.runtime.page.cItem || A.c.isAdmin || A.runtime.page.cItem.getIsReference() !== !0 && A.runtime.page.cItem.getHideContext() !== !0) && (e(), f(), k || (D(".pp-context-general").css("margin-top", "-70px"), TweenLite.to(j, .1, {
            autoAlpha: 1
        }), TweenLite.to(D(".pp-context-general"), .3, {
            "margin-top": 0,
            ease: Power2.easeOut
        }), w = Date.now(), k = !0, a.broadcast("context-shown")))
    }

    function e(a) {
        if (A.runtime.design.cPage.canvas.getActiveGroup() || A.runtime.design.cPage.canvas.getActiveObject()) {
            var b = z.adjustOffset(D(A.runtime.design.cPage.parent).offset()),
                c = (A.runtime.design.cPage.canvas.getActiveGroup() || A.runtime.design.cPage.canvas.getActiveObject()).getBoundingRect(),
                d = b.top + c.top + c.height + 10,
                e = b.left + c.left - 6;
            d + j.height() > A.runtime.ui.pack.height() && (d = b.top + c.top - j.height() - 5), 0 > d && (d = 0), 0 >= e ? e = 5 : e + j.width() > A.runtime.ui.pack.width() && (e = A.runtime.ui.pack.width() - j.width() - 5), A.runtime.page.cItem && ("image" === A.runtime.page.cItem.type && c.width > 400 && c.height > 200 ? "function" == typeof A.runtime.page.cItem.clipTo && (d = b.top + c.top + c.height / 2 - j.outerHeight() / 2, e = b.left + c.left + c.width / 2 - j.outerWidth() / 2) : "shape" === A.runtime.page.cItem.type ? (c.width > A.runtime.design.cPage.canvas.width - .2 * A.runtime.design.cPage.canvas.width || c.height > A.runtime.design.cPage.canvas.height - .2 * A.runtime.design.cPage.canvas.height) && (d = b.top + c.top + c.height / 2 - j.outerHeight() / 2, e = b.left + c.left + c.width / 2 - j.outerWidth() / 2) : A.runtime.page.cItem instanceof fabric.IText && ("right" === A.runtime.page.cItem.textAlign ? e += c.width - j.width() : "center" === A.runtime.page.cItem.textAlign && (e += (c.width - j.width()) / 2))), parseInt(j.css("top").replace("px", "")) == parseInt(d) && parseInt(j.css("left").replace("px", "")) == parseInt(e) || (a ? TweenLite.to(j, .3, {
                top: d,
                left: e,
                ease: Power2.easeOut
            }) : j.css({
                top: d,
                left: e
            }))
        }
    }

    function f() {
        if (A.runtime.page.cItems.length > 1) {
            D("[data-type='ctx-edit-picture'], [data-type='ctx-toggle-photo-expand'], [data-type='ctx-picture-to-bg'], [data-type='ctx-depth'], [data-type='ctx-ungroup'], [data-type='ctx-edit-group'], .pp-context-text, .pp-context-font, .pp-context-text-format").hide();
            for (var a = !1, b = 0, c = A.runtime.page.cItems.length; c > b; b++)
                if ("textbox" === A.runtime.page.cItems[b].type) {
                    a = !0;
                    break
                }
            a || D("[data-type='ctx-group']").show();
            for (var d = !0, e = A.runtime.design.cPage.canvas.getActiveGroup()._objects, f = 0, c = e.length; c > f; f++) e[f] instanceof fabric.IText || (d = !1);
            d ? D("[data-type='ctx-color']").show() : D("[data-type='ctx-color']").hide()
        } else if (A.runtime.page.cItem) switch (D("[data-type='ctx-edit-picture'], [data-type='ctx-toggle-photo-expand'], [data-type='ctx-picture-to-bg'], [data-type='ctx-ungroup'], [data-type='ctx-edit-group'], .pp-context-text, .pp-context-font, .pp-context-text-format, [data-type='ctx-group']").hide(), D("[data-type='ctx-depth']").show(), A.runtime.page.cItem.type) {
            case "shape":
                A.runtime.page.cItem.fill || A.runtime.page.cItem.paths ? D("[data-type='ctx-color']").show() : D("[data-type='ctx-color']").hide();
                break;
            case "image":
                D("[data-type='ctx-edit-picture'], [data-type='ctx-toggle-photo-expand'], [data-type='ctx-picture-to-bg']").show(), D("[data-type='ctx-color']").hide();
                break;
            case "i-text":
            case "textbox":
                D("[data-type='ctx-color'], .pp-context-text, .pp-context-font, .pp-context-text-format").show(), B.fire("sync-text-props");
                break;
            case "group":
                D("[data-type='ctx-ungroup'], [data-type='ctx-edit-group']").show(), D("[data-type='ctx-group'], [data-type='ctx-color']").hide()
        }
    }

    function g() {
        !n && A.runtime.page.cItem instanceof fabric.IText && (A.runtime.page.cItem.hideContext || (s.show().height(0), D("[data-type='ctx-text-edit']").addClass("pp-btn-greyed"), TweenLite.to(s, .3, {
            height: 85,
            ease: Power2.easeOut,
            delay: .1
        }), D(".pp-text-editor").val(A.runtime.page.cItem.text), n = !0, e(!0)), A.runtime.act.editMode = !0, A.runtime.act.initialText = A.runtime.page.cItem.text, a.broadcast("clear-all-popups"), D(".pp-text-editor").focus())
    }

    function h() {
        D("[data-type='ctx-text-edit']").removeClass("pp-btn-greyed"), TweenLite.to(s, .3, {
            height: 0,
            ease: Power2.easeOut,
            onComplete: function() {
                s.hide()
            }
        }), n = A.runtime.act.editMode = !1
    }

    function i() {
        Date.now() - w < 300 || (h(), TweenLite.to(j, .2, {
            autoAlpha: 0
        }), k = !1, a.broadcast("context-hidden"))
    }
    var j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z = a.getService("utils"),
        A = a.getGlobalConfig("model"),
        B = a.getGlobalConfig("events"),
        C = a.getService("pop-over"),
        D = a.getGlobal("jQuery");
    return {
        init: function() {
            j = D(a.getElement()), b(), TweenLite.to(j, .2, {
                autoAlpha: 0
            })
        },
        behaviors: ["all-behavs"],
        messages: ["context-show", "context-hide", "adjust-layout", "show-text-editor", "context-move", "text-prop-synced", "canvas-text-changed", "text-edited"],
        onmessage: function(a, b) {
            switch (a) {
                case "show-text-editor":
                    g();
                    break;
                case "context-move":
                    e(!0);
                    break;
                case "context-show":
                    d();
                    break;
                case "adjust-layout":
                case "context-hide":
                    i();
                    break;
                case "text-prop-synced":
                    c();
                    break;
                case "canvas-text-changed":
                case "text-edited":
                    var f = z.findItems(b);
                    f.length && f[0] instanceof fabric.IText && D(".pp-text-editor").val(f[0].text), e(!0)
            }
        }
    }
}), Box.Application.addModule("dialog", function(a) {
    "use strict";

    function b(b) {
        g.runtime.ui.pack.block({
            message: d,
            css: {
                padding: "40px 0px",
                margin: "0",
                width: "100%",
                left: "0",
                right: "0",
                height: "180px",
                textAlign: "center",
                backgroundColor: "#000",
                border: "none",
                cursor: "default",
                "z-index": 999999
            },
            overlayCSS: {
                cursor: "default"
            }
        }), e(".pp-dialog-top-right").html(b.text), e(".pp-dialog-top-left").html('<i class="pp-icon-' + f.fetchIcon(b.icon) + '" style="font-size:80px"></i>'), e(".pp-dialog-bottom").html('<div id="pp_dialog_ok" class="pp-dialog-btn pp-flex-display">' + (b.buttons.ok.label ? b.buttons.ok.label : g.lib.lang.button_label_ok) + "</div>" + (b.buttons.middle ? '<div id="pp_dialog_middle" class="pp-dialog-btn pp-flex-display">' + b.buttons.middle.label + "</div>" : "") + (b.buttons.cancel ? '<div id="pp_dialog_cancel" class="pp-dialog-btn pp-flex-display">' + (b.buttons.cancel.label ? b.buttons.cancel.label : g.lib.lang.button_label_cancel) + "</div>" : "")), e("#pp_dialog_ok").bind(W2P.isMobile ? "touchend" : "click", null, "close" === b.buttons.ok.click ? function(b) {
            a.broadcast("dialog-hide")
        } : b.buttons.ok.click), b.buttons.middle && e("#pp_dialog_middle").bind(W2P.isMobile ? "touchend" : "click", null, "close" === b.buttons.middle.click ? function(b) {
            a.broadcast("dialog-hide")
        } : b.buttons.middle.click), b.buttons.cancel && e("#pp_dialog_cancel").bind(W2P.isMobile ? "touchend" : "click", null, "close" === b.buttons.cancel.click ? function(b) {
            a.broadcast("dialog-hide")
        } : b.buttons.cancel.click), d.css("margin-top", "-" + d.outerHeight() / 2 + "px"), a.broadcast("dialog-shown")
    }

    function c() {
        g.runtime.ui.pack.unblock(), a.broadcast("dialog-hidden")
    }
    var d, e = a.getGlobal("jQuery"),
        f = a.getService("utils"),
        g = a.getGlobalConfig("model");
    return {
        init: function() {
            d = e(a.getElement()).remove(), g.runtime.ui.alert = d
        },
        messages: ["dialog-hide", "dialog"],
        onmessage: function(a, d) {
            switch (a) {
                case "dialog-hide":
                    c();
                    break;
                case "dialog":
                    b(d)
            }
        }
    }
}), Box.Application.addModule("flash", function(a) {
    "use strict";

    function b() {
        f.detach().appendTo(j.runtime.ui.container), e()
    }

    function c(a) {
        h(".pp-flash-alert-text").html(a.text || ""), h(".pp-flash-alert-icon").html(a.icon ? '<i class="pp-icon-' + i.fetchIcon(a.icon) + '" style="font-size:40px; opacity:0.8"></i>' : ""), d(), 0 === k && (TweenLite.to(f, .4, {
            autoAlpha: 1,
            ease: Power2.easeOut
        }), g = setInterval(function() {
            k--, 0 === k && (clearInterval(g), e())
        }, a.delay || 500)), k = 1
    }

    function d() {
        f.css({
            left: parseInt((j.runtime.ui.container.width() - f.width()) / 2),
            top: parseInt((j.runtime.ui.container.height() - f.height()) / 2)
        })
    }

    function e() {
        TweenLite.to(f, .4, {
            autoAlpha: 0,
            ease: Power2.easeOut
        }), k = 0
    }
    var f, g, h = a.getGlobal("jQuery"),
        i = a.getService("utils"),
        j = a.getGlobalConfig("model"),
        k = 0;
    return {
        init: function() {
            f = h(a.getElement()), b()
        },
        messages: ["flash-show", "flash-hide"],
        onmessage: function(a, b) {
            switch (a) {
                case "flash-hide":
                    e();
                    break;
                case "flash-show":
                    c(b)
            }
        }
    }
}), Box.Application.addModule("preloader", function(a) {
    "use strict";

    function b() {
        g.runtime.ui.pack.block({
            message: d,
            css: {
                padding: "0",
                margin: "0",
                width: "100%",
                left: "0",
                right: "0",
                top: "0",
                bottom: "0",
                textAlign: "center",
                background: "#FFFFFF",
                border: "none",
                cursor: "default"
            },
            overlayCSS: {
                cursor: "default",
                opacity: 1
            }
        }), setTimeout(function() {
            g.runtime.ui.container.css("opacity", 1)
        }, 300)
    }

    function c() {
        g.runtime.ui.pack.unblock(), f.fire("app-ready")
    }
    var d, e = a.getGlobal("jQuery"),
        f = a.getGlobalConfig("events"),
        g = a.getGlobalConfig("model");
    return {
        init: function() {
            d = e(a.getElement()).detach(), b()
        },
        messages: ["design-loaded"],
        onmessage: function(a, b) {
            switch (a) {
                case "design-loaded":
                    setTimeout(function() {
                        g.runtime.design.cPage && g.runtime.design.cPage.canvas.renderAll(), c()
                    }, 1e3)
            }
        }
    }
}), Box.Application.addModule("preset-form", function(a) {
    "use strict";

    function b() {
        q && (i.css("height", "initial"), i.css("height", (i.outerHeight() > n.runtime.ui.container.height() ? n.runtime.ui.container.height() : i.outerHeight()) + "px"), l("#pp_preset_cont").css("max-height", i.outerHeight() - 110 + "px"), i.css("margin-top", "-" + i.outerHeight() / 2 + "px"))
    }

    function c() {
        j = l(".pp-preset-page-title").detach(), k = l(".pp-preset-page").detach(), i.hide()
    }

    function d() {
        n.runtime.ui.pack.block({
            message: i,
            css: {
                padding: "0",
                margin: "0",
                width: "100%",
                left: "0",
                right: "0",
                top: "0",
                bottom: "0",
                textAlign: "center",
                background: "rgba(0,0,0,1)",
                border: "none",
                cursor: "default"
            },
            overlayCSS: {
                cursor: "default",
                opacity: 1
            }
        });
        var a, c, d, g, h = !1;
        n.runtime.design.pages.forEach(function(b, e) {
            g = [], a = j.clone(), c = k.clone(), c.append(a), a.html(b.pageData.title), d = !1, b.canvas._objects.forEach(function(a) {
                if (a.includeInForm && a.title && !a.isReference && -1 === g.indexOf(a.title)) {
                    switch (a.type) {
                        case "i-text":
                            a.text.indexOf("\n") > -1 ? c.append('<textarea pg="' + e + '" chain="' + (a.chain || "") + '" preset="pitch" id="' + a.reference + '" class="pp-preset-input" placeHolder="' + a.title + '" rows="3" ></textarea>') : c.append('<input pg="' + e + '" chain="' + (a.chain || "") + '" preset="pitch" id="' + a.reference + '" class="pp-preset-input" placeHolder="' + a.title + '" >');
                            break;
                        case "image":
                        case "shape":
                            c.append('<a class="pp-image-thumb-btn pp-preset-upload-div" ><div id="pp_thumb_' + a.reference + '" style="background-size: contain; background-image:url(\'' + (a.url || a.src) + '\')" style="position:relative" class="pp-img-thumb-div"><div class="pp-preset-upload-title">' + a.title + '</div><input chain="' + (a.chain || "") + '" iRef="' + a.reference + '" class="pp-preset-files" type="file" name="files" multiple> </div></a>')
                    }
                    d = !0, h = !0, g.push(a.title)
                }
            }), d && l("#pp_preset_cont").append(c)
        }), q = !0, h ? (e(), b()) : (n.runtime.act.presetFormShown = !0, f())
    }

    function e() {
        l(".pp-preset-files").each(function() {
            var a, b = l(this);
            a = b.attr("iRef"), o.mnml(b, a)
        })
    }

    function f() {
        i.detach(), q && n.runtime.ui.pack.unblock(), m.fire("app-ready")
    }

    function g() {
        var a, b, c, d, e = [],
            g = [];
        l("[preset='pitch']").each(function() {
            a = l(this), "" !== a.attr("placeHolder") && "" !== a.val() && (d = parseInt(a.attr("pg")), b = a.attr("placeHolder"), c = a.attr("chain"), -1 === e.indexOf(b + d) && -1 === g.indexOf(c) && a.val().length && (p.findItems(null, b, d, c).forEach(function(b) {
                b.text = a.val(), b.setCoords()
            }), e.push(b + d), c.length && g.push(c)))
        }), n.runtime.design.cPage.canvas.renderAll(), n.runtime.act.presetFormShown = !0, f()
    }

    function h(a) {
        "string" == typeof a ? l("#pp_thumb_" + a).length && l("#pp_thumb_" + a).css({
            "background-image": "url('https://s3.amazonaws.com/pitchprint.rsc/images/loaders/spinner.svg')",
            "background-size": "initial"
        }).children().hide() : l("#pp_thumb_" + a.id).length && l("#pp_thumb_" + a.id).css({
            "background-image": "url('" + a.url + "')",
            "background-size": "contain"
        }).children().show()
    }
    var i, j, k, l = a.getGlobal("jQuery"),
        m = a.getGlobalConfig("events"),
        n = a.getGlobalConfig("model"),
        o = a.getService("uploader"),
        p = a.getService("utils"),
        q = !1;
    return m.on("show-preset-form", d), {
        init: function() {
            i = l(a.getElement()), c()
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "submit-preview", "upload-add"],
        onmessage: function(a, c) {
            switch (a) {
                case "submit-preview":
                    g();
                    break;
                case "resize":
                    b();
                    break;
                case "hide-preset-form":
                    f();
                    break;
                case "upload-add":
                    h(c)
            }
        }
    }
}), Box.Application.addModule("previews", function(a) {
    "use strict";

    function b() {
        i(".pp-preview-main").css("height", parseInt(l.runtime.ui.pack.height() - i(".pp-preview-top").height())), i(".pp-preview-main").css("width", parseInt(l.runtime.ui.pack.width()))
    }

    function c() {
        l.runtime.ui.pack.unblock(), l.runtime.act.previewShowing = !1
    }

    function d(b) {
        switch (b) {
            case "+":
                if (m === h.length - 1) return;
                m++;
                break;
            case "-":
                m > 0 && m--;
                break;
            default:
                "number" == typeof b && (m = b)
        }
        h[m].previewImage || j.renderPage(h[m]), i(".pp-preview-content-div").empty().append(h[m].previewImage), e(), a.broadcast("preview-page-change", m)
    }

    function e() {
        l.runtime.act.singlePageMode || l.runtime.design.pPages.length < 2 ? i(".pp-preview-navs").hide() : (i(".pp-preview-navs").removeClass("pp-disabled"), 0 === m && i("#pp_preview_prev").addClass("pp-disabled"), m + 1 === h.length && i("#pp_preview_next").addClass("pp-disabled"))
    }

    function f(e, f) {
        a.broadcast("before-preview"), l.runtime.act.overidePreview || (l.runtime.design.pPages = l.runtime.act.singlePageMode ? [l.runtime.design.cPage] : l.runtime.design.pages, a.broadcast("preview-start"), h = l.runtime.design.pPages, h.length ? (k.fire("select-page", l.runtime.design.dPage), l.runtime.ui.pack.block({
            message: g,
            css: {
                padding: "0",
                margin: "0",
                width: "100%",
                left: "0",
                right: "0",
                top: "0",
                bottom: "0",
                textAlign: "center",
                background: f ? "rgb(222, 222, 222)" : "rgba(0,0,0,1)",
                border: "none",
                cursor: "default",
                "z-index": 999999
            },
            overlayCSS: {
                cursor: "default",
                opacity: 1
            }
        }), h.forEach(function(a) {
            delete a.previewImage
        }), l.runtime.act.previewShowing = !0, a.broadcast("preview-shown"), m = 0, d(m), e ? (i(".pp-preview-msg, [data-type='preview-submit']").show(), i(".pp-preview-msg").html(l.lib.lang.finish_message)) : i(".pp-preview-msg, [data-type='preview-submit']").hide(), f ? i(".pp-preview-top").hide() : i(".pp-preview-top").show(), b()) : c())
    }
    var g, h, i = a.getGlobal("jQuery"),
        j = (a.getService("utils"), a.getService("renders")),
        k = a.getGlobalConfig("events"),
        l = a.getGlobalConfig("model"),
        m = 0;
    return {
        init: function() {
            g = i(a.getElement()).detach()
        },
        behaviors: ["all-behavs"],
        messages: ["resize", "show-preview", "hide-preview", "select-preview", "show-preview-closed"],
        onmessage: function(a, e) {
            switch (a) {
                case "select-preview":
                    d(e);
                    break;
                case "resize":
                    b();
                    break;
                case "show-preview":
                    f(e);
                    break;
                case "hide-preview":
                    c();
                    break;
                case "show-preview-closed":
                    f(!1, !0)
            }
        }
    }
}), Box.Application.addModule("tool-opacity", function(a) {
    "use strict";

    function b() {
        i && l.fire("opacity-change", {
            target: i.attr("target"),
            value: h.noUiSlider.get()
        })
    }

    function c(a) {
        h.noUiSlider.set(a)
    }

    function d() {
        l.fire("opacity-shown", i.attr("target"))
    }

    function e() {
        h = a.getElement(), noUiSlider.create(h, {
            start: 1,
            step: .1,
            range: {
                min: 0,
                max: 1
            }
        }), k.runtime.ui.opacityTool = a.getService("pop-over").create({
            trigger: "click",
            anchor: "t",
            content: g.detach(),
            ahide: !1,
            show: d
        }), h.noUiSlider.on("slide", b)
    }

    function f(a) {
        if (i = a.target, k.runtime.ui.opacityTool.forceShow(i, a.anchor, a.point), k.runtime.ui.opacityTool.target.addClass("pp-btn-selected-hot"), "cItem" === i.attr("target") && k.runtime.page.cItems.length) {
            var b = k.runtime.design.cPage.canvas.getActiveObject() || k.runtime.design.cPage.canvas.getActiveGroup();
            c(b.getOpacity())
        }
    }
    var g, h, i, j = a.getGlobal("jQuery"),
        k = a.getGlobalConfig("model"),
        l = a.getGlobalConfig("events");
    return {
        init: function() {
            g = j(a.getElement()), e()
        },
        behaviors: ["all-behavs"],
        messages: ["show-opacity-tool", "opacity-set-slider"],
        onmessage: function(a, b) {
            switch (a) {
                case "show-opacity-tool":
                    f(b);
                    break;
                case "opacity-set-slider":
                    c(b)
            }
        }
    }
});
var W2P = W2P || {},
    PPR = Box.Application;
WEB2PRINT = W2P, W2P.version = "8.2.0",
    function(a) {
        "use strict";
        if (!jQuery) throw new Error("jQuery required for PitchPrint!");
        a.$ || (a.$ = jQuery);
        var b, c, d, e, f, g, h = a.W2P,
            i = jQuery;
        h.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent), h.designer = function(j) {
            return h.designer.prototype._singletonInstance ? h.designer.prototype._singletonInstance : (h.designer.prototype._singletonInstance = this, h.MODEL = {
                c: {
                    apiKey: j.apiKey,
                    lang: j.lang,
                    appApiUrl: j.appApiUrl || j.globalUrlPrefix,
                    designId: j.designId || j.designid,
                    projectId: j.projectId || j.projectid || j.projectID,
                    userId: j.userId || j.userID || "guest",
                    product: j.product || "",
                    autoSave: j.autoSave,
                    designDetails: j.designDetails || j.design || "",
                    isDesign: j.isDesign || !1,
                    designCat: j.designCat,
                    rscBase: j.rscBase,
                    parentDiv: j.parentDiv,
                    mode: j.mode.substr(0, 4).toLowerCase() || "",
                    autoShow: "undefined" == typeof j.autoShow ? !0 : j.autoShow,
                    autoInitialize: "undefined" == typeof j.autoInitialize ? !0 : j.autoInitialize,
                    isUserProject: j.isUserProject || ("undefined" == typeof j.isUserproject ? !1 : j.isUserproject),
                    isAdmin: j.isAdmin && (j.isDesign || j.isUserproject) || !1,
                    langCode: j.langCode || ("object" == typeof j.language ? j.language._id : j.language || "en"),
                    currentDesign: "new" === j.mode && j.isDesign ? "" : j.designId || j.designid,
                    libCache: [],
                    hoverAlpha: .3,
                    thumbResolution: 92,
                    screenDPI: 72,
                    version: h.version,
                    client: j.client || "custom",
                    design: j.design,
                    designFolder: j.designFolder,
                    staging: j.staging || !1,
                    userData: j.userData
                },
                functions: {
                    onReady: j.onReady,
                    onSaveButtonClicked: j.onSaveButtonClicked,
                    onSave: j.onSave,
                    onShown: j.onShown,
                    onClose: j.onClose,
                    onError: j.onError,
                    onLibReady: j.onLibReady,
                    onResourceLoaded: j.onResourceLoaded || j.resource_loaded_fnc,
                    onValidation: j.onValidation || j.validationComplete,
                    onLanguageLoaded: j.onLanguageLoaded,
                    onCaUpdate: j.onCaUpdate,
                    onDesignLoaded: j.onDesignLoaded
                },
                runtime: {
                    act: {
                        dragging: !1,
                        dropTarget: null,
                        globalLoadItems: {},
                        shown: !1,
                        libLoaded: !1,
                        colorItemMode: !1,
                        utilCounter: 0,
                        popStack: [],
                        snapOff: !1,
                        presetFormShown: !1,
                        appReady: !1,
                        grouping: {}
                    },
                    ui: {
                        currentPanel: null,
                        panelShowing: !0,
                        currentPanelBtn: null,
                        colorPickerShowing: !1,
                        panelShown: !0,
                        config: {
                            topHeight: 50,
                            bottomHeight: 50,
                            maxi: !0,
                            leftPanelWidth: 360,
                            forceHidePanel: !1
                        },
                        panels: {},
                        tabs: {},
                        mods: {},
                        stage: {}
                    },
                    modules: {},
                    page: {},
                    design: {
                        defaultTab: "bg-colors",
                        dPage: 0
                    },
                    apiUrl: {
                        facebook: "https://www.facebook.com/dialog/oauth",
                        instagram: "https://api.instagram.com/oauth/authorize/",
                        pixabay: "//pixabay.com/api/"
                    }
                },
                server: {},
                lib: {}
            }, f = new Box.EventTarget, h.MODEL.runtime.ui.config.maxi = (jQuery(h.MODEL.c.parentDiv).length ? jQuery(h.MODEL.c.parentDiv).width() : jQuery(window).width()) >= 1e3, h.MODEL.runtime.ui.hideFlaps = !h.MODEL.runtime.ui.config.maxi, window.onresize = function() {
                h.MODEL.runtime.ui.config.maxi = (jQuery(h.MODEL.c.parentDiv).length ? jQuery(h.MODEL.c.parentDiv).width() : jQuery(window).width()) >= 1e3, h.MODEL.runtime.ui.hideFlaps = !h.MODEL.runtime.ui.config.maxi, h.MODEL.runtime.ui.container && !jQuery(h.MODEL.c.parentDiv).length && h.MODEL.runtime.ui.container.css({
                    width: window.innerWidth,
                    height: window.innerHeight
                }), PPR.broadcast("resize"), f.fire("resize")
            }, i(document).on("dragstart", function(a) {
                return i(a.target).attr("urldata") ? void f.fire("start-item-drag", a) : !1
            }), i(document).on("dragend", function(a) {
                return f.fire("end-item-drag", a), !1
            }), i(document).on("drop", function(a) {
                return !1
            }), window.onfocus = function() {
                f.fire("window-focused")
            }, PPR.init({
                debug: !1,
                model: h.MODEL,
                events: f
            }), c = PPR.getService("utils"), d = PPR.getService("comm"), e = PPR.getService("pages"), b = PPR.getService("actions"), g = PPR.getService("designs"), a.W2P["class"] || (a.W2P["class"] = {}), a.W2P.services || (a.W2P.services = {}), h["class"].utils = c, h.services.pages = e, b.start(), void console.info(h.version))
        }, h.designer.prototype.close = function(a) {
            f.fire("close-app", a)
        }, h.designer.prototype.resume = function() {
            f.fire("resume-app")
        }, h.designer.prototype.show = function(a) {
            f.fire("show-editor", a)
        }, h.designer.prototype.loadDesign = function(a) {
            return a ? g.loadDesign(a) : void 0
        }, h.designer.prototype.getModel = function() {
            return h.MODEL
        }, h.designer.prototype.loadLib = function() {
            return d.loadLib()
        }, h.designer.prototype.showModal = function(a) {
            a && PPR.broadcast("alert-modal", a)
        }, h.designer.prototype.newPage = function(a, b, c) {
            a && f.fire("new-page", {
                w: a,
                h: b,
                t: c
            })
        }, h.designer.prototype.selectPage = function(a) {
            a && f.fire("select-page", parseInt(a))
        }, h.designer.prototype.deletePage = function(a) {
            f.fire("remove-page", parseInt(a))
        }, h.designer.prototype.getPageAt = function(a) {
            return "number" == typeof a ? h.MODEL.runtime.pages[a] : void 0
        }, h.designer.prototype.getPages = function() {
            return h.MODEL.runtime.pages
        }, h.designer.prototype.showPreview = function(a) {
            PPR.broadcast("show-preview", a)
        }, h.designer.prototype.swapDimensions = function() {
            f.fire("page-swap-dimension")
        }, h.designer.prototype.getPdfDownload = function() {
            return h.MODEL.lib.project ? h.MODEL.lib.project.pdfDownload : h.MODEL.lib.design ? h.MODEL.lib.design.pdfDownload : h.MODEL.runtime.design ? h.MODEL.runtime.design.pdfDownload : !1
        }
    }(this);
